<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="AugmentWebviewStateStore">
    <option name="stateMap">
      <map>
        <entry key="CHAT_STATE" value="eyJjdXJyZW50Q29udmVyc2F0aW9uSWQiOiI5ZmQ5MjRmOC02NjAyLTQzNmUtYmI4Yi1mNDUzY2Y3NTdhZGQiLCJjb252ZXJzYXRpb25zIjp7IjI0NTg1ZTlmLTc3YzgtNGJhYi05MWVjLTA3MTNjNjU0OTllOSI6eyJpZCI6IjI0NTg1ZTlmLTc3YzgtNGJhYi05MWVjLTA3MTNjNjU0OTllOSIsIm5hbWUiOiJXZWxjb21lIHRvIEF1Z21lbnQiLCJjcmVhdGVkQXRJc28iOiIyMDI1LTA1LTA2VDExOjAzOjA1LjE3NVoiLCJsYXN0SW50ZXJhY3RlZEF0SXNvIjoiMjAyNS0wNS0wNlQxMTowMzowNS4xNzVaIiwiY2hhdEhpc3RvcnkiOlt7ImNoYXRJdGVtVHlwZSI6ImVkdWNhdGUtZmVhdHVyZXMiLCJyZXF1ZXN0X2lkIjoiYThmYTM2OWEtZTg5My00NzY3LThjZGUtZDAxNmE1MzE1NjI3Iiwic2Vlbl9zdGF0ZSI6InNlZW4ifV0sImZlZWRiYWNrU3RhdGVzIjp7fSwidG9vbFVzZVN0YXRlcyI6e30sImRyYWZ0RXhjaGFuZ2UiOnsicmVxdWVzdF9tZXNzYWdlIjoiIiwicmljaF90ZXh0X2pzb25fcmVwciI6eyJ0eXBlIjoiZG9jIiwiY29udGVudCI6W3sidHlwZSI6InBhcmFncmFwaCJ9XX0sInN0YXR1cyI6ImRyYWZ0In0sImRyYWZ0QWN0aXZlQ29udGV4dElkcyI6WyJDOi9Vc2Vycy9wcmluY2lwL0Rlc2t0b3AvamF2YS1rZXNoZS9qYXZhLXNlcnZlci9zcmMvbWFpbi9qYXZhL2NuL2VkdS9zZHUvamF2YS9zZXJ2ZXIvc2VydmljZXMvVGVhY2hlclNlcnZpY2VzLmphdmEiLCJDOi9Vc2Vycy9wcmluY2lwL0Rlc2t0b3AvamF2YS1rZXNoZS9qYXZhLXNlcnZlcmZhbHNlZmFsc2UiXSwicmVxdWVzdElkcyI6W10sImlzUGlubmVkIjpmYWxzZSwiaXNTaGFyZWFibGUiOmZhbHNlLCJleHRyYURhdGEiOnsiaGFzRGlydHlFZGl0cyI6ZmFsc2V9fSwiOWZkOTI0ZjgtNjYwMi00MzZlLWJiOGItZjQ1M2NmNzU3YWRkIjp7ImlkIjoiOWZkOTI0ZjgtNjYwMi00MzZlLWJiOGItZjQ1M2NmNzU3YWRkIiwibmFtZSI6IldlbGNvbWUgdG8gdGhlIEF1Z21lbnQgQWdlbnQiLCJjcmVhdGVkQXRJc28iOiIyMDI1LTA1LTA2VDExOjM5OjIxLjYyNloiLCJsYXN0SW50ZXJhY3RlZEF0SXNvIjoiMjAyNS0wNS0xNlQxNTozMjo1OC41MjVaIiwiY2hhdEhpc3RvcnkiOlt7InJlcXVlc3RfaWQiOiI4M2YwNzNmYy01YTMwLTQzNGUtYTljZC0zMGU1OWExMmFmYzgiLCJ1dWlkIjoiZWM5Njc0NjUtZDQ3OC00NjNjLTlkYjEtZTMxMDEzOGMyYTYzIiwiY2hhdEl0ZW1UeXBlIjoiYWdlbnRpYy1jaGVja3BvaW50LWRlbGltaXRlciIsInN0YXR1cyI6InN1Y2Nlc3MiLCJmcm9tVGltZXN0YW1wIjowLCJ0b1RpbWVzdGFtcCI6MTc0NjUzMTU2MTYyNywic2Vlbl9zdGF0ZSI6InNlZW4ifSx7InN0YXR1cyI6InN1Y2Nlc3MiLCJyZXF1ZXN0X2lkIjoiNDc3NGU5OTctYWNmYS00ZDlkLWJhYTMtY2I4ZDBjN2E3ZGUxIiwicmVxdWVzdF9tZXNzYWdlIjoiXG5cblxuXG4iLCJyaWNoX3RleHRfanNvbl9yZXByIjp7InR5cGUiOiJkb2MiLCJjb250ZW50IjpbeyJ0eXBlIjoicGFyYWdyYXBoIn0seyJ0eXBlIjoiaW1hZ2UiLCJhdHRycyI6eyJzcmMiOiJlZWE4ZmFmYmU2M2RmOGIzYWM5ODlhYWJlMzg1NGE4NGViMjUxYzNiYjAyN2U0NjZkNGEwZDlkZTVhZDUxZjVhLnBuZyIsImFsdCI6bnVsbCwidGl0bGUiOiJpbWFnZS5wbmciLCJyZW5kZXJNb2RlIjoiY29sbGFwc2VkIiwiaXNMb2FkaW5nIjpmYWxzZX19LHsidHlwZSI6InBhcmFncmFwaCJ9XX0sIm1lbnRpb25lZF9pdGVtcyI6W10sInN0cnVjdHVyZWRfb3V0cHV0X25vZGVzIjpbeyJpZCI6MCwidHlwZSI6MCwiY29udGVudCI6Ikkgbm90aWNlIHRoYXQgeW91IGhhdmVuJ3QgcHJvdmlkZWQgYSBzcGVjaWZpYyByZXF1ZXN0LiBJIGNhbiBzZWUgdGhhdCB5b3UgaGF2ZSB0aGUgZmlsZSBgamF2YS1zZXJ2ZXIvc3JjL21haW4vamF2YS9jbi9lZHUvc2R1L2phdmEvc2VydmVyL3NlcnZpY2VzL1RlYWNoZXJTZXJ2aWNlcy5qYXZhYCBvcGVuLiBcblxuV291bGQgeW91IGxpa2UgbWUgdG86XG4xLiBFeGFtaW5lIHRoaXMgZmlsZSB0byB1bmRlcnN0YW5kIGl0cyBjb250ZW50cz9cbjIuIEhlbHAgeW91IG1ha2UgY2hhbmdlcyB0byB0aGlzIGZpbGU/XG4zLiBBc3Npc3Qgd2l0aCBzb21ldGhpbmcgZWxzZSByZWxhdGVkIHRvIHlvdXIgcHJvamVjdD9cblxuUGxlYXNlIGxldCBtZSBrbm93IHdoYXQgeW91J2QgbGlrZSBoZWxwIHdpdGgsIGFuZCBJJ2xsIGJlIGhhcHB5IHRvIGFzc2lzdC5cbiJ9LHsiaWQiOjIsInR5cGUiOjIsImNvbnRlbnQiOiIifSx7ImlkIjozLCJ0eXBlIjozLCJjb250ZW50IjoiIn1dLCJzZWVuX3N0YXRlIjoic2VlbiIsInN0cnVjdHVyZWRfcmVxdWVzdF9ub2RlcyI6W3siaWQiOjAsInR5cGUiOjMsImltYWdlX2lkX25vZGUiOnsiaW1hZ2VfaWQiOiJlZWE4ZmFmYmU2M2RmOGIzYWM5ODlhYWJlMzg1NGE4NGViMjUxYzNiYjAyN2U0NjZkNGEwZDlkZTVhZDUxZjVhLnBuZyIsImZvcm1hdCI6MX19LHsiaWQiOjEsInR5cGUiOjAsInRleHRfbm9kZSI6eyJjb250ZW50IjoiXG5cblxuXG4ifX0seyJpZCI6MiwidHlwZSI6NCwiaWRlX3N0YXRlX25vZGUiOnsid29ya3NwYWNlRm9sZGVycyI6W3sicmVwb3NpdG9yeVJvb3QiOiJDOi9Vc2Vycy9wcmluY2lwL0RvY3VtZW50cy9HaXRIdWIvYmFpY2FpL2phdmEtc2VydmVyIiwiZm9sZGVyUm9vdCI6IkM6L1VzZXJzL3ByaW5jaXAvRG9jdW1lbnRzL0dpdEh1Yi9iYWljYWkvamF2YS1zZXJ2ZXIifV0sIndvcmtzcGFjZUZvbGRlcnNVbmNoYW5nZWQiOmZhbHNlfX1dLCJ0aW1lc3RhbXAiOiIyMDI1LTA1LTE2VDE1OjAzOjE3LjYxNFoiLCJyZXNwb25zZV90ZXh0IjoiSSBub3RpY2UgdGhhdCB5b3UgaGF2ZW4ndCBwcm92aWRlZCBhIHNwZWNpZmljIHJlcXVlc3QuIEkgY2FuIHNlZSB0aGF0IHlvdSBoYXZlIHRoZSBmaWxlIGBqYXZhLXNlcnZlci9zcmMvbWFpbi9qYXZhL2NuL2VkdS9zZHUvamF2YS9zZXJ2ZXIvc2VydmljZXMvVGVhY2hlclNlcnZpY2VzLmphdmFgIG9wZW4uIFxuXG5Xb3VsZCB5b3UgbGlrZSBtZSB0bzpcbjEuIEV4YW1pbmUgdGhpcyBmaWxlIHRvIHVuZGVyc3RhbmQgaXRzIGNvbnRlbnRzP1xuMi4gSGVscCB5b3UgbWFrZSBjaGFuZ2VzIHRvIHRoaXMgZmlsZT9cbjMuIEFzc2lzdCB3aXRoIHNvbWV0aGluZyBlbHNlIHJlbGF0ZWQgdG8geW91ciBwcm9qZWN0P1xuXG5QbGVhc2UgbGV0IG1lIGtub3cgd2hhdCB5b3UnZCBsaWtlIGhlbHAgd2l0aCwgYW5kIEknbGwgYmUgaGFwcHkgdG8gYXNzaXN0LlxuIiwid29ya3NwYWNlX2ZpbGVfY2h1bmtzIjpbXX0seyJyZXF1ZXN0X2lkIjoiMDdmYjBiNjktYzIyNi00MDcyLThhMmEtYjU5MmM4NGYxMWQwIiwic3RhdHVzIjoiY2FuY2VsbGVkIiwiY2hhdEl0ZW1UeXBlIjoiYWdlbnRpYy10dXJuLWRlbGltaXRlciJ9LHsic3RhdHVzIjoic3VjY2VzcyIsInJlcXVlc3RfaWQiOiI4MTJlOTgyYi04OGJlLTRjYTMtYTM0Yi1jYzU5Y2UyZmE4Y2UiLCJyZXF1ZXN0X21lc3NhZ2UiOiLkvb/nlKjkuK3mloflm57lpI0iLCJyaWNoX3RleHRfanNvbl9yZXByIjp7InR5cGUiOiJkb2MiLCJjb250ZW50IjpbeyJ0eXBlIjoicGFyYWdyYXBoIiwiY29udGVudCI6W3sidHlwZSI6InRleHQiLCJ0ZXh0Ijoi5L2/55So5Lit5paH5Zue5aSNIn1dfV19LCJtZW50aW9uZWRfaXRlbXMiOltdLCJzdHJ1Y3R1cmVkX291dHB1dF9ub2RlcyI6W3siaWQiOjAsInR5cGUiOjAsImNvbnRlbnQiOiLmiJHms6jmhI/liLDmgqjmraPlnKjmn6XnnIsgYGphdmEtc2VydmVyL3NyYy9tYWluL2phdmEvY24vZWR1L3NkdS9qYXZhL3NlcnZlci9zZXJ2aWNlcy9UZWFjaGVyU2VydmljZXMuamF2YWAg5paH5Lu277yM5bm25LiU5oKo55qE5oiq5Zu+5pi+56S65LqG5LiA5Liq57G75Z6L6L2s5o2i6ZSZ6K+v77yaXG5cblwiY2xhc3MgamF2YS5sYW5nLkRvdWJsZSBjYW5ub3QgYmUgY2FzdCB0byBjbGFzcyBqYXZhLmxhbmcuSW50ZWdlciAoamF2YS5sYW5nLkRvdWJsZSBhbmQgamF2YS5sYW5nLkludGVnZXIgLi4uKVwiXG5cbui/meaYr+S4gOS4quW4uOingeeahCBKYXZhIOexu+Wei+i9rOaNoumUmeivr++8jOihqOekuuS7o+eggeS4reWwneivleWwhiBEb3VibGUg57G75Z6L55u05o6l6L2s5o2i5Li6IEludGVnZXIg57G75Z6L77yM6L+Z5ZyoIEphdmEg5Lit5piv5LiN5YWB6K6455qE44CCXG5cbuaIkeWPr+S7peW4ruaCqO+8mlxuMS4g5p+l55yL55u45YWz5Luj56CB5bm25om+5Ye66ZSZ6K+vXG4yLiDmj5Dkvpvkv67lpI3mlrnmoYhcbjMuIOino+mHiuWmguS9leato+ehruWcsOWcqCBEb3VibGUg5ZKMIEludGVnZXIg5LmL6Ze06L+b6KGM6L2s5o2iXG5cbuivt+WRiuivieaIkeaCqOW4jOacm+aIkeWmguS9leW4ruWKqeaCqOino+WGs+i/meS4qumXrumimO+8n1xuIn0seyJpZCI6MiwidHlwZSI6MiwiY29udGVudCI6IiJ9LHsiaWQiOjMsInR5cGUiOjMsImNvbnRlbnQiOiIifSx7ImlkIjowLCJ0eXBlIjo2LCJjb250ZW50Ijoie1wibWVtb3JpZXNSZXF1ZXN0SWRcIjpcImViMTVlMThjLWFhNjAtNDVlMi1hMzZhLTA4ZmM3MzE4Yzc4NVwiLFwibWVtb3J5XCI6XCJVc2VyIHByZWZlcnMgY29tbXVuaWNhdGlvbiBpbiBDaGluZXNlIGxhbmd1YWdlLlwifSJ9XSwic2Vlbl9zdGF0ZSI6InNlZW4iLCJzdHJ1Y3R1cmVkX3JlcXVlc3Rfbm9kZXMiOlt7ImlkIjowLCJ0eXBlIjowLCJ0ZXh0X25vZGUiOnsiY29udGVudCI6IuS9v+eUqOS4reaWh+WbnuWkjSJ9fSx7ImlkIjoxLCJ0eXBlIjo0LCJpZGVfc3RhdGVfbm9kZSI6eyJ3b3Jrc3BhY2VGb2xkZXJzIjpbeyJyZXBvc2l0b3J5Um9vdCI6IkM6L1VzZXJzL3ByaW5jaXAvRG9jdW1lbnRzL0dpdEh1Yi9iYWljYWkvamF2YS1zZXJ2ZXIiLCJmb2xkZXJSb290IjoiQzovVXNlcnMvcHJpbmNpcC9Eb2N1bWVudHMvR2l0SHViL2JhaWNhaS9qYXZhLXNlcnZlciJ9XSwid29ya3NwYWNlRm9sZGVyc1VuY2hhbmdlZCI6ZmFsc2V9fV0sInRpbWVzdGFtcCI6IjIwMjUtMDUtMTZUMTU6MDM6NTEuMDc0WiIsInJlc3BvbnNlX3RleHQiOiLmiJHms6jmhI/liLDmgqjmraPlnKjmn6XnnIsgYGphdmEtc2VydmVyL3NyYy9tYWluL2phdmEvY24vZWR1L3NkdS9qYXZhL3NlcnZlci9zZXJ2aWNlcy9UZWFjaGVyU2VydmljZXMuamF2YWAg5paH5Lu277yM5bm25LiU5oKo55qE5oiq5Zu+5pi+56S65LqG5LiA5Liq57G75Z6L6L2s5o2i6ZSZ6K+v77yaXG5cblwiY2xhc3MgamF2YS5sYW5nLkRvdWJsZSBjYW5ub3QgYmUgY2FzdCB0byBjbGFzcyBqYXZhLmxhbmcuSW50ZWdlciAoamF2YS5sYW5nLkRvdWJsZSBhbmQgamF2YS5sYW5nLkludGVnZXIgLi4uKVwiXG5cbui/meaYr+S4gOS4quW4uOingeeahCBKYXZhIOexu+Wei+i9rOaNoumUmeivr++8jOihqOekuuS7o+eggeS4reWwneivleWwhiBEb3VibGUg57G75Z6L55u05o6l6L2s5o2i5Li6IEludGVnZXIg57G75Z6L77yM6L+Z5ZyoIEphdmEg5Lit5piv5LiN5YWB6K6455qE44CCXG5cbuaIkeWPr+S7peW4ruaCqO+8mlxuMS4g5p+l55yL55u45YWz5Luj56CB5bm25om+5Ye66ZSZ6K+vXG4yLiDmj5Dkvpvkv67lpI3mlrnmoYhcbjMuIOino+mHiuWmguS9leato+ehruWcsOWcqCBEb3VibGUg5ZKMIEludGVnZXIg5LmL6Ze06L+b6KGM6L2s5o2iXG5cbuivt+WRiuivieaIkeaCqOW4jOacm+aIkeWmguS9leW4ruWKqeaCqOino+WGs+i/meS4qumXrumimO+8n1xuIiwid29ya3NwYWNlX2ZpbGVfY2h1bmtzIjpbXX0seyJyZXF1ZXN0X2lkIjoiMjcxMzY0NDUtMGM1NC00Yjc4LWFmNzctNmE5NjMyZTYzMGQwIiwic3RhdHVzIjoiY2FuY2VsbGVkIiwiY2hhdEl0ZW1UeXBlIjoiYWdlbnRpYy10dXJuLWRlbGltaXRlciJ9LHsic3RhdHVzIjoic3VjY2VzcyIsInJlcXVlc3RfaWQiOiI1MWUzNjI4Yi0zZjMzLTQ4ZDItOGQ5Zi01OTg3OGY1MDE5NTMiLCJyZXF1ZXN0X21lc3NhZ2UiOiIxIiwicmljaF90ZXh0X2pzb25fcmVwciI6eyJ0eXBlIjoiZG9jIiwiY29udGVudCI6W3sidHlwZSI6InBhcmFncmFwaCIsImNvbnRlbnQiOlt7InR5cGUiOiJ0ZXh0IiwidGV4dCI6IjEifV19XX0sIm1lbnRpb25lZF9pdGVtcyI6W10sInN0cnVjdHVyZWRfb3V0cHV0X25vZGVzIjpbeyJpZCI6MSwidHlwZSI6NSwiY29udGVudCI6IiIsInRvb2xfdXNlIjp7InRvb2xfdXNlX2lkIjoidG9vbHVfdnJ0eF8wMVdzTURyclY5dXFMS0NQbWJkV2p0bW4iLCJ0b29sX25hbWUiOiJzdHItcmVwbGFjZS1lZGl0b3IiLCJpbnB1dF9qc29uIjoie1wiY29tbWFuZFwiOiBcInZpZXdcIiwgXCJwYXRoXCI6IFwiamF2YS1zZXJ2ZXIvc3JjL21haW4vamF2YS9jbi9lZHUvc2R1L2phdmEvc2VydmVyL3NlcnZpY2VzL1RlYWNoZXJTZXJ2aWNlcy5qYXZhXCJ9IiwibWNwX3NlcnZlcl9uYW1lIjoiIiwibWNwX3Rvb2xfbmFtZSI6IiJ9fSx7ImlkIjowLCJ0eXBlIjowLCJjb250ZW50Ijoi5aW955qE77yM5oiR5bCG5p+l55yL55u45YWz5Luj56CB5bm25om+5Ye66ZSZ6K+v44CC6aaW5YWI77yM6K6p5oiR5qOA5p+lIGBUZWFjaGVyU2VydmljZXMuamF2YWAg5paH5Lu255qE5YaF5a6577yM55yL55yL5piv5ZCm6IO95om+5Yiw5Y+v6IO95a+86Ie0IERvdWJsZSDliLAgSW50ZWdlciDnsbvlnovovazmjaLplJnor6/nmoTku6PnoIHjgIJcbiJ9LHsiaWQiOjIsInR5cGUiOjIsImNvbnRlbnQiOiIifSx7ImlkIjozLCJ0eXBlIjozLCJjb250ZW50IjoiIn1dLCJzZWVuX3N0YXRlIjoic2VlbiIsInN0cnVjdHVyZWRfcmVxdWVzdF9ub2RlcyI6W3siaWQiOjAsInR5cGUiOjAsInRleHRfbm9kZSI6eyJjb250ZW50IjoiMSJ9fSx7ImlkIjoxLCJ0eXBlIjo0LCJpZGVfc3RhdGVfbm9kZSI6eyJ3b3Jrc3BhY2VGb2xkZXJzIjpbeyJyZXBvc2l0b3J5Um9vdCI6IkM6L1VzZXJzL3ByaW5jaXAvRG9jdW1lbnRzL0dpdEh1Yi9iYWljYWkvamF2YS1zZXJ2ZXIiLCJmb2xkZXJSb290IjoiQzovVXNlcnMvcHJpbmNpcC9Eb2N1bWVudHMvR2l0SHViL2JhaWNhaS9qYXZhLXNlcnZlciJ9XSwid29ya3NwYWNlRm9sZGVyc1VuY2hhbmdlZCI6ZmFsc2V9fV0sInRpbWVzdGFtcCI6IjIwMjUtMDUtMTZUMTU6MDQ6NDAuMjExWiIsInJlc3BvbnNlX3RleHQiOiLlpb3nmoTvvIzmiJHlsIbmn6XnnIvnm7jlhbPku6PnoIHlubbmib7lh7rplJnor6/jgILpppblhYjvvIzorqnmiJHmo4Dmn6UgYFRlYWNoZXJTZXJ2aWNlcy5qYXZhYCDmlofku7bnmoTlhoXlrrnvvIznnIvnnIvmmK/lkKbog73mib7liLDlj6/og73lr7zoh7QgRG91YmxlIOWIsCBJbnRlZ2VyIOexu+Wei+i9rOaNoumUmeivr+eahOS7o+eggeOAglxuIiwid29ya3NwYWNlX2ZpbGVfY2h1bmtzIjpbXX0seyJzdGF0dXMiOiJzdWNjZXNzIiwicmVxdWVzdF9pZCI6ImVmM2RiMjQyLWY2ZDQtNDM2Ny1iMWQ5LWI1OTBjMjVkNjU3MSIsInJlcXVlc3RfbWVzc2FnZSI6IiIsInN0cnVjdHVyZWRfb3V0cHV0X25vZGVzIjpbeyJpZCI6MSwidHlwZSI6NSwiY29udGVudCI6IiIsInRvb2xfdXNlIjp7InRvb2xfdXNlX2lkIjoidG9vbHVfdnJ0eF8wMVNVNE1iSzV4NWN5eG5jNnRRMkJWTVciLCJ0b29sX25hbWUiOiJjb2RlYmFzZS1yZXRyaWV2YWwiLCJpbnB1dF9qc29uIjoie1wiaW5mb3JtYXRpb25fcmVxdWVzdFwiOiBcIlxcdTY3ZTVcXHU2MjdlIFRlYWNoZXJTZXJ2aWNlcy5qYXZhIFxcdTY1ODdcXHU0ZWY2XFx1NzY4NFxcdTUxODVcXHU1YmI5XFx1ZmYwY1xcdTcyNzlcXHU1MjJiXFx1NjYyZlxcdTUzZWZcXHU4MGZkXFx1NmQ4OVxcdTUzY2EgRG91YmxlIFxcdTUyMzAgSW50ZWdlciBcXHU3YzdiXFx1NTc4YlxcdThmNmNcXHU2MzYyXFx1NzY4NFxcdTRlZTNcXHU3ODAxXCJ9IiwibWNwX3NlcnZlcl9uYW1lIjoiIiwibWNwX3Rvb2xfbmFtZSI6IiJ9fSx7ImlkIjowLCJ0eXBlIjowLCJjb250ZW50Ijoi6K6p5oiR5bCd6K+V5L2/55So5Luj56CB5bqT5qOA57Si5bel5YW35p2l5p+l5om+55u45YWz5Luj56CB77yaXG4ifSx7ImlkIjoyLCJ0eXBlIjoyLCJjb250ZW50IjoiIn0seyJpZCI6MywidHlwZSI6MywiY29udGVudCI6IiJ9XSwic2Vlbl9zdGF0ZSI6InNlZW4iLCJzdHJ1Y3R1cmVkX3JlcXVlc3Rfbm9kZXMiOlt7ImlkIjoxLCJ0eXBlIjoxLCJ0b29sX3Jlc3VsdF9ub2RlIjp7ImNvbnRlbnQiOiJSYW4gaW50byBVbmtub3duIGVycm9yIHdoaWxlIHRyeWluZyB0byByZWFkIGphdmEtc2VydmVyL3NyYy9tYWluL2phdmEvY24vZWR1L3NkdS9qYXZhL3NlcnZlci9zZXJ2aWNlcy9UZWFjaGVyU2VydmljZXMuamF2YSIsImlzX2Vycm9yIjp0cnVlLCJyZXF1ZXN0X2lkIjoiIiwidG9vbF91c2VfaWQiOiJ0b29sdV92cnR4XzAxV3NNRHJyVjl1cUxLQ1BtYmRXanRtbiJ9fSx7ImlkIjoyLCJ0eXBlIjo0LCJpZGVfc3RhdGVfbm9kZSI6eyJ3b3Jrc3BhY2VGb2xkZXJzIjpbeyJyZXBvc2l0b3J5Um9vdCI6IkM6L1VzZXJzL3ByaW5jaXAvRG9jdW1lbnRzL0dpdEh1Yi9iYWljYWkvamF2YS1zZXJ2ZXIiLCJmb2xkZXJSb290IjoiQzovVXNlcnMvcHJpbmNpcC9Eb2N1bWVudHMvR2l0SHViL2JhaWNhaS9qYXZhLXNlcnZlciJ9XSwid29ya3NwYWNlRm9sZGVyc1VuY2hhbmdlZCI6ZmFsc2V9fV0sInRpbWVzdGFtcCI6IjIwMjUtMDUtMTZUMTU6MDQ6NTUuODM3WiIsInJlc3BvbnNlX3RleHQiOiLorqnmiJHlsJ3or5Xkvb/nlKjku6PnoIHlupPmo4DntKLlt6XlhbfmnaXmn6Xmib7nm7jlhbPku6PnoIHvvJpcbiIsIndvcmtzcGFjZV9maWxlX2NodW5rcyI6W119LHsic3RhdHVzIjoic3VjY2VzcyIsInJlcXVlc3RfaWQiOiI5ZmVlZmE1OS1iMTQ1LTQwOGUtYjViMC1iNWYyMDEyMTgwOTAiLCJyZXF1ZXN0X21lc3NhZ2UiOiIiLCJzdHJ1Y3R1cmVkX291dHB1dF9ub2RlcyI6W3siaWQiOjEsInR5cGUiOjUsImNvbnRlbnQiOiIiLCJ0b29sX3VzZSI6eyJ0b29sX3VzZV9pZCI6InRvb2x1X3ZydHhfMDFVWHBZR3VRMjZib1FmWERBN2hXUmE4IiwidG9vbF9uYW1lIjoiY29kZWJhc2UtcmV0cmlldmFsIiwiaW5wdXRfanNvbiI6IntcImluZm9ybWF0aW9uX3JlcXVlc3RcIjogXCJcXHU2N2U1XFx1NjI3ZSBDb21tb25NZXRob2QgXFx1N2M3YlxcdTRlMmRcXHU3Njg0IGdldEludGVnZXIgXFx1NjViOVxcdTZjZDVcXHU1YjllXFx1NzNiMFxcdWZmMGNcXHU3Mjc5XFx1NTIyYlxcdTY2MmZcXHU1M2VmXFx1ODBmZFxcdTZkODlcXHU1M2NhIERvdWJsZSBcXHU1MjMwIEludGVnZXIgXFx1N2M3YlxcdTU3OGJcXHU4ZjZjXFx1NjM2MlxcdTc2ODRcXHU0ZWUzXFx1NzgwMVwifSIsIm1jcF9zZXJ2ZXJfbmFtZSI6IiIsIm1jcF90b29sX25hbWUiOiIifX0seyJpZCI6MCwidHlwZSI6MCwiY29udGVudCI6IuiuqeaIkeafpeeci+S4gOS4iyBgQ29tbW9uTWV0aG9kYCDnsbvvvIzlm6DkuLrlroPlj6/og73ljIXlkKvnsbvlnovovazmjaLnmoTmlrnms5XvvJpcbiJ9LHsiaWQiOjIsInR5cGUiOjIsImNvbnRlbnQiOiIifSx7ImlkIjozLCJ0eXBlIjozLCJjb250ZW50IjoiIn1dLCJzZWVuX3N0YXRlIjoic2VlbiIsInN0cnVjdHVyZWRfcmVxdWVzdF9ub2RlcyI6W3siaWQiOjEsInR5cGUiOjEsInRvb2xfcmVzdWx0X25vZGUiOnsiY29udGVudCI6IlRoZSBmb2xsb3dpbmcgY29kZSBzZWN0aW9ucyB3ZXJlIHJldHJpZXZlZDpcblBhdGg6IHNyYy9tYWluL2phdmEvY24vZWR1L3NkdS9qYXZhL3NlcnZlci9zZXJ2aWNlcy9UZWFjaGVyU2VydmljZXMuamF2YVxucGFja2FnZSBjbi5lZHUuc2R1LmphdmEuc2VydmVyLnNlcnZpY2VzO1xuXG5pbXBvcnQgY24uZWR1LnNkdS5qYXZhLnNlcnZlci5tb2RlbHMuKjtcbmltcG9ydCBjbi5lZHUuc2R1LmphdmEuc2VydmVyLm1vZGVscy5UZWFjaGVyO1xuaW1wb3J0IGNuLmVkdS5zZHUuamF2YS5zZXJ2ZXIucGF5bG9hZC5yZXF1ZXN0LkRhdGFSZXF1ZXN0O1xuaW1wb3J0IGNuLmVkdS5zZHUuamF2YS5zZXJ2ZXIucGF5bG9hZC5yZXNwb25zZS5EYXRhUmVzcG9uc2U7XG5pbXBvcnQgY24uZWR1LnNkdS5qYXZhLnNlcnZlci5yZXBvc2l0b3J5cy4qO1xuaW1wb3J0IGNuLmVkdS5zZHUuamF2YS5zZXJ2ZXIudXRpbC5Db21EYXRhVXRpbDtcbmltcG9ydCBjbi5lZHUuc2R1LmphdmEuc2VydmVyLnV0aWwuQ29tbW9uTWV0aG9kO1xuaW1wb3J0IGNuLmVkdS5zZHUuamF2YS5zZXJ2ZXIudXRpbC5EYXRlVGltZVRvb2w7XG5pbXBvcnQgb3JnLmFwYWNoZS5wb2kuc3MudXNlcm1vZGVsLkNlbGw7XG5pbXBvcnQgb3JnLmFwYWNoZS5wb2kuc3MudXNlcm1vZGVsLlJvdztcbmltcG9ydCBvcmcuYXBhY2hlLnBvaS54c3NmLnVzZXJtb2RlbC4qO1xuaW1wb3J0IG9yZy5zbGY0ai5Mb2dnZXI7XG5pbXBvcnQgb3JnLnNsZjRqLkxvZ2dlckZhY3Rvcnk7XG5pbXBvcnQgb3JnLnNwcmluZ2ZyYW1ld29yay5kYXRhLmRvbWFpbi5QYWdlO1xuaW1wb3J0IG9yZy5zcHJpbmdmcmFtZXdvcmsuZGF0YS5kb21haW4uUGFnZVJlcXVlc3Q7XG5pbXBvcnQgb3JnLnNwcmluZ2ZyYW1ld29yay5kYXRhLmRvbWFpbi5QYWdlYWJsZTtcbi4uLlxuICAgIHB1YmxpYyBNYXA8U3RyaW5nLE9iamVjdD4gZ2V0TWFwRnJvbVRlYWNoZXIoVGVhY2hlciBzKSB7XG4gICAgICAgIE1hcDxTdHJpbmcsT2JqZWN0PiBtID0gbmV3IEhhc2hNYXA8PigpO1xuICAgICAgICBQZXJzb24gcDtcbiAgICAgICAgaWYocyA9PSBudWxsKVxuICAgICAgICAgICAgcmV0dXJuIG07XG4gICAgICAgIG0ucHV0KFwidGl0bGVcIixzLmdldFRpdGxlKCkpO1xuICAgICAgICBtLnB1dChcImRlZ3JlZVwiLHMuZ2V0RGVncmVlKCkpO1xuICAgICAgICBtLnB1dChcImNsYXNzTmFtZVwiLHMuZ2V0Q2xhc3NOYW1lKCkpO1xuICAgICAgICBwID0gcy5nZXRQZXJzb24oKTtcbiAgICAgICAgaWYocCA9PSBudWxsKVxuICAgICAgICAgICAgcmV0dXJuIG07XG4gICAgICAgIG0ucHV0KFwicGVyc29uSWRcIiwgcy5nZXRQZXJzb25JZCgpKTtcbiAgICAgICAgbS5wdXQoXCJudW1cIixwLmdldE51bSgpKTtcbiAgICAgICAgbS5wdXQoXCJuYW1lXCIscC5nZXROYW1lKCkpO1xuICAgICAgICBtLnB1dChcImRlcHRcIixwLmdldERlcHQoKSk7XG4gICAgICAgIG0ucHV0KFwiY2FyZFwiLHAuZ2V0Q2FyZCgpKTtcbiAgICAgICAgU3RyaW5nIGdlbmRlciA9IHAuZ2V0R2VuZGVyKCk7XG4gICAgICAgIG0ucHV0KFwiZ2VuZGVyXCIsZ2VuZGVyKTtcbiAgICAgICAgbS5wdXQoXCJnZW5kZXJOYW1lXCIsIENvbURhdGFVdGlsLmdldEluc3RhbmNlKCkuZ2V0RGljdGlvbmFyeUxhYmVsQnlWYWx1ZShcIlhCTVwiLCBnZW5kZXIpKTsgLy/mgKfliKvnsbvlnovnmoTlgLzovazmjaLmiJDmlbDmja7nsbvlnovlkI1cbiAgICAgICAgbS5wdXQoXCJiaXJ0aGRheVwiLCBwLmdldEJpcnRoZGF5KCkpOyAgLy/ml7bpl7TmoLzlvI/ovazmjaLlrZfnrKbkuLJcbiAgICAgICAgbS5wdXQoXCJlbWFpbFwiLHAuZ2V0RW1haWwoKSk7XG4gICAgICAgIG0ucHV0KFwicGhvbmVcIixwLmdldFBob25lKCkpO1xuICAgICAgICBtLnB1dChcImFkZHJlc3NcIixwLmdldEFkZHJlc3MoKSk7XG4gICAgICAgIG0ucHV0KFwiaW50cm9kdWNlXCIscC5nZXRJbnRyb2R1Y2UoKSk7XG4gICAgICAgIHJldHVybiBtO1xuICAgIH1cbiAgICBwdWJsaWMgTGlzdDxNYXA8U3RyaW5nLE9iamVjdD4+IGdldFRlYWNoZXJNYXBMaXN0KFN0cmluZyBudW1OYW1lKSB7XG4gICAgICAgIExpc3Q8TWFwPFN0cmluZyxPYmplY3Q+PiBkYXRhTGlzdCA9IG5ldyBBcnJheUxpc3Q8PigpO1xuICAgICAgICBMaXN0PFRlYWNoZXI+IHNMaXN0ID0gdGVhY2hlclJlcG9zaXRvcnkuZmluZFRlYWNoZXJMaXN0QnlOdW1OYW1lKG51bU5hbWUpOyAgLy/mlbDmja7lupPmn6Xor6Lmk43kvZxcbiAgICAgICAgaWYgKHNMaXN0ID09IG51bGwgfHwgc0xpc3QuaXNFbXB0eSgpKVxuICAgICAgICAgICAgcmV0dXJuIGRhdGFMaXN0O1xuICAgICAgICBmb3IgKFRlYWNoZXIgdGVhY2hlciA6IHNMaXN0KSB7XG4gICAgICAgICAgICBkYXRhTGlzdC5hZGQoZ2V0TWFwRnJvbVRlYWNoZXIodGVhY2hlcikpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBkYXRhTGlzdDtcbiAgICB9XG4gICAgcHVibGljIERhdGFSZXNwb25zZSBnZXRUZWFjaGVyTGlzdChEYXRhUmVxdWVzdCBkYXRhUmVxdWVzdCkge1xuICAgICAgICBTdHJpbmcgbnVtTmFtZSA9IGRhdGFSZXF1ZXN0LmdldFN0cmluZyhcIm51bU5hbWVcIik7XG4gICAgICAgIExpc3Q8TWFwPFN0cmluZyxPYmplY3Q+PiBkYXRhTGlzdCA9ICBnZXRUZWFjaGVyTGlzdChudW1OYW1lKTtcbiAgICAgICAgcmV0dXJuIENvbW1vbk1ldGhvZC5nZXRSZXR1cm5EYXRhKGRhdGFMaXN0KTsgIC8v5oyJ54Wn5rWL6K+V5qGG5p626KeE6IyD5Lya6YCBTWFw55qEbGlzdFxuICAgIH1cbiAgICBwdWJsaWMgRGF0YVJlc3BvbnNlIHRlYWNoZXJEZWxldGUoRGF0YVJlcXVlc3QgZGF0YVJlcXVlc3QpIHtcbiAgICAgICAgSW50ZWdlciBwZXJzb25JZCA9IGRhdGFSZXF1ZXN0LmdldEludGVnZXIoXCJwZXJzb25JZFwiKTsgIC8v6I635Y+WdGVhY2hlcl9pZOWAvFxuICAgICAgICBUZWFjaGVyIHMgPSBudWxsO1xuICAgICAgICBPcHRpb25hbDxUZWFjaGVyPiBvcDtcbiAgICAgICAgaWYgKHBlcnNvbklkICE9IG51bGwgJiYgcGVyc29uSWQgPiAwKSB7XG4gICAgICAgICAgICBvcCA9IHRlYWNoZXJSZXBvc2l0b3J5LmZpbmRCeUlkKHBlcnNvbklkKTsgICAvL+afpeivouiOt+W+l+WunuS9k+WvueixoVxuICAgICAgICAgICAgaWYob3AuaXNQcmVzZW50KCkpIHtcbiAgICAgICAgICAgICAgICBzID0gb3AuZ2V0KCk7XG4gICAgICAgICAgICAgICAgT3B0aW9uYWw8VXNlcj4gdU9wID0gdXNlclJlcG9zaXRvcnkuZmluZEJ5SWQocGVyc29uSWQpOyAvL+afpeivouWvueW6lOivpeaVmeW4iOeahOi0puaIt1xuICAgICAgICAgICAgICAgIC8v5Yig6Zmk5a+55bqU6K+l5pWZ5biI55qE6LSm5oi3XG4gICAgICAgICAgICAgICAgdU9wLmlmUHJlc2VudCh1c2VyUmVwb3NpdG9yeTo6ZGVsZXRlKTtcbiAgICAgICAgICAgICAgICBQZXJzb24gcCA9IHMuZ2V0UGVyc29uKCk7XG4gICAgICAgICAgICAgICAgdGVhY2hlclJlcG9zaXRvcnkuZGVsZXRlKHMpOyAgICAvL+mmluWFiOaVsOaNruW6k+awuOS5heWIoOmZpOaVmeW4iOS/oeaBr1xuICAgICAgICAgICAgICAgIHBlcnNvblJlcG9zaXRvcnkuZGVsZXRlKHApO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBDb21tb25NZXRob2QuZ2V0UmV0dXJuTWVzc2FnZU9LKCk7ICAvL+mAmuefpeWJjeerr+aTjeS9nOato+W4uFxuICAgIH1cbiAgICBwdWJsaWMgRGF0YVJlc3BvbnNlIGdldFRlYWNoZXJJbmZvKERhdGFSZXF1ZXN0IGRhdGFSZXF1ZXN0KSB7XG4gICAgICAgIEludGVnZXIgcGVyc29uSWQgPSBkYXRhUmVxdWVzdC5nZXRJbnRlZ2VyKFwicGVyc29uSWRcIik7XG4gICAgICAgIFRlYWNoZXIgcyA9IG51bGw7XG4gICAgICAgIE9wdGlvbmFsPFRlYWNoZXI+IG9wO1xuICAgICAgICBpZiAocGVyc29uSWQgIT0gbnVsbCkge1xuICAgICAgICAgICAgb3AgPSB0ZWFjaGVyUmVwb3NpdG9yeS5maW5kQnlJZChwZXJzb25JZCk7IC8v5qC55o2u5a2m55Sf5Li76ZSu5LuO5pWw5o2u5bqT5p+l6K+i5a2m55Sf55qE5L+h5oGvXG4gICAgICAgICAgICBpZiAob3AuaXNQcmVzZW50KCkpIHtcbiAgICAgICAgICAgICAgICBzID0gb3AuZ2V0KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIENvbW1vbk1ldGhvZC5nZXRSZXR1cm5EYXRhKGdldE1hcEZyb21UZWFjaGVyKHMpKTsgLy/ov5nph4zlm57kvKDljIXlkKvlrabnlJ/kv6Hmga/nmoRNYXDlr7nosaFcbiAgICB9XG5cbiAgICBwdWJsaWMgRGF0YVJlc3BvbnNlIHRlYWNoZXJFZGl0U2F2ZShEYXRhUmVxdWVzdCBkYXRhUmVxdWVzdCkge1xuICAgICAgICBJbnRlZ2VyIHBlcnNvbklkID0gZGF0YVJlcXVlc3QuZ2V0SW50ZWdlcihcInBlcnNvbklkXCIpO1xuICAgICAgICBNYXA8U3RyaW5nLE9iamVjdD4gZm9ybSA9IGRhdGFSZXF1ZXN0LmdldE1hcChcImZvcm1cIik7IC8v5Y+C5pWw6I635Y+WTWFw5a+56LGhXG4gICAgICAgIFN0cmluZyBudW0gPSBDb21tb25NZXRob2QuZ2V0U3RyaW5nKGZvcm0sIFwibnVtXCIpOyAgLy9NYXAg6I635Y+W5bGe5oCn55qE5YC8XG4gICAgICAgIFRlYWNoZXIgcyA9IG51bGw7XG4gICAgICAgIFBlcnNvbiBwO1xuICAgICAgICBVc2VyIHU7XG4gICAgICAgIE9wdGlvbmFsPFRlYWNoZXI+IG9wO1xuICAgICAgICBib29sZWFuIGlzTmV3ID0gZmFsc2U7XG4gICAgICAgIGlmIChwZXJzb25JZCAhPSBudWxsKSB7XG4gICAgICAgICAgICBvcCA9IHRlYWNoZXJSZXBvc2l0b3J5LmZpbmRCeUlkKHBlcnNvbklkKTsgIC8v5p+l6K+i5a+55bqU5pWw5o2u5bqT5Lit5Li76ZSu5Li6aWTnmoTlgLznmoTlrp7kvZPlr7nosaFcbiAgICAgICAgICAgIGlmIChvcC5pc1ByZXNlbnQoKSkge1xuICAgICAgICAgICAgICAgIHMgPSBvcC5nZXQoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBPcHRpb25hbDxQZXJzb24+IG5PcCA9IHBlcnNvblJlcG9zaXRvcnkuZmluZEJ5TnVtKG51bSk7IC8v5p+l6K+i5piv5ZCm5a2Y5ZyobnVt55qE5Lq65ZGYXG4gICAgICAgIGlmIChuT3AuaXNQcmVzZW50KCkpIHtcbiAgICAgICAgICAgIGlmIChzID09IG51bGwgfHwgIXMuZ2V0UGVyc29uKCkuZ2V0TnVtKCkuZXF1YWxzKG51bSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gQ29tbW9uTWV0aG9kLmdldFJldHVybk1lc3NhZ2VFcnJvcihcIuaWsOWtpuWPt+W3sue7j+WtmOWcqO+8jOS4jeiDvea3u+WKoOaIluS/ruaUue+8gVwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAocyA9PSBudWxsKSB7XG4gICAgICAgICAgICBwID0gbmV3IFBlcnNvbigpO1xuICAgICAgICAgICAgcC5zZXROdW0obnVtKTtcbiAgICAgICAgICAgIHAuc2V0VHlwZShcIjFcIik7XG4gICAgICAgICAgICBwZXJzb25SZXBvc2l0b3J5LnNhdmVBbmRGbHVzaChwKTsgIC8v5o+S5YWl5paw55qEUGVyc29u6K6w5b2VXG4gICAgICAgICAgICBwZXJzb25JZCA9IHAuZ2V0UGVyc29uSWQoKTtcbiAgICAgICAgICAgIFN0cmluZyBwYXNzd29yZCA9IGVuY29kZXIuZW5jb2RlKFwiMTIzNDU2XCIpO1xuICAgICAgICAgICAgdSA9IG5ldyBVc2VyKCk7XG4gICAgICAgICAgICB1LnNldFBlcnNvbklkKHBlcnNvbklkKTtcbiAgICAgICAgICAgIHUuc2V0VXNlck5hbWUobnVtKTtcbiAgICAgICAgICAgIHUuc2V0UGFzc3dvcmQocGFzc3dvcmQpO1xuICAgICAgICAgICAgdS5zZXRVc2VyVHlwZSh1c2VyVHlwZVJlcG9zaXRvcnkuZmluZEJ5TmFtZShFVXNlclR5cGUuUk9MRV9TVFVERU5UKSk7XG4gICAgICAgICAgICB1LnNldENyZWF0ZVRpbWUoRGF0ZVRpbWVUb29sLnBhcnNlRGF0ZVRpbWUobmV3IERhdGUoKSkpO1xuICAgICAgICAgICAgdS5zZXRDcmVhdG9ySWQoQ29tbW9uTWV0aG9kLmdldFBlcnNvbklkKCkpO1xuICAgICAgICAgICAgdXNlclJlcG9zaXRvcnkuc2F2ZUFuZEZsdXNoKHUpOyAvL+aPkuWFpeaWsOeahFVzZXLorrDlvZVcbiAgICAgICAgICAgIHMgPSBuZXcgVGVhY2hlcigpOyAgIC8vIOWIm+W7uuWunuS9k+WvueixoVxuICAgICAgICAgICAgcy5zZXRQZXJzb25JZChwZXJzb25JZCk7XG4gICAgICAgICAgICB0ZWFjaGVyUmVwb3NpdG9yeS5zYXZlQW5kRmx1c2gocyk7ICAvL+aPkuWFpeaWsOeahFN0dWRlbnTorrDlvZVcbiAgICAgICAgICAgIGlzTmV3ID0gdHJ1ZTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHAgPSBzLmdldFBlcnNvbigpO1xuICAgICAgICB9XG4uLi5cbiAgICAgICAgcC5zZXROYW1lKENvbW1vbk1ldGhvZC5nZXRTdHJpbmcoZm9ybSwgXCJuYW1lXCIpKTtcbiAgICAgICAgcC5zZXREZXB0KENvbW1vbk1ldGhvZC5nZXRTdHJpbmcoZm9ybSwgXCJkZXB0XCIpKTtcbiAgICAgICAgcC5zZXRDYXJkKENvbW1vbk1ldGhvZC5nZXRTdHJpbmcoZm9ybSwgXCJjYXJkXCIpKTtcbiAgICAgICAgcC5zZXRHZW5kZXIoQ29tbW9uTWV0aG9kLmdldFN0cmluZyhmb3JtLCBcImdlbmRlclwiKSk7XG4gICAgICAgIHAuc2V0QmlydGhkYXkoQ29tbW9uTWV0aG9kLmdldFN0cmluZyhmb3JtLCBcImJpcnRoZGF5XCIpKTtcbiAgICAgICAgcC5zZXRFbWFpbChDb21tb25NZXRob2QuZ2V0U3RyaW5nKGZvcm0sIFwiZW1haWxcIikpO1xuICAgICAgICBwLnNldFBob25lKENvbW1vbk1ldGhvZC5nZXRTdHJpbmcoZm9ybSwgXCJwaG9uZVwiKSk7XG4gICAgICAgIHAuc2V0QWRkcmVzcyhDb21tb25NZXRob2QuZ2V0U3RyaW5nKGZvcm0sIFwiYWRkcmVzc1wiKSk7XG4gICAgICAgIHBlcnNvblJlcG9zaXRvcnkuc2F2ZShwKTsgIC8vIOS/ruaUueS/neWtmOS6uuWRmOS/oeaBr1xuICAgICAgICBzLnNldENsYXNzTmFtZShDb21tb25NZXRob2QuZ2V0U3RyaW5nKGZvcm0sIFwiY2xhc3NOYW1lXCIpKTtcbiAgICAgICAgdGVhY2hlclJlcG9zaXRvcnkuc2F2ZShzKTsgIC8v5L+u5pS55L+d5a2Y5a2m55Sf5L+h5oGvXG4gICAgICAgIHN5c3RlbVNlcnZpY2UubW9kaWZ5TG9nKHMsaXNOZXcpO1xuICAgICAgICByZXR1cm4gQ29tbW9uTWV0aG9kLmdldFJldHVybkRhdGEocy5nZXRQZXJzb25JZCgpKTsgIC8vIOWwhnBlcnNvbklk6L+U5Zue5YmN56uvXG4gICAgfVxuICAgIHB1YmxpYyBSZXNwb25zZUVudGl0eTxTdHJlYW1pbmdSZXNwb25zZUJvZHk+IGdldFRlYWNoZXJMaXN0RXhjbChEYXRhUmVxdWVzdCBkYXRhUmVxdWVzdCkge1xuICAgICAgICBTdHJpbmcgbnVtTmFtZSA9IGRhdGFSZXF1ZXN0LmdldFN0cmluZyhcIm51bU5hbWVcIik7XG4gICAgICAgIExpc3Q8TWFwPFN0cmluZyxPYmplY3Q+PiBsaXN0ID0gZ2V0VGVhY2hlck1hcExpc3QobnVtTmFtZSk7IC8vIOWBh+iuvuW3suaUueS4uuiOt+WPluaVmeW4iOaVsOaNrueahOaWueazlVxuXG4gICAgICAgIC8vIOiwg+aVtOWIl+WuvemFjee9ru+8iOagueaNruaVmeW4iOS/oeaBr+eJueeCueiwg+aVtO+8iVxuICAgICAgICBJbnRlZ2VyW10gd2lkdGhzID0gezgsIDE1LCAxMCwgMjAsIDE1LCAxMCwgOCwgMjUsIDE1LCAzMH07XG4gICAgICAgIFN0cmluZ1tdIHRpdGxlcyA9IHtcIuW6j+WPt1wiLCBcIuW3peWPt1wiLCBcIuWnk+WQjVwiLCBcIuWtpumZolwiLCBcIuiBjOensFwiLCBcIuWtpuS9jVwiLCBcIuaAp+WIq1wiLCBcIumCrueusVwiLCBcIueUteivnVwiLCBcIuWcsOWdgFwifTtcbiAgICAgICAgU3RyaW5nIG91dFB1dFNoZWV0TmFtZSA9IFwidGVhY2hlci54bHN4XCI7XG5cbiAgICAgICAgWFNTRldvcmtib29rIHdiID0gbmV3IFhTU0ZXb3JrYm9vaygpO1xuICAgICAgICBYU1NGU2hlZXQgc2hlZXQgPSB3Yi5jcmVhdGVTaGVldChvdXRQdXRTaGVldE5hbWUpO1xuXG4gICAgICAgIC8vIOiuvue9ruWIl+WuvVxuICAgICAgICBmb3IoaW50IGogPSAwOyBqIDwgd2lkdGhzLmxlbmd0aDsgaisrKSB7XG4gICAgICAgICAgICBzaGVldC5zZXRDb2x1bW5XaWR0aChqLCB3aWR0aHNbal0gKiAyNTYpO1xuICAgICAgICB9XG4uLi5cblxuICAgICAgICAgICAgICAgIC8vIOWhq+WFheWFt+S9k+aVsOaNru+8iOWtl+auteWQjemcgOimgeagueaNruWunumZheaVmeW4iOaVsOaNrue7k+aehOiwg+aVtO+8iVxuICAgICAgICAgICAgICAgIGNlbGxbMF0uc2V0Q2VsbFZhbHVlKChpICsgMSkgKyBcIlwiKTsgLy8g5bqP5Y+3XG4gICAgICAgICAgICAgICAgY2VsbFsxXS5zZXRDZWxsVmFsdWUoQ29tbW9uTWV0aG9kLmdldFN0cmluZyhtLCBcInRlYWNoZXJOdW1cIikpOyAvLyDlt6Xlj7dcbiAgICAgICAgICAgICAgICBjZWxsWzJdLnNldENlbGxWYWx1ZShDb21tb25NZXRob2QuZ2V0U3RyaW5nKG0sIFwibmFtZVwiKSk7IC8vIOWnk+WQjVxuICAgICAgICAgICAgICAgIGNlbGxbM10uc2V0Q2VsbFZhbHVlKENvbW1vbk1ldGhvZC5nZXRTdHJpbmcobSwgXCJkZXBhcnRcIikpOyAvLyDlrabpmaJcbiAgICAgICAgICAgICAgICBjZWxsWzRdLnNldENlbGxWYWx1ZShDb21tb25NZXRob2QuZ2V0U3RyaW5nKG0sIFwidGl0bGVcIikpOyAvLyDogYznp7BcbiAgICAgICAgICAgICAgICBjZWxsWzVdLnNldENlbGxWYWx1ZShDb21tb25NZXRob2QuZ2V0U3RyaW5nKG0sIFwiZGVncmVlXCIpKTsgLy8g5a2m5L2NXG4gICAgICAgICAgICAgICAgY2VsbFs2XS5zZXRDZWxsVmFsdWUoQ29tbW9uTWV0aG9kLmdldFN0cmluZyhtLCBcImdlbmRlclwiKSk7IC8vIOaAp+WIq1xuICAgICAgICAgICAgICAgIGNlbGxbN10uc2V0Q2VsbFZhbHVlKENvbW1vbk1ldGhvZC5nZXRTdHJpbmcobSwgXCJlbWFpbFwiKSk7IC8vIOmCrueusVxuICAgICAgICAgICAgICAgIGNlbGxbOF0uc2V0Q2VsbFZhbHVlKENvbW1vbk1ldGhvZC5nZXRTdHJpbmcobSwgXCJwaG9uZVwiKSk7IC8vIOeUteivnVxuICAgICAgICAgICAgICAgIGNlbGxbOV0uc2V0Q2VsbFZhbHVlKENvbW1vbk1ldGhvZC5nZXRTdHJpbmcobSwgXCJhZGRyZXNzXCIpKTsgLy8g5Zyw5Z2AXG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbi4uLlxuICAgIHB1YmxpYyBEYXRhUmVzcG9uc2UgZ2V0VGVhY2hlclBhZ2VEYXRhKERhdGFSZXF1ZXN0IGRhdGFSZXF1ZXN0KSB7XG4gICAgICAgIFN0cmluZyBudW1OYW1lID0gZGF0YVJlcXVlc3QuZ2V0U3RyaW5nKFwibnVtTmFtZVwiKTtcbiAgICAgICAgSW50ZWdlciBjUGFnZSA9IGRhdGFSZXF1ZXN0LmdldEN1cnJlbnRQYWdlKCk7XG4gICAgICAgIGludCBkYXRhVG90YWwgPSAwO1xuICAgICAgICBpbnQgc2l6ZSA9IDQwO1xuICAgICAgICBMaXN0PE1hcDxTdHJpbmcsT2JqZWN0Pj4gZGF0YUxpc3QgPSBuZXcgQXJyYXlMaXN0PD4oKTtcbiAgICAgICAgUGFnZTxUZWFjaGVyPiBwYWdlID0gbnVsbDtcbiAgICAgICAgUGFnZWFibGUgcGFnZWFibGUgPSBQYWdlUmVxdWVzdC5vZihjUGFnZSwgc2l6ZSk7XG4gICAgICAgIHBhZ2UgPSB0ZWFjaGVyUmVwb3NpdG9yeS5maW5kVGVhY2hlckxpc3RCeU51bU5hbWUobnVtTmFtZSwgcGFnZWFibGUpO1xuICAgICAgICBNYXA8U3RyaW5nLE9iamVjdD4gbTtcbiAgICAgICAgaWYgKHBhZ2UgIT0gbnVsbCkge1xuICAgICAgICAgICAgZGF0YVRvdGFsID0gKGludCkgcGFnZS5nZXRUb3RhbEVsZW1lbnRzKCk7XG4gICAgICAgICAgICBMaXN0PFRlYWNoZXI+IGxpc3QgPSBwYWdlLmdldENvbnRlbnQoKTtcbiAgICAgICAgICAgIGlmICghbGlzdC5pc0VtcHR5KCkpIHtcbiAgICAgICAgICAgICAgICBmb3IgKFRlYWNoZXIgdGVhY2hlciA6IGxpc3QpIHtcbiAgICAgICAgICAgICAgICAgICAgbSA9IGdldE1hcEZyb21UZWFjaGVyKHRlYWNoZXIpO1xuICAgICAgICAgICAgICAgICAgICBkYXRhTGlzdC5hZGQobSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4uLi5cbiAgICBwdWJsaWMgRGF0YVJlc3BvbnNlIGdldEZhbWlseU1lbWJlckxpc3QoRGF0YVJlcXVlc3QgZGF0YVJlcXVlc3QpIHtcbiAgICAgICAgSW50ZWdlciBwZXJzb25JZCA9IGRhdGFSZXF1ZXN0LmdldEludGVnZXIoXCJwZXJzb25JZFwiKTtcbiAgICAgICAgTGlzdDxGYW1pbHlNZW1iZXI+IGZMaXN0ID0gZmFtaWx5TWVtYmVyUmVwb3NpdG9yeS5maW5kQnlUZWFjaGVyUGVyc29uSWQocGVyc29uSWQpO1xuICAgICAgICBMaXN0PE1hcDxTdHJpbmcsT2JqZWN0Pj4gZGF0YUxpc3QgPSBuZXcgQXJyYXlMaXN0PD4oKTtcbiAgICAgICAgTWFwPFN0cmluZyxPYmplY3Q+IG07XG4gICAgICAgIGlmIChmTGlzdCAhPSBudWxsKSB7XG4gICAgICAgICAgICBmb3IgKEZhbWlseU1lbWJlciBmIDogZkxpc3QpIHtcbiAgICAgICAgICAgICAgICBtID0gbmV3IEhhc2hNYXA8PigpO1xuICAgICAgICAgICAgICAgIG0ucHV0KFwibWVtYmVySWRcIiwgZi5nZXRNZW1iZXJJZCgpKTtcbiAgICAgICAgICAgICAgICBtLnB1dChcInBlcnNvbklkXCIsIGYuZ2V0VGVhY2hlcigpLmdldFBlcnNvbklkKCkpO1xuICAgICAgICAgICAgICAgIG0ucHV0KFwicmVsYXRpb25cIiwgZi5nZXRSZWxhdGlvbigpKTtcbiAgICAgICAgICAgICAgICBtLnB1dChcIm5hbWVcIiwgZi5nZXROYW1lKCkpO1xuICAgICAgICAgICAgICAgIG0ucHV0KFwiZ2VuZGVyXCIsIGYuZ2V0R2VuZGVyKCkpO1xuICAgICAgICAgICAgICAgIG0ucHV0KFwiYWdlXCIsIGYuZ2V0QWdlKCkrXCJcIik7XG4gICAgICAgICAgICAgICAgbS5wdXQoXCJ1bml0XCIsIGYuZ2V0VW5pdCgpKTtcbiAgICAgICAgICAgICAgICBkYXRhTGlzdC5hZGQobSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIENvbW1vbk1ldGhvZC5nZXRSZXR1cm5EYXRhKGRhdGFMaXN0KTtcbiAgICB9XG4gICAgcHVibGljIERhdGFSZXNwb25zZSBmYW1pbHlNZW1iZXJTYXZlKERhdGFSZXF1ZXN0IGRhdGFSZXF1ZXN0KSB7XG4gICAgICAgIE1hcDxTdHJpbmcsT2JqZWN0PiBmb3JtID0gZGF0YVJlcXVlc3QuZ2V0TWFwKFwiZm9ybVwiKTtcbiAgICAgICAgSW50ZWdlciBwZXJzb25JZCA9IENvbW1vbk1ldGhvZC5nZXRJbnRlZ2VyKGZvcm0sXCJwZXJzb25JZFwiKTtcbiAgICAgICAgSW50ZWdlciBtZW1iZXJJZCA9IENvbW1vbk1ldGhvZC5nZXRJbnRlZ2VyKGZvcm0sXCJtZW1iZXJJZFwiKTtcbiAgICAgICAgT3B0aW9uYWw8RmFtaWx5TWVtYmVyPiBvcDtcbiAgICAgICAgRmFtaWx5TWVtYmVyIGYgPSBudWxsO1xuICAgICAgICBpZihtZW1iZXJJZCAhPSBudWxsKSB7XG4gICAgICAgICAgICBvcCA9IGZhbWlseU1lbWJlclJlcG9zaXRvcnkuZmluZEJ5SWQobWVtYmVySWQpO1xuICAgICAgICAgICAgaWYob3AuaXNQcmVzZW50KCkpIHtcbiAgICAgICAgICAgICAgICBmID0gb3AuZ2V0KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYoZj09IG51bGwpIHtcbiAgICAgICAgICAgIGYgPSBuZXcgRmFtaWx5TWVtYmVyKCk7XG4gICAgICAgICAgICBhc3NlcnQgcGVyc29uSWQgIT0gbnVsbDtcbiAgICAgICAgICAgIGYuc2V0U3R1ZGVudCh0ZWFjaGVyUmVwb3NpdG9yeS5maW5kQnlJZChwZXJzb25JZCkuZ2V0KCkpO1xuICAgICAgICB9XG4uLi5cblBhdGg6IGphdmEtc2VydmVyL3NyYy9tYWluL2phdmEvY24vZWR1L3NkdS9qYXZhL3NlcnZlci9zZXJ2aWNlcy9UZWFjaGVyU2VydmljZXMuamF2YVxuLi4uXG5cbmltcG9ydCBjbi5lZHUuc2R1LmphdmEuc2VydmVyLm1vZGVscy4qO1xuaW1wb3J0IGNuLmVkdS5zZHUuamF2YS5zZXJ2ZXIubW9kZWxzLlRlYWNoZXI7XG5pbXBvcnQgY24uZWR1LnNkdS5qYXZhLnNlcnZlci5wYXlsb2FkLnJlcXVlc3QuRGF0YVJlcXVlc3Q7XG5pbXBvcnQgY24uZWR1LnNkdS5qYXZhLnNlcnZlci5wYXlsb2FkLnJlc3BvbnNlLkRhdGFSZXNwb25zZTtcbmltcG9ydCBjbi5lZHUuc2R1LmphdmEuc2VydmVyLnJlcG9zaXRvcnlzLio7XG5pbXBvcnQgY24uZWR1LnNkdS5qYXZhLnNlcnZlci51dGlsLkNvbURhdGFVdGlsO1xuaW1wb3J0IGNuLmVkdS5zZHUuamF2YS5zZXJ2ZXIudXRpbC5Db21tb25NZXRob2Q7XG5pbXBvcnQgY24uZWR1LnNkdS5qYXZhLnNlcnZlci51dGlsLkRhdGVUaW1lVG9vbDtcbmltcG9ydCBvcmcuYXBhY2hlLnBvaS54c3NmLnVzZXJtb2RlbC4qO1xuaW1wb3J0IG9yZy5zbGY0ai5Mb2dnZXI7XG5pbXBvcnQgb3JnLnNsZjRqLkxvZ2dlckZhY3Rvcnk7XG5pbXBvcnQgb3JnLnNwcmluZ2ZyYW1ld29yay5kYXRhLmRvbWFpbi5QYWdlO1xuaW1wb3J0IG9yZy5zcHJpbmdmcmFtZXdvcmsuZGF0YS5kb21haW4uUGFnZVJlcXVlc3Q7XG5pbXBvcnQgb3JnLnNwcmluZ2ZyYW1ld29yay5kYXRhLmRvbWFpbi5QYWdlYWJsZTtcbmltcG9ydCBvcmcuc3ByaW5nZnJhbWV3b3JrLmh0dHAuUmVzcG9uc2VFbnRpdHk7XG5pbXBvcnQgb3JnLnNwcmluZ2ZyYW1ld29yay5zZWN1cml0eS5jcnlwdG8ucGFzc3dvcmQuUGFzc3dvcmRFbmNvZGVyO1xuaW1wb3J0IG9yZy5zcHJpbmdmcmFtZXdvcmsuc3RlcmVvdHlwZS5TZXJ2aWNlO1xuaW1wb3J0IG9yZy5zcHJpbmdmcmFtZXdvcmsud2ViLnNlcnZsZXQubXZjLm1ldGhvZC5hbm5vdGF0aW9uLlN0cmVhbWluZ1Jlc3BvbnNlQm9keTtcblxuaW1wb3J0IGphdmEudXRpbC4qO1xuXG5AU2VydmljZVxucHVibGljIGNsYXNzIFRlYWNoZXJTZXJ2aWNlcyB7XG4gICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgTG9nZ2VyIGxvZyA9IExvZ2dlckZhY3RvcnkuZ2V0TG9nZ2VyKFRlYWNoZXJTZXJ2aWNlcy5jbGFzcyk7XG4gICAgcHJpdmF0ZSBmaW5hbCBQZXJzb25SZXBvc2l0b3J5IHBlcnNvblJlcG9zaXRvcnk7ICAvL+S6uuWRmOaVsOaNruaTjeS9nOiHquWKqOazqOWFpVxuICAgIHByaXZhdGUgZmluYWwgVGVhY2hlclJlcG9zaXRvcnkgdGVhY2hlclJlcG9zaXRvcnk7ICAvL+aVmeW4iOaVsOaNruaTjeS9nOiHquWKqOazqOWFpVxuICAgIHByaXZhdGUgZmluYWwgVXNlclJlcG9zaXRvcnkgdXNlclJlcG9zaXRvcnk7ICAvL+aVsOaNruaTjeS9nOiHquWKqOazqOWFpVxuICAgIHByaXZhdGUgZmluYWwgVXNlclR5cGVSZXBvc2l0b3J5IHVzZXJUeXBlUmVwb3NpdG9yeTsgLy/nlKjmiLfnsbvlnovmlbDmja7mk43kvZzoh6rliqjms6jlhaVcbiAgICBwcml2YXRlIGZpbmFsIFBhc3N3b3JkRW5jb2RlciBlbmNvZGVyOyAgLy/lr4bnoIHmnI3liqHoh6rliqjms6jlhaVcbiAgICAvL+a2iOi0ueaVsOaNruaTjeS9nOiHquWKqOazqOWFpVxuICAgIHByaXZhdGUgZmluYWwgRmFtaWx5TWVtYmVyUmVwb3NpdG9yeSBmYW1pbHlNZW1iZXJSZXBvc2l0b3J5O1xuICAgIHByaXZhdGUgZmluYWwgU3lzdGVtU2VydmljZSBzeXN0ZW1TZXJ2aWNlO1xuLi4uXG5cbiAgICBwdWJsaWMgTWFwPFN0cmluZywgT2JqZWN0PiBnZXRNYXBGcm9tVGVhY2hlcihUZWFjaGVyIHMpIHtcbiAgICAgICAgTWFwPFN0cmluZywgT2JqZWN0PiBtID0gbmV3IEhhc2hNYXA8PigpO1xuICAgICAgICBQZXJzb24gcDtcbiAgICAgICAgaWYgKHMgPT0gbnVsbClcbiAgICAgICAgICAgIHJldHVybiBtO1xuICAgICAgICBtLnB1dChcInRpdGxlXCIsIHMuZ2V0VGl0bGUoKSk7XG4gICAgICAgIG0ucHV0KFwiZGVncmVlXCIsIHMuZ2V0RGVncmVlKCkpO1xuICAgICAgICBtLnB1dChcImNsYXNzTmFtZVwiLCBzLmdldENsYXNzTmFtZSgpKTtcbiAgICAgICAgcCA9IHMuZ2V0UGVyc29uKCk7XG4gICAgICAgIGlmIChwID09IG51bGwpXG4gICAgICAgICAgICByZXR1cm4gbTtcbiAgICAgICAgbS5wdXQoXCJwZXJzb25JZFwiLCBzLmdldFBlcnNvbklkKCkpO1xuICAgICAgICBtLnB1dChcIm51bVwiLCBwLmdldE51bSgpKTtcbiAgICAgICAgbS5wdXQoXCJuYW1lXCIsIHAuZ2V0TmFtZSgpKTtcbiAgICAgICAgbS5wdXQoXCJkZXB0XCIsIHAuZ2V0RGVwdCgpKTtcbiAgICAgICAgbS5wdXQoXCJjYXJkXCIsIHAuZ2V0Q2FyZCgpKTtcbiAgICAgICAgU3RyaW5nIGdlbmRlciA9IHAuZ2V0R2VuZGVyKCk7XG4gICAgICAgIG0ucHV0KFwiZ2VuZGVyXCIsIGdlbmRlcik7XG4gICAgICAgIG0ucHV0KFwiZ2VuZGVyTmFtZVwiLCBDb21EYXRhVXRpbC5nZXRJbnN0YW5jZSgpLmdldERpY3Rpb25hcnlMYWJlbEJ5VmFsdWUoXCJYQk1cIiwgZ2VuZGVyKSk7IC8v5oCn5Yir57G75Z6L55qE5YC86L2s5o2i5oiQ5pWw5o2u57G75Z6L5ZCNXG4gICAgICAgIG0ucHV0KFwiYmlydGhkYXlcIiwgcC5nZXRCaXJ0aGRheSgpKTsgIC8v5pe26Ze05qC85byP6L2s5o2i5a2X56ym5LiyXG4gICAgICAgIG0ucHV0KFwiZW1haWxcIiwgcC5nZXRFbWFpbCgpKTtcbiAgICAgICAgbS5wdXQoXCJwaG9uZVwiLCBwLmdldFBob25lKCkpO1xuICAgICAgICBtLnB1dChcImFkZHJlc3NcIiwgcC5nZXRBZGRyZXNzKCkpO1xuICAgICAgICBtLnB1dChcImludHJvZHVjZVwiLCBwLmdldEludHJvZHVjZSgpKTtcbiAgICAgICAgcmV0dXJuIG07XG4gICAgfVxuXG4gICAgcHVibGljIExpc3Q8TWFwPFN0cmluZywgT2JqZWN0Pj4gZ2V0VGVhY2hlck1hcExpc3QoU3RyaW5nIG51bU5hbWUpIHtcbiAgICAgICAgTGlzdDxNYXA8U3RyaW5nLCBPYmplY3Q+PiBkYXRhTGlzdCA9IG5ldyBBcnJheUxpc3Q8PigpO1xuICAgICAgICBMaXN0PFRlYWNoZXI+IHNMaXN0ID0gdGVhY2hlclJlcG9zaXRvcnkuZmluZFRlYWNoZXJMaXN0QnlOdW1OYW1lKG51bU5hbWUpOyAgLy/mlbDmja7lupPmn6Xor6Lmk43kvZxcbiAgICAgICAgaWYgKHNMaXN0ID09IG51bGwgfHwgc0xpc3QuaXNFbXB0eSgpKVxuICAgICAgICAgICAgcmV0dXJuIGRhdGFMaXN0O1xuICAgICAgICBmb3IgKFRlYWNoZXIgdGVhY2hlciA6IHNMaXN0KSB7XG4gICAgICAgICAgICBkYXRhTGlzdC5hZGQoZ2V0TWFwRnJvbVRlYWNoZXIodGVhY2hlcikpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBkYXRhTGlzdDtcbiAgICB9XG5cbiAgICBwdWJsaWMgRGF0YVJlc3BvbnNlIGdldFRlYWNoZXJMaXN0KERhdGFSZXF1ZXN0IGRhdGFSZXF1ZXN0KSB7XG4gICAgICAgIFN0cmluZyBudW1OYW1lID0gZGF0YVJlcXVlc3QuZ2V0U3RyaW5nKFwibnVtTmFtZVwiKTtcbiAgICAgICAgTGlzdDxNYXA8U3RyaW5nLCBPYmplY3Q+PiBkYXRhTGlzdCA9IGdldFRlYWNoZXJNYXBMaXN0KG51bU5hbWUpO1xuICAgICAgICByZXR1cm4gQ29tbW9uTWV0aG9kLmdldFJldHVybkRhdGEoZGF0YUxpc3QpOyAgLy/mjInnhafmtYvor5XmoYbmnrbop4TojIPkvJrpgIFNYXDnmoRsaXN0XG4gICAgfVxuXG4gICAgcHVibGljIERhdGFSZXNwb25zZSB0ZWFjaGVyRGVsZXRlKERhdGFSZXF1ZXN0IGRhdGFSZXF1ZXN0KSB7XG4gICAgICAgIEludGVnZXIgcGVyc29uSWQgPSBkYXRhUmVxdWVzdC5nZXRJbnRlZ2VyKFwicGVyc29uSWRcIik7ICAvL+iOt+WPlnRlYWNoZXJfaWTlgLxcbiAgICAgICAgVGVhY2hlciBzID0gbnVsbDtcbiAgICAgICAgT3B0aW9uYWw8VGVhY2hlcj4gb3A7XG4gICAgICAgIGlmIChwZXJzb25JZCAhPSBudWxsICYmIHBlcnNvbklkID4gMCkge1xuICAgICAgICAgICAgb3AgPSB0ZWFjaGVyUmVwb3NpdG9yeS5maW5kQnlJZChwZXJzb25JZCk7ICAgLy/mn6Xor6Lojrflvpflrp7kvZPlr7nosaFcbiAgICAgICAgICAgIGlmIChvcC5pc1ByZXNlbnQoKSkge1xuICAgICAgICAgICAgICAgIHMgPSBvcC5nZXQoKTtcbiAgICAgICAgICAgICAgICBPcHRpb25hbDxVc2VyPiB1T3AgPSB1c2VyUmVwb3NpdG9yeS5maW5kQnlJZChwZXJzb25JZCk7IC8v5p+l6K+i5a+55bqU6K+l5pWZ5biI55qE6LSm5oi3XG4gICAgICAgICAgICAgICAgLy/liKDpmaTlr7nlupTor6XmlZnluIjnmoTotKbmiLdcbiAgICAgICAgICAgICAgICB1T3AuaWZQcmVzZW50KHVzZXJSZXBvc2l0b3J5OjpkZWxldGUpO1xuICAgICAgICAgICAgICAgIFBlcnNvbiBwID0gcy5nZXRQZXJzb24oKTtcbiAgICAgICAgICAgICAgICB0ZWFjaGVyUmVwb3NpdG9yeS5kZWxldGUocyk7ICAgIC8v6aaW5YWI5pWw5o2u5bqT5rC45LmF5Yig6Zmk5pWZ5biI5L+h5oGvXG4gICAgICAgICAgICAgICAgcGVyc29uUmVwb3NpdG9yeS5kZWxldGUocCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIENvbW1vbk1ldGhvZC5nZXRSZXR1cm5NZXNzYWdlT0soKTsgIC8v6YCa55+l5YmN56uv5pON5L2c5q2j5bi4XG4gICAgfVxuXG4gICAgcHVibGljIERhdGFSZXNwb25zZSBnZXRUZWFjaGVySW5mbyhEYXRhUmVxdWVzdCBkYXRhUmVxdWVzdCkge1xuICAgICAgICBJbnRlZ2VyIHBlcnNvbklkID0gZGF0YVJlcXVlc3QuZ2V0SW50ZWdlcihcInBlcnNvbklkXCIpO1xuICAgICAgICBUZWFjaGVyIHMgPSBudWxsO1xuICAgICAgICBPcHRpb25hbDxUZWFjaGVyPiBvcDtcbiAgICAgICAgaWYgKHBlcnNvbklkICE9IG51bGwpIHtcbiAgICAgICAgICAgIG9wID0gdGVhY2hlclJlcG9zaXRvcnkuZmluZEJ5SWQocGVyc29uSWQpOyAvL+agueaNruWtpueUn+S4u+mUruS7juaVsOaNruW6k+afpeivouWtpueUn+eahOS/oeaBr1xuICAgICAgICAgICAgaWYgKG9wLmlzUHJlc2VudCgpKSB7XG4gICAgICAgICAgICAgICAgcyA9IG9wLmdldCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBDb21tb25NZXRob2QuZ2V0UmV0dXJuRGF0YShnZXRNYXBGcm9tVGVhY2hlcihzKSk7IC8v6L+Z6YeM5Zue5Lyg5YyF5ZCr5a2m55Sf5L+h5oGv55qETWFw5a+56LGhXG4gICAgfVxuXG4gICAgcHVibGljIERhdGFSZXNwb25zZSB0ZWFjaGVyRWRpdFNhdmUoRGF0YVJlcXVlc3QgZGF0YVJlcXVlc3QpIHtcbiAgICAgICAgSW50ZWdlciBwZXJzb25JZCA9IGRhdGFSZXF1ZXN0LmdldEludGVnZXIoXCJwZXJzb25JZFwiKTtcbiAgICAgICAgTWFwPFN0cmluZywgT2JqZWN0PiBmb3JtID0gZGF0YVJlcXVlc3QuZ2V0TWFwKFwiZm9ybVwiKTsgLy/lj4LmlbDojrflj5ZNYXDlr7nosaFcbiAgICAgICAgU3RyaW5nIG51bSA9IENvbW1vbk1ldGhvZC5nZXRTdHJpbmcoZm9ybSwgXCJudW1cIik7ICAvL01hcCDojrflj5blsZ7mgKfnmoTlgLxcbiAgICAgICAgVGVhY2hlciBzID0gbnVsbDtcbiAgICAgICAgUGVyc29uIHA7XG4gICAgICAgIFVzZXIgdTtcbiAgICAgICAgT3B0aW9uYWw8VGVhY2hlcj4gb3A7XG4gICAgICAgIGJvb2xlYW4gaXNOZXcgPSBmYWxzZTtcbiAgICAgICAgaWYgKHBlcnNvbklkICE9IG51bGwpIHtcbiAgICAgICAgICAgIG9wID0gdGVhY2hlclJlcG9zaXRvcnkuZmluZEJ5SWQocGVyc29uSWQpOyAgLy/mn6Xor6Llr7nlupTmlbDmja7lupPkuK3kuLvplK7kuLppZOeahOWAvOeahOWunuS9k+WvueixoVxuICAgICAgICAgICAgaWYgKG9wLmlzUHJlc2VudCgpKSB7XG4gICAgICAgICAgICAgICAgcyA9IG9wLmdldCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIE9wdGlvbmFsPFBlcnNvbj4gbk9wID0gcGVyc29uUmVwb3NpdG9yeS5maW5kQnlOdW0obnVtKTsgLy/mn6Xor6LmmK/lkKblrZjlnKhudW3nmoTkurrlkZhcbiAgICAgICAgaWYgKG5PcC5pc1ByZXNlbnQoKSkge1xuICAgICAgICAgICAgaWYgKHMgPT0gbnVsbCB8fCAhcy5nZXRQZXJzb24oKS5nZXROdW0oKS5lcXVhbHMobnVtKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBDb21tb25NZXRob2QuZ2V0UmV0dXJuTWVzc2FnZUVycm9yKFwi5paw5bel5Y+35bey57uP5a2Y5Zyo77yM5LiN6IO95re75Yqg5oiW5L+u5pS577yBXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmIChzID09IG51bGwpIHtcbiAgICAgICAgICAgIHAgPSBuZXcgUGVyc29uKCk7XG4gICAgICAgICAgICBwLnNldE51bShudW0pO1xuICAgICAgICAgICAgcC5zZXRUeXBlKFwiMlwiKTsgIC8vIDLooajnpLrmlZnluIjnsbvlnotcbiAgICAgICAgICAgIHBlcnNvblJlcG9zaXRvcnkuc2F2ZUFuZEZsdXNoKHApOyAgLy/mj5LlhaXmlrDnmoRQZXJzb27orrDlvZVcbiAgICAgICAgICAgIHBlcnNvbklkID0gcC5nZXRQZXJzb25JZCgpO1xuICAgICAgICAgICAgU3RyaW5nIHBhc3N3b3JkID0gZW5jb2Rlci5lbmNvZGUoXCIxMjM0NTZcIik7XG4gICAgICAgICAgICB1ID0gbmV3IFVzZXIoKTtcbiAgICAgICAgICAgIHUuc2V0UGVyc29uSWQocGVyc29uSWQpO1xuICAgICAgICAgICAgdS5zZXRVc2VyTmFtZShudW0pO1xuICAgICAgICAgICAgdS5zZXRQYXNzd29yZChwYXNzd29yZCk7XG4gICAgICAgICAgICB1LnNldFVzZXJUeXBlKHVzZXJUeXBlUmVwb3NpdG9yeS5maW5kQnlOYW1lKEVVc2VyVHlwZS5ST0xFX1RFQUNIRVIpKTsgIC8vIOiuvue9ruS4uuaVmeW4iOinkuiJslxuICAgICAgICAgICAgdS5zZXRDcmVhdGVUaW1lKERhdGVUaW1lVG9vbC5wYXJzZURhdGVUaW1lKG5ldyBEYXRlKCkpKTtcbiAgICAgICAgICAgIHUuc2V0Q3JlYXRvcklkKENvbW1vbk1ldGhvZC5nZXRQZXJzb25JZCgpKTtcbiAgICAgICAgICAgIHVzZXJSZXBvc2l0b3J5LnNhdmVBbmRGbHVzaCh1KTsgLy/mj5LlhaXmlrDnmoRVc2Vy6K6w5b2VXG4gICAgICAgICAgICBzID0gbmV3IFRlYWNoZXIoKTsgICAvLyDliJvlu7rlrp7kvZPlr7nosaFcbiAgICAgICAgICAgIHMuc2V0UGVyc29uSWQocGVyc29uSWQpO1xuICAgICAgICAgICAgdGVhY2hlclJlcG9zaXRvcnkuc2F2ZUFuZEZsdXNoKHMpOyAgLy/mj5LlhaXmlrDnmoRUZWFjaGVy6K6w5b2VXG4gICAgICAgICAgICBpc05ldyA9IHRydWU7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBwID0gcy5nZXRQZXJzb24oKTtcbiAgICAgICAgfVxuLi4uXG4gICAgICAgIHAuc2V0TmFtZShDb21tb25NZXRob2QuZ2V0U3RyaW5nKGZvcm0sIFwibmFtZVwiKSk7XG4gICAgICAgIHAuc2V0RGVwdChDb21tb25NZXRob2QuZ2V0U3RyaW5nKGZvcm0sIFwiZGVwdFwiKSk7XG4gICAgICAgIHAuc2V0Q2FyZChDb21tb25NZXRob2QuZ2V0U3RyaW5nKGZvcm0sIFwiY2FyZFwiKSk7XG4gICAgICAgIHAuc2V0R2VuZGVyKENvbW1vbk1ldGhvZC5nZXRTdHJpbmcoZm9ybSwgXCJnZW5kZXJcIikpO1xuICAgICAgICBwLnNldEJpcnRoZGF5KENvbW1vbk1ldGhvZC5nZXRTdHJpbmcoZm9ybSwgXCJiaXJ0aGRheVwiKSk7XG4gICAgICAgIHAuc2V0RW1haWwoQ29tbW9uTWV0aG9kLmdldFN0cmluZyhmb3JtLCBcImVtYWlsXCIpKTtcbiAgICAgICAgcC5zZXRQaG9uZShDb21tb25NZXRob2QuZ2V0U3RyaW5nKGZvcm0sIFwicGhvbmVcIikpO1xuICAgICAgICBwLnNldEFkZHJlc3MoQ29tbW9uTWV0aG9kLmdldFN0cmluZyhmb3JtLCBcImFkZHJlc3NcIikpO1xuICAgICAgICBwZXJzb25SZXBvc2l0b3J5LnNhdmUocCk7ICAvLyDkv67mlLnkv53lrZjkurrlkZjkv6Hmga9cbiAgICAgICAgcy5zZXRDbGFzc05hbWUoQ29tbW9uTWV0aG9kLmdldFN0cmluZyhmb3JtLCBcImNsYXNzTmFtZVwiKSk7XG4gICAgICAgIHRlYWNoZXJSZXBvc2l0b3J5LnNhdmUocyk7ICAvL+S/ruaUueS/neWtmOWtpueUn+S/oeaBr1xuICAgICAgICBzeXN0ZW1TZXJ2aWNlLm1vZGlmeUxvZyhzLCBpc05ldyk7XG4gICAgICAgIHJldHVybiBDb21tb25NZXRob2QuZ2V0UmV0dXJuRGF0YShzLmdldFBlcnNvbklkKCkpOyAgLy8g5bCGcGVyc29uSWTov5Tlm57liY3nq69cbiAgICB9XG5cbiAgICBwdWJsaWMgUmVzcG9uc2VFbnRpdHk8U3RyZWFtaW5nUmVzcG9uc2VCb2R5PiBnZXRUZWFjaGVyTGlzdEV4Y2woRGF0YVJlcXVlc3QgZGF0YVJlcXVlc3QpIHtcbiAgICAgICAgU3RyaW5nIG51bU5hbWUgPSBkYXRhUmVxdWVzdC5nZXRTdHJpbmcoXCJudW1OYW1lXCIpO1xuICAgICAgICBMaXN0PE1hcDxTdHJpbmcsIE9iamVjdD4+IGxpc3QgPSBnZXRUZWFjaGVyTWFwTGlzdChudW1OYW1lKTtcblxuICAgICAgICAvLyDosIPmlbTliJflrr3phY3nva5cbiAgICAgICAgSW50ZWdlcltdIHdpZHRocyA9IHs4LCAxNSwgMTAsIDIwLCAxNSwgMTAsIDgsIDI1LCAxNSwgMzB9O1xuICAgICAgICBTdHJpbmdbXSB0aXRsZXMgPSB7XCLluo/lj7dcIiwgXCLlt6Xlj7dcIiwgXCLlp5PlkI1cIiwgXCLlrabpmaJcIiwgXCLogYznp7BcIiwgXCLlrabkvY1cIiwgXCLmgKfliKtcIiwgXCLpgq7nrrFcIiwgXCLnlLXor51cIiwgXCLlnLDlnYBcIn07XG4gICAgICAgIFN0cmluZyBvdXRQdXRTaGVldE5hbWUgPSBcInRlYWNoZXIueGxzeFwiO1xuXG4gICAgICAgIFhTU0ZXb3JrYm9vayB3YiA9IG5ldyBYU1NGV29ya2Jvb2soKTtcbiAgICAgICAgWFNTRlNoZWV0IHNoZWV0ID0gd2IuY3JlYXRlU2hlZXQob3V0UHV0U2hlZXROYW1lKTtcblxuICAgICAgICAvLyDorr7nva7liJflrr1cbiAgICAgICAgZm9yIChpbnQgaiA9IDA7IGogPCB3aWR0aHMubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgICAgIHNoZWV0LnNldENvbHVtbldpZHRoKGosIHdpZHRoc1tqXSAqIDI1Nik7XG4gICAgICAgIH1cbi4uLlxuXG4gICAgICAgICAgICAgICAgLy8g5aGr5YWF5YW35L2T5pWw5o2uXG4gICAgICAgICAgICAgICAgY2VsbFswXS5zZXRDZWxsVmFsdWUoKGkgKyAxKSArIFwiXCIpOyAvLyDluo/lj7dcbiAgICAgICAgICAgICAgICBjZWxsWzFdLnNldENlbGxWYWx1ZShDb21tb25NZXRob2QuZ2V0U3RyaW5nKG0sIFwibnVtXCIpKTsgLy8g5bel5Y+3XG4gICAgICAgICAgICAgICAgY2VsbFsyXS5zZXRDZWxsVmFsdWUoQ29tbW9uTWV0aG9kLmdldFN0cmluZyhtLCBcIm5hbWVcIikpOyAvLyDlp5PlkI1cbiAgICAgICAgICAgICAgICBjZWxsWzNdLnNldENlbGxWYWx1ZShDb21tb25NZXRob2QuZ2V0U3RyaW5nKG0sIFwiZGVwdFwiKSk7IC8vIOWtpumZolxuICAgICAgICAgICAgICAgIGNlbGxbNF0uc2V0Q2VsbFZhbHVlKENvbW1vbk1ldGhvZC5nZXRTdHJpbmcobSwgXCJ0aXRsZVwiKSk7IC8vIOiBjOensFxuICAgICAgICAgICAgICAgIGNlbGxbNV0uc2V0Q2VsbFZhbHVlKENvbW1vbk1ldGhvZC5nZXRTdHJpbmcobSwgXCJkZWdyZWVcIikpOyAvLyDlrabkvY1cbiAgICAgICAgICAgICAgICBjZWxsWzZdLnNldENlbGxWYWx1ZShDb21tb25NZXRob2QuZ2V0U3RyaW5nKG0sIFwiZ2VuZGVyTmFtZVwiKSk7IC8vIOaAp+WIq1xuICAgICAgICAgICAgICAgIGNlbGxbN10uc2V0Q2VsbFZhbHVlKENvbW1vbk1ldGhvZC5nZXRTdHJpbmcobSwgXCJlbWFpbFwiKSk7IC8vIOmCrueusVxuICAgICAgICAgICAgICAgIGNlbGxbOF0uc2V0Q2VsbFZhbHVlKENvbW1vbk1ldGhvZC5nZXRTdHJpbmcobSwgXCJwaG9uZVwiKSk7IC8vIOeUteivnVxuICAgICAgICAgICAgICAgIGNlbGxbOV0uc2V0Q2VsbFZhbHVlKENvbW1vbk1ldGhvZC5nZXRTdHJpbmcobSwgXCJhZGRyZXNzXCIpKTsgLy8g5Zyw5Z2AXG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbi4uLlxuXG4gICAgcHVibGljIERhdGFSZXNwb25zZSBnZXRUZWFjaGVyUGFnZURhdGEoRGF0YVJlcXVlc3QgZGF0YVJlcXVlc3QpIHtcbiAgICAgICAgU3RyaW5nIG51bU5hbWUgPSBkYXRhUmVxdWVzdC5nZXRTdHJpbmcoXCJudW1OYW1lXCIpO1xuICAgICAgICBJbnRlZ2VyIGNQYWdlID0gZGF0YVJlcXVlc3QuZ2V0Q3VycmVudFBhZ2UoKTtcbiAgICAgICAgaW50IGRhdGFUb3RhbCA9IDA7XG4gICAgICAgIGludCBzaXplID0gNDA7XG4gICAgICAgIExpc3Q8TWFwPFN0cmluZywgT2JqZWN0Pj4gZGF0YUxpc3QgPSBuZXcgQXJyYXlMaXN0PD4oKTtcbiAgICAgICAgUGFnZTxUZWFjaGVyPiBwYWdlID0gbnVsbDtcbiAgICAgICAgUGFnZWFibGUgcGFnZWFibGUgPSBQYWdlUmVxdWVzdC5vZihjUGFnZSwgc2l6ZSk7XG4gICAgICAgIHBhZ2UgPSB0ZWFjaGVyUmVwb3NpdG9yeS5maW5kVGVhY2hlckxpc3RCeU51bU5hbWUobnVtTmFtZSwgcGFnZWFibGUpO1xuICAgICAgICBNYXA8U3RyaW5nLCBPYmplY3Q+IG07XG4gICAgICAgIGlmIChwYWdlICE9IG51bGwpIHtcbiAgICAgICAgICAgIGRhdGFUb3RhbCA9IChpbnQpIHBhZ2UuZ2V0VG90YWxFbGVtZW50cygpO1xuICAgICAgICAgICAgTGlzdDxUZWFjaGVyPiBsaXN0ID0gcGFnZS5nZXRDb250ZW50KCk7XG4gICAgICAgICAgICBpZiAoIWxpc3QuaXNFbXB0eSgpKSB7XG4gICAgICAgICAgICAgICAgZm9yIChUZWFjaGVyIHRlYWNoZXIgOiBsaXN0KSB7XG4gICAgICAgICAgICAgICAgICAgIG0gPSBnZXRNYXBGcm9tVGVhY2hlcih0ZWFjaGVyKTtcbiAgICAgICAgICAgICAgICAgICAgZGF0YUxpc3QuYWRkKG0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuLi4uXG4iLCJpc19lcnJvciI6ZmFsc2UsInJlcXVlc3RfaWQiOiIiLCJ0b29sX3VzZV9pZCI6InRvb2x1X3ZydHhfMDFTVTRNYks1eDVjeXhuYzZ0UTJCVk1XIn19LHsiaWQiOjIsInR5cGUiOjQsImlkZV9zdGF0ZV9ub2RlIjp7IndvcmtzcGFjZUZvbGRlcnMiOlt7InJlcG9zaXRvcnlSb290IjoiQzovVXNlcnMvcHJpbmNpcC9Eb2N1bWVudHMvR2l0SHViL2JhaWNhaS9qYXZhLXNlcnZlciIsImZvbGRlclJvb3QiOiJDOi9Vc2Vycy9wcmluY2lwL0RvY3VtZW50cy9HaXRIdWIvYmFpY2FpL2phdmEtc2VydmVyIn1dLCJ3b3Jrc3BhY2VGb2xkZXJzVW5jaGFuZ2VkIjpmYWxzZX19XSwidGltZXN0YW1wIjoiMjAyNS0wNS0xNlQxNTowNTowNC4xNjJaIiwicmVzcG9uc2VfdGV4dCI6IuiuqeaIkeafpeeci+S4gOS4iyBgQ29tbW9uTWV0aG9kYCDnsbvvvIzlm6DkuLrlroPlj6/og73ljIXlkKvnsbvlnovovazmjaLnmoTmlrnms5XvvJpcbiIsIndvcmtzcGFjZV9maWxlX2NodW5rcyI6W119LHsic3RhdHVzIjoic3VjY2VzcyIsInJlcXVlc3RfaWQiOiJiNzkyYjNlYS0xOTZjLTQwNjItOTRlZS1mZDgzNjlkNzA5NDgiLCJyZXF1ZXN0X21lc3NhZ2UiOiIiLCJzdHJ1Y3R1cmVkX291dHB1dF9ub2RlcyI6W3siaWQiOjEsInR5cGUiOjUsImNvbnRlbnQiOiIiLCJ0b29sX3VzZSI6eyJ0b29sX3VzZV9pZCI6InRvb2x1X3ZydHhfMDFDQ3ZHWk1aQ1JKU1k2MjVwNXlBbnpnIiwidG9vbF9uYW1lIjoiY29kZWJhc2UtcmV0cmlldmFsIiwiaW5wdXRfanNvbiI6IntcImluZm9ybWF0aW9uX3JlcXVlc3RcIjogXCJcXHU2N2U1XFx1NjI3ZSBGYW1pbHlNZW1iZXIgXFx1N2M3YlxcdTc2ODRcXHU1YjlhXFx1NGU0OVxcdTU0OGNcXHU1YzVlXFx1NjAyN1xcdWZmMGNcXHU3Mjc5XFx1NTIyYlxcdTY2MmYgYWdlIFxcdTVjNWVcXHU2MDI3XFx1NzY4NFxcdTdjN2JcXHU1NzhiXCJ9IiwibWNwX3NlcnZlcl9uYW1lIjoiIiwibWNwX3Rvb2xfbmFtZSI6IiJ9fSx7ImlkIjowLCJ0eXBlIjowLCJjb250ZW50Ijoi6K6p5oiR5p+l55yL5LiA5LiLIGBGYW1pbHlNZW1iZXJgIOexu++8jOWboOS4uuWcqCBgVGVhY2hlclNlcnZpY2VzLmphdmFgIOS4reacieWFs+S6juWutuW6reaIkOWRmOeahOWkhOeQhu+8mlxuIn0seyJpZCI6MiwidHlwZSI6MiwiY29udGVudCI6IiJ9LHsiaWQiOjMsInR5cGUiOjMsImNvbnRlbnQiOiIifV0sInNlZW5fc3RhdGUiOiJzZWVuIiwic3RydWN0dXJlZF9yZXF1ZXN0X25vZGVzIjpbeyJpZCI6MSwidHlwZSI6MSwidG9vbF9yZXN1bHRfbm9kZSI6eyJjb250ZW50IjoiVGhlIGZvbGxvd2luZyBjb2RlIHNlY3Rpb25zIHdlcmUgcmV0cmlldmVkOlxuUGF0aDogc3JjL21haW4vamF2YS9jbi9lZHUvc2R1L2phdmEvc2VydmVyL3V0aWwvQ29tbW9uTWV0aG9kLmphdmFcbi4uLlxuXG4gICAgcHVibGljIHN0YXRpYyBTdHJpbmcgZ2V0TmV4dE51bTIoU3RyaW5nIG51bSkge1xuICAgICAgICBTdHJpbmcgc3RyO1xuICAgICAgICBTdHJpbmcgcHJlZml4O1xuICAgICAgICBpZihudW0ubGVuZ3RoKCkgPT0gMikge1xuICAgICAgICAgICAgc3RyID0gbnVtO1xuICAgICAgICAgICAgcHJlZml4PSBcIlwiO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgc3RyID0gbnVtLnN1YnN0cmluZyhudW0ubGVuZ3RoKCkgLSAyKTtcbiAgICAgICAgICAgIHByZWZpeCA9IG51bS5zdWJzdHJpbmcoMCxudW0ubGVuZ3RoKCkgLSAyKTtcbiAgICAgICAgfVxuICAgICAgICBpbnQgYztcbiAgICAgICAgaWYoc3RyLmNoYXJBdCgwKT09JzAnKSB7XG4gICAgICAgICAgICBjID0gc3RyLmNoYXJBdCgxKS0nMCc7XG4gICAgICAgIH1lbHNlIHtcbiAgICAgICAgICAgIGMgPSAoc3RyLmNoYXJBdCgwKS0nMCcpKjEwICsgc3RyLmNoYXJBdCgxKS0nMCc7XG4gICAgICAgIH1cbiAgICAgICAgYysrO1xuICAgICAgICBpZihjIDwgMTApIHtcbiAgICAgICAgICAgIHJldHVybiBwcmVmaXgrXCIwXCIgKyBjO1xuICAgICAgICB9ZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gcHJlZml4KyBjO1xuICAgICAgICB9XG4gICAgfVxuLi4uXG4gICAgcHVibGljIHN0YXRpYyBTdHJpbmcgZ2V0TmV4dE51bTQoIFN0cmluZyBudW0pIHtcbiAgICAgICAgU3RyaW5nIHN0cjtcbiAgICAgICAgU3RyaW5nIHByZWZpeDtcbiAgICAgICAgaWYobnVtLmxlbmd0aCgpID09IDQpIHtcbiAgICAgICAgICAgIHN0ciA9IG51bTtcbiAgICAgICAgICAgIHByZWZpeD0gXCJcIjtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHN0ciA9IG51bS5zdWJzdHJpbmcobnVtLmxlbmd0aCgpIC0gNCk7XG4gICAgICAgICAgICBwcmVmaXggPSBudW0uc3Vic3RyaW5nKDAsbnVtLmxlbmd0aCgpIC0gNCk7XG4gICAgICAgIH1cbiAgICAgICAgaW50IGM7XG4gICAgICAgIGlmKHN0ci5jaGFyQXQoMCk9PScwJykge1xuICAgICAgICAgICAgaWYgKHN0ci5jaGFyQXQoMSkgPT0gJzAnKSB7XG4gICAgICAgICAgICAgICAgaWYgKHN0ci5jaGFyQXQoMikgPT0gJzAnKSB7XG4gICAgICAgICAgICAgICAgICAgIGMgPSBzdHIuY2hhckF0KDMpIC0gJzAnO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGMgPSAoc3RyLmNoYXJBdCgyKSAtICcwJykgKiAxMCArIHN0ci5jaGFyQXQoMykgLSAnMCc7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBjID0gKHN0ci5jaGFyQXQoMSkgLSAnMCcpICogMTAwICsgKHN0ci5jaGFyQXQoMikgLSAnMCcpICogMTAgKyBzdHIuY2hhckF0KDMpIC0gJzAnO1xuICAgICAgICAgICAgfVxuICAgICAgICB9ZWxzZSB7XG4gICAgICAgICAgICBjID0gKHN0ci5jaGFyQXQoMCkgLSAnMCcpICogMTAwMCArIChzdHIuY2hhckF0KDEpIC0gJzAnKSAqIDEwMCArIChzdHIuY2hhckF0KDIpIC0gJzAnKSAqIDEwICsgc3RyLmNoYXJBdCgzKSAtICcwJztcbiAgICAgICAgfVxuICAgICAgICBjKys7XG4gICAgICAgIGlmKGMgPCAxMCkge1xuICAgICAgICAgICAgcmV0dXJuIHByZWZpeCtcIjAwMFwiICsgYztcbiAgICAgICAgfWVsc2UgaWYoYyA8IDEwMCkge1xuICAgICAgICAgICAgcmV0dXJuIHByZWZpeCtcIjAwXCIgKyBjO1xuICAgICAgICB9ZWxzZSBpZihjIDwgMTAwMCl7XG4gICAgICAgICAgICByZXR1cm4gcHJlZml4ICsgXCIwXCIgKyBjO1xuICAgICAgICB9ZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gcHJlZml4KyBjO1xuICAgICAgICB9XG4gICAgfVxuICAgIHB1YmxpYyBzdGF0aWMgU3RyaW5nW10gZ2V0U3RyaW5ncyhNYXA8U3RyaW5nLE9iamVjdD4gZGF0YSxTdHJpbmcga2V5KXtcbiAgICAgICAgT2JqZWN0IG9iaiA9IGRhdGEuZ2V0KGtleSk7XG4gICAgICAgIGlmKG9iaiA9PSBudWxsKVxuICAgICAgICAgICAgcmV0dXJuIG5ldyBTdHJpbmdbXXt9O1xuICAgICAgICBpZihvYmogaW5zdGFuY2VvZiBTdHJpbmdbXSlcbiAgICAgICAgICAgIHJldHVybiAoU3RyaW5nW10pb2JqO1xuICAgICAgICByZXR1cm4gbmV3IFN0cmluZ1tde307XG4gICAgfVxuXG4gICAgcHVibGljIHN0YXRpYyBTdHJpbmcgZ2V0U3RyaW5nKE1hcDxTdHJpbmcsT2JqZWN0PiBkYXRhLFN0cmluZyBrZXkpe1xuICAgICAgICBPYmplY3Qgb2JqID0gZGF0YS5nZXQoa2V5KTtcbiAgICAgICAgaWYob2JqID09IG51bGwpXG4gICAgICAgICAgICByZXR1cm4gXCJcIjtcbiAgICAgICAgaWYob2JqIGluc3RhbmNlb2YgU3RyaW5nKVxuICAgICAgICAgICAgcmV0dXJuIChTdHJpbmcpb2JqO1xuICAgICAgICByZXR1cm4gb2JqLnRvU3RyaW5nKCk7XG4gICAgfVxuICAgIHB1YmxpYyBzdGF0aWMgQm9vbGVhbiBnZXRCb29sZWFuKE1hcDxTdHJpbmcsT2JqZWN0PiBkYXRhLFN0cmluZyBrZXkpe1xuICAgICAgICBPYmplY3Qgb2JqID0gZGF0YS5nZXQoa2V5KTtcbiAgICAgICAgaWYob2JqID09IG51bGwpXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIGlmKG9iaiBpbnN0YW5jZW9mIEJvb2xlYW4pXG4gICAgICAgICAgICByZXR1cm4gKEJvb2xlYW4pb2JqO1xuICAgICAgICByZXR1cm4gXCJ0cnVlXCIuZXF1YWxzKG9iai50b1N0cmluZygpKTtcbiAgICB9XG4gICAgcHVibGljIHN0YXRpYyBMaXN0PD8+IGdldExpc3QoTWFwPFN0cmluZyxPYmplY3Q+IGRhdGEsIFN0cmluZyBrZXkpe1xuICAgICAgICBPYmplY3Qgb2JqID0gZGF0YS5nZXQoa2V5KTtcbiAgICAgICAgaWYob2JqID09IG51bGwpXG4gICAgICAgICAgICByZXR1cm4gbmV3IEFycmF5TGlzdDw+KCk7XG4gICAgICAgIGlmKG9iaiBpbnN0YW5jZW9mIExpc3QpXG4gICAgICAgICAgICByZXR1cm4gKExpc3Q8Pz4pb2JqO1xuICAgICAgICBlbHNlXG4gICAgICAgICAgICByZXR1cm4gbmV3IEFycmF5TGlzdDw+KCk7XG4gICAgfVxuICAgIHB1YmxpYyBzdGF0aWMgTWFwPFN0cmluZyxPYmplY3Q+IGdldE1hcChNYXA8U3RyaW5nLE9iamVjdD4gZGF0YSxTdHJpbmcga2V5KXtcbiAgICAgICAgT2JqZWN0IG9iaiA9IGRhdGEuZ2V0KGtleSk7XG4gICAgICAgIGlmKG9iaiA9PSBudWxsKVxuICAgICAgICAgICAgcmV0dXJuIG5ldyBIYXNoTWFwPD4oKTtcbiAgICAgICAgaWYob2JqIGluc3RhbmNlb2YgTWFwKVxuICAgICAgICAgICAgcmV0dXJuIChNYXA8U3RyaW5nLCBPYmplY3Q+KSBvYmo7XG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIHJldHVybiBuZXcgSGFzaE1hcDw+KCk7XG4gICAgfVxuXG4gICAgcHVibGljIHN0YXRpYyBJbnRlZ2VyIGdldEludGVnZXIoTWFwPFN0cmluZyxPYmplY3Q+IGRhdGEsU3RyaW5nIGtleSkge1xuICAgICAgICBPYmplY3Qgb2JqID0gZGF0YS5nZXQoa2V5KTtcbiAgICAgICAgaWYob2JqID09IG51bGwpXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgaWYob2JqIGluc3RhbmNlb2YgSW50ZWdlcilcbiAgICAgICAgICAgIHJldHVybiAoSW50ZWdlcilvYmo7XG4gICAgICAgIFN0cmluZyBzdHIgPSBvYmoudG9TdHJpbmcoKTtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIHJldHVybiAoaW50KURvdWJsZS5wYXJzZURvdWJsZShzdHIpO1xuICAgICAgICB9Y2F0Y2goRXhjZXB0aW9uIGUpIHtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgfVxuICAgIHB1YmxpYyBzdGF0aWMgSW50ZWdlciBnZXRJbnRlZ2VyMChNYXA8U3RyaW5nLE9iamVjdD4gZGF0YSxTdHJpbmcga2V5KSB7XG4gICAgICAgIE9iamVjdCBvYmogPSBkYXRhLmdldChrZXkpO1xuICAgICAgICBpZihvYmogPT0gbnVsbClcbiAgICAgICAgICAgIHJldHVybiAwO1xuICAgICAgICBpZihvYmogaW5zdGFuY2VvZiBJbnRlZ2VyKVxuICAgICAgICAgICAgcmV0dXJuIChJbnRlZ2VyKW9iajtcbiAgICAgICAgU3RyaW5nIHN0ciA9IG9iai50b1N0cmluZygpO1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgcmV0dXJuIChpbnQpRG91YmxlLnBhcnNlRG91YmxlKHN0cik7XG4gICAgICAgIH1jYXRjaChFeGNlcHRpb24gZSkge1xuICAgICAgICAgICAgcmV0dXJuIDA7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcHVibGljIHN0YXRpYyBMb25nIGdldExvbmcoTWFwPFN0cmluZyxPYmplY3Q+IGRhdGEsU3RyaW5nIGtleSkge1xuICAgICAgICBPYmplY3Qgb2JqID0gZGF0YS5nZXQoa2V5KTtcbiAgICAgICAgaWYob2JqID09IG51bGwpXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgaWYob2JqIGluc3RhbmNlb2YgTG9uZylcbiAgICAgICAgICAgIHJldHVybiAoTG9uZylvYmo7XG4gICAgICAgIFN0cmluZyBzdHIgPSBvYmoudG9TdHJpbmcoKTtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIHJldHVybiBMb25nLnBhcnNlTG9uZyhzdHIpO1xuICAgICAgICB9Y2F0Y2goRXhjZXB0aW9uIGUpIHtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHVibGljIHN0YXRpYyBEb3VibGUgZ2V0RG91YmxlKE1hcDxTdHJpbmcsT2JqZWN0PiBkYXRhLFN0cmluZyBrZXkpIHtcbiAgICAgICAgT2JqZWN0IG9iaiA9IGRhdGEuZ2V0KGtleSk7XG4gICAgICAgIGlmKG9iaiA9PSBudWxsKVxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIGlmKG9iaiBpbnN0YW5jZW9mIERvdWJsZSlcbiAgICAgICAgICAgIHJldHVybiAoRG91YmxlKW9iajtcbiAgICAgICAgU3RyaW5nIHN0ciA9IG9iai50b1N0cmluZygpO1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgcmV0dXJuIERvdWJsZS5wYXJzZURvdWJsZShzdHIpO1xuICAgICAgICB9Y2F0Y2goRXhjZXB0aW9uIGUpIHtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgfVxuICAgIHB1YmxpYyBzdGF0aWMgRG91YmxlIGdldERvdWJsZTAoTWFwPFN0cmluZyxPYmplY3Q+IGRhdGEsU3RyaW5nIGtleSkge1xuICAgICAgICBEb3VibGUgZDAgPSAwZDtcbiAgICAgICAgT2JqZWN0IG9iaiA9IGRhdGEuZ2V0KGtleSk7XG4gICAgICAgIGlmKG9iaiA9PSBudWxsKVxuICAgICAgICAgICAgcmV0dXJuIGQwO1xuICAgICAgICBpZihvYmogaW5zdGFuY2VvZiBEb3VibGUpXG4gICAgICAgICAgICByZXR1cm4gKERvdWJsZSlvYmo7XG4gICAgICAgIFN0cmluZyBzdHIgPSBvYmoudG9TdHJpbmcoKTtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIHJldHVybiBEb3VibGUucGFyc2VEb3VibGUoc3RyKTtcbiAgICAgICAgfWNhdGNoKEV4Y2VwdGlvbiBlKSB7XG4gICAgICAgICAgICByZXR1cm4gZDA7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcHVibGljIHN0YXRpYyBEYXRlIGdldERhdGUoTWFwPFN0cmluZyxPYmplY3Q+IGRhdGEsIFN0cmluZyBrZXkpIHtcbiAgICAgICAgT2JqZWN0IG9iaiA9IGRhdGEuZ2V0KGtleSk7XG4gICAgICAgIGlmKG9iaiA9PSBudWxsKVxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIGlmKG9iaiBpbnN0YW5jZW9mIERhdGUpXG4gICAgICAgICAgICByZXR1cm4gKERhdGUpb2JqO1xuICAgICAgICBTdHJpbmcgc3RyID0gb2JqLnRvU3RyaW5nKCk7XG4gICAgICAgIHJldHVybiBEYXRlVGltZVRvb2wuZm9ybWF0RGF0ZVRpbWUoc3RyLFwieXl5eS1NTS1kZFwiKTtcbiAgICB9XG4gICAgcHVibGljIHN0YXRpYyBEYXRlIGdldFRpbWUoTWFwPFN0cmluZyxPYmplY3Q+IGRhdGEsU3RyaW5nIGtleSkge1xuICAgICAgICBPYmplY3Qgb2JqID0gZGF0YS5nZXQoa2V5KTtcbiAgICAgICAgaWYob2JqID09IG51bGwpXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgaWYob2JqIGluc3RhbmNlb2YgRGF0ZSlcbiAgICAgICAgICAgIHJldHVybiAoRGF0ZSlvYmo7XG4gICAgICAgIFN0cmluZyBzdHIgPSBvYmoudG9TdHJpbmcoKTtcbiAgICAgICAgcmV0dXJuIERhdGVUaW1lVG9vbC5mb3JtYXREYXRlVGltZShzdHIsXCJ5eXl5LU1NLWRkIEhIOm1tOnNzXCIpO1xuICAgIH1cbi4uLlxuICAgIHB1YmxpYyBzdGF0aWMgRG91YmxlIGdldERvdWJsZTIoRG91YmxlIGYpIHtcbiAgICAgICAgaWYgKGYgPT0gbnVsbClcbiAgICAgICAgICAgIHJldHVybiAwZDtcbiAgICAgICAgQmlnRGVjaW1hbCBiZyA9IG5ldyBCaWdEZWNpbWFsKGYpO1xuICAgICAgICByZXR1cm4gYmcuc2V0U2NhbGUoMiwgQmlnRGVjaW1hbC5ST1VORF9IQUxGX1VQKS5kb3VibGVWYWx1ZSgpO1xuICAgIH1cbiAgICBwdWJsaWMgc3RhdGljIFN0cmluZyBPYmplY3RUb0pTb24oT2JqZWN0IG8pe1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgLy9w5piv5oyH5a6a6KaB6L2s5o2i55qE5a+56LGhXG4gICAgICAgICAgICBTdHJpbmcganNvbiA9IG1hcHBlci53cml0ZVZhbHVlQXNTdHJpbmcobyk7XG4gICAgICAgICAgICByZXR1cm4ganNvbjtcbiAgICAgICAgfWNhdGNoKEV4Y2VwdGlvbiBlKXtcbiAgICAgICAgICAgIHJldHVybiBcIlwiO1xuICAgICAgICB9XG4gICAgfVxuLi4uXG5QYXRoOiBzcmMvbWFpbi9qYXZhL2NvbS90ZWFjaC9qYXZhZngvdXRpbC9Db21tb25NZXRob2QuamF2YVxuLi4uXG5cbnB1YmxpYyBjbGFzcyBDb21tb25NZXRob2Qge1xuICAgIHB1YmxpYyBzdGF0aWMgU3RyaW5nW10gZ2V0U3RyaW5ncyhNYXA8U3RyaW5nLE9iamVjdD4gZGF0YSxTdHJpbmcga2V5KXtcbiAgICAgICAgT2JqZWN0IG9iaiA9IGRhdGEuZ2V0KGtleSk7XG4gICAgICAgIGlmKG9iaiA9PSBudWxsKVxuICAgICAgICAgICAgcmV0dXJuIG5ldyBTdHJpbmdbXXt9O1xuICAgICAgICBpZihvYmogaW5zdGFuY2VvZiBTdHJpbmdbXSlcbiAgICAgICAgICAgIHJldHVybiAoU3RyaW5nW10pb2JqO1xuICAgICAgICByZXR1cm4gbmV3IFN0cmluZ1tde307XG4gICAgfVxuXG4gICAgcHVibGljIHN0YXRpYyBTdHJpbmcgZ2V0U3RyaW5nKE1hcDxTdHJpbmcsT2JqZWN0PiBkYXRhLFN0cmluZyBrZXkpe1xuICAgICAgICBpZihkYXRhID09IG51bGwpXG4gICAgICAgICAgICByZXR1cm4gXCJcIjtcbiAgICAgICAgT2JqZWN0IG9iaiA9IGRhdGEuZ2V0KGtleSk7XG4gICAgICAgIGlmKG9iaiA9PSBudWxsKVxuICAgICAgICAgICAgcmV0dXJuIFwiXCI7XG4gICAgICAgIGlmKG9iaiBpbnN0YW5jZW9mIFN0cmluZylcbiAgICAgICAgICAgIHJldHVybiAoU3RyaW5nKW9iajtcbiAgICAgICAgcmV0dXJuIG9iai50b1N0cmluZygpO1xuICAgIH1cbiAgICBwdWJsaWMgc3RhdGljIEJvb2xlYW4gZ2V0Qm9vbGVhbihNYXA8U3RyaW5nLE9iamVjdD4gZGF0YSxTdHJpbmcga2V5KXtcbiAgICAgICAgaWYoZGF0YSA9PSBudWxsKVxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIE9iamVjdCBvYmogPSBkYXRhLmdldChrZXkpO1xuICAgICAgICBpZihvYmogPT0gbnVsbClcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgaWYob2JqIGluc3RhbmNlb2YgQm9vbGVhbilcbiAgICAgICAgICAgIHJldHVybiAoQm9vbGVhbilvYmo7XG4gICAgICAgIGlmKFwidHJ1ZVwiLmVxdWFscyhvYmoudG9TdHJpbmcoKSkpXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbi4uLlxuICAgIHB1YmxpYyBzdGF0aWMgSW50ZWdlciBnZXRJbnRlZ2VyRnJvbU9iamVjdChPYmplY3Qgb2JqKSB7XG4gICAgICAgIGlmKG9iaiA9PSBudWxsKVxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIGlmKG9iaiBpbnN0YW5jZW9mIEludGVnZXIpXG4gICAgICAgICAgICByZXR1cm4gKEludGVnZXIpb2JqO1xuICAgICAgICBTdHJpbmcgc3RyID0gb2JqLnRvU3RyaW5nKCk7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICByZXR1cm4gKGludClEb3VibGUucGFyc2VEb3VibGUoc3RyKTtcbiAgICAgICAgfWNhdGNoKEV4Y2VwdGlvbiBlKSB7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHB1YmxpYyBzdGF0aWMgSW50ZWdlciBnZXRJbnRlZ2VyKE1hcDxTdHJpbmcsT2JqZWN0PiBkYXRhLFN0cmluZyBrZXkpIHtcbiAgICAgICAgaWYoZGF0YSA9PSBudWxsKVxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIE9iamVjdCBvYmogPSBkYXRhLmdldChrZXkpO1xuICAgICAgICBpZihvYmogPT0gbnVsbClcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICBpZihvYmogaW5zdGFuY2VvZiBJbnRlZ2VyKVxuICAgICAgICAgICAgcmV0dXJuIChJbnRlZ2VyKW9iajtcbiAgICAgICAgU3RyaW5nIHN0ciA9IG9iai50b1N0cmluZygpO1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgcmV0dXJuIChpbnQpRG91YmxlLnBhcnNlRG91YmxlKHN0cik7XG4gICAgICAgIH1jYXRjaChFeGNlcHRpb24gZSkge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcHVibGljIHN0YXRpYyBJbnRlZ2VyIGdldEludGVnZXIwKE1hcDxTdHJpbmcsT2JqZWN0PiBkYXRhLFN0cmluZyBrZXkpIHtcbiAgICAgICAgaWYoZGF0YSA9PSBudWxsKVxuICAgICAgICAgICAgcmV0dXJuIDA7XG4gICAgICAgIE9iamVjdCBvYmogPSBkYXRhLmdldChrZXkpO1xuICAgICAgICBpZihvYmogPT0gbnVsbClcbiAgICAgICAgICAgIHJldHVybiAwO1xuICAgICAgICBpZihvYmogaW5zdGFuY2VvZiBJbnRlZ2VyKVxuICAgICAgICAgICAgcmV0dXJuIChJbnRlZ2VyKW9iajtcbiAgICAgICAgU3RyaW5nIHN0ciA9IG9iai50b1N0cmluZygpO1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgcmV0dXJuIChpbnQpRG91YmxlLnBhcnNlRG91YmxlKHN0cik7XG4gICAgICAgIH1jYXRjaChFeGNlcHRpb24gZSkge1xuICAgICAgICAgICAgcmV0dXJuIDA7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwdWJsaWMgc3RhdGljIERvdWJsZSBnZXREb3VibGUoTWFwPFN0cmluZyxPYmplY3Q+IGRhdGEsU3RyaW5nIGtleSkge1xuICAgICAgICBpZihkYXRhID09IG51bGwpXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgT2JqZWN0IG9iaiA9IGRhdGEuZ2V0KGtleSk7XG4gICAgICAgIGlmKG9iaiA9PSBudWxsKVxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIGlmKG9iaiBpbnN0YW5jZW9mIERvdWJsZSlcbiAgICAgICAgICAgIHJldHVybiAoRG91YmxlKW9iajtcbiAgICAgICAgU3RyaW5nIHN0ciA9IG9iai50b1N0cmluZygpO1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgcmV0dXJuIDBkO1xuICAgICAgICB9Y2F0Y2goRXhjZXB0aW9uIGUpIHtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgfVxuICAgIHB1YmxpYyBzdGF0aWMgRG91YmxlIGdldERvdWJsZTAoTWFwPFN0cmluZyxPYmplY3Q+IGRhdGEsU3RyaW5nIGtleSkge1xuICAgICAgICBEb3VibGUgZDAgPSAwZDtcbiAgICAgICAgT2JqZWN0IG9iaiA9IGRhdGEuZ2V0KGtleSk7XG4gICAgICAgIGlmKG9iaiA9PSBudWxsKVxuICAgICAgICAgICAgcmV0dXJuIGQwO1xuICAgICAgICBpZihvYmogaW5zdGFuY2VvZiBEb3VibGUpXG4gICAgICAgICAgICByZXR1cm4gKERvdWJsZSlvYmo7XG4gICAgICAgIFN0cmluZyBzdHIgPSBvYmoudG9TdHJpbmcoKTtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIHJldHVybiBkMDtcbiAgICAgICAgfWNhdGNoKEV4Y2VwdGlvbiBlKSB7XG4gICAgICAgICAgICByZXR1cm4gZDA7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcHVibGljIHN0YXRpYyBEYXRlIGdldERhdGUoTWFwPFN0cmluZyxPYmplY3Q+IGRhdGEsIFN0cmluZyBrZXkpIHtcbiAgICAgICAgaWYoZGF0YSA9PSBudWxsKVxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIE9iamVjdCBvYmogPSBkYXRhLmdldChrZXkpO1xuICAgICAgICBpZihvYmogPT0gbnVsbClcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICBpZihvYmogaW5zdGFuY2VvZiBEYXRlKVxuICAgICAgICAgICAgcmV0dXJuIChEYXRlKW9iajtcbiAgICAgICAgU3RyaW5nIHN0ciA9IG9iai50b1N0cmluZygpO1xuICAgICAgICByZXR1cm4gRGF0ZVRpbWVUb29sLmZvcm1hdERhdGVUaW1lKHN0cixcInl5eXktTU0tZGRcIik7XG4gICAgfVxuLi4uXG5QYXRoOiBzcmMvbWFpbi9qYXZhL2NuL2VkdS9zZHUvamF2YS9zZXJ2ZXIvcGF5bG9hZC9yZXF1ZXN0L0RhdGFSZXF1ZXN0LmphdmFcbi4uLlxuXG4gICAgcHVibGljIExpc3Q8Pz4gZ2V0TGlzdChTdHJpbmcga2V5KXtcbiAgICAgICAgT2JqZWN0IG9iaiA9IGRhdGEuZ2V0KGtleSk7XG4gICAgICAgIGlmKG9iaiA9PSBudWxsKVxuICAgICAgICAgICAgcmV0dXJuIG5ldyBBcnJheUxpc3Q8PigpO1xuICAgICAgICBpZihvYmogaW5zdGFuY2VvZiBMaXN0KVxuICAgICAgICAgICAgcmV0dXJuIChMaXN0PD8+KW9iajtcbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgcmV0dXJuIG5ldyBBcnJheUxpc3Q8PigpO1xuICAgIH1cbiAgICBwdWJsaWMgTWFwPFN0cmluZyxPYmplY3Q+IGdldE1hcChTdHJpbmcga2V5KXtcbiAgICAgICAgaWYoZGF0YSA9PSBudWxsKVxuICAgICAgICAgICAgcmV0dXJuIG5ldyBIYXNoTWFwPD4oKTtcbiAgICAgICAgT2JqZWN0IG9iaiA9IGRhdGEuZ2V0KGtleSk7XG4gICAgICAgIGlmKG9iaiA9PSBudWxsKVxuICAgICAgICAgICAgcmV0dXJuIG5ldyBIYXNoTWFwPD4oKTtcbiAgICAgICAgaWYob2JqIGluc3RhbmNlb2YgTWFwKVxuICAgICAgICAgICAgcmV0dXJuIChNYXA8U3RyaW5nLE9iamVjdD4pb2JqO1xuICAgICAgICBlbHNlXG4gICAgICAgICAgICByZXR1cm4gbmV3IEhhc2hNYXA8PigpO1xuICAgIH1cblxuICAgIHB1YmxpYyBJbnRlZ2VyIGdldEludGVnZXIoU3RyaW5nIGtleSkge1xuICAgICAgICBpZihkYXRhID09IG51bGwpXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgT2JqZWN0IG9iaiA9IGRhdGEuZ2V0KGtleSk7XG4gICAgICAgIGlmKG9iaiA9PSBudWxsKVxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIGlmKG9iaiBpbnN0YW5jZW9mIEludGVnZXIpXG4gICAgICAgICAgICByZXR1cm4gKEludGVnZXIpb2JqO1xuICAgICAgICBTdHJpbmcgc3RyID0gb2JqLnRvU3RyaW5nKCk7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICByZXR1cm4gKGludClEb3VibGUucGFyc2VEb3VibGUoc3RyKTtcbiAgICAgICAgfWNhdGNoKEV4Y2VwdGlvbiBlKSB7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgIH1cbi4uLlxuICAgIHB1YmxpYyBEYXRlIGdldFRpbWUoU3RyaW5nIGtleSkge1xuICAgICAgICBPYmplY3Qgb2JqID0gZGF0YS5nZXQoa2V5KTtcbiAgICAgICAgaWYob2JqID09IG51bGwpXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgaWYob2JqIGluc3RhbmNlb2YgRGF0ZSlcbiAgICAgICAgICAgIHJldHVybiAoRGF0ZSlvYmo7XG4gICAgICAgIFN0cmluZyBzdHIgPSBvYmoudG9TdHJpbmcoKTtcbiAgICAgICAgcmV0dXJuIERhdGVUaW1lVG9vbC5mb3JtYXREYXRlVGltZShzdHIsXCJ5eXl5LU1NLWRkIEhIOm1tOnNzXCIpO1xuICAgIH1cbiAgICBwdWJsaWMgSW50ZWdlciBnZXRDdXJyZW50UGFnZSgpe1xuICAgICAgICBJbnRlZ2VyIGNQYWdlID0gdGhpcy5nZXRJbnRlZ2VyKFwiY3VycmVudFBhZ2VcIik7XG4gICAgICAgIGlmKGNQYWdlICE9IG51bGwgJiYgY1BhZ2UgPjAgKVxuICAgICAgICAgICAgY1BhZ2UgPSBjUGFnZSAtMTtcbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgY1BhZ2UgPSAwO1xuICAgICAgICByZXR1cm4gY1BhZ2U7XG5cbiAgICB9XG5cbn1cbi4uLlxuUGF0aDogc3JjL21haW4vamF2YS9jb20vdGVhY2gvamF2YWZ4L3JlcXVlc3QvRGF0YVJlcXVlc3QuamF2YVxuLi4uXG5cbiAgICBwdWJsaWMgTGlzdDw/PiBnZXRMaXN0KFN0cmluZyBrZXkpe1xuICAgICAgICBPYmplY3Qgb2JqID0gZGF0YS5nZXQoa2V5KTtcbiAgICAgICAgaWYob2JqID09IG51bGwpXG4gICAgICAgICAgICByZXR1cm4gbmV3IEFycmF5TGlzdDw+KCk7XG4gICAgICAgIGlmKG9iaiBpbnN0YW5jZW9mIExpc3QpXG4gICAgICAgICAgICByZXR1cm4gKExpc3Q8Pz4pb2JqO1xuICAgICAgICBlbHNlXG4gICAgICAgICAgICByZXR1cm4gbmV3IEFycmF5TGlzdDw+KCk7XG4gICAgfVxuICAgIHB1YmxpYyBNYXA8U3RyaW5nLE9iamVjdD4gZ2V0TWFwKFN0cmluZyBrZXkpe1xuICAgICAgICBpZihkYXRhID09IG51bGwpXG4gICAgICAgICAgICByZXR1cm4gbmV3IEhhc2hNYXA8PigpO1xuICAgICAgICBPYmplY3Qgb2JqID0gZGF0YS5nZXQoa2V5KTtcbiAgICAgICAgaWYob2JqID09IG51bGwpXG4gICAgICAgICAgICByZXR1cm4gbmV3IEhhc2hNYXA8PigpO1xuICAgICAgICBpZihvYmogaW5zdGFuY2VvZiBNYXApXG4gICAgICAgICAgICByZXR1cm4gKE1hcDxTdHJpbmcsT2JqZWN0PilvYmo7XG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIHJldHVybiBuZXcgSGFzaE1hcDw+KCk7XG4gICAgfVxuXG4gICAgcHVibGljIEludGVnZXIgZ2V0SW50ZWdlcihTdHJpbmcga2V5KSB7XG4gICAgICAgIGlmKGRhdGEgPT0gbnVsbClcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICBPYmplY3Qgb2JqID0gZGF0YS5nZXQoa2V5KTtcbiAgICAgICAgaWYob2JqID09IG51bGwpXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgaWYob2JqIGluc3RhbmNlb2YgSW50ZWdlcilcbiAgICAgICAgICAgIHJldHVybiAoSW50ZWdlcilvYmo7XG4gICAgICAgIFN0cmluZyBzdHIgPSBvYmoudG9TdHJpbmcoKTtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIHJldHVybiAoaW50KURvdWJsZS5wYXJzZURvdWJsZShzdHIpO1xuICAgICAgICB9Y2F0Y2goRXhjZXB0aW9uIGUpIHtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgfVxuLi4uXG4gICAgcHVibGljIERhdGUgZ2V0VGltZShTdHJpbmcga2V5KSB7XG4gICAgICAgIE9iamVjdCBvYmogPSBkYXRhLmdldChrZXkpO1xuICAgICAgICBpZihvYmogPT0gbnVsbClcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICBpZihvYmogaW5zdGFuY2VvZiBEYXRlKVxuICAgICAgICAgICAgcmV0dXJuIChEYXRlKW9iajtcbiAgICAgICAgU3RyaW5nIHN0ciA9IG9iai50b1N0cmluZygpO1xuICAgICAgICByZXR1cm4gRGF0ZVRpbWVUb29sLmZvcm1hdERhdGVUaW1lKHN0cixcInl5eXktTU0tZGQgSEg6bW06c3NcIik7XG4gICAgfVxuICAgIHB1YmxpYyBJbnRlZ2VyIGdldEN1cnJlbnRQYWdlKCl7XG4gICAgICAgIEludGVnZXIgY1BhZ2UgPSB0aGlzLmdldEludGVnZXIoXCJjdXJyZW50UGFnZVwiKTtcbiAgICAgICAgaWYoY1BhZ2UgIT0gbnVsbCAmJiBjUGFnZSA+MCApXG4gICAgICAgICAgICBjUGFnZSA9IGNQYWdlIC0xO1xuICAgICAgICBlbHNlXG4gICAgICAgICAgICBjUGFnZSA9IDA7XG4gICAgICAgIHJldHVybiBjUGFnZTtcblxuICAgIH1cblxufVxuLi4uXG5QYXRoOiBzcmMvbWFpbi9qYXZhL2NuL2VkdS9zZHUvamF2YS9zZXJ2ZXIvc2VydmljZXMvQmFzZVNlcnZpY2UuamF2YVxuLi4uXG5cbiAgICBwdWJsaWMgRGF0YVJlc3BvbnNlIGdldE1lbnVMaXN0KERhdGFSZXF1ZXN0IGRhdGFSZXF1ZXN0KSB7XG4gICAgICAgIExpc3Q8TWFwPFN0cmluZywgT2JqZWN0Pj4gZGF0YUxpc3QgPSBuZXcgQXJyYXlMaXN0PD4oKTtcbiAgICAgICAgSW50ZWdlciB1c2VyVHlwZUlkID0gZGF0YVJlcXVlc3QuZ2V0SW50ZWdlcihcInVzZXJUeXBlSWRcIik7XG4gICAgICAgIGlmICh1c2VyVHlwZUlkID09IG51bGwpIHtcbiAgICAgICAgICAgIEludGVnZXIgcGVyc29uSWQgPSBDb21tb25NZXRob2QuZ2V0UGVyc29uSWQoKTtcbiAgICAgICAgICAgIGlmIChwZXJzb25JZCA9PSBudWxsKVxuICAgICAgICAgICAgICAgIHJldHVybiBDb21tb25NZXRob2QuZ2V0UmV0dXJuRGF0YShkYXRhTGlzdCk7XG4gICAgICAgICAgICB1c2VyVHlwZUlkID0gdXNlclJlcG9zaXRvcnkuZmluZEJ5SWQocGVyc29uSWQpLmdldCgpLmdldFVzZXJUeXBlKCkuZ2V0SWQoKTtcbiAgICAgICAgfVxuICAgICAgICBMaXN0PE1lbnVJbmZvPiBtTGlzdCA9IG1lbnVJbmZvUmVwb3NpdG9yeS5maW5kQnlVc2VyVHlwZUlkcyh1c2VyVHlwZUlkICsgXCJcIik7XG4gICAgICAgIE1hcDxTdHJpbmcsIE9iamVjdD4gbTtcbiAgICAgICAgTGlzdDxNYXA8U3RyaW5nLCBPYmplY3Q+PiBzTGlzdDtcbiAgICAgICAgZm9yIChNZW51SW5mbyBpbmZvIDogbUxpc3QpIHtcbiAgICAgICAgICAgIG0gPSBuZXcgSGFzaE1hcDw+KCk7XG4gICAgICAgICAgICBtLnB1dChcImlkXCIsIGluZm8uZ2V0SWQoKSk7XG4gICAgICAgICAgICBtLnB1dChcIm5hbWVcIiwgaW5mby5nZXROYW1lKCkpO1xuICAgICAgICAgICAgbS5wdXQoXCJ0aXRsZVwiLCBpbmZvLmdldFRpdGxlKCkpO1xuICAgICAgICAgICAgc0xpc3QgPSBnZXRNZW51TGlzdCh1c2VyVHlwZUlkLCBpbmZvLmdldElkKCkpO1xuICAgICAgICAgICAgbS5wdXQoXCJzTGlzdFwiLCBzTGlzdCk7XG4gICAgICAgICAgICBkYXRhTGlzdC5hZGQobSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIENvbW1vbk1ldGhvZC5nZXRSZXR1cm5EYXRhKGRhdGFMaXN0KTtcbiAgICB9XG5cblxuICAgIHB1YmxpYyBPcHRpb25JdGVtTGlzdCBnZXRSb2xlT3B0aW9uSXRlbUxpc3QoQFZhbGlkIEBSZXF1ZXN0Qm9keSBEYXRhUmVxdWVzdCBkYXRhUmVxdWVzdCkge1xuICAgICAgICBMaXN0PFVzZXJUeXBlPiB1TGlzdCA9IHVzZXJUeXBlUmVwb3NpdG9yeS5maW5kQWxsKCk7XG4gICAgICAgIExpc3Q8T3B0aW9uSXRlbT4gaXRlbUxpc3QgPSBuZXcgQXJyYXlMaXN0PD4oKTtcbiAgICAgICAgZm9yIChVc2VyVHlwZSB1dCA6IHVMaXN0KSB7XG4gICAgICAgICAgICBpdGVtTGlzdC5hZGQobmV3IE9wdGlvbkl0ZW0odXQuZ2V0SWQoKSwgbnVsbCwgdXQuZ2V0TmFtZSgpLm5hbWUoKSkpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBuZXcgT3B0aW9uSXRlbUxpc3QoMCwgaXRlbUxpc3QpO1xuICAgIH1cblxuXG4gICAgcHVibGljIERhdGFSZXNwb25zZSBtZW51RGVsZXRlKERhdGFSZXF1ZXN0IGRhdGFSZXF1ZXN0KSB7XG4gICAgICAgIEludGVnZXIgaWQgPSBkYXRhUmVxdWVzdC5nZXRJbnRlZ2VyKFwiaWRcIik7XG4gICAgICAgIGludCBjb3VudCAgPSBtZW51SW5mb1JlcG9zaXRvcnkuY291bnRNZW51SW5mb0J5UGlkKGlkKTtcbiAgICAgICAgaWYoY291bnQgPiAwKSB7XG4gICAgICAgICAgICByZXR1cm4gQ29tbW9uTWV0aG9kLmdldFJldHVybk1lc3NhZ2VFcnJvcihcIuWtmOWcqOWtkOiPnOWNle+8jOS4jeiDveWIoOmZpO+8gVwiKTtcbiAgICAgICAgfVxuICAgICAgICBPcHRpb25hbDxNZW51SW5mbz4gb3AgPSBtZW51SW5mb1JlcG9zaXRvcnkuZmluZEJ5SWQoaWQpO1xuICAgICAgICBvcC5pZlByZXNlbnQobWVudUluZm9SZXBvc2l0b3J5OjpkZWxldGUpO1xuICAgICAgICByZXR1cm4gQ29tbW9uTWV0aG9kLmdldFJldHVybk1lc3NhZ2VPSygpO1xuICAgIH1cbi4uLlxuICAgICAgICBpZiAobSA9PSBudWxsKVxuICAgICAgICAgICAgbSA9IG5ldyBNZW51SW5mbygpO1xuICAgICAgICBtLnNldElkKGlkKTtcbiAgICAgICAgbS5zZXRUaXRsZSh0aXRsZSk7XG4gICAgICAgIG0uc2V0TmFtZShuYW1lKTtcbiAgICAgICAgbS5zZXRQaWQocGlkKTtcbiAgICAgICAgbS5zZXRVc2VyVHlwZUlkcyh1c2VyVHlwZUlkcyk7XG4gICAgICAgIG1lbnVJbmZvUmVwb3NpdG9yeS5zYXZlKG0pO1xuICAgICAgICByZXR1cm4gQ29tbW9uTWV0aG9kLmdldFJldHVybk1lc3NhZ2VPSygpO1xuICAgIH1cblxuICAgIHB1YmxpYyBEYXRhUmVzcG9uc2UgZGVsZXRlRGljdGlvbmFyeShEYXRhUmVxdWVzdCBkYXRhUmVxdWVzdCkge1xuICAgICAgICBJbnRlZ2VyIGlkID0gZGF0YVJlcXVlc3QuZ2V0SW50ZWdlcihcImlkXCIpO1xuICAgICAgICBpbnQgY291bnQgPSBkaWN0aW9uYXJ5SW5mb1JlcG9zaXRvcnkuY291bnREaWN0aW9uYXJ5SW5mb0J5UGlkKGlkKTtcbiAgICAgICAgaWYoY291bnQgPiAwKSB7XG4gICAgICAgICAgICByZXR1cm4gQ29tbW9uTWV0aG9kLmdldFJldHVybk1lc3NhZ2VFcnJvcihcIuWtmOWcqOaVsOaNrumhue+8jOS4jeiDveWIoOmZpO+8gVwiKTtcbiAgICAgICAgfVxuICAgICAgICBPcHRpb25hbDxEaWN0aW9uYXJ5SW5mbz4gb3AgPSBkaWN0aW9uYXJ5SW5mb1JlcG9zaXRvcnkuZmluZEJ5SWQoaWQpO1xuICAgICAgICBvcC5pZlByZXNlbnQoZGljdGlvbmFyeUluZm9SZXBvc2l0b3J5OjpkZWxldGUpO1xuICAgICAgICByZXR1cm4gQ29tbW9uTWV0aG9kLmdldFJldHVybk1lc3NhZ2VPSygpO1xuICAgIH1cblxuICAgIHB1YmxpYyBEYXRhUmVzcG9uc2UgZGljdGlvbmFyeVNhdmUoRGF0YVJlcXVlc3QgZGF0YVJlcXVlc3QpIHtcbiAgICAgICAgSW50ZWdlciBpZCA9IGRhdGFSZXF1ZXN0LmdldEludGVnZXIoXCJpZFwiKTtcbiAgICAgICAgSW50ZWdlciBwaWQgPSBkYXRhUmVxdWVzdC5nZXRJbnRlZ2VyKFwicGlkXCIpO1xuICAgICAgICBTdHJpbmcgdmFsdWUgPSBkYXRhUmVxdWVzdC5nZXRTdHJpbmcoXCJ2YWx1ZVwiKTtcbiAgICAgICAgU3RyaW5nIHRpdGxlID0gZGF0YVJlcXVlc3QuZ2V0U3RyaW5nKFwidGl0bGVcIik7XG4gICAgICAgIERpY3Rpb25hcnlJbmZvIG0gPSBudWxsO1xuICAgICAgICBpZihpZCAhPSBudWxsKSB7XG4gICAgICAgICAgICBPcHRpb25hbDxEaWN0aW9uYXJ5SW5mbz4gb3AgPSBkaWN0aW9uYXJ5SW5mb1JlcG9zaXRvcnkuZmluZEJ5SWQoaWQpO1xuICAgICAgICAgICAgaWYgKG9wLmlzUHJlc2VudCgpKSB7XG4gICAgICAgICAgICAgICAgbSA9IG9wLmdldCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmKG0gPT0gbnVsbCkge1xuICAgICAgICAgICAgbSA9IG5ldyBEaWN0aW9uYXJ5SW5mbygpO1xuICAgICAgICAgICAgbS5zZXRQaWQocGlkKTtcbiAgICAgICAgfVxuICAgICAgICBtLnNldExhYmVsKHRpdGxlKTtcbiAgICAgICAgbS5zZXRWYWx1ZSh2YWx1ZSk7XG4gICAgICAgIGRpY3Rpb25hcnlJbmZvUmVwb3NpdG9yeS5zYXZlKG0pO1xuICAgICAgICByZXR1cm4gQ29tbW9uTWV0aG9kLmdldFJldHVybk1lc3NhZ2VPSygpO1xuICAgIH1cbi4uLlxuUGF0aDogc3JjL21haW4vamF2YS9jb20vdGVhY2gvamF2YWZ4L3JlcXVlc3QvT3B0aW9uSXRlbS5qYXZhXG4uLi5cblxuLyoqXG4gKiBPcHRpb25JdGVtIOmAiemhueaVsOaNruexu1xuICogSW50ZWdlciBpZCAg5pWw5o2u6aG5aWRcbiAqIFN0cmluZyB2YWx1ZSDmlbDmja7pobnlgLxcbiAqIFN0cmluZyBsYWJlbCDmlbDmja7lgLzmoIfpophcbiAqL1xucHVibGljIGNsYXNzIE9wdGlvbkl0ZW0ge1xuICAgIHByaXZhdGUgSW50ZWdlciBpZDtcbiAgICBwcml2YXRlIFN0cmluZyB2YWx1ZTtcbiAgICBwcml2YXRlIFN0cmluZyB0aXRsZTtcblxuICAgIHB1YmxpYyBPcHRpb25JdGVtKCl7XG5cbiAgICB9XG4gICAgcHVibGljIE9wdGlvbkl0ZW0oSW50ZWdlciBpZCwgU3RyaW5nIHZhbHVlLCBTdHJpbmcgdGl0bGUpe1xuICAgICAgICB0aGlzLmlkID0gaWQ7XG4gICAgICAgIHRoaXMudmFsdWUgPSB2YWx1ZTtcbiAgICAgICAgdGhpcy50aXRsZSA9IHRpdGxlO1xuICAgIH1cbiAgICBwdWJsaWMgT3B0aW9uSXRlbShNYXA8U3RyaW5nLE9iamVjdD4gbWFwKXtcbiAgICAgICAgdGhpcy5pZCA9IENvbW1vbk1ldGhvZC5nZXRJbnRlZ2VyKG1hcCxcImlkXCIpO1xuICAgICAgICB0aGlzLnZhbHVlID0gQ29tbW9uTWV0aG9kLmdldFN0cmluZyhtYXAsXCJ2YWx1ZVwiKTtcbiAgICAgICAgdGhpcy50aXRsZSA9IENvbW1vbk1ldGhvZC5nZXRTdHJpbmcobWFwLFwidGl0bGVcIik7XG4gICAgfVxuICAgIHB1YmxpYyBJbnRlZ2VyIGdldElkKCkge1xuICAgICAgICByZXR1cm4gaWQ7XG4gICAgfVxuXG4gICAgcHVibGljIHZvaWQgc2V0SWQoSW50ZWdlciBpZCkge1xuICAgICAgICB0aGlzLmlkID0gaWQ7XG4gICAgfVxuXG4gICAgcHVibGljIFN0cmluZyBnZXRWYWx1ZSgpIHtcbiAgICAgICAgcmV0dXJuIHZhbHVlO1xuICAgIH1cblxuICAgIHB1YmxpYyB2b2lkIHNldFZhbHVlKFN0cmluZyB2YWx1ZSkge1xuICAgICAgICB0aGlzLnZhbHVlID0gdmFsdWU7XG4gICAgfVxuXG4gICAgcHVibGljIFN0cmluZyBnZXRUaXRsZSgpIHtcbiAgICAgICAgcmV0dXJuIHRpdGxlO1xuICAgIH1cbi4uLlxuUGF0aDogc3JjL21haW4vamF2YS9jbi9lZHUvc2R1L2phdmEvc2VydmVyL3NlcnZpY2VzL1N0dWRlbnRTZXJ2aWNlLmphdmFcbi4uLlxuXG5cbiAgICBwdWJsaWMgRGF0YVJlc3BvbnNlIGdldFN0dWRlbnRJbmZvKERhdGFSZXF1ZXN0IGRhdGFSZXF1ZXN0KSB7XG4gICAgICAgIEludGVnZXIgcGVyc29uSWQgPSBkYXRhUmVxdWVzdC5nZXRJbnRlZ2VyKFwicGVyc29uSWRcIik7XG4gICAgICAgIFN0dWRlbnQgcyA9IG51bGw7XG4gICAgICAgIE9wdGlvbmFsPFN0dWRlbnQ+IG9wO1xuICAgICAgICBpZiAocGVyc29uSWQgIT0gbnVsbCkge1xuICAgICAgICAgICAgb3AgPSBzdHVkZW50UmVwb3NpdG9yeS5maW5kQnlJZChwZXJzb25JZCk7IC8v5qC55o2u5a2m55Sf5Li76ZSu5LuO5pWw5o2u5bqT5p+l6K+i5a2m55Sf55qE5L+h5oGvXG4gICAgICAgICAgICBpZiAob3AuaXNQcmVzZW50KCkpIHtcbiAgICAgICAgICAgICAgICBzID0gb3AuZ2V0KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIENvbW1vbk1ldGhvZC5nZXRSZXR1cm5EYXRhKGdldE1hcEZyb21TdHVkZW50KHMpKTsgLy/ov5nph4zlm57kvKDljIXlkKvlrabnlJ/kv6Hmga/nmoRNYXDlr7nosaFcbiAgICB9XG4uLi5cblBhdGg6IGphdmEtc2VydmVyL3NyYy9tYWluL2phdmEvY24vZWR1L3NkdS9qYXZhL3NlcnZlci9zZXJ2aWNlcy9UZWFjaGVyU2VydmljZXMuamF2YVxuLi4uXG5cbiAgICBwdWJsaWMgRGF0YVJlc3BvbnNlIGdldFRlYWNoZXJJbmZvKERhdGFSZXF1ZXN0IGRhdGFSZXF1ZXN0KSB7XG4gICAgICAgIEludGVnZXIgcGVyc29uSWQgPSBkYXRhUmVxdWVzdC5nZXRJbnRlZ2VyKFwicGVyc29uSWRcIik7XG4gICAgICAgIFRlYWNoZXIgcyA9IG51bGw7XG4gICAgICAgIE9wdGlvbmFsPFRlYWNoZXI+IG9wO1xuICAgICAgICBpZiAocGVyc29uSWQgIT0gbnVsbCkge1xuICAgICAgICAgICAgb3AgPSB0ZWFjaGVyUmVwb3NpdG9yeS5maW5kQnlJZChwZXJzb25JZCk7IC8v5qC55o2u5a2m55Sf5Li76ZSu5LuO5pWw5o2u5bqT5p+l6K+i5a2m55Sf55qE5L+h5oGvXG4gICAgICAgICAgICBpZiAob3AuaXNQcmVzZW50KCkpIHtcbiAgICAgICAgICAgICAgICBzID0gb3AuZ2V0KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIENvbW1vbk1ldGhvZC5nZXRSZXR1cm5EYXRhKGdldE1hcEZyb21UZWFjaGVyKHMpKTsgLy/ov5nph4zlm57kvKDljIXlkKvlrabnlJ/kv6Hmga/nmoRNYXDlr7nosaFcbiAgICB9XG4uLi5cblBhdGg6IHNyYy9tYWluL2phdmEvY24vZWR1L3NkdS9qYXZhL3NlcnZlci9zZXJ2aWNlcy9UZWFjaGVyU2VydmljZXMuamF2YVxuLi4uXG4gICAgcHVibGljIERhdGFSZXNwb25zZSBnZXRUZWFjaGVySW5mbyhEYXRhUmVxdWVzdCBkYXRhUmVxdWVzdCkge1xuICAgICAgICBJbnRlZ2VyIHBlcnNvbklkID0gZGF0YVJlcXVlc3QuZ2V0SW50ZWdlcihcInBlcnNvbklkXCIpO1xuICAgICAgICBUZWFjaGVyIHMgPSBudWxsO1xuICAgICAgICBPcHRpb25hbDxUZWFjaGVyPiBvcDtcbiAgICAgICAgaWYgKHBlcnNvbklkICE9IG51bGwpIHtcbiAgICAgICAgICAgIG9wID0gdGVhY2hlclJlcG9zaXRvcnkuZmluZEJ5SWQocGVyc29uSWQpOyAvL+agueaNruWtpueUn+S4u+mUruS7juaVsOaNruW6k+afpeivouWtpueUn+eahOS/oeaBr1xuICAgICAgICAgICAgaWYgKG9wLmlzUHJlc2VudCgpKSB7XG4gICAgICAgICAgICAgICAgcyA9IG9wLmdldCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBDb21tb25NZXRob2QuZ2V0UmV0dXJuRGF0YShnZXRNYXBGcm9tVGVhY2hlcihzKSk7IC8v6L+Z6YeM5Zue5Lyg5YyF5ZCr5a2m55Sf5L+h5oGv55qETWFw5a+56LGhXG4gICAgfVxuLi4uXG5QYXRoOiBzcmMvbWFpbi9qYXZhL2NvbS90ZWFjaC9qYXZhZngvcmVxdWVzdC9NeVRyZWVOb2RlLmphdmFcbi4uLlxuXG4gICAgcHVibGljIE15VHJlZU5vZGUoTWFwPFN0cmluZyxPYmplY3Q+IG1hcCl7XG4gICAgICAgIHRoaXMuaWQgID0gQ29tbW9uTWV0aG9kLmdldEludGVnZXIobWFwLFwiaWRcIik7XG4gICAgICAgIHRoaXMudmFsdWUgPSBDb21tb25NZXRob2QuZ2V0U3RyaW5nKG1hcCxcInZhbHVlXCIpO1xuICAgICAgICB0aGlzLmxhYmVsID0gQ29tbW9uTWV0aG9kLmdldFN0cmluZyhtYXAsXCJsYWJlbFwiKTtcbiAgICAgICAgdGhpcy50aXRsZSA9IENvbW1vbk1ldGhvZC5nZXRTdHJpbmcobWFwLFwidGl0bGVcIik7XG4gICAgICAgIHRoaXMuaXNMZWFmID0gQ29tbW9uTWV0aG9kLmdldEludGVnZXIobWFwLFwiaXNMZWFmXCIpO1xuICAgICAgICB0aGlzLnBpZCA9IENvbW1vbk1ldGhvZC5nZXRJbnRlZ2VyKG1hcCxcInBpZFwiKTtcbiAgICAgICAgdGhpcy51c2VyVHlwZUlkcyA9IENvbW1vbk1ldGhvZC5nZXRTdHJpbmcobWFwLFwidXNlclR5cGVJZHNcIik7XG4gICAgICAgIHRoaXMucGFyZW50VGl0bGUgPSBDb21tb25NZXRob2QuZ2V0U3RyaW5nKG1hcCxcInBhcmVudFRpdGxlXCIpO1xuICAgICAgICB0aGlzLmNoaWxkcmVuPSBuZXcgQXJyYXlMaXN0PE15VHJlZU5vZGU+KCk7XG4gICAgICAgIExpc3Q8Pz4gY2hpbGRyZW4gPSBDb21tb25NZXRob2QuZ2V0TGlzdChtYXAsXCJjaGlsZHJlblwiKTtcbiAuLi4iLCJpc19lcnJvciI6ZmFsc2UsInJlcXVlc3RfaWQiOiIiLCJ0b29sX3VzZV9pZCI6InRvb2x1X3ZydHhfMDFVWHBZR3VRMjZib1FmWERBN2hXUmE4In19LHsiaWQiOjIsInR5cGUiOjQsImlkZV9zdGF0ZV9ub2RlIjp7IndvcmtzcGFjZUZvbGRlcnMiOlt7InJlcG9zaXRvcnlSb290IjoiQzovVXNlcnMvcHJpbmNpcC9Eb2N1bWVudHMvR2l0SHViL2JhaWNhaS9qYXZhLXNlcnZlciIsImZvbGRlclJvb3QiOiJDOi9Vc2Vycy9wcmluY2lwL0RvY3VtZW50cy9HaXRIdWIvYmFpY2FpL2phdmEtc2VydmVyIn1dLCJ3b3Jrc3BhY2VGb2xkZXJzVW5jaGFuZ2VkIjpmYWxzZX19XSwidGltZXN0YW1wIjoiMjAyNS0wNS0xNlQxNTowNToyOS44MjZaIiwicmVzcG9uc2VfdGV4dCI6IuiuqeaIkeafpeeci+S4gOS4iyBgRmFtaWx5TWVtYmVyYCDnsbvvvIzlm6DkuLrlnKggYFRlYWNoZXJTZXJ2aWNlcy5qYXZhYCDkuK3mnInlhbPkuo7lrrbluq3miJDlkZjnmoTlpITnkIbvvJpcbiIsIndvcmtzcGFjZV9maWxlX2NodW5rcyI6W119LHsic3RhdHVzIjoic3VjY2VzcyIsInJlcXVlc3RfaWQiOiI5YWIwYzU3Mi0yN2NjLTQzN2EtYWNhNS02MmE3NGZjMWI5NGEiLCJyZXF1ZXN0X21lc3NhZ2UiOiIiLCJzdHJ1Y3R1cmVkX291dHB1dF9ub2RlcyI6W3siaWQiOjEsInR5cGUiOjUsImNvbnRlbnQiOiIiLCJ0b29sX3VzZSI6eyJ0b29sX3VzZV9pZCI6InRvb2x1X3ZydHhfMDExU29tbkJFNVRRYkxQWmllQUhoSkc5IiwidG9vbF9uYW1lIjoiY29kZWJhc2UtcmV0cmlldmFsIiwiaW5wdXRfanNvbiI6IntcImluZm9ybWF0aW9uX3JlcXVlc3RcIjogXCJcXHU2N2U1XFx1NjI3ZSBUZWFjaGVyU2VydmljZXMuamF2YSBcXHU0ZTJkXFx1NzY4NCBnZXRGYW1pbHlNZW1iZXJMaXN0IFxcdTU0OGMgZmFtaWx5TWVtYmVyU2F2ZSBcXHU2NWI5XFx1NmNkNVxcdTc2ODRcXHU1YjhjXFx1NjU3NFxcdTViOWVcXHU3M2IwXCJ9IiwibWNwX3NlcnZlcl9uYW1lIjoiIiwibWNwX3Rvb2xfbmFtZSI6IiJ9fSx7ImlkIjowLCJ0eXBlIjowLCJjb250ZW50Ijoi6K6p5oiR5p+l55yL5LiA5LiLIGBUZWFjaGVyU2VydmljZXMuamF2YWAg5Lit55qEIGBnZXRGYW1pbHlNZW1iZXJMaXN0YCDlkowgYGZhbWlseU1lbWJlclNhdmVgIOaWueazle+8mlxuIn0seyJpZCI6MiwidHlwZSI6MiwiY29udGVudCI6IiJ9LHsiaWQiOjMsInR5cGUiOjMsImNvbnRlbnQiOiIifV0sInNlZW5fc3RhdGUiOiJzZWVuIiwic3RydWN0dXJlZF9yZXF1ZXN0X25vZGVzIjpbeyJpZCI6MSwidHlwZSI6MSwidG9vbF9yZXN1bHRfbm9kZSI6eyJjb250ZW50IjoiVGhlIGZvbGxvd2luZyBjb2RlIHNlY3Rpb25zIHdlcmUgcmV0cmlldmVkOlxuUGF0aDogc3JjL21haW4vamF2YS9jbi9lZHUvc2R1L2phdmEvc2VydmVyL21vZGVscy9GYW1pbHlNZW1iZXIuamF2YVxucGFja2FnZSBjbi5lZHUuc2R1LmphdmEuc2VydmVyLm1vZGVscztcblxuaW1wb3J0IGpha2FydGEucGVyc2lzdGVuY2UuKjtcbmltcG9ydCBqYWthcnRhLnZhbGlkYXRpb24uY29uc3RyYWludHMuU2l6ZTtcbmltcG9ydCBsb21ib2suR2V0dGVyO1xuaW1wb3J0IGxvbWJvay5TZXR0ZXI7XG5AR2V0dGVyXG5AU2V0dGVyXG5ARW50aXR5XG5AVGFibGUoXHRuYW1lID0gXCJmYW1pbHlfbWVtYmVyXCIsXG4gICAgICAgIHVuaXF1ZUNvbnN0cmFpbnRzID0ge1xuICAgICAgICB9KVxucHVibGljIGNsYXNzIEZhbWlseU1lbWJlciB7XG4gICAgQElkXG4gICAgQEdlbmVyYXRlZFZhbHVlKHN0cmF0ZWd5ID0gR2VuZXJhdGlvblR5cGUuSURFTlRJVFkpXG4gICAgcHJpdmF0ZSBJbnRlZ2VyIG1lbWJlcklkO1xuXG4gICAgQE1hbnlUb09uZVxuICAgIEBKb2luQ29sdW1uKG5hbWU9XCJwZXJzb25JZFwiKVxuICAgIHByaXZhdGUgU3R1ZGVudCBzdHVkZW50O1xuICAgIEBTaXplKG1heD0xMClcbiAgICBwcml2YXRlIFN0cmluZyByZWxhdGlvbjtcbiAgICBAU2l6ZShtYXg9MzApXG4gICAgcHJpdmF0ZSBTdHJpbmcgbmFtZTtcbiAgICBAU2l6ZShtYXg9MTApXG4gICAgcHJpdmF0ZSBTdHJpbmcgZ2VuZGVyO1xuICAgIHByaXZhdGUgSW50ZWdlciBhZ2U7XG4gICAgQFNpemUobWF4PTUwKVxuICAgIHByaXZhdGUgU3RyaW5nIHVuaXQ7XG5cbn1cbi4uLlxuUGF0aDogamF2YS1zZXJ2ZXIvc3JjL21haW4vamF2YS9jbi9lZHUvc2R1L2phdmEvc2VydmVyL21vZGVscy9GYW1pbHlNZW1iZXIuamF2YVxucGFja2FnZSBjbi5lZHUuc2R1LmphdmEuc2VydmVyLm1vZGVscztcblxuaW1wb3J0IGpha2FydGEucGVyc2lzdGVuY2UuKjtcbmltcG9ydCBqYWthcnRhLnZhbGlkYXRpb24uY29uc3RyYWludHMuU2l6ZTtcbmltcG9ydCBsb21ib2suR2V0dGVyO1xuaW1wb3J0IGxvbWJvay5TZXR0ZXI7XG5AR2V0dGVyXG5AU2V0dGVyXG5ARW50aXR5XG5AVGFibGUoXHRuYW1lID0gXCJmYW1pbHlfbWVtYmVyXCIsXG4gICAgICAgIHVuaXF1ZUNvbnN0cmFpbnRzID0ge1xuICAgICAgICB9KVxucHVibGljIGNsYXNzIEZhbWlseU1lbWJlciB7XG4gICAgQElkXG4gICAgQEdlbmVyYXRlZFZhbHVlKHN0cmF0ZWd5ID0gR2VuZXJhdGlvblR5cGUuSURFTlRJVFkpXG4gICAgcHJpdmF0ZSBJbnRlZ2VyIG1lbWJlcklkO1xuXG4gICAgQE1hbnlUb09uZVxuICAgIEBKb2luQ29sdW1uKG5hbWU9XCJwZXJzb25JZFwiKVxuICAgIHByaXZhdGUgU3R1ZGVudCBzdHVkZW50O1xuICAgIEBTaXplKG1heD0xMClcbiAgICBwcml2YXRlIFN0cmluZyByZWxhdGlvbjtcbiAgICBAU2l6ZShtYXg9MzApXG4gICAgcHJpdmF0ZSBTdHJpbmcgbmFtZTtcbiAgICBAU2l6ZShtYXg9MTApXG4gICAgcHJpdmF0ZSBTdHJpbmcgZ2VuZGVyO1xuICAgIHByaXZhdGUgSW50ZWdlciBhZ2U7XG4gICAgQFNpemUobWF4PTUwKVxuICAgIHByaXZhdGUgU3RyaW5nIHVuaXQ7XG5cbiAgICBwdWJsaWMgdm9pZCBzZXRUZWFjaGVyKE9iamVjdCBvKSB7XG4gICAgfVxufVxuLi4uXG5QYXRoOiBzcmMvbWFpbi9qYXZhL2NuL2VkdS9zZHUvamF2YS9zZXJ2ZXIvcmVwb3NpdG9yeXMvRmFtaWx5TWVtYmVyUmVwb3NpdG9yeS5qYXZhXG5wYWNrYWdlIGNuLmVkdS5zZHUuamF2YS5zZXJ2ZXIucmVwb3NpdG9yeXM7XG5cbmltcG9ydCBjbi5lZHUuc2R1LmphdmEuc2VydmVyLm1vZGVscy5GYW1pbHlNZW1iZXI7XG5pbXBvcnQgb3JnLnNwcmluZ2ZyYW1ld29yay5kYXRhLmpwYS5yZXBvc2l0b3J5LkpwYVJlcG9zaXRvcnk7XG5cbmltcG9ydCBqYXZhLnV0aWwuTGlzdDtcblxucHVibGljIGludGVyZmFjZSBGYW1pbHlNZW1iZXJSZXBvc2l0b3J5IGV4dGVuZHMgSnBhUmVwb3NpdG9yeTxGYW1pbHlNZW1iZXIsSW50ZWdlcj4ge1xuICAgIExpc3Q8RmFtaWx5TWVtYmVyPiBmaW5kQnlTdHVkZW50UGVyc29uSWQoSW50ZWdlciBwZXJzb25JZCk7XG59XG4uLi5cblBhdGg6IHNyYy9tYWluL2phdmEvY24vZWR1L3NkdS9qYXZhL3NlcnZlci9tb2RlbHMvUGVyc29uLmphdmFcbnBhY2thZ2UgY24uZWR1LnNkdS5qYXZhLnNlcnZlci5tb2RlbHM7XG5cblxuXG5pbXBvcnQgamFrYXJ0YS5wZXJzaXN0ZW5jZS4qO1xuaW1wb3J0IGpha2FydGEudmFsaWRhdGlvbi5jb25zdHJhaW50cy5FbWFpbDtcbmltcG9ydCBqYWthcnRhLnZhbGlkYXRpb24uY29uc3RyYWludHMuTm90Qmxhbms7XG5pbXBvcnQgamFrYXJ0YS52YWxpZGF0aW9uLmNvbnN0cmFpbnRzLlNpemU7XG5cblxuLypcbiAqIFBlcnNvbuS6uuWRmOihqOWunuS9k+exuyDkv53lrZjkurrlkZjnmoTln7rmnKzkv6Hmga/kv6Hmga/vvIwg6LSm5oi344CB5a2m55Sf5ZKM5pWZ5biI6YO95YWz6IGU5Lq65ZGY77yMXG4gKiBJbnRlZ2VyIHBlcnNvbklkIOS6uuWRmOihqCBwZXJzb24g5Li76ZSuIHBlcnNvbl9pZFxuICogU3RyaW5nIG51bSDkurrlkZjnvJblj7dcbiAqIFN0cmluZyBuYW1lIOS6uuWRmOWQjeensFxuICogU3RyaW5nIHR5cGUg5Lq65ZGY57G75Z6LICAw566h55CG5ZGYIDHlrabnlJ8gMuaVmeW4iFxuICogU3RyaW5nIGRlcHQg5a2m6ZmiXG4gKiBTdHJpbmcgY2FyZCDouqvku73or4Hlj7dcbiAqIFN0cmluZyBnZW5kZXIg5oCn5YirICAxIOeUtyAyIOWls1xuICogU3RyaW5nIGJpcnRoZGF5IOWHuueUn+aXpeacn1xuICogU3RyaW5nIGVtYWlsIOmCrueusVxuICogU3RyaW5nIHBob25lIOeUteivnVxuICogU3RyaW5nIGFkZHJlc3Mg5Zyw5Z2AXG4gKiBTdHJpbmcgaW50cm9kdWNlIOS4quS6uueugOS7i1xuICovXG5pbXBvcnQgbG9tYm9rLkdldHRlcjtcbmltcG9ydCBsb21ib2suU2V0dGVyO1xuQEdldHRlclxuQFNldHRlclxuQEVudGl0eVxuQFRhYmxlKFx0bmFtZSA9IFwicGVyc29uXCIsXG4gICAgICAgIHVuaXF1ZUNvbnN0cmFpbnRzID0ge1xuICAgICAgICAgICAgICAgIEBVbmlxdWVDb25zdHJhaW50KGNvbHVtbk5hbWVzID0gXCJudW1cIiksICAgLy/kurrlkZjooajkuK3nmoTnvJblj7cg5ZSv5LiAXG4gICAgICAgIH0pXG5wdWJsaWMgY2xhc3MgUGVyc29uIHtcbiAgICBASWRcbiAgICBAR2VuZXJhdGVkVmFsdWUoc3RyYXRlZ3kgPSBHZW5lcmF0aW9uVHlwZS5JREVOVElUWSlcbiAgICBwcml2YXRlIEludGVnZXIgcGVyc29uSWQ7XG5cbiAgICBATm90QmxhbmsgICAgLy8g5a2X5q616Z2e56m6XG4gICAgQFNpemUobWF4ID0gMjApICAgLy/lrZfmrrXplb/luqbmnIDplb/kuLoyMFxuICAgIHByaXZhdGUgU3RyaW5nIG51bTtcblxuICAgIEBTaXplKG1heCA9IDUwKVxuICAgIHByaXZhdGUgU3RyaW5nIG5hbWU7XG5cbiAgICBAU2l6ZShtYXggPSAyKVxuICAgIHByaXZhdGUgU3RyaW5nIHR5cGU7XG4uLi5cblBhdGg6IHNyYy9tYWluL2phdmEvY24vZWR1L3NkdS9qYXZhL3NlcnZlci9tb2RlbHMvVGVhY2hlci5qYXZhXG5wYWNrYWdlIGNuLmVkdS5zZHUuamF2YS5zZXJ2ZXIubW9kZWxzO1xuXG5pbXBvcnQgY29tLmZhc3RlcnhtbC5qYWNrc29uLmFubm90YXRpb24uSnNvbklnbm9yZTtcbmltcG9ydCBqYWthcnRhLnBlcnNpc3RlbmNlLio7XG5pbXBvcnQgamFrYXJ0YS52YWxpZGF0aW9uLmNvbnN0cmFpbnRzLlNpemU7XG5pbXBvcnQgbG9tYm9rLkdldHRlcjtcbmltcG9ydCBsb21ib2suU2V0dGVyO1xuXG5pbXBvcnQgamF2YS51dGlsLkRhdGU7XG5cbkBHZXR0ZXJcbiAgICBAU2V0dGVyXG4gICAgQEVudGl0eVxuICAgIEBUYWJsZShcdG5hbWUgPSBcInRlYWNoZXJcIixcbiAgICAgICAgICAgIHVuaXF1ZUNvbnN0cmFpbnRzID0ge1xuICAgICAgICAgICAgfSlcbiAgICBwdWJsaWMgY2xhc3MgVGVhY2hlciB7XG4gICAgICAgIEBJZFxuICAgICAgICBwcml2YXRlIEludGVnZXIgcGVyc29uSWQ7XG5cbiAgICAgICAgQE9uZVRvT25lXG4gICAgICAgIEBKb2luQ29sdW1uKG5hbWU9XCJwZXJzb25JZFwiKVxuICAgICAgICBASnNvbklnbm9yZVxuICAgICAgICBwcml2YXRlIFBlcnNvbiBwZXJzb247XG4gICAgICAgIEBTaXplKG1heD01MClcbiAgICAgICAgcHJpdmF0ZSBTdHJpbmcgdGl0bGU7XG4gICAgICAgIEBTaXplKG1heD0zMClcbiAgICAgICAgcHJpdmF0ZSBTdHJpbmcgZGVncmVlO1xuICAgICAgICBwcml2YXRlIERhdGUgZW50ZXJUaW1lO1xuICAgICAgICBwcml2YXRlIEludGVnZXIgc3R1ZGVudE51bTtcbiAgICAgICAgQFNpemUobWF4ID0gNTApXG4gICAgICAgIHByaXZhdGUgU3RyaW5nIGNsYXNzTmFtZTtcblxuXG59XG5cblxuXG5cblxuLi4uXG5QYXRoOiBqYXZhLXNlcnZlci9zcmMvbWFpbi9qYXZhL2NuL2VkdS9zZHUvamF2YS9zZXJ2ZXIvbW9kZWxzL1RlYWNoZXIuamF2YVxucGFja2FnZSBjbi5lZHUuc2R1LmphdmEuc2VydmVyLm1vZGVscztcblxuaW1wb3J0IGNvbS5mYXN0ZXJ4bWwuamFja3Nvbi5hbm5vdGF0aW9uLkpzb25JZ25vcmU7XG5pbXBvcnQgamFrYXJ0YS5wZXJzaXN0ZW5jZS4qO1xuaW1wb3J0IGpha2FydGEudmFsaWRhdGlvbi5jb25zdHJhaW50cy5TaXplO1xuaW1wb3J0IGxvbWJvay5HZXR0ZXI7XG5pbXBvcnQgbG9tYm9rLlNldHRlcjtcblxuaW1wb3J0IGphdmEudXRpbC5EYXRlO1xuXG4vKipcbiAqIFRlYWNoZXLmlZnluIjooajlrp7kvZPnsbsg5L+d5a2Y5q+P5Liq5pWZ5biI55qE5L+h5oGv77yMXG4gKiBJbnRlZ2VyIHBlcnNvbklkIOaVmeW4iOihqCB0ZWFjaGVyIOS4u+mUriBwZXJzb25faWQg5LiOUGVyc29u6KGo5Li76ZSu55u45ZCMXG4gKiBQZXJzb24gcGVyc29uIOWFs+iBlOWIsOivpeeUqOaIt+aJgOeUqOeahFBlcnNvbuWvueixoe+8jOi0puaIt+aJgOWvueW6lOeahOS6uuWRmOS/oeaBryBwZXJzb25faWQg5YWz6IGUIHBlcnNvbiDooajkuLvplK4gcGVyc29uX2lkXG4gKiBTdHJpbmcgdGl0bGUg6IGM56ewXG4gKiBTdHJpbmcgZGVncmVlIOWtpuS9jVxuICogRGF0ZSBlbnRlclRpbWUg5YWl6IGM5pe26Ze0XG4gKiBJbnRlZ2VyIHN0dWRlbnROdW0g5a2m55Sf5pWw6YePXG4gKiBTdHJpbmcgY2xhc3NOYW1lIOePree6p+WQjeensFxuICovXG5AR2V0dGVyXG5AU2V0dGVyXG5ARW50aXR5XG5AVGFibGUobmFtZSA9IFwidGVhY2hlclwiLFxuICAgICAgICB1bmlxdWVDb25zdHJhaW50cyA9IHtcbiAgICAgICAgfSlcbnB1YmxpYyBjbGFzcyBUZWFjaGVyIHtcbiAgICAvKipcbiAgICAgKiDmlZnluIhJRO+8jOS4jlBlcnNvbuihqOeahHBlcnNvbklk55u45ZCMXG4gICAgICovXG4gICAgQElkXG4gICAgcHJpdmF0ZSBJbnRlZ2VyIHBlcnNvbklkO1xuXG4gICAgLyoqXG4gICAgICog5YWz6IGU55qEUGVyc29u5a+56LGh77yM5YyF5ZCr5Z+65pys5Lq65ZGY5L+h5oGvXG4gICAgICovXG4gICAgQE9uZVRvT25lXG4gICAgQEpvaW5Db2x1bW4obmFtZT1cInBlcnNvbklkXCIpXG4gICAgQEpzb25JZ25vcmVcbiAgICBwcml2YXRlIFBlcnNvbiBwZXJzb247XG5cbiAgICAvKipcbiAgICAgKiDogYznp7DvvIzlpoLmlZnmjojjgIHlia/mlZnmjojjgIHorrLluIjnrYlcbiAgICAgKi9cbiAgICBAU2l6ZShtYXg9NTApXG4gICAgcHJpdmF0ZSBTdHJpbmcgdGl0bGU7XG5cbiAgICAvKipcbiAgICAgKiDlrabkvY3vvIzlpoLlrablo6vjgIHnoZXlo6vjgIHljZrlo6vnrYlcbiAgICAgKi9cbiAgICBAU2l6ZShtYXg9MzApXG4gICAgcHJpdmF0ZSBTdHJpbmcgZGVncmVlO1xuXG4gICAgLyoqXG4gICAgICog5YWl6IGM5pe26Ze0XG4gICAgICovXG4gICAgcHJpdmF0ZSBEYXRlIGVudGVyVGltZTtcblxuICAgIC8qKlxuICAgICAqIOaMh+WvvOeahOWtpueUn+aVsOmHj1xuICAgICAqL1xuICAgIHByaXZhdGUgSW50ZWdlciBzdHVkZW50TnVtO1xuLi4uXG5QYXRoOiBzcmMvbWFpbi9qYXZhL2NuL2VkdS9zZHUvamF2YS9zZXJ2ZXIvbW9kZWxzL1VzZXJUeXBlLmphdmFcbnBhY2thZ2UgY24uZWR1LnNkdS5qYXZhLnNlcnZlci5tb2RlbHM7XG5cblxuaW1wb3J0IGpha2FydGEucGVyc2lzdGVuY2UuKjtcblxuLypcbiAqIFVzZXJUeXBl55So5oi357G75Z6L6KGo5a6e5L2T57G7IOS4ieenjeexu+WeiyDnrqHnkIblkZjvvIzlrabnlJ/lkozmlZnluIgg5a+55bqUIOaemuS4vuexu+Wei0VVc2VyVHlwZVxuICogSW50ZWdlciBpZCB1c2VyX3R5cGUg6KGoIOS4u+mUriBpZFxuICogRVVzZXJUeXBlIG5hbSDop5LoibLlkI3np7AgUk9MRV9BRE1JTiwgUk9MRV9TVFVERU5ULFJPTEVfVEVBQ0hFUlxuICovXG5pbXBvcnQgbG9tYm9rLkdldHRlcjtcbmltcG9ydCBsb21ib2suU2V0dGVyO1xuQEdldHRlclxuQFNldHRlclxuQEVudGl0eVxuQFRhYmxlKG5hbWUgPSBcInVzZXJfdHlwZVwiKVxucHVibGljIGNsYXNzIFVzZXJUeXBlIHtcbiAgICBASWRcbiAgICBAR2VuZXJhdGVkVmFsdWUoc3RyYXRlZ3kgPSBHZW5lcmF0aW9uVHlwZS5JREVOVElUWSlcbiAgICBwcml2YXRlIEludGVnZXIgaWQ7XG5cbiAgICBARW51bWVyYXRlZChFbnVtVHlwZS5TVFJJTkcpXG4gICAgQENvbHVtbihsZW5ndGggPSAyMClcbiAgICBwcml2YXRlIEVVc2VyVHlwZSBuYW1lO1xufS4uLlxuUGF0aDogc3JjL21haW4vamF2YS9jbi9lZHUvc2R1L2phdmEvc2VydmVyL3NlcnZpY2VzL1N0dWRlbnRTZXJ2aWNlLmphdmFcbi4uLlxuXG5AU2VydmljZVxucHVibGljIGNsYXNzIFN0dWRlbnRTZXJ2aWNlIHtcbiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBMb2dnZXIgbG9nID0gTG9nZ2VyRmFjdG9yeS5nZXRMb2dnZXIoU3R1ZGVudFNlcnZpY2UuY2xhc3MpO1xuICAgIHByaXZhdGUgZmluYWwgUGVyc29uUmVwb3NpdG9yeSBwZXJzb25SZXBvc2l0b3J5OyAgLy/kurrlkZjmlbDmja7mk43kvZzoh6rliqjms6jlhaVcbiAgICBwcml2YXRlIGZpbmFsIFN0dWRlbnRSZXBvc2l0b3J5IHN0dWRlbnRSZXBvc2l0b3J5OyAgLy/lrabnlJ/mlbDmja7mk43kvZzoh6rliqjms6jlhaVcbiAgICBwcml2YXRlIGZpbmFsIFVzZXJSZXBvc2l0b3J5IHVzZXJSZXBvc2l0b3J5OyAgLy/lrabnlJ/mlbDmja7mk43kvZzoh6rliqjms6jlhaVcbiAgICBwcml2YXRlIGZpbmFsIFVzZXJUeXBlUmVwb3NpdG9yeSB1c2VyVHlwZVJlcG9zaXRvcnk7IC8v55So5oi357G75Z6L5pWw5o2u5pON5L2c6Ieq5Yqo5rOo5YWlXG4gICAgcHJpdmF0ZSBmaW5hbCBQYXNzd29yZEVuY29kZXIgZW5jb2RlcjsgIC8v5a+G56CB5pyN5Yqh6Ieq5Yqo5rOo5YWlXG4gICAgcHJpdmF0ZSBmaW5hbCBGZWVSZXBvc2l0b3J5IGZlZVJlcG9zaXRvcnk7ICAvL+a2iOi0ueaVsOaNruaTjeS9nOiHquWKqOazqOWFpVxuICAgIHByaXZhdGUgZmluYWwgRmFtaWx5TWVtYmVyUmVwb3NpdG9yeSBmYW1pbHlNZW1iZXJSZXBvc2l0b3J5O1xuICAgIHByaXZhdGUgZmluYWwgU3lzdGVtU2VydmljZSBzeXN0ZW1TZXJ2aWNlO1xuLi4uXG5cblxuXG4gICAgLypcbiAgICAgICAgRmFtaWx5TWVtYmVyXG4gICAgICovXG4gICAgcHVibGljIERhdGFSZXNwb25zZSBnZXRGYW1pbHlNZW1iZXJMaXN0KERhdGFSZXF1ZXN0IGRhdGFSZXF1ZXN0KSB7XG4gICAgICAgIEludGVnZXIgcGVyc29uSWQgPSBkYXRhUmVxdWVzdC5nZXRJbnRlZ2VyKFwicGVyc29uSWRcIik7XG4gICAgICAgIExpc3Q8RmFtaWx5TWVtYmVyPiBmTGlzdCA9IGZhbWlseU1lbWJlclJlcG9zaXRvcnkuZmluZEJ5U3R1ZGVudFBlcnNvbklkKHBlcnNvbklkKTtcbiAgICAgICAgTGlzdDxNYXA8U3RyaW5nLE9iamVjdD4+IGRhdGFMaXN0ID0gbmV3IEFycmF5TGlzdDw+KCk7XG4gICAgICAgIE1hcDxTdHJpbmcsT2JqZWN0PiBtO1xuICAgICAgICBpZiAoZkxpc3QgIT0gbnVsbCkge1xuICAgICAgICAgICAgZm9yIChGYW1pbHlNZW1iZXIgZiA6IGZMaXN0KSB7XG4gICAgICAgICAgICAgICAgbSA9IG5ldyBIYXNoTWFwPD4oKTtcbiAgICAgICAgICAgICAgICBtLnB1dChcIm1lbWJlcklkXCIsIGYuZ2V0TWVtYmVySWQoKSk7XG4gICAgICAgICAgICAgICAgbS5wdXQoXCJwZXJzb25JZFwiLCBmLmdldFN0dWRlbnQoKS5nZXRQZXJzb25JZCgpKTtcbiAgICAgICAgICAgICAgICBtLnB1dChcInJlbGF0aW9uXCIsIGYuZ2V0UmVsYXRpb24oKSk7XG4gICAgICAgICAgICAgICAgbS5wdXQoXCJuYW1lXCIsIGYuZ2V0TmFtZSgpKTtcbiAgICAgICAgICAgICAgICBtLnB1dChcImdlbmRlclwiLCBmLmdldEdlbmRlcigpKTtcbiAgICAgICAgICAgICAgICBtLnB1dChcImFnZVwiLCBmLmdldEFnZSgpK1wiXCIpO1xuICAgICAgICAgICAgICAgIG0ucHV0KFwidW5pdFwiLCBmLmdldFVuaXQoKSk7XG4gICAgICAgICAgICAgICAgZGF0YUxpc3QuYWRkKG0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBDb21tb25NZXRob2QuZ2V0UmV0dXJuRGF0YShkYXRhTGlzdCk7XG4gICAgfVxuXG4gICAgcHVibGljIERhdGFSZXNwb25zZSBmYW1pbHlNZW1iZXJTYXZlKERhdGFSZXF1ZXN0IGRhdGFSZXF1ZXN0KSB7XG4gICAgICAgIE1hcDxTdHJpbmcsT2JqZWN0PiBmb3JtID0gZGF0YVJlcXVlc3QuZ2V0TWFwKFwiZm9ybVwiKTtcbiAgICAgICAgSW50ZWdlciBwZXJzb25JZCA9IENvbW1vbk1ldGhvZC5nZXRJbnRlZ2VyKGZvcm0sXCJwZXJzb25JZFwiKTtcbiAgICAgICAgSW50ZWdlciBtZW1iZXJJZCA9IENvbW1vbk1ldGhvZC5nZXRJbnRlZ2VyKGZvcm0sXCJtZW1iZXJJZFwiKTtcbiAgICAgICAgT3B0aW9uYWw8RmFtaWx5TWVtYmVyPiBvcDtcbiAgICAgICAgRmFtaWx5TWVtYmVyIGYgPSBudWxsO1xuICAgICAgICBpZihtZW1iZXJJZCAhPSBudWxsKSB7XG4gICAgICAgICAgICBvcCA9IGZhbWlseU1lbWJlclJlcG9zaXRvcnkuZmluZEJ5SWQobWVtYmVySWQpO1xuICAgICAgICAgICAgaWYob3AuaXNQcmVzZW50KCkpIHtcbiAgICAgICAgICAgICAgICBmID0gb3AuZ2V0KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYoZj09IG51bGwpIHtcbiAgICAgICAgICAgIGYgPSBuZXcgRmFtaWx5TWVtYmVyKCk7XG4gICAgICAgICAgICBhc3NlcnQgcGVyc29uSWQgIT0gbnVsbDtcbiAgICAgICAgICAgIGYuc2V0U3R1ZGVudChzdHVkZW50UmVwb3NpdG9yeS5maW5kQnlJZChwZXJzb25JZCkuZ2V0KCkpO1xuICAgICAgICB9XG4gICAgICAgIGYuc2V0UmVsYXRpb24oQ29tbW9uTWV0aG9kLmdldFN0cmluZyhmb3JtLFwicmVsYXRpb25cIikpO1xuICAgICAgICBmLnNldE5hbWUoQ29tbW9uTWV0aG9kLmdldFN0cmluZyhmb3JtLFwibmFtZVwiKSk7XG4gICAgICAgIGYuc2V0R2VuZGVyKENvbW1vbk1ldGhvZC5nZXRTdHJpbmcoZm9ybSxcImdlbmRlclwiKSk7XG4gICAgICAgIGYuc2V0QWdlKENvbW1vbk1ldGhvZC5nZXRJbnRlZ2VyKGZvcm0sXCJhZ2VcIikpO1xuICAgICAgICBmLnNldFVuaXQoQ29tbW9uTWV0aG9kLmdldFN0cmluZyhmb3JtLFwidW5pdFwiKSk7XG4gICAgICAgIGZhbWlseU1lbWJlclJlcG9zaXRvcnkuc2F2ZShmKTtcbiAgICAgICAgcmV0dXJuIENvbW1vbk1ldGhvZC5nZXRSZXR1cm5NZXNzYWdlT0soKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgRGF0YVJlc3BvbnNlIGZhbWlseU1lbWJlckRlbGV0ZShEYXRhUmVxdWVzdCBkYXRhUmVxdWVzdCkge1xuICAgICAgICBJbnRlZ2VyIG1lbWJlcklkID0gZGF0YVJlcXVlc3QuZ2V0SW50ZWdlcihcIm1lbWJlcklkXCIpO1xuICAgICAgICBPcHRpb25hbDxGYW1pbHlNZW1iZXI+IG9wO1xuICAgICAgICBvcCA9IGZhbWlseU1lbWJlclJlcG9zaXRvcnkuZmluZEJ5SWQobWVtYmVySWQpO1xuICAgICAgICBvcC5pZlByZXNlbnQoZmFtaWx5TWVtYmVyUmVwb3NpdG9yeTo6ZGVsZXRlKTtcbiAgICAgICAgcmV0dXJuIENvbW1vbk1ldGhvZC5nZXRSZXR1cm5NZXNzYWdlT0soKTtcbiAgICB9XG4uLi5cblBhdGg6IHNyYy9tYWluL2phdmEvY24vZWR1L3NkdS9qYXZhL3NlcnZlci9zZXJ2aWNlcy9UZWFjaGVyU2VydmljZXMuamF2YVxuLi4uXG5cbkBTZXJ2aWNlXG5wdWJsaWMgY2xhc3MgVGVhY2hlclNlcnZpY2Uge1xuICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIExvZ2dlciBsb2cgPSBMb2dnZXJGYWN0b3J5LmdldExvZ2dlcihjbi5lZHUuc2R1LmphdmEuc2VydmVyLnNlcnZpY2VzLlRlYWNoZXJTZXJ2aWNlLmNsYXNzKTtcbiAgICBwcml2YXRlIGZpbmFsIFBlcnNvblJlcG9zaXRvcnkgcGVyc29uUmVwb3NpdG9yeTsgIC8v5Lq65ZGY5pWw5o2u5pON5L2c6Ieq5Yqo5rOo5YWlXG4gICAgcHJpdmF0ZSBmaW5hbCBUZWFjaGVyUmVwb3NpdG9yeSB0ZWFjaGVyUmVwb3NpdG9yeTsgIC8v5pWZ5biI5pWw5o2u5pON5L2c6Ieq5Yqo5rOo5YWlXG4gICAgcHJpdmF0ZSBmaW5hbCBVc2VyUmVwb3NpdG9yeSB1c2VyUmVwb3NpdG9yeTsgIC8v5pWw5o2u5pON5L2c6Ieq5Yqo5rOo5YWlXG4gICAgcHJpdmF0ZSBmaW5hbCBVc2VyVHlwZVJlcG9zaXRvcnkgdXNlclR5cGVSZXBvc2l0b3J5OyAvL+eUqOaIt+exu+Wei+aVsOaNruaTjeS9nOiHquWKqOazqOWFpVxuICAgIHByaXZhdGUgZmluYWwgUGFzc3dvcmRFbmNvZGVyIGVuY29kZXI7ICAvL+WvhueggeacjeWKoeiHquWKqOazqOWFpVxuICAgIHByaXZhdGUgZmluYWwgRmVlUmVwb3NpdG9yeSBmZWVSZXBvc2l0b3J5OyAgLy/mtojotLnmlbDmja7mk43kvZzoh6rliqjms6jlhaVcbiAgICBwcml2YXRlIGZpbmFsIEZhbWlseU1lbWJlclJlcG9zaXRvcnkgZmFtaWx5TWVtYmVyUmVwb3NpdG9yeTtcbiAgICBwcml2YXRlIGZpbmFsIFN5c3RlbVNlcnZpY2Ugc3lzdGVtU2VydmljZTtcbi4uLlxuICAgIHB1YmxpYyBEYXRhUmVzcG9uc2UgZ2V0RmFtaWx5TWVtYmVyTGlzdChEYXRhUmVxdWVzdCBkYXRhUmVxdWVzdCkge1xuICAgICAgICBJbnRlZ2VyIHBlcnNvbklkID0gZGF0YVJlcXVlc3QuZ2V0SW50ZWdlcihcInBlcnNvbklkXCIpO1xuICAgICAgICBMaXN0PEZhbWlseU1lbWJlcj4gZkxpc3QgPSBmYW1pbHlNZW1iZXJSZXBvc2l0b3J5LmZpbmRCeVRlYWNoZXJQZXJzb25JZChwZXJzb25JZCk7XG4gICAgICAgIExpc3Q8TWFwPFN0cmluZyxPYmplY3Q+PiBkYXRhTGlzdCA9IG5ldyBBcnJheUxpc3Q8PigpO1xuICAgICAgICBNYXA8U3RyaW5nLE9iamVjdD4gbTtcbiAgICAgICAgaWYgKGZMaXN0ICE9IG51bGwpIHtcbiAgICAgICAgICAgIGZvciAoRmFtaWx5TWVtYmVyIGYgOiBmTGlzdCkge1xuICAgICAgICAgICAgICAgIG0gPSBuZXcgSGFzaE1hcDw+KCk7XG4gICAgICAgICAgICAgICAgbS5wdXQoXCJtZW1iZXJJZFwiLCBmLmdldE1lbWJlcklkKCkpO1xuICAgICAgICAgICAgICAgIG0ucHV0KFwicGVyc29uSWRcIiwgZi5nZXRUZWFjaGVyKCkuZ2V0UGVyc29uSWQoKSk7XG4gICAgICAgICAgICAgICAgbS5wdXQoXCJyZWxhdGlvblwiLCBmLmdldFJlbGF0aW9uKCkpO1xuICAgICAgICAgICAgICAgIG0ucHV0KFwibmFtZVwiLCBmLmdldE5hbWUoKSk7XG4gICAgICAgICAgICAgICAgbS5wdXQoXCJnZW5kZXJcIiwgZi5nZXRHZW5kZXIoKSk7XG4gICAgICAgICAgICAgICAgbS5wdXQoXCJhZ2VcIiwgZi5nZXRBZ2UoKStcIlwiKTtcbiAgICAgICAgICAgICAgICBtLnB1dChcInVuaXRcIiwgZi5nZXRVbml0KCkpO1xuICAgICAgICAgICAgICAgIGRhdGFMaXN0LmFkZChtKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gQ29tbW9uTWV0aG9kLmdldFJldHVybkRhdGEoZGF0YUxpc3QpO1xuICAgIH1cbiAgICBwdWJsaWMgRGF0YVJlc3BvbnNlIGZhbWlseU1lbWJlclNhdmUoRGF0YVJlcXVlc3QgZGF0YVJlcXVlc3QpIHtcbiAgICAgICAgTWFwPFN0cmluZyxPYmplY3Q+IGZvcm0gPSBkYXRhUmVxdWVzdC5nZXRNYXAoXCJmb3JtXCIpO1xuICAgICAgICBJbnRlZ2VyIHBlcnNvbklkID0gQ29tbW9uTWV0aG9kLmdldEludGVnZXIoZm9ybSxcInBlcnNvbklkXCIpO1xuICAgICAgICBJbnRlZ2VyIG1lbWJlcklkID0gQ29tbW9uTWV0aG9kLmdldEludGVnZXIoZm9ybSxcIm1lbWJlcklkXCIpO1xuICAgICAgICBPcHRpb25hbDxGYW1pbHlNZW1iZXI+IG9wO1xuICAgICAgICBGYW1pbHlNZW1iZXIgZiA9IG51bGw7XG4gICAgICAgIGlmKG1lbWJlcklkICE9IG51bGwpIHtcbiAgICAgICAgICAgIG9wID0gZmFtaWx5TWVtYmVyUmVwb3NpdG9yeS5maW5kQnlJZChtZW1iZXJJZCk7XG4gICAgICAgICAgICBpZihvcC5pc1ByZXNlbnQoKSkge1xuICAgICAgICAgICAgICAgIGYgPSBvcC5nZXQoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZihmPT0gbnVsbCkge1xuICAgICAgICAgICAgZiA9IG5ldyBGYW1pbHlNZW1iZXIoKTtcbiAgICAgICAgICAgIGFzc2VydCBwZXJzb25JZCAhPSBudWxsO1xuICAgICAgICAgICAgZi5zZXRTdHVkZW50KHRlYWNoZXJSZXBvc2l0b3J5LmZpbmRCeUlkKHBlcnNvbklkKS5nZXQoKSk7XG4gICAgICAgIH1cbi4uLlxuUGF0aDogc3JjL21haW4vamF2YS9jbi9lZHUvc2R1L2phdmEvc2VydmVyL21vZGVscy9TdHVkZW50LmphdmFcbnBhY2thZ2UgY24uZWR1LnNkdS5qYXZhLnNlcnZlci5tb2RlbHM7XG5cbmltcG9ydCBjb20uZmFzdGVyeG1sLmphY2tzb24uYW5ub3RhdGlvbi5Kc29uSWdub3JlO1xuXG5pbXBvcnQgamFrYXJ0YS5wZXJzaXN0ZW5jZS4qO1xuaW1wb3J0IGpha2FydGEudmFsaWRhdGlvbi5jb25zdHJhaW50cy5TaXplO1xuXG5cbi8qKlxuICogU3R1ZGVudOWtpueUn+ihqOWunuS9k+exuyDkv53lrZjmr4/kuKrlrabnlJ/nmoTkv6Hmga/vvIxcbiAqIEludGVnZXIgcGVyc29uSWQg5a2m55Sf6KGoIHN0dWRlbnQg5Li76ZSuIHBlcnNvbl9pZCDkuI5QZXJzb27ooajkuLvplK7nm7jlkIxcbiAqIFBlcnNvbiBwZXJzb24g5YWz6IGU5Yiw6K+l55So5oi35omA55So55qEUGVyc29u5a+56LGh77yM6LSm5oi35omA5a+55bqU55qE5Lq65ZGY5L+h5oGvIHBlcnNvbl9pZCDlhbPogZQgcGVyc29uIOihqOS4u+mUriBwZXJzb25faWRcbiAqIFN0cmluZyBtYWpvciDkuJPkuJpcbiAqIFN0cmluZyBjbGFzc05hbWUg54+t57qnXG4gKlxuICovXG5pbXBvcnQgbG9tYm9rLkdldHRlcjtcbmltcG9ydCBsb21ib2suU2V0dGVyO1xuQEdldHRlclxuQFNldHRlclxuQEVudGl0eVxuQFRhYmxlKFx0bmFtZSA9IFwic3R1ZGVudFwiLFxuICAgICAgICB1bmlxdWVDb25zdHJhaW50cyA9IHtcbiAgICAgICAgfSlcbnB1YmxpYyBjbGFzcyBTdHVkZW50IHtcbiAgICBASWRcbiAgICBwcml2YXRlIEludGVnZXIgcGVyc29uSWQ7XG5cbiAgICBAT25lVG9PbmVcbiAgICBASm9pbkNvbHVtbihuYW1lPVwicGVyc29uSWRcIilcbiAgICBASnNvbklnbm9yZVxuICAgIHByaXZhdGUgUGVyc29uIHBlcnNvbjtcblxuICAgIEBTaXplKG1heCA9IDIwKVxuICAgIHByaXZhdGUgU3RyaW5nIG1ham9yO1xuXG4gICAgQFNpemUobWF4ID0gNTApXG4gICAgcHJpdmF0ZSBTdHJpbmcgY2xhc3NOYW1lO1xuXG59XG4uLi5cblBhdGg6IHNyYy9tYWluL2phdmEvY24vZWR1L3NkdS9qYXZhL3NlcnZlci9tb2RlbHMvRmVlLmphdmFcbnBhY2thZ2UgY24uZWR1LnNkdS5qYXZhLnNlcnZlci5tb2RlbHM7XG5cbmltcG9ydCBqYWthcnRhLnBlcnNpc3RlbmNlLio7XG5pbXBvcnQgamFrYXJ0YS52YWxpZGF0aW9uLmNvbnN0cmFpbnRzLlNpemU7XG5cbi8qXG4gKiBGZWUg5raI6LS55rWB5rC05a6e5L2T57G7ICDkv53lrZjlrabnlJ/mtojotLnmtYHmsLTnmoTln7rmnKzkv6Hmga/kv6Hmga/vvIxcbiAqIEludGVnZXIgZmVlSWQg5raI6LS56KGoIGZlZSDkuLvplK4gZmVlX2lkXG4gKiBJbnRlZ2VyIHBlcnNvbklkICAg5a+55bqUc3R1ZGVudCDooajph4zpnaLnmoQgcGVyc29uX2lkXG4gKiBTdHJpbmcgZGF5IOaXpeacn1xuICogRG91YmxlIG1vbmV5IOmHkeminVxuICovXG5pbXBvcnQgbG9tYm9rLkdldHRlcjtcbmltcG9ydCBsb21ib2suU2V0dGVyO1xuQEdldHRlclxuQFNldHRlclxuQEVudGl0eVxuQFRhYmxlKFx0bmFtZSA9IFwiZmVlXCJcbilcbnB1YmxpYyBjbGFzcyBGZWUge1xuICAgIEBJZFxuICAgIEBHZW5lcmF0ZWRWYWx1ZShzdHJhdGVneSA9IEdlbmVyYXRpb25UeXBlLklERU5USVRZKVxuICAgIHByaXZhdGUgSW50ZWdlciBmZWVJZDtcbiAgICBATWFueVRvT25lXG4gICAgQEpvaW5Db2x1bW4obmFtZSA9IFwicGVyc29uSWRcIilcbiAgICBwcml2YXRlIFN0dWRlbnQgc3R1ZGVudDtcbiAgICBAU2l6ZShtYXggPSAyMClcbiAgICBwcml2YXRlIFN0cmluZyBkYXk7XG4gICAgcHJpdmF0ZSBEb3VibGUgbW9uZXk7XG5cbn1cbi4uLlxuUGF0aDogc3JjL21haW4vamF2YS9jbi9lZHUvc2R1L2phdmEvc2VydmVyL2NvbnRyb2xsZXJzL1N0dWRlbnRDb250cm9sbGVyLmphdmFcbi4uLlxuXG4gICAgLypcbiAgICAgICAgRmFtaWx5TWVtYmVyXG4gICAgICovXG4gICAgQFBvc3RNYXBwaW5nKFwiL2dldEZhbWlseU1lbWJlckxpc3RcIilcbiAgICBAUHJlQXV0aG9yaXplKFwiIGhhc1JvbGUoJ0FETUlOJykgb3IgIGhhc1JvbGUoJ1NUVURFTlQnKVwiKVxuICAgIHB1YmxpYyBEYXRhUmVzcG9uc2UgZ2V0RmFtaWx5TWVtYmVyTGlzdChAVmFsaWQgQFJlcXVlc3RCb2R5IERhdGFSZXF1ZXN0IGRhdGFSZXF1ZXN0KSB7XG4gICAgICAgIHJldHVybiBzdHVkZW50U2VydmljZS5nZXRGYW1pbHlNZW1iZXJMaXN0KGRhdGFSZXF1ZXN0KTtcbiAgICB9XG5cbiAgICBAUG9zdE1hcHBpbmcoXCIvZmFtaWx5TWVtYmVyU2F2ZVwiKVxuICAgIEBQcmVBdXRob3JpemUoXCIgaGFzUm9sZSgnQURNSU4nKSBvciAgaGFzUm9sZSgnU1RVREVOVCcpXCIpXG4gICAgcHVibGljIERhdGFSZXNwb25zZSBmYW1pbHlNZW1iZXJTYXZlKEBWYWxpZCBAUmVxdWVzdEJvZHkgRGF0YVJlcXVlc3QgZGF0YVJlcXVlc3QpIHtcbiAgICAgICAgcmV0dXJuIHN0dWRlbnRTZXJ2aWNlLmZhbWlseU1lbWJlclNhdmUoZGF0YVJlcXVlc3QpO1xuICAgIH1cblxuICAgIEBQb3N0TWFwcGluZyhcIi9mYW1pbHlNZW1iZXJEZWxldGVcIilcbiAgICBAUHJlQXV0aG9yaXplKFwiIGhhc1JvbGUoJ0FETUlOJykgb3IgIGhhc1JvbGUoJ1NUVURFTlQnKVwiKVxuICAgIHB1YmxpYyBEYXRhUmVzcG9uc2UgZmFtaWx5TWVtYmVyRGVsZXRlKEBWYWxpZCBAUmVxdWVzdEJvZHkgRGF0YVJlcXVlc3QgZGF0YVJlcXVlc3QpIHtcbiAgICAgICAgcmV0dXJuIHN0dWRlbnRTZXJ2aWNlLmZhbWlseU1lbWJlckRlbGV0ZShkYXRhUmVxdWVzdCk7XG4gICAgfVxuLi4uXG5QYXRoOiBqYXZhLXNlcnZlci9zcmMvbWFpbi9qYXZhL2NuL2VkdS9zZHUvamF2YS9zZXJ2ZXIvY29udHJvbGxlcnMvU3R1ZGVudENvbnRyb2xsZXIuamF2YVxuLi4uXG5cbiAgICAvKlxuICAgICAgICBGYW1pbHlNZW1iZXJcbiAgICAgKi9cbiAgICBAUG9zdE1hcHBpbmcoXCIvZ2V0RmFtaWx5TWVtYmVyTGlzdFwiKVxuICAgIEBQcmVBdXRob3JpemUoXCIgaGFzUm9sZSgnQURNSU4nKSBvciAgaGFzUm9sZSgnU1RVREVOVCcpXCIpXG4gICAgcHVibGljIERhdGFSZXNwb25zZSBnZXRGYW1pbHlNZW1iZXJMaXN0KEBWYWxpZCBAUmVxdWVzdEJvZHkgRGF0YVJlcXVlc3QgZGF0YVJlcXVlc3QpIHtcbiAgICAgICAgcmV0dXJuIHN0dWRlbnRTZXJ2aWNlLmdldEZhbWlseU1lbWJlckxpc3QoZGF0YVJlcXVlc3QpO1xuICAgIH1cblxuICAgIEBQb3N0TWFwcGluZyhcIi9mYW1pbHlNZW1iZXJTYXZlXCIpXG4gICAgQFByZUF1dGhvcml6ZShcIiBoYXNSb2xlKCdBRE1JTicpIG9yICBoYXNSb2xlKCdTVFVERU5UJylcIilcbiAgICBwdWJsaWMgRGF0YVJlc3BvbnNlIGZhbWlseU1lbWJlclNhdmUoQFZhbGlkIEBSZXF1ZXN0Qm9keSBEYXRhUmVxdWVzdCBkYXRhUmVxdWVzdCkge1xuICAgICAgICByZXR1cm4gc3R1ZGVudFNlcnZpY2UuZmFtaWx5TWVtYmVyU2F2ZShkYXRhUmVxdWVzdCk7XG4gICAgfVxuXG4gICAgQFBvc3RNYXBwaW5nKFwiL2ZhbWlseU1lbWJlckRlbGV0ZVwiKVxuICAgIEBQcmVBdXRob3JpemUoXCIgaGFzUm9sZSgnQURNSU4nKSBvciAgaGFzUm9sZSgnU1RVREVOVCcpXCIpXG4gICAgcHVibGljIERhdGFSZXNwb25zZSBmYW1pbHlNZW1iZXJEZWxldGUoQFZhbGlkIEBSZXF1ZXN0Qm9keSBEYXRhUmVxdWVzdCBkYXRhUmVxdWVzdCkge1xuICAgICAgICByZXR1cm4gc3R1ZGVudFNlcnZpY2UuZmFtaWx5TWVtYmVyRGVsZXRlKGRhdGFSZXF1ZXN0KTtcbiAgICB9XG4uLi5cblBhdGg6IHNyYy9tYWluL2phdmEvY29tL3RlYWNoL2phdmFmeC9jb250cm9sbGVyL1N0dWRlbnRDb250cm9sbGVyLmphdmFcbi4uLlxuXG4gICAgQEZYTUxcbiAgICBwcm90ZWN0ZWQgdm9pZCBvbkZhbWlseUJ1dHRvbkNsaWNrKCkge1xuICAgICAgICBEYXRhUmVxdWVzdCByZXEgPSBuZXcgRGF0YVJlcXVlc3QoKTtcbiAgICAgICAgcmVxLmFkZChcInBlcnNvbklkXCIsIHBlcnNvbklkKTtcbiAgICAgICAgRGF0YVJlc3BvbnNlIHJlcyA9IEh0dHBSZXF1ZXN0VXRpbC5yZXF1ZXN0KFwiL2FwaS9zdHVkZW50L2dldEZhbWlseU1lbWJlckxpc3RcIiwgcmVxKTtcbiAgICAgICAgaWYgKHJlcy5nZXRDb2RlKCkgIT0gMCkge1xuICAgICAgICAgICAgTWVzc2FnZURpYWxvZy5zaG93RGlhbG9nKHJlcy5nZXRNc2coKSk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbi4uLlxuUGF0aDogdGFyZ2V0L21hdmVuLXN0YXR1cy9tYXZlbi1jb21waWxlci1wbHVnaW4vY29tcGlsZS9kZWZhdWx0LWNvbXBpbGUvY3JlYXRlZEZpbGVzLmxzdFxuLi4uXG5jblxcZWR1XFxzZHVcXGphdmFcXHNlcnZlclxccmVwb3NpdG9yeXNcXFN0YXRpc3RpY3NEYXlSZXBvc2l0b3J5LmNsYXNzXG5jblxcZWR1XFxzZHVcXGphdmFcXHNlcnZlclxcc2VydmljZXNcXFN0YXRpc3RpY3NTZXJ2aWNlLmNsYXNzXG5jblxcZWR1XFxzZHVcXGphdmFcXHNlcnZlclxccmVwb3NpdG9yeXNcXEZhbWlseU1lbWJlclJlcG9zaXRvcnkuY2xhc3NcbmNuXFxlZHVcXHNkdVxcamF2YVxcc2VydmVyXFxyZXBvc2l0b3J5c1xcTWVudUluZm9SZXBvc2l0b3J5LmNsYXNzXG5jblxcZWR1XFxzZHVcXGphdmFcXHNlcnZlclxccmVwb3NpdG9yeXNcXFN5c3RlbUluZm9SZXBvc2l0b3J5LmNsYXNzXG5jblxcZWR1XFxzZHVcXGphdmFcXHNlcnZlclxcbW9kZWxzXFxSZXF1ZXN0TG9nLmNsYXNzXG5jblxcZWR1XFxzZHVcXGphdmFcXHNlcnZlclxccGF5bG9hZFxccmVxdWVzdFxcRGF0YVJlcXVlc3QuY2xhc3NcbmNuXFxlZHVcXHNkdVxcamF2YVxcc2VydmVyXFx1dGlsXFxMb2dpbkNvbnRyb2xVdGlsLmNsYXNzXG5jblxcZWR1XFxzZHVcXGphdmFcXHNlcnZlclxcc2VydmljZXNcXENvdXJzZVNlcnZpY2UuY2xhc3NcbmNuXFxlZHVcXHNkdVxcamF2YVxcc2VydmVyXFxwYXlsb2FkXFxyZXNwb25zZVxcT3B0aW9uSXRlbUxpc3QuY2xhc3NcbmNuXFxlZHVcXHNkdVxcamF2YVxcc2VydmVyXFxyZXBvc2l0b3J5c1xcU3R1ZGVudFN0YXRpc3RpY3NSZXBvc2l0b3J5LmNsYXNzXG5jblxcZWR1XFxzZHVcXGphdmFcXHNlcnZlclxcY29uZmlnc1xcU2VjdXJpdHlDb25maWd1cmF0aW9uLmNsYXNzXG5jblxcZWR1XFxzZHVcXGphdmFcXHNlcnZlclxcY29uZmlnc1xcSnd0QXV0aGVudGljYXRpb25GaWx0ZXIuY2xhc3NcbmNuXFxlZHVcXHNkdVxcamF2YVxcc2VydmVyXFxyZXBvc2l0b3J5c1xcU2NvcmVSZXBvc2l0b3J5LmNsYXNzXG5jblxcZWR1XFxzZHVcXGphdmFcXHNlcnZlclxcc2VydmljZXNcXEF1dGhlbnRpY2F0aW9uU2VydmljZS5jbGFzc1xuY25cXGVkdVxcc2R1XFxqYXZhXFxzZXJ2ZXJcXHNlcnZpY2VzXFxBdXRoU2VydmljZS5jbGFzc1xuY25cXGVkdVxcc2R1XFxqYXZhXFxzZXJ2ZXJcXEphdmFTZXJ2ZXJBcHBsaWNhdGlvbi5jbGFzc1xuY25cXGVkdVxcc2R1XFxqYXZhXFxzZXJ2ZXJcXG1vZGVsc1xcU3R1ZGVudC5jbGFzc1xuY25cXGVkdVxcc2R1XFxqYXZhXFxzZXJ2ZXJcXG1vZGVsc1xcVXNlci5jbGFzc1xuY25cXGVkdVxcc2R1XFxqYXZhXFxzZXJ2ZXJcXHNlcnZpY2VzXFxCYXNlU2VydmljZS5jbGFzc1xuY25cXGVkdVxcc2R1XFxqYXZhXFxzZXJ2ZXJcXG1vZGVsc1xcRVVzZXJUeXBlLmNsYXNzXG5jblxcZWR1XFxzZHVcXGphdmFcXHNlcnZlclxcbW9kZWxzXFxGYW1pbHlNZW1iZXIuY2xhc3NcbmNuXFxlZHVcXHNkdVxcamF2YVxcc2VydmVyXFxwYXlsb2FkXFxyZXNwb25zZVxcRGF0YVJlc3BvbnNlLmNsYXNzXG5jblxcZWR1XFxzZHVcXGphdmFcXHNlcnZlclxcU3lzdGVtQXBwbGljYXRpb25MaXN0ZW5lci5jbGFzc1xuY25cXGVkdVxcc2R1XFxqYXZhXFxzZXJ2ZXJcXHJlcG9zaXRvcnlzXFxVc2VyVHlwZVJlcG9zaXRvcnkuY2xhc3NcbmNuXFxlZHVcXHNkdVxcamF2YVxcc2VydmVyXFxjb250cm9sbGVyc1xcQmFzZUNvbnRyb2xsZXIuY2xhc3NcbmNuXFxlZHVcXHNkdVxcamF2YVxcc2VydmVyXFxjb250cm9sbGVyc1xcU3R1ZGVudENvbnRyb2xsZXIuY2xhc3Ncbi4uLlxuUGF0aDogdGFyZ2V0L21hdmVuLXN0YXR1cy9tYXZlbi1jb21waWxlci1wbHVnaW4vY29tcGlsZS9kZWZhdWx0LWNvbXBpbGUvaW5wdXRGaWxlcy5sc3Rcbi4uLlxuQzpcXFVzZXJzXFxwcmluY2lwXFxEZXNrdG9wXFxqYXZhLWtlc2hlXFxqYXZhLXNlcnZlclxcc3JjXFxtYWluXFxqYXZhXFxjblxcZWR1XFxzZHVcXGphdmFcXHNlcnZlclxcbW9kZWxzXFxFVXNlclR5cGUuamF2YVxuQzpcXFVzZXJzXFxwcmluY2lwXFxEZXNrdG9wXFxqYXZhLWtlc2hlXFxqYXZhLXNlcnZlclxcc3JjXFxtYWluXFxqYXZhXFxjblxcZWR1XFxzZHVcXGphdmFcXHNlcnZlclxcbW9kZWxzXFxGYW1pbHlNZW1iZXIuamF2YVxuQzpcXFVzZXJzXFxwcmluY2lwXFxEZXNrdG9wXFxqYXZhLWtlc2hlXFxqYXZhLXNlcnZlclxcc3JjXFxtYWluXFxqYXZhXFxjblxcZWR1XFxzZHVcXGphdmFcXHNlcnZlclxcbW9kZWxzXFxGZWUuamF2YVxuQzpcXFVzZXJzXFxwcmluY2lwXFxEZXNrdG9wXFxqYXZhLWtlc2hlXFxqYXZhLXNlcnZlclxcc3JjXFxtYWluXFxqYXZhXFxjblxcZWR1XFxzZHVcXGphdmFcXHNlcnZlclxcbW9kZWxzXFxNZW51SW5mby5qYXZhXG5DOlxcVXNlcnNcXHByaW5jaXBcXERlc2t0b3BcXGphdmEta2VzaGVcXGphdmEtc2VydmVyXFxzcmNcXG1haW5cXGphdmFcXGNuXFxlZHVcXHNkdVxcamF2YVxcc2VydmVyXFxtb2RlbHNcXE1vZGlmeUxvZy5qYXZhXG5DOlxcVXNlcnNcXHByaW5jaXBcXERlc2t0b3BcXGphdmEta2VzaGVcXGphdmEtc2VydmVyXFxzcmNcXG1haW5cXGphdmFcXGNuXFxlZHVcXHNkdVxcamF2YVxcc2VydmVyXFxtb2RlbHNcXFBlcnNvbi5qYXZhXG5DOlxcVXNlcnNcXHByaW5jaXBcXERlc2t0b3BcXGphdmEta2VzaGVcXGphdmEtc2VydmVyXFxzcmNcXG1haW5cXGphdmFcXGNuXFxlZHVcXHNkdVxcamF2YVxcc2VydmVyXFxtb2RlbHNcXFJlcXVlc3RMb2cuamF2YVxuLi4uXG5QYXRoOiBqYXZhLXNlcnZlci9zcmMvbWFpbi9qYXZhL2NuL2VkdS9zZHUvamF2YS9zZXJ2ZXIvc2VydmljZXMvVGVhY2hlclNlcnZpY2VzLmphdmFcbi4uLlxuaW1wb3J0IG9yZy5zcHJpbmdmcmFtZXdvcmsuc3RlcmVvdHlwZS5TZXJ2aWNlO1xuaW1wb3J0IG9yZy5zcHJpbmdmcmFtZXdvcmsud2ViLnNlcnZsZXQubXZjLm1ldGhvZC5hbm5vdGF0aW9uLlN0cmVhbWluZ1Jlc3BvbnNlQm9keTtcblxuaW1wb3J0IGphdmEudXRpbC4qO1xuXG5AU2VydmljZVxucHVibGljIGNsYXNzIFRlYWNoZXJTZXJ2aWNlcyB7XG4gICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgTG9nZ2VyIGxvZyA9IExvZ2dlckZhY3RvcnkuZ2V0TG9nZ2VyKFRlYWNoZXJTZXJ2aWNlcy5jbGFzcyk7XG4gICAgcHJpdmF0ZSBmaW5hbCBQZXJzb25SZXBvc2l0b3J5IHBlcnNvblJlcG9zaXRvcnk7ICAvL+S6uuWRmOaVsOaNruaTjeS9nOiHquWKqOazqOWFpVxuICAgIHByaXZhdGUgZmluYWwgVGVhY2hlclJlcG9zaXRvcnkgdGVhY2hlclJlcG9zaXRvcnk7ICAvL+aVmeW4iOaVsOaNruaTjeS9nOiHquWKqOazqOWFpVxuICAgIHByaXZhdGUgZmluYWwgVXNlclJlcG9zaXRvcnkgdXNlclJlcG9zaXRvcnk7ICAvL+aVsOaNruaTjeS9nOiHquWKqOazqOWFpVxuICAgIHByaXZhdGUgZmluYWwgVXNlclR5cGVSZXBvc2l0b3J5IHVzZXJUeXBlUmVwb3NpdG9yeTsgLy/nlKjmiLfnsbvlnovmlbDmja7mk43kvZzoh6rliqjms6jlhaVcbiAgICBwcml2YXRlIGZpbmFsIFBhc3N3b3JkRW5jb2RlciBlbmNvZGVyOyAgLy/lr4bnoIHmnI3liqHoh6rliqjms6jlhaVcbiAgICAvL+a2iOi0ueaVsOaNruaTjeS9nOiHquWKqOazqOWFpVxuICAgIHByaXZhdGUgZmluYWwgRmFtaWx5TWVtYmVyUmVwb3NpdG9yeSBmYW1pbHlNZW1iZXJSZXBvc2l0b3J5O1xuICAgIHByaXZhdGUgZmluYWwgU3lzdGVtU2VydmljZSBzeXN0ZW1TZXJ2aWNlO1xuLi4uXG5QYXRoOiBsb2dzL2phdmEtc2VydmVyLTIwMjUtMDItMTkuMC5sb2dcbi4uLlxuMjAyNS0wMi0xOSAxNzowMDo1Miw0NTkgW21haW5dIElORk8gIG8ucy5kLnIuYy5SZXBvc2l0b3J5Q29uZmlndXJhdGlvbkV4dGVuc2lvblN1cHBvcnQgIC0gU3ByaW5nIERhdGEgUmVkaXMgLSBDb3VsZCBub3Qgc2FmZWx5IGlkZW50aWZ5IHN0b3JlIGFzc2lnbm1lbnQgZm9yIHJlcG9zaXRvcnkgY2FuZGlkYXRlIGludGVyZmFjZSBjbi5lZHUuc2R1LmphdmEuc2VydmVyLnJlcG9zaXRvcnlzLkZhbWlseU1lbWJlclJlcG9zaXRvcnk7IElmIHlvdSB3YW50IHRoaXMgcmVwb3NpdG9yeSB0byBiZSBhIFJlZGlzIHJlcG9zaXRvcnksIGNvbnNpZGVyIGFubm90YXRpbmcgeW91ciBlbnRpdGllcyB3aXRoIG9uZSBvZiB0aGVzZSBhbm5vdGF0aW9uczogb3JnLnNwcmluZ2ZyYW1ld29yay5kYXRhLnJlZGlzLmNvcmUuUmVkaXNIYXNoIChwcmVmZXJyZWQpLCBvciBjb25zaWRlciBleHRlbmRpbmcgb25lIG9mIHRoZSBmb2xsb3dpbmcgdHlwZXMgd2l0aCB5b3VyIHJlcG9zaXRvcnk6IG9yZy5zcHJpbmdmcmFtZXdvcmsuZGF0YS5rZXl2YWx1ZS5yZXBvc2l0b3J5LktleVZhbHVlUmVwb3NpdG9yeVxuLi4uXG4yMDI1LTAyLTE5IDE3OjEwOjE0LDc4MyBbbWFpbl0gSU5GTyAgby5zLmQuci5jLlJlcG9zaXRvcnlDb25maWd1cmF0aW9uRXh0ZW5zaW9uU3VwcG9ydCAgLSBTcHJpbmcgRGF0YSBSZWRpcyAtIENvdWxkIG5vdCBzYWZlbHkgaWRlbnRpZnkgc3RvcmUgYXNzaWdubWVudCBmb3IgcmVwb3NpdG9yeSBjYW5kaWRhdGUgaW50ZXJmYWNlIGNuLmVkdS5zZHUuamF2YS5zZXJ2ZXIucmVwb3NpdG9yeXMuRmFtaWx5TWVtYmVyUmVwb3NpdG9yeTsgSWYgeW91IHdhbnQgdGhpcyByZXBvc2l0b3J5IHRvIGJlIGEgUmVkaXMgcmVwb3NpdG9yeSwgY29uc2lkZXIgYW5ub3RhdGluZyB5b3VyIGVudGl0aWVzIHdpdGggb25lIG9mIHRoZXNlIGFubm90YXRpb25zOiBvcmcuc3ByaW5nZnJhbWV3b3JrLmRhdGEucmVkaXMuY29yZS5SZWRpc0hhc2ggKHByZWZlcnJlZCksIG9yIGNvbnNpZGVyIGV4dGVuZGluZyBvbmUgb2YgdGhlIGZvbGxvd2luZyB0eXBlcyB3aXRoIHlvdXIgcmVwb3NpdG9yeTogb3JnLnNwcmluZ2ZyYW1ld29yay5kYXRhLmtleXZhbHVlLnJlcG9zaXRvcnkuS2V5VmFsdWVSZXBvc2l0b3J5XG4uLi5cbjIwMjUtMDItMTkgMTc6NDI6MDcsMjgxIFttYWluXSBJTkZPICBvLnMuZC5yLmMuUmVwb3NpdG9yeUNvbmZpZ3VyYXRpb25FeHRlbnNpb25TdXBwb3J0ICAtIFNwcmluZyBEYXRhIFJlZGlzIC0gQ291bGQgbm90IHNhZmVseSBpZGVudGlmeSBzdG9yZSBhc3NpZ25tZW50IGZvciByZXBvc2l0b3J5IGNhbmRpZGF0ZSBpbnRlcmZhY2UgY24uZWR1LnNkdS5qYXZhLnNlcnZlci5yZXBvc2l0b3J5cy5GYW1pbHlNZW1iZXJSZXBvc2l0b3J5OyBJZiB5b3Ugd2FudCB0aGlzIHJlcG9zaXRvcnkgdG8gYmUgYSBSZWRpcyByZXBvc2l0b3J5LCBjb25zaWRlciBhbm5vdGF0aW5nIHlvdXIgZW50aXRpZXMgd2l0aCBvbmUgb2YgdGhlc2UgYW5ub3RhdGlvbnM6IG9yZy5zcHJpbmdmcmFtZXdvcmsuZGF0YS5yZWRpcy5jb3JlLlJlZGlzSGFzaCAocHJlZmVycmVkKSwgb3IgY29uc2lkZXIgZXh0ZW5kaW5nIG9uZSBvZiB0aGUgZm9sbG93aW5nIHR5cGVzIHdpdGggeW91ciByZXBvc2l0b3J5OiBvcmcuc3ByaW5nZnJhbWV3b3JrLmRhdGEua2V5dmFsdWUucmVwb3NpdG9yeS5LZXlWYWx1ZVJlcG9zaXRvcnlcbi4uLlxuUGF0aDogbG9ncy9qYXZhLXNlcnZlci0yMDI1LTAyLTI1LjAubG9nXG4uLi5cbjIwMjUtMDItMjUgMTg6NTg6MDAsNjM5IFttYWluXSBJTkZPICBvLnMuZC5yLmMuUmVwb3NpdG9yeUMuLi4iLCJpc19lcnJvciI6ZmFsc2UsInJlcXVlc3RfaWQiOiIiLCJ0b29sX3VzZV9pZCI6InRvb2x1X3ZydHhfMDFDQ3ZHWk1aQ1JKU1k2MjVwNXlBbnpnIn19LHsiaWQiOjIsInR5cGUiOjQsImlkZV9zdGF0ZV9ub2RlIjp7IndvcmtzcGFjZUZvbGRlcnMiOlt7InJlcG9zaXRvcnlSb290IjoiQzovVXNlcnMvcHJpbmNpcC9Eb2N1bWVudHMvR2l0SHViL2JhaWNhaS9qYXZhLXNlcnZlciIsImZvbGRlclJvb3QiOiJDOi9Vc2Vycy9wcmluY2lwL0RvY3VtZW50cy9HaXRIdWIvYmFpY2FpL2phdmEtc2VydmVyIn1dLCJ3b3Jrc3BhY2VGb2xkZXJzVW5jaGFuZ2VkIjpmYWxzZX19XSwidGltZXN0YW1wIjoiMjAyNS0wNS0xNlQxNTowNTozOC4yOTJaIiwicmVzcG9uc2VfdGV4dCI6IuiuqeaIkeafpeeci+S4gOS4iyBgVGVhY2hlclNlcnZpY2VzLmphdmFgIOS4reeahCBgZ2V0RmFtaWx5TWVtYmVyTGlzdGAg5ZKMIGBmYW1pbHlNZW1iZXJTYXZlYCDmlrnms5XvvJpcbiIsIndvcmtzcGFjZV9maWxlX2NodW5rcyI6W119LHsic3RhdHVzIjoic3VjY2VzcyIsInJlcXVlc3RfaWQiOiI5ZDViN2YwNS1jMWU1LTRiMTgtYjBjZC0wNTY2NWUyYzBmY2EiLCJyZXF1ZXN0X21lc3NhZ2UiOiIiLCJzdHJ1Y3R1cmVkX291dHB1dF9ub2RlcyI6W3siaWQiOjEsInR5cGUiOjUsImNvbnRlbnQiOiIiLCJ0b29sX3VzZSI6eyJ0b29sX3VzZV9pZCI6InRvb2x1X3ZydHhfMDFQYTRZYWduY3lHdWR5TUZhNWlFRjJVIiwidG9vbF9uYW1lIjoiY29kZWJhc2UtcmV0cmlldmFsIiwiaW5wdXRfanNvbiI6IntcImluZm9ybWF0aW9uX3JlcXVlc3RcIjogXCJcXHU2N2U1XFx1NjI3ZSBqYXZhLXNlcnZlci9zcmMvbWFpbi9qYXZhL2NuL2VkdS9zZHUvamF2YS9zZXJ2ZXIvc2VydmljZXMvVGVhY2hlclNlcnZpY2VzLmphdmEgXFx1NjU4N1xcdTRlZjZcXHU0ZTJkXFx1NzY4NCBmYW1pbHlNZW1iZXJTYXZlIFxcdTY1YjlcXHU2Y2Q1XFx1NzY4NFxcdTViOGNcXHU2NTc0XFx1NWI5ZVxcdTczYjBcIn0iLCJtY3Bfc2VydmVyX25hbWUiOiIiLCJtY3BfdG9vbF9uYW1lIjoiIn19LHsiaWQiOjAsInR5cGUiOjAsImNvbnRlbnQiOiLorqnmiJHmn6XnnIvkuIDkuIsgYFRlYWNoZXJTZXJ2aWNlcy5qYXZhYCDkuK3nmoQgYGZhbWlseU1lbWJlclNhdmVgIOaWueazleeahOWujOaVtOWunueOsO+8mlxuIn0seyJpZCI6MiwidHlwZSI6MiwiY29udGVudCI6IiJ9LHsiaWQiOjMsInR5cGUiOjMsImNvbnRlbnQiOiIifV0sInNlZW5fc3RhdGUiOiJzZWVuIiwic3RydWN0dXJlZF9yZXF1ZXN0X25vZGVzIjpbeyJpZCI6MSwidHlwZSI6MSwidG9vbF9yZXN1bHRfbm9kZSI6eyJjb250ZW50IjoiVGhlIGZvbGxvd2luZyBjb2RlIHNlY3Rpb25zIHdlcmUgcmV0cmlldmVkOlxuUGF0aDogc3JjL21haW4vamF2YS9jbi9lZHUvc2R1L2phdmEvc2VydmVyL3NlcnZpY2VzL1RlYWNoZXJTZXJ2aWNlcy5qYXZhXG4uLi5cblxuQFNlcnZpY2VcbnB1YmxpYyBjbGFzcyBUZWFjaGVyU2VydmljZSB7XG4gICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgTG9nZ2VyIGxvZyA9IExvZ2dlckZhY3RvcnkuZ2V0TG9nZ2VyKGNuLmVkdS5zZHUuamF2YS5zZXJ2ZXIuc2VydmljZXMuVGVhY2hlclNlcnZpY2UuY2xhc3MpO1xuICAgIHByaXZhdGUgZmluYWwgUGVyc29uUmVwb3NpdG9yeSBwZXJzb25SZXBvc2l0b3J5OyAgLy/kurrlkZjmlbDmja7mk43kvZzoh6rliqjms6jlhaVcbiAgICBwcml2YXRlIGZpbmFsIFRlYWNoZXJSZXBvc2l0b3J5IHRlYWNoZXJSZXBvc2l0b3J5OyAgLy/mlZnluIjmlbDmja7mk43kvZzoh6rliqjms6jlhaVcbiAgICBwcml2YXRlIGZpbmFsIFVzZXJSZXBvc2l0b3J5IHVzZXJSZXBvc2l0b3J5OyAgLy/mlbDmja7mk43kvZzoh6rliqjms6jlhaVcbiAgICBwcml2YXRlIGZpbmFsIFVzZXJUeXBlUmVwb3NpdG9yeSB1c2VyVHlwZVJlcG9zaXRvcnk7IC8v55So5oi357G75Z6L5pWw5o2u5pON5L2c6Ieq5Yqo5rOo5YWlXG4gICAgcHJpdmF0ZSBmaW5hbCBQYXNzd29yZEVuY29kZXIgZW5jb2RlcjsgIC8v5a+G56CB5pyN5Yqh6Ieq5Yqo5rOo5YWlXG4gICAgcHJpdmF0ZSBmaW5hbCBGZWVSZXBvc2l0b3J5IGZlZVJlcG9zaXRvcnk7ICAvL+a2iOi0ueaVsOaNruaTjeS9nOiHquWKqOazqOWFpVxuICAgIHByaXZhdGUgZmluYWwgRmFtaWx5TWVtYmVyUmVwb3NpdG9yeSBmYW1pbHlNZW1iZXJSZXBvc2l0b3J5O1xuICAgIHByaXZhdGUgZmluYWwgU3lzdGVtU2VydmljZSBzeXN0ZW1TZXJ2aWNlO1xuLi4uXG4gICAgcHVibGljIE1hcDxTdHJpbmcsT2JqZWN0PiBnZXRNYXBGcm9tVGVhY2hlcihUZWFjaGVyIHMpIHtcbiAgICAgICAgTWFwPFN0cmluZyxPYmplY3Q+IG0gPSBuZXcgSGFzaE1hcDw+KCk7XG4gICAgICAgIFBlcnNvbiBwO1xuICAgICAgICBpZihzID09IG51bGwpXG4gICAgICAgICAgICByZXR1cm4gbTtcbiAgICAgICAgbS5wdXQoXCJ0aXRsZVwiLHMuZ2V0VGl0bGUoKSk7XG4gICAgICAgIG0ucHV0KFwiZGVncmVlXCIscy5nZXREZWdyZWUoKSk7XG4gICAgICAgIG0ucHV0KFwiY2xhc3NOYW1lXCIscy5nZXRDbGFzc05hbWUoKSk7XG4gICAgICAgIHAgPSBzLmdldFBlcnNvbigpO1xuICAgICAgICBpZihwID09IG51bGwpXG4gICAgICAgICAgICByZXR1cm4gbTtcbiAgICAgICAgbS5wdXQoXCJwZXJzb25JZFwiLCBzLmdldFBlcnNvbklkKCkpO1xuICAgICAgICBtLnB1dChcIm51bVwiLHAuZ2V0TnVtKCkpO1xuICAgICAgICBtLnB1dChcIm5hbWVcIixwLmdldE5hbWUoKSk7XG4gICAgICAgIG0ucHV0KFwiZGVwdFwiLHAuZ2V0RGVwdCgpKTtcbiAgICAgICAgbS5wdXQoXCJjYXJkXCIscC5nZXRDYXJkKCkpO1xuICAgICAgICBTdHJpbmcgZ2VuZGVyID0gcC5nZXRHZW5kZXIoKTtcbiAgICAgICAgbS5wdXQoXCJnZW5kZXJcIixnZW5kZXIpO1xuICAgICAgICBtLnB1dChcImdlbmRlck5hbWVcIiwgQ29tRGF0YVV0aWwuZ2V0SW5zdGFuY2UoKS5nZXREaWN0aW9uYXJ5TGFiZWxCeVZhbHVlKFwiWEJNXCIsIGdlbmRlcikpOyAvL+aAp+WIq+exu+Wei+eahOWAvOi9rOaNouaIkOaVsOaNruexu+Wei+WQjVxuICAgICAgICBtLnB1dChcImJpcnRoZGF5XCIsIHAuZ2V0QmlydGhkYXkoKSk7ICAvL+aXtumXtOagvOW8j+i9rOaNouWtl+espuS4slxuICAgICAgICBtLnB1dChcImVtYWlsXCIscC5nZXRFbWFpbCgpKTtcbiAgICAgICAgbS5wdXQoXCJwaG9uZVwiLHAuZ2V0UGhvbmUoKSk7XG4gICAgICAgIG0ucHV0KFwiYWRkcmVzc1wiLHAuZ2V0QWRkcmVzcygpKTtcbiAgICAgICAgbS5wdXQoXCJpbnRyb2R1Y2VcIixwLmdldEludHJvZHVjZSgpKTtcbiAgICAgICAgcmV0dXJuIG07XG4gICAgfVxuICAgIHB1YmxpYyBMaXN0PE1hcDxTdHJpbmcsT2JqZWN0Pj4gZ2V0VGVhY2hlck1hcExpc3QoU3RyaW5nIG51bU5hbWUpIHtcbiAgICAgICAgTGlzdDxNYXA8U3RyaW5nLE9iamVjdD4+IGRhdGFMaXN0ID0gbmV3IEFycmF5TGlzdDw+KCk7XG4gICAgICAgIExpc3Q8VGVhY2hlcj4gc0xpc3QgPSB0ZWFjaGVyUmVwb3NpdG9yeS5maW5kVGVhY2hlckxpc3RCeU51bU5hbWUobnVtTmFtZSk7ICAvL+aVsOaNruW6k+afpeivouaTjeS9nFxuICAgICAgICBpZiAoc0xpc3QgPT0gbnVsbCB8fCBzTGlzdC5pc0VtcHR5KCkpXG4gICAgICAgICAgICByZXR1cm4gZGF0YUxpc3Q7XG4gICAgICAgIGZvciAoVGVhY2hlciB0ZWFjaGVyIDogc0xpc3QpIHtcbiAgICAgICAgICAgIGRhdGFMaXN0LmFkZChnZXRNYXBGcm9tVGVhY2hlcih0ZWFjaGVyKSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGRhdGFMaXN0O1xuICAgIH1cbiAgICBwdWJsaWMgRGF0YVJlc3BvbnNlIGdldFRlYWNoZXJMaXN0KERhdGFSZXF1ZXN0IGRhdGFSZXF1ZXN0KSB7XG4gICAgICAgIFN0cmluZyBudW1OYW1lID0gZGF0YVJlcXVlc3QuZ2V0U3RyaW5nKFwibnVtTmFtZVwiKTtcbiAgICAgICAgTGlzdDxNYXA8U3RyaW5nLE9iamVjdD4+IGRhdGFMaXN0ID0gIGdldFRlYWNoZXJMaXN0KG51bU5hbWUpO1xuICAgICAgICByZXR1cm4gQ29tbW9uTWV0aG9kLmdldFJldHVybkRhdGEoZGF0YUxpc3QpOyAgLy/mjInnhafmtYvor5XmoYbmnrbop4TojIPkvJrpgIFNYXDnmoRsaXN0XG4gICAgfVxuICAgIHB1YmxpYyBEYXRhUmVzcG9uc2UgdGVhY2hlckRlbGV0ZShEYXRhUmVxdWVzdCBkYXRhUmVxdWVzdCkge1xuICAgICAgICBJbnRlZ2VyIHBlcnNvbklkID0gZGF0YVJlcXVlc3QuZ2V0SW50ZWdlcihcInBlcnNvbklkXCIpOyAgLy/ojrflj5Z0ZWFjaGVyX2lk5YC8XG4gICAgICAgIFRlYWNoZXIgcyA9IG51bGw7XG4gICAgICAgIE9wdGlvbmFsPFRlYWNoZXI+IG9wO1xuICAgICAgICBpZiAocGVyc29uSWQgIT0gbnVsbCAmJiBwZXJzb25JZCA+IDApIHtcbiAgICAgICAgICAgIG9wID0gdGVhY2hlclJlcG9zaXRvcnkuZmluZEJ5SWQocGVyc29uSWQpOyAgIC8v5p+l6K+i6I635b6X5a6e5L2T5a+56LGhXG4gICAgICAgICAgICBpZihvcC5pc1ByZXNlbnQoKSkge1xuICAgICAgICAgICAgICAgIHMgPSBvcC5nZXQoKTtcbiAgICAgICAgICAgICAgICBPcHRpb25hbDxVc2VyPiB1T3AgPSB1c2VyUmVwb3NpdG9yeS5maW5kQnlJZChwZXJzb25JZCk7IC8v5p+l6K+i5a+55bqU6K+l5pWZ5biI55qE6LSm5oi3XG4gICAgICAgICAgICAgICAgLy/liKDpmaTlr7nlupTor6XmlZnluIjnmoTotKbmiLdcbiAgICAgICAgICAgICAgICB1T3AuaWZQcmVzZW50KHVzZXJSZXBvc2l0b3J5OjpkZWxldGUpO1xuICAgICAgICAgICAgICAgIFBlcnNvbiBwID0gcy5nZXRQZXJzb24oKTtcbiAgICAgICAgICAgICAgICB0ZWFjaGVyUmVwb3NpdG9yeS5kZWxldGUocyk7ICAgIC8v6aaW5YWI5pWw5o2u5bqT5rC45LmF5Yig6Zmk5pWZ5biI5L+h5oGvXG4gICAgICAgICAgICAgICAgcGVyc29uUmVwb3NpdG9yeS5kZWxldGUocCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIENvbW1vbk1ldGhvZC5nZXRSZXR1cm5NZXNzYWdlT0soKTsgIC8v6YCa55+l5YmN56uv5pON5L2c5q2j5bi4XG4gICAgfVxuICAgIHB1YmxpYyBEYXRhUmVzcG9uc2UgZ2V0VGVhY2hlckluZm8oRGF0YVJlcXVlc3QgZGF0YVJlcXVlc3QpIHtcbiAgICAgICAgSW50ZWdlciBwZXJzb25JZCA9IGRhdGFSZXF1ZXN0LmdldEludGVnZXIoXCJwZXJzb25JZFwiKTtcbiAgICAgICAgVGVhY2hlciBzID0gbnVsbDtcbiAgICAgICAgT3B0aW9uYWw8VGVhY2hlcj4gb3A7XG4gICAgICAgIGlmIChwZXJzb25JZCAhPSBudWxsKSB7XG4gICAgICAgICAgICBvcCA9IHRlYWNoZXJSZXBvc2l0b3J5LmZpbmRCeUlkKHBlcnNvbklkKTsgLy/moLnmja7lrabnlJ/kuLvplK7ku47mlbDmja7lupPmn6Xor6LlrabnlJ/nmoTkv6Hmga9cbiAgICAgICAgICAgIGlmIChvcC5pc1ByZXNlbnQoKSkge1xuICAgICAgICAgICAgICAgIHMgPSBvcC5nZXQoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gQ29tbW9uTWV0aG9kLmdldFJldHVybkRhdGEoZ2V0TWFwRnJvbVRlYWNoZXIocykpOyAvL+i/memHjOWbnuS8oOWMheWQq+WtpueUn+S/oeaBr+eahE1hcOWvueixoVxuICAgIH1cblxuICAgIHB1YmxpYyBEYXRhUmVzcG9uc2UgdGVhY2hlckVkaXRTYXZlKERhdGFSZXF1ZXN0IGRhdGFSZXF1ZXN0KSB7XG4gICAgICAgIEludGVnZXIgcGVyc29uSWQgPSBkYXRhUmVxdWVzdC5nZXRJbnRlZ2VyKFwicGVyc29uSWRcIik7XG4gICAgICAgIE1hcDxTdHJpbmcsT2JqZWN0PiBmb3JtID0gZGF0YVJlcXVlc3QuZ2V0TWFwKFwiZm9ybVwiKTsgLy/lj4LmlbDojrflj5ZNYXDlr7nosaFcbiAgICAgICAgU3RyaW5nIG51bSA9IENvbW1vbk1ldGhvZC5nZXRTdHJpbmcoZm9ybSwgXCJudW1cIik7ICAvL01hcCDojrflj5blsZ7mgKfnmoTlgLxcbiAgICAgICAgVGVhY2hlciBzID0gbnVsbDtcbiAgICAgICAgUGVyc29uIHA7XG4gICAgICAgIFVzZXIgdTtcbiAgICAgICAgT3B0aW9uYWw8VGVhY2hlcj4gb3A7XG4gICAgICAgIGJvb2xlYW4gaXNOZXcgPSBmYWxzZTtcbiAgICAgICAgaWYgKHBlcnNvbklkICE9IG51bGwpIHtcbiAgICAgICAgICAgIG9wID0gdGVhY2hlclJlcG9zaXRvcnkuZmluZEJ5SWQocGVyc29uSWQpOyAgLy/mn6Xor6Llr7nlupTmlbDmja7lupPkuK3kuLvplK7kuLppZOeahOWAvOeahOWunuS9k+WvueixoVxuICAgICAgICAgICAgaWYgKG9wLmlzUHJlc2VudCgpKSB7XG4gICAgICAgICAgICAgICAgcyA9IG9wLmdldCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIE9wdGlvbmFsPFBlcnNvbj4gbk9wID0gcGVyc29uUmVwb3NpdG9yeS5maW5kQnlOdW0obnVtKTsgLy/mn6Xor6LmmK/lkKblrZjlnKhudW3nmoTkurrlkZhcbiAgICAgICAgaWYgKG5PcC5pc1ByZXNlbnQoKSkge1xuICAgICAgICAgICAgaWYgKHMgPT0gbnVsbCB8fCAhcy5nZXRQZXJzb24oKS5nZXROdW0oKS5lcXVhbHMobnVtKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBDb21tb25NZXRob2QuZ2V0UmV0dXJuTWVzc2FnZUVycm9yKFwi5paw5a2m5Y+35bey57uP5a2Y5Zyo77yM5LiN6IO95re75Yqg5oiW5L+u5pS577yBXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmIChzID09IG51bGwpIHtcbiAgICAgICAgICAgIHAgPSBuZXcgUGVyc29uKCk7XG4gICAgICAgICAgICBwLnNldE51bShudW0pO1xuICAgICAgICAgICAgcC5zZXRUeXBlKFwiMVwiKTtcbiAgICAgICAgICAgIHBlcnNvblJlcG9zaXRvcnkuc2F2ZUFuZEZsdXNoKHApOyAgLy/mj5LlhaXmlrDnmoRQZXJzb27orrDlvZVcbiAgICAgICAgICAgIHBlcnNvbklkID0gcC5nZXRQZXJzb25JZCgpO1xuICAgICAgICAgICAgU3RyaW5nIHBhc3N3b3JkID0gZW5jb2Rlci5lbmNvZGUoXCIxMjM0NTZcIik7XG4gICAgICAgICAgICB1ID0gbmV3IFVzZXIoKTtcbiAgICAgICAgICAgIHUuc2V0UGVyc29uSWQocGVyc29uSWQpO1xuICAgICAgICAgICAgdS5zZXRVc2VyTmFtZShudW0pO1xuICAgICAgICAgICAgdS5zZXRQYXNzd29yZChwYXNzd29yZCk7XG4gICAgICAgICAgICB1LnNldFVzZXJUeXBlKHVzZXJUeXBlUmVwb3NpdG9yeS5maW5kQnlOYW1lKEVVc2VyVHlwZS5ST0xFX1NUVURFTlQpKTtcbiAgICAgICAgICAgIHUuc2V0Q3JlYXRlVGltZShEYXRlVGltZVRvb2wucGFyc2VEYXRlVGltZShuZXcgRGF0ZSgpKSk7XG4gICAgICAgICAgICB1LnNldENyZWF0b3JJZChDb21tb25NZXRob2QuZ2V0UGVyc29uSWQoKSk7XG4gICAgICAgICAgICB1c2VyUmVwb3NpdG9yeS5zYXZlQW5kRmx1c2godSk7IC8v5o+S5YWl5paw55qEVXNlcuiusOW9lVxuICAgICAgICAgICAgcyA9IG5ldyBUZWFjaGVyKCk7ICAgLy8g5Yib5bu65a6e5L2T5a+56LGhXG4gICAgICAgICAgICBzLnNldFBlcnNvbklkKHBlcnNvbklkKTtcbiAgICAgICAgICAgIHRlYWNoZXJSZXBvc2l0b3J5LnNhdmVBbmRGbHVzaChzKTsgIC8v5o+S5YWl5paw55qEU3R1ZGVudOiusOW9lVxuICAgICAgICAgICAgaXNOZXcgPSB0cnVlO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcCA9IHMuZ2V0UGVyc29uKCk7XG4gICAgICAgIH1cbi4uLlxuICAgIHB1YmxpYyBSZXNwb25zZUVudGl0eTxTdHJlYW1pbmdSZXNwb25zZUJvZHk+IGdldFRlYWNoZXJMaXN0RXhjbChEYXRhUmVxdWVzdCBkYXRhUmVxdWVzdCkge1xuICAgICAgICBTdHJpbmcgbnVtTmFtZSA9IGRhdGFSZXF1ZXN0LmdldFN0cmluZyhcIm51bU5hbWVcIik7XG4gICAgICAgIExpc3Q8TWFwPFN0cmluZyxPYmplY3Q+PiBsaXN0ID0gZ2V0VGVhY2hlck1hcExpc3QobnVtTmFtZSk7IC8vIOWBh+iuvuW3suaUueS4uuiOt+WPluaVmeW4iOaVsOaNrueahOaWueazlVxuXG4gICAgICAgIC8vIOiwg+aVtOWIl+WuvemFjee9ru+8iOagueaNruaVmeW4iOS/oeaBr+eJueeCueiwg+aVtO+8iVxuICAgICAgICBJbnRlZ2VyW10gd2lkdGhzID0gezgsIDE1LCAxMCwgMjAsIDE1LCAxMCwgOCwgMjUsIDE1LCAzMH07XG4gICAgICAgIFN0cmluZ1tdIHRpdGxlcyA9IHtcIuW6j+WPt1wiLCBcIuW3peWPt1wiLCBcIuWnk+WQjVwiLCBcIuWtpumZolwiLCBcIuiBjOensFwiLCBcIuWtpuS9jVwiLCBcIuaAp+WIq1wiLCBcIumCrueusVwiLCBcIueUteivnVwiLCBcIuWcsOWdgFwifTtcbiAgICAgICAgU3RyaW5nIG91dFB1dFNoZWV0TmFtZSA9IFwidGVhY2hlci54bHN4XCI7XG5cbiAgICAgICAgWFNTRldvcmtib29rIHdiID0gbmV3IFhTU0ZXb3JrYm9vaygpO1xuICAgICAgICBYU1NGU2hlZXQgc2hlZXQgPSB3Yi5jcmVhdGVTaGVldChvdXRQdXRTaGVldE5hbWUpO1xuXG4gICAgICAgIC8vIOiuvue9ruWIl+WuvVxuICAgICAgICBmb3IoaW50IGogPSAwOyBqIDwgd2lkdGhzLmxlbmd0aDsgaisrKSB7XG4gICAgICAgICAgICBzaGVldC5zZXRDb2x1bW5XaWR0aChqLCB3aWR0aHNbal0gKiAyNTYpO1xuICAgICAgICB9XG4uLi5cbiAgICBwdWJsaWMgRGF0YVJlc3BvbnNlIGdldFRlYWNoZXJQYWdlRGF0YShEYXRhUmVxdWVzdCBkYXRhUmVxdWVzdCkge1xuICAgICAgICBTdHJpbmcgbnVtTmFtZSA9IGRhdGFSZXF1ZXN0LmdldFN0cmluZyhcIm51bU5hbWVcIik7XG4gICAgICAgIEludGVnZXIgY1BhZ2UgPSBkYXRhUmVxdWVzdC5nZXRDdXJyZW50UGFnZSgpO1xuICAgICAgICBpbnQgZGF0YVRvdGFsID0gMDtcbiAgICAgICAgaW50IHNpemUgPSA0MDtcbiAgICAgICAgTGlzdDxNYXA8U3RyaW5nLE9iamVjdD4+IGRhdGFMaXN0ID0gbmV3IEFycmF5TGlzdDw+KCk7XG4gICAgICAgIFBhZ2U8VGVhY2hlcj4gcGFnZSA9IG51bGw7XG4gICAgICAgIFBhZ2VhYmxlIHBhZ2VhYmxlID0gUGFnZVJlcXVlc3Qub2YoY1BhZ2UsIHNpemUpO1xuICAgICAgICBwYWdlID0gdGVhY2hlclJlcG9zaXRvcnkuZmluZFRlYWNoZXJMaXN0QnlOdW1OYW1lKG51bU5hbWUsIHBhZ2VhYmxlKTtcbiAgICAgICAgTWFwPFN0cmluZyxPYmplY3Q+IG07XG4gICAgICAgIGlmIChwYWdlICE9IG51bGwpIHtcbiAgICAgICAgICAgIGRhdGFUb3RhbCA9IChpbnQpIHBhZ2UuZ2V0VG90YWxFbGVtZW50cygpO1xuICAgICAgICAgICAgTGlzdDxUZWFjaGVyPiBsaXN0ID0gcGFnZS5nZXRDb250ZW50KCk7XG4gICAgICAgICAgICBpZiAoIWxpc3QuaXNFbXB0eSgpKSB7XG4gICAgICAgICAgICAgICAgZm9yIChUZWFjaGVyIHRlYWNoZXIgOiBsaXN0KSB7XG4gICAgICAgICAgICAgICAgICAgIG0gPSBnZXRNYXBGcm9tVGVhY2hlcih0ZWFjaGVyKTtcbiAgICAgICAgICAgICAgICAgICAgZGF0YUxpc3QuYWRkKG0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuLi4uXG4gICAgcHVibGljIERhdGFSZXNwb25zZSBnZXRGYW1pbHlNZW1iZXJMaXN0KERhdGFSZXF1ZXN0IGRhdGFSZXF1ZXN0KSB7XG4gICAgICAgIEludGVnZXIgcGVyc29uSWQgPSBkYXRhUmVxdWVzdC5nZXRJbnRlZ2VyKFwicGVyc29uSWRcIik7XG4gICAgICAgIExpc3Q8RmFtaWx5TWVtYmVyPiBmTGlzdCA9IGZhbWlseU1lbWJlclJlcG9zaXRvcnkuZmluZEJ5VGVhY2hlclBlcnNvbklkKHBlcnNvbklkKTtcbiAgICAgICAgTGlzdDxNYXA8U3RyaW5nLE9iamVjdD4+IGRhdGFMaXN0ID0gbmV3IEFycmF5TGlzdDw+KCk7XG4gICAgICAgIE1hcDxTdHJpbmcsT2JqZWN0PiBtO1xuICAgICAgICBpZiAoZkxpc3QgIT0gbnVsbCkge1xuICAgICAgICAgICAgZm9yIChGYW1pbHlNZW1iZXIgZiA6IGZMaXN0KSB7XG4gICAgICAgICAgICAgICAgbSA9IG5ldyBIYXNoTWFwPD4oKTtcbiAgICAgICAgICAgICAgICBtLnB1dChcIm1lbWJlcklkXCIsIGYuZ2V0TWVtYmVySWQoKSk7XG4gICAgICAgICAgICAgICAgbS5wdXQoXCJwZXJzb25JZFwiLCBmLmdldFRlYWNoZXIoKS5nZXRQZXJzb25JZCgpKTtcbiAgICAgICAgICAgICAgICBtLnB1dChcInJlbGF0aW9uXCIsIGYuZ2V0UmVsYXRpb24oKSk7XG4gICAgICAgICAgICAgICAgbS5wdXQoXCJuYW1lXCIsIGYuZ2V0TmFtZSgpKTtcbiAgICAgICAgICAgICAgICBtLnB1dChcImdlbmRlclwiLCBmLmdldEdlbmRlcigpKTtcbiAgICAgICAgICAgICAgICBtLnB1dChcImFnZVwiLCBmLmdldEFnZSgpK1wiXCIpO1xuICAgICAgICAgICAgICAgIG0ucHV0KFwidW5pdFwiLCBmLmdldFVuaXQoKSk7XG4gICAgICAgICAgICAgICAgZGF0YUxpc3QuYWRkKG0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBDb21tb25NZXRob2QuZ2V0UmV0dXJuRGF0YShkYXRhTGlzdCk7XG4gICAgfVxuICAgIHB1YmxpYyBEYXRhUmVzcG9uc2UgZmFtaWx5TWVtYmVyU2F2ZShEYXRhUmVxdWVzdCBkYXRhUmVxdWVzdCkge1xuICAgICAgICBNYXA8U3RyaW5nLE9iamVjdD4gZm9ybSA9IGRhdGFSZXF1ZXN0LmdldE1hcChcImZvcm1cIik7XG4gICAgICAgIEludGVnZXIgcGVyc29uSWQgPSBDb21tb25NZXRob2QuZ2V0SW50ZWdlcihmb3JtLFwicGVyc29uSWRcIik7XG4gICAgICAgIEludGVnZXIgbWVtYmVySWQgPSBDb21tb25NZXRob2QuZ2V0SW50ZWdlcihmb3JtLFwibWVtYmVySWRcIik7XG4gICAgICAgIE9wdGlvbmFsPEZhbWlseU1lbWJlcj4gb3A7XG4gICAgICAgIEZhbWlseU1lbWJlciBmID0gbnVsbDtcbiAgICAgICAgaWYobWVtYmVySWQgIT0gbnVsbCkge1xuICAgICAgICAgICAgb3AgPSBmYW1pbHlNZW1iZXJSZXBvc2l0b3J5LmZpbmRCeUlkKG1lbWJlcklkKTtcbiAgICAgICAgICAgIGlmKG9wLmlzUHJlc2VudCgpKSB7XG4gICAgICAgICAgICAgICAgZiA9IG9wLmdldCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmKGY9PSBudWxsKSB7XG4gICAgICAgICAgICBmID0gbmV3IEZhbWlseU1lbWJlcigpO1xuICAgICAgICAgICAgYXNzZXJ0IHBlcnNvbklkICE9IG51bGw7XG4gICAgICAgICAgICBmLnNldFN0dWRlbnQodGVhY2hlclJlcG9zaXRvcnkuZmluZEJ5SWQocGVyc29uSWQpLmdldCgpKTtcbiAgICAgICAgfVxuICAgICAgICBmLnNldFJlbGF0aW9uKENvbW1vbk1ldGhvZC5nZXRTdHJpbmcoZm9ybSxcInJlbGF0aW9uXCIpKTtcbiAgICAgICAgZi5zZXROYW1lKENvbW1vbk1ldGhvZC5nZXRTdHJpbmcoZm9ybSxcIm5hbWVcIikpO1xuICAgICAgICBmLnNldEdlbmRlcihDb21tb25NZXRob2QuZ2V0U3RyaW5nKGZvcm0sXCJnZW5kZXJcIikpO1xuICAgICAgICBmLnNldEFnZShDb21tb25NZXRob2QuZ2V0SW50ZWdlcihmb3JtLFwiYWdlXCIpKTtcbiAgICAgICAgZi5zZXRVbml0KENvbW1vbk1ldGhvZC5nZXRTdHJpbmcoZm9ybSxcInVuaXRcIikpO1xuICAgICAgICBmYW1pbHlNZW1iZXJSZXBvc2l0b3J5LnNhdmUoZik7XG4gICAgICAgIHJldHVybiBDb21tb25NZXRob2QuZ2V0UmV0dXJuTWVzc2FnZU9LKCk7XG4gICAgfVxufVxuXG4uLi5cblBhdGg6IHNyYy9tYWluL2phdmEvY24vZWR1L3NkdS9qYXZhL3NlcnZlci9zZXJ2aWNlcy9TdHVkZW50U2VydmljZS5qYXZhXG4uLi5cblxuXG5cbiAgICAvKlxuICAgICAgICBGYW1pbHlNZW1iZXJcbiAgICAgKi9cbiAgICBwdWJsaWMgRGF0YVJlc3BvbnNlIGdldEZhbWlseU1lbWJlckxpc3QoRGF0YVJlcXVlc3QgZGF0YVJlcXVlc3QpIHtcbiAgICAgICAgSW50ZWdlciBwZXJzb25JZCA9IGRhdGFSZXF1ZXN0LmdldEludGVnZXIoXCJwZXJzb25JZFwiKTtcbiAgICAgICAgTGlzdDxGYW1pbHlNZW1iZXI+IGZMaXN0ID0gZmFtaWx5TWVtYmVyUmVwb3NpdG9yeS5maW5kQnlTdHVkZW50UGVyc29uSWQocGVyc29uSWQpO1xuICAgICAgICBMaXN0PE1hcDxTdHJpbmcsT2JqZWN0Pj4gZGF0YUxpc3QgPSBuZXcgQXJyYXlMaXN0PD4oKTtcbiAgICAgICAgTWFwPFN0cmluZyxPYmplY3Q+IG07XG4gICAgICAgIGlmIChmTGlzdCAhPSBudWxsKSB7XG4gICAgICAgICAgICBmb3IgKEZhbWlseU1lbWJlciBmIDogZkxpc3QpIHtcbiAgICAgICAgICAgICAgICBtID0gbmV3IEhhc2hNYXA8PigpO1xuICAgICAgICAgICAgICAgIG0ucHV0KFwibWVtYmVySWRcIiwgZi5nZXRNZW1iZXJJZCgpKTtcbiAgICAgICAgICAgICAgICBtLnB1dChcInBlcnNvbklkXCIsIGYuZ2V0U3R1ZGVudCgpLmdldFBlcnNvbklkKCkpO1xuICAgICAgICAgICAgICAgIG0ucHV0KFwicmVsYXRpb25cIiwgZi5nZXRSZWxhdGlvbigpKTtcbiAgICAgICAgICAgICAgICBtLnB1dChcIm5hbWVcIiwgZi5nZXROYW1lKCkpO1xuICAgICAgICAgICAgICAgIG0ucHV0KFwiZ2VuZGVyXCIsIGYuZ2V0R2VuZGVyKCkpO1xuICAgICAgICAgICAgICAgIG0ucHV0KFwiYWdlXCIsIGYuZ2V0QWdlKCkrXCJcIik7XG4gICAgICAgICAgICAgICAgbS5wdXQoXCJ1bml0XCIsIGYuZ2V0VW5pdCgpKTtcbiAgICAgICAgICAgICAgICBkYXRhTGlzdC5hZGQobSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIENvbW1vbk1ldGhvZC5nZXRSZXR1cm5EYXRhKGRhdGFMaXN0KTtcbiAgICB9XG5cbiAgICBwdWJsaWMgRGF0YVJlc3BvbnNlIGZhbWlseU1lbWJlclNhdmUoRGF0YVJlcXVlc3QgZGF0YVJlcXVlc3QpIHtcbiAgICAgICAgTWFwPFN0cmluZyxPYmplY3Q+IGZvcm0gPSBkYXRhUmVxdWVzdC5nZXRNYXAoXCJmb3JtXCIpO1xuICAgICAgICBJbnRlZ2VyIHBlcnNvbklkID0gQ29tbW9uTWV0aG9kLmdldEludGVnZXIoZm9ybSxcInBlcnNvbklkXCIpO1xuICAgICAgICBJbnRlZ2VyIG1lbWJlcklkID0gQ29tbW9uTWV0aG9kLmdldEludGVnZXIoZm9ybSxcIm1lbWJlcklkXCIpO1xuICAgICAgICBPcHRpb25hbDxGYW1pbHlNZW1iZXI+IG9wO1xuICAgICAgICBGYW1pbHlNZW1iZXIgZiA9IG51bGw7XG4gICAgICAgIGlmKG1lbWJlcklkICE9IG51bGwpIHtcbiAgICAgICAgICAgIG9wID0gZmFtaWx5TWVtYmVyUmVwb3NpdG9yeS5maW5kQnlJZChtZW1iZXJJZCk7XG4gICAgICAgICAgICBpZihvcC5pc1ByZXNlbnQoKSkge1xuICAgICAgICAgICAgICAgIGYgPSBvcC5nZXQoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZihmPT0gbnVsbCkge1xuICAgICAgICAgICAgZiA9IG5ldyBGYW1pbHlNZW1iZXIoKTtcbiAgICAgICAgICAgIGFzc2VydCBwZXJzb25JZCAhPSBudWxsO1xuICAgICAgICAgICAgZi5zZXRTdHVkZW50KHN0dWRlbnRSZXBvc2l0b3J5LmZpbmRCeUlkKHBlcnNvbklkKS5nZXQoKSk7XG4gICAgICAgIH1cbiAgICAgICAgZi5zZXRSZWxhdGlvbihDb21tb25NZXRob2QuZ2V0U3RyaW5nKGZvcm0sXCJyZWxhdGlvblwiKSk7XG4gICAgICAgIGYuc2V0TmFtZShDb21tb25NZXRob2QuZ2V0U3RyaW5nKGZvcm0sXCJuYW1lXCIpKTtcbiAgICAgICAgZi5zZXRHZW5kZXIoQ29tbW9uTWV0aG9kLmdldFN0cmluZyhmb3JtLFwiZ2VuZGVyXCIpKTtcbiAgICAgICAgZi5zZXRBZ2UoQ29tbW9uTWV0aG9kLmdldEludGVnZXIoZm9ybSxcImFnZVwiKSk7XG4gICAgICAgIGYuc2V0VW5pdChDb21tb25NZXRob2QuZ2V0U3RyaW5nKGZvcm0sXCJ1bml0XCIpKTtcbiAgICAgICAgZmFtaWx5TWVtYmVyUmVwb3NpdG9yeS5zYXZlKGYpO1xuICAgICAgICByZXR1cm4gQ29tbW9uTWV0aG9kLmdldFJldHVybk1lc3NhZ2VPSygpO1xuICAgIH1cblxuICAgIHB1YmxpYyBEYXRhUmVzcG9uc2UgZmFtaWx5TWVtYmVyRGVsZXRlKERhdGFSZXF1ZXN0IGRhdGFSZXF1ZXN0KSB7XG4gICAgICAgIEludGVnZXIgbWVtYmVySWQgPSBkYXRhUmVxdWVzdC5nZXRJbnRlZ2VyKFwibWVtYmVySWRcIik7XG4gICAgICAgIE9wdGlvbmFsPEZhbWlseU1lbWJlcj4gb3A7XG4gICAgICAgIG9wID0gZmFtaWx5TWVtYmVyUmVwb3NpdG9yeS5maW5kQnlJZChtZW1iZXJJZCk7XG4gICAgICAgIG9wLmlmUHJlc2VudChmYW1pbHlNZW1iZXJSZXBvc2l0b3J5OjpkZWxldGUpO1xuICAgICAgICByZXR1cm4gQ29tbW9uTWV0aG9kLmdldFJldHVybk1lc3NhZ2VPSygpO1xuICAgIH1cbi4uLlxuUGF0aDogamF2YS1zZXJ2ZXIvc3JjL21haW4vamF2YS9jbi9lZHUvc2R1L2phdmEvc2VydmVyL3NlcnZpY2VzL1RlYWNoZXJTZXJ2aWNlcy5qYXZhXG4uLi5cbmltcG9ydCBvcmcuc3ByaW5nZnJhbWV3b3JrLnN0ZXJlb3R5cGUuU2VydmljZTtcbmltcG9ydCBvcmcuc3ByaW5nZnJhbWV3b3JrLndlYi5zZXJ2bGV0Lm12Yy5tZXRob2QuYW5ub3RhdGlvbi5TdHJlYW1pbmdSZXNwb25zZUJvZHk7XG5cbmltcG9ydCBqYXZhLnV0aWwuKjtcblxuQFNlcnZpY2VcbnB1YmxpYyBjbGFzcyBUZWFjaGVyU2VydmljZXMge1xuICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIExvZ2dlciBsb2cgPSBMb2dnZXJGYWN0b3J5LmdldExvZ2dlcihUZWFjaGVyU2VydmljZXMuY2xhc3MpO1xuICAgIHByaXZhdGUgZmluYWwgUGVyc29uUmVwb3NpdG9yeSBwZXJzb25SZXBvc2l0b3J5OyAgLy/kurrlkZjmlbDmja7mk43kvZzoh6rliqjms6jlhaVcbiAgICBwcml2YXRlIGZpbmFsIFRlYWNoZXJSZXBvc2l0b3J5IHRlYWNoZXJSZXBvc2l0b3J5OyAgLy/mlZnluIjmlbDmja7mk43kvZzoh6rliqjms6jlhaVcbiAgICBwcml2YXRlIGZpbmFsIFVzZXJSZXBvc2l0b3J5IHVzZXJSZXBvc2l0b3J5OyAgLy/mlbDmja7mk43kvZzoh6rliqjms6jlhaVcbiAgICBwcml2YXRlIGZpbmFsIFVzZXJUeXBlUmVwb3NpdG9yeSB1c2VyVHlwZVJlcG9zaXRvcnk7IC8v55So5oi357G75Z6L5pWw5o2u5pON5L2c6Ieq5Yqo5rOo5YWlXG4gICAgcHJpdmF0ZSBmaW5hbCBQYXNzd29yZEVuY29kZXIgZW5jb2RlcjsgIC8v5a+G56CB5pyN5Yqh6Ieq5Yqo5rOo5YWlXG4gICAgLy/mtojotLnmlbDmja7mk43kvZzoh6rliqjms6jlhaVcbiAgICBwcml2YXRlIGZpbmFsIEZhbWlseU1lbWJlclJlcG9zaXRvcnkgZmFtaWx5TWVtYmVyUmVwb3NpdG9yeTtcbiAgICBwcml2YXRlIGZpbmFsIFN5c3RlbVNlcnZpY2Ugc3lzdGVtU2VydmljZTtcbi4uLlxuXG4gICAgcHVibGljIE1hcDxTdHJpbmcsIE9iamVjdD4gZ2V0TWFwRnJvbVRlYWNoZXIoVGVhY2hlciBzKSB7XG4gICAgICAgIE1hcDxTdHJpbmcsIE9iamVjdD4gbSA9IG5ldyBIYXNoTWFwPD4oKTtcbiAgICAgICAgUGVyc29uIHA7XG4gICAgICAgIGlmIChzID09IG51bGwpXG4gICAgICAgICAgICByZXR1cm4gbTtcbiAgICAgICAgbS5wdXQoXCJ0aXRsZVwiLCBzLmdldFRpdGxlKCkpO1xuICAgICAgICBtLnB1dChcImRlZ3JlZVwiLCBzLmdldERlZ3JlZSgpKTtcbiAgICAgICAgbS5wdXQoXCJjbGFzc05hbWVcIiwgcy5nZXRDbGFzc05hbWUoKSk7XG4gICAgICAgIHAgPSBzLmdldFBlcnNvbigpO1xuICAgICAgICBpZiAocCA9PSBudWxsKVxuICAgICAgICAgICAgcmV0dXJuIG07XG4gICAgICAgIG0ucHV0KFwicGVyc29uSWRcIiwgcy5nZXRQZXJzb25JZCgpKTtcbiAgICAgICAgbS5wdXQoXCJudW1cIiwgcC5nZXROdW0oKSk7XG4gICAgICAgIG0ucHV0KFwibmFtZVwiLCBwLmdldE5hbWUoKSk7XG4gICAgICAgIG0ucHV0KFwiZGVwdFwiLCBwLmdldERlcHQoKSk7XG4gICAgICAgIG0ucHV0KFwiY2FyZFwiLCBwLmdldENhcmQoKSk7XG4gICAgICAgIFN0cmluZyBnZW5kZXIgPSBwLmdldEdlbmRlcigpO1xuICAgICAgICBtLnB1dChcImdlbmRlclwiLCBnZW5kZXIpO1xuICAgICAgICBtLnB1dChcImdlbmRlck5hbWVcIiwgQ29tRGF0YVV0aWwuZ2V0SW5zdGFuY2UoKS5nZXREaWN0aW9uYXJ5TGFiZWxCeVZhbHVlKFwiWEJNXCIsIGdlbmRlcikpOyAvL+aAp+WIq+exu+Wei+eahOWAvOi9rOaNouaIkOaVsOaNruexu+Wei+WQjVxuICAgICAgICBtLnB1dChcImJpcnRoZGF5XCIsIHAuZ2V0QmlydGhkYXkoKSk7ICAvL+aXtumXtOagvOW8j+i9rOaNouWtl+espuS4slxuICAgICAgICBtLnB1dChcImVtYWlsXCIsIHAuZ2V0RW1haWwoKSk7XG4gICAgICAgIG0ucHV0KFwicGhvbmVcIiwgcC5nZXRQaG9uZSgpKTtcbiAgICAgICAgbS5wdXQoXCJhZGRyZXNzXCIsIHAuZ2V0QWRkcmVzcygpKTtcbiAgICAgICAgbS5wdXQoXCJpbnRyb2R1Y2VcIiwgcC5nZXRJbnRyb2R1Y2UoKSk7XG4gICAgICAgIHJldHVybiBtO1xuICAgIH1cblxuICAgIHB1YmxpYyBMaXN0PE1hcDxTdHJpbmcsIE9iamVjdD4+IGdldFRlYWNoZXJNYXBMaXN0KFN0cmluZyBudW1OYW1lKSB7XG4gICAgICAgIExpc3Q8TWFwPFN0cmluZywgT2JqZWN0Pj4gZGF0YUxpc3QgPSBuZXcgQXJyYXlMaXN0PD4oKTtcbiAgICAgICAgTGlzdDxUZWFjaGVyPiBzTGlzdCA9IHRlYWNoZXJSZXBvc2l0b3J5LmZpbmRUZWFjaGVyTGlzdEJ5TnVtTmFtZShudW1OYW1lKTsgIC8v5pWw5o2u5bqT5p+l6K+i5pON5L2cXG4gICAgICAgIGlmIChzTGlzdCA9PSBudWxsIHx8IHNMaXN0LmlzRW1wdHkoKSlcbiAgICAgICAgICAgIHJldHVybiBkYXRhTGlzdDtcbiAgICAgICAgZm9yIChUZWFjaGVyIHRlYWNoZXIgOiBzTGlzdCkge1xuICAgICAgICAgICAgZGF0YUxpc3QuYWRkKGdldE1hcEZyb21UZWFjaGVyKHRlYWNoZXIpKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZGF0YUxpc3Q7XG4gICAgfVxuXG4gICAgcHVibGljIERhdGFSZXNwb25zZSBnZXRUZWFjaGVyTGlzdChEYXRhUmVxdWVzdCBkYXRhUmVxdWVzdCkge1xuICAgICAgICBTdHJpbmcgbnVtTmFtZSA9IGRhdGFSZXF1ZXN0LmdldFN0cmluZyhcIm51bU5hbWVcIik7XG4gICAgICAgIExpc3Q8TWFwPFN0cmluZywgT2JqZWN0Pj4gZGF0YUxpc3QgPSBnZXRUZWFjaGVyTWFwTGlzdChudW1OYW1lKTtcbiAgICAgICAgcmV0dXJuIENvbW1vbk1ldGhvZC5nZXRSZXR1cm5EYXRhKGRhdGFMaXN0KTsgIC8v5oyJ54Wn5rWL6K+V5qGG5p626KeE6IyD5Lya6YCBTWFw55qEbGlzdFxuICAgIH1cblxuICAgIHB1YmxpYyBEYXRhUmVzcG9uc2UgdGVhY2hlckRlbGV0ZShEYXRhUmVxdWVzdCBkYXRhUmVxdWVzdCkge1xuICAgICAgICBJbnRlZ2VyIHBlcnNvbklkID0gZGF0YVJlcXVlc3QuZ2V0SW50ZWdlcihcInBlcnNvbklkXCIpOyAgLy/ojrflj5Z0ZWFjaGVyX2lk5YC8XG4gICAgICAgIFRlYWNoZXIgcyA9IG51bGw7XG4gICAgICAgIE9wdGlvbmFsPFRlYWNoZXI+IG9wO1xuICAgICAgICBpZiAocGVyc29uSWQgIT0gbnVsbCAmJiBwZXJzb25JZCA+IDApIHtcbiAgICAgICAgICAgIG9wID0gdGVhY2hlclJlcG9zaXRvcnkuZmluZEJ5SWQocGVyc29uSWQpOyAgIC8v5p+l6K+i6I635b6X5a6e5L2T5a+56LGhXG4gICAgICAgICAgICBpZiAob3AuaXNQcmVzZW50KCkpIHtcbiAgICAgICAgICAgICAgICBzID0gb3AuZ2V0KCk7XG4gICAgICAgICAgICAgICAgT3B0aW9uYWw8VXNlcj4gdU9wID0gdXNlclJlcG9zaXRvcnkuZmluZEJ5SWQocGVyc29uSWQpOyAvL+afpeivouWvueW6lOivpeaVmeW4iOeahOi0puaIt1xuICAgICAgICAgICAgICAgIC8v5Yig6Zmk5a+55bqU6K+l5pWZ5biI55qE6LSm5oi3XG4gICAgICAgICAgICAgICAgdU9wLmlmUHJlc2VudCh1c2VyUmVwb3NpdG9yeTo6ZGVsZXRlKTtcbiAgICAgICAgICAgICAgICBQZXJzb24gcCA9IHMuZ2V0UGVyc29uKCk7XG4gICAgICAgICAgICAgICAgdGVhY2hlclJlcG9zaXRvcnkuZGVsZXRlKHMpOyAgICAvL+mmluWFiOaVsOaNruW6k+awuOS5heWIoOmZpOaVmeW4iOS/oeaBr1xuICAgICAgICAgICAgICAgIHBlcnNvblJlcG9zaXRvcnkuZGVsZXRlKHApO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBDb21tb25NZXRob2QuZ2V0UmV0dXJuTWVzc2FnZU9LKCk7ICAvL+mAmuefpeWJjeerr+aTjeS9nOato+W4uFxuICAgIH1cblxuICAgIHB1YmxpYyBEYXRhUmVzcG9uc2UgZ2V0VGVhY2hlckluZm8oRGF0YVJlcXVlc3QgZGF0YVJlcXVlc3QpIHtcbiAgICAgICAgSW50ZWdlciBwZXJzb25JZCA9IGRhdGFSZXF1ZXN0LmdldEludGVnZXIoXCJwZXJzb25JZFwiKTtcbiAgICAgICAgVGVhY2hlciBzID0gbnVsbDtcbiAgICAgICAgT3B0aW9uYWw8VGVhY2hlcj4gb3A7XG4gICAgICAgIGlmIChwZXJzb25JZCAhPSBudWxsKSB7XG4gICAgICAgICAgICBvcCA9IHRlYWNoZXJSZXBvc2l0b3J5LmZpbmRCeUlkKHBlcnNvbklkKTsgLy/moLnmja7lrabnlJ/kuLvplK7ku47mlbDmja7lupPmn6Xor6LlrabnlJ/nmoTkv6Hmga9cbiAgICAgICAgICAgIGlmIChvcC5pc1ByZXNlbnQoKSkge1xuICAgICAgICAgICAgICAgIHMgPSBvcC5nZXQoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gQ29tbW9uTWV0aG9kLmdldFJldHVybkRhdGEoZ2V0TWFwRnJvbVRlYWNoZXIocykpOyAvL+i/memHjOWbnuS8oOWMheWQq+WtpueUn+S/oeaBr+eahE1hcOWvueixoVxuICAgIH1cblxuICAgIHB1YmxpYyBEYXRhUmVzcG9uc2UgdGVhY2hlckVkaXRTYXZlKERhdGFSZXF1ZXN0IGRhdGFSZXF1ZXN0KSB7XG4gICAgICAgIEludGVnZXIgcGVyc29uSWQgPSBkYXRhUmVxdWVzdC5nZXRJbnRlZ2VyKFwicGVyc29uSWRcIik7XG4gICAgICAgIE1hcDxTdHJpbmcsIE9iamVjdD4gZm9ybSA9IGRhdGFSZXF1ZXN0LmdldE1hcChcImZvcm1cIik7IC8v5Y+C5pWw6I635Y+WTWFw5a+56LGhXG4gICAgICAgIFN0cmluZyBudW0gPSBDb21tb25NZXRob2QuZ2V0U3RyaW5nKGZvcm0sIFwibnVtXCIpOyAgLy9NYXAg6I635Y+W5bGe5oCn55qE5YC8XG4gICAgICAgIFRlYWNoZXIgcyA9IG51bGw7XG4gICAgICAgIFBlcnNvbiBwO1xuICAgICAgICBVc2VyIHU7XG4gICAgICAgIE9wdGlvbmFsPFRlYWNoZXI+IG9wO1xuICAgICAgICBib29sZWFuIGlzTmV3ID0gZmFsc2U7XG4gICAgICAgIGlmIChwZXJzb25JZCAhPSBudWxsKSB7XG4gICAgICAgICAgICBvcCA9IHRlYWNoZXJSZXBvc2l0b3J5LmZpbmRCeUlkKHBlcnNvbklkKTsgIC8v5p+l6K+i5a+55bqU5pWw5o2u5bqT5Lit5Li76ZSu5Li6aWTnmoTlgLznmoTlrp7kvZPlr7nosaFcbiAgICAgICAgICAgIGlmIChvcC5pc1ByZXNlbnQoKSkge1xuICAgICAgICAgICAgICAgIHMgPSBvcC5nZXQoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBPcHRpb25hbDxQZXJzb24+IG5PcCA9IHBlcnNvblJlcG9zaXRvcnkuZmluZEJ5TnVtKG51bSk7IC8v5p+l6K+i5piv5ZCm5a2Y5ZyobnVt55qE5Lq65ZGYXG4gICAgICAgIGlmIChuT3AuaXNQcmVzZW50KCkpIHtcbiAgICAgICAgICAgIGlmIChzID09IG51bGwgfHwgIXMuZ2V0UGVyc29uKCkuZ2V0TnVtKCkuZXF1YWxzKG51bSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gQ29tbW9uTWV0aG9kLmdldFJldHVybk1lc3NhZ2VFcnJvcihcIuaWsOW3peWPt+W3sue7j+WtmOWcqO+8jOS4jeiDvea3u+WKoOaIluS/ruaUue+8gVwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAocyA9PSBudWxsKSB7XG4gICAgICAgICAgICBwID0gbmV3IFBlcnNvbigpO1xuICAgICAgICAgICAgcC5zZXROdW0obnVtKTtcbiAgICAgICAgICAgIHAuc2V0VHlwZShcIjJcIik7ICAvLyAy6KGo56S65pWZ5biI57G75Z6LXG4gICAgICAgICAgICBwZXJzb25SZXBvc2l0b3J5LnNhdmVBbmRGbHVzaChwKTsgIC8v5o+S5YWl5paw55qEUGVyc29u6K6w5b2VXG4gICAgICAgICAgICBwZXJzb25JZCA9IHAuZ2V0UGVyc29uSWQoKTtcbiAgICAgICAgICAgIFN0cmluZyBwYXNzd29yZCA9IGVuY29kZXIuZW5jb2RlKFwiMTIzNDU2XCIpO1xuICAgICAgICAgICAgdSA9IG5ldyBVc2VyKCk7XG4gICAgICAgICAgICB1LnNldFBlcnNvbklkKHBlcnNvbklkKTtcbiAgICAgICAgICAgIHUuc2V0VXNlck5hbWUobnVtKTtcbiAgICAgICAgICAgIHUuc2V0UGFzc3dvcmQocGFzc3dvcmQpO1xuICAgICAgICAgICAgdS5zZXRVc2VyVHlwZSh1c2VyVHlwZVJlcG9zaXRvcnkuZmluZEJ5TmFtZShFVXNlclR5cGUuUk9MRV9URUFDSEVSKSk7ICAvLyDorr7nva7kuLrmlZnluIjop5LoibJcbiAgICAgICAgICAgIHUuc2V0Q3JlYXRlVGltZShEYXRlVGltZVRvb2wucGFyc2VEYXRlVGltZShuZXcgRGF0ZSgpKSk7XG4gICAgICAgICAgICB1LnNldENyZWF0b3JJZChDb21tb25NZXRob2QuZ2V0UGVyc29uSWQoKSk7XG4gICAgICAgICAgICB1c2VyUmVwb3NpdG9yeS5zYXZlQW5kRmx1c2godSk7IC8v5o+S5YWl5paw55qEVXNlcuiusOW9lVxuICAgICAgICAgICAgcyA9IG5ldyBUZWFjaGVyKCk7ICAgLy8g5Yib5bu65a6e5L2T5a+56LGhXG4gICAgICAgICAgICBzLnNldFBlcnNvbklkKHBlcnNvbklkKTtcbiAgICAgICAgICAgIHRlYWNoZXJSZXBvc2l0b3J5LnNhdmVBbmRGbHVzaChzKTsgIC8v5o+S5YWl5paw55qEVGVhY2hlcuiusOW9lVxuICAgICAgICAgICAgaXNOZXcgPSB0cnVlO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcCA9IHMuZ2V0UGVyc29uKCk7XG4gICAgICAgIH1cbi4uLlxuXG4gICAgcHVibGljIFJlc3BvbnNlRW50aXR5PFN0cmVhbWluZ1Jlc3BvbnNlQm9keT4gZ2V0VGVhY2hlckxpc3RFeGNsKERhdGFSZXF1ZXN0IGRhdGFSZXF1ZXN0KSB7XG4gICAgICAgIFN0cmluZyBudW1OYW1lID0gZGF0YVJlcXVlc3QuZ2V0U3RyaW5nKFwibnVtTmFtZVwiKTtcbiAgICAgICAgTGlzdDxNYXA8U3RyaW5nLCBPYmplY3Q+PiBsaXN0ID0gZ2V0VGVhY2hlck1hcExpc3QobnVtTmFtZSk7XG5cbiAgICAgICAgLy8g6LCD5pW05YiX5a696YWN572uXG4gICAgICAgIEludGVnZXJbXSB3aWR0aHMgPSB7OCwgMTUsIDEwLCAyMCwgMTUsIDEwLCA4LCAyNSwgMTUsIDMwfTtcbiAgICAgICAgU3RyaW5nW10gdGl0bGVzID0ge1wi5bqP5Y+3XCIsIFwi5bel5Y+3XCIsIFwi5aeT5ZCNXCIsIFwi5a2m6ZmiXCIsIFwi6IGM56ewXCIsIFwi5a2m5L2NXCIsIFwi5oCn5YirXCIsIFwi6YKu566xXCIsIFwi55S16K+dXCIsIFwi5Zyw5Z2AXCJ9O1xuICAgICAgICBTdHJpbmcgb3V0UHV0U2hlZXROYW1lID0gXCJ0ZWFjaGVyLnhsc3hcIjtcblxuICAgICAgICBYU1NGV29ya2Jvb2sgd2IgPSBuZXcgWFNTRldvcmtib29rKCk7XG4gICAgICAgIFhTU0ZTaGVldCBzaGVldCA9IHdiLmNyZWF0ZVNoZWV0KG91dFB1dFNoZWV0TmFtZSk7XG5cbiAgICAgICAgLy8g6K6+572u5YiX5a69XG4gICAgICAgIGZvciAoaW50IGogPSAwOyBqIDwgd2lkdGhzLmxlbmd0aDsgaisrKSB7XG4gICAgICAgICAgICBzaGVldC5zZXRDb2x1bW5XaWR0aChqLCB3aWR0aHNbal0gKiAyNTYpO1xuICAgICAgICB9XG4uLi5cblxuICAgIHB1YmxpYyBEYXRhUmVzcG9uc2UgZ2V0VGVhY2hlclBhZ2VEYXRhKERhdGFSZXF1ZXN0IGRhdGFSZXF1ZXN0KSB7XG4gICAgICAgIFN0cmluZyBudW1OYW1lID0gZGF0YVJlcXVlc3QuZ2V0U3RyaW5nKFwibnVtTmFtZVwiKTtcbiAgICAgICAgSW50ZWdlciBjUGFnZSA9IGRhdGFSZXF1ZXN0LmdldEN1cnJlbnRQYWdlKCk7XG4gICAgICAgIGludCBkYXRhVG90YWwgPSAwO1xuICAgICAgICBpbnQgc2l6ZSA9IDQwO1xuICAgICAgICBMaXN0PE1hcDxTdHJpbmcsIE9iamVjdD4+IGRhdGFMaXN0ID0gbmV3IEFycmF5TGlzdDw+KCk7XG4gICAgICAgIFBhZ2U8VGVhY2hlcj4gcGFnZSA9IG51bGw7XG4gICAgICAgIFBhZ2VhYmxlIHBhZ2VhYmxlID0gUGFnZVJlcXVlc3Qub2YoY1BhZ2UsIHNpemUpO1xuICAgICAgICBwYWdlID0gdGVhY2hlclJlcG9zaXRvcnkuZmluZFRlYWNoZXJMaXN0QnlOdW1OYW1lKG51bU5hbWUsIHBhZ2VhYmxlKTtcbiAgICAgICAgTWFwPFN0cmluZywgT2JqZWN0PiBtO1xuICAgICAgICBpZiAocGFnZSAhPSBudWxsKSB7XG4gICAgICAgICAgICBkYXRhVG90YWwgPSAoaW50KSBwYWdlLmdldFRvdGFsRWxlbWVudHMoKTtcbiAgICAgICAgICAgIExpc3Q8VGVhY2hlcj4gbGlzdCA9IHBhZ2UuZ2V0Q29udGVudCgpO1xuICAgICAgICAgICAgaWYgKCFsaXN0LmlzRW1wdHkoKSkge1xuICAgICAgICAgICAgICAgIGZvciAoVGVhY2hlciB0ZWFjaGVyIDogbGlzdCkge1xuICAgICAgICAgICAgICAgICAgICBtID0gZ2V0TWFwRnJvbVRlYWNoZXIodGVhY2hlcik7XG4gICAgICAgICAgICAgICAgICAgIGRhdGFMaXN0LmFkZChtKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbi4uLlxuUGF0aDogamF2YS1zZXJ2ZXIvc3JjL21haW4vamF2YS9jbi9lZHUvc2R1L2phdmEvc2VydmVyL2NvbnRyb2xsZXJzL1N0dWRlbnRDb250cm9sbGVyLmphdmFcbi4uLlxuXG4gICAgLypcbiAgICAgICAgRmFtaWx5TWVtYmVyXG4gICAgICovXG4gICAgQFBvc3RNYXBwaW5nKFwiL2dldEZhbWlseU1lbWJlckxpc3RcIilcbiAgICBAUHJlQXV0aG9yaXplKFwiIGhhc1JvbGUoJ0FETUlOJykgb3IgIGhhc1JvbGUoJ1NUVURFTlQnKVwiKVxuICAgIHB1YmxpYyBEYXRhUmVzcG9uc2UgZ2V0RmFtaWx5TWVtYmVyTGlzdChAVmFsaWQgQFJlcXVlc3RCb2R5IERhdGFSZXF1ZXN0IGRhdGFSZXF1ZXN0KSB7XG4gICAgICAgIHJldHVybiBzdHVkZW50U2VydmljZS5nZXRGYW1pbHlNZW1iZXJMaXN0KGRhdGFSZXF1ZXN0KTtcbiAgICB9XG5cbiAgICBAUG9zdE1hcHBpbmcoXCIvZmFtaWx5TWVtYmVyU2F2ZVwiKVxuICAgIEBQcmVBdXRob3JpemUoXCIgaGFzUm9sZSgnQURNSU4nKSBvciAgaGFzUm9sZSgnU1RVREVOVCcpXCIpXG4gICAgcHVibGljIERhdGFSZXNwb25zZSBmYW1pbHlNZW1iZXJTYXZlKEBWYWxpZCBAUmVxdWVzdEJvZHkgRGF0YVJlcXVlc3QgZGF0YVJlcXVlc3QpIHtcbiAgICAgICAgcmV0dXJuIHN0dWRlbnRTZXJ2aWNlLmZhbWlseU1lbWJlclNhdmUoZGF0YVJlcXVlc3QpO1xuICAgIH1cblxuICAgIEBQb3N0TWFwcGluZyhcIi9mYW1pbHlNZW1iZXJEZWxldGVcIilcbiAgICBAUHJlQXV0aG9yaXplKFwiIGhhc1JvbGUoJ0FETUlOJykgb3IgIGhhc1JvbGUoJ1NUVURFTlQnKVwiKVxuICAgIHB1YmxpYyBEYXRhUmVzcG9uc2UgZmFtaWx5TWVtYmVyRGVsZXRlKEBWYWxpZCBAUmVxdWVzdEJvZHkgRGF0YVJlcXVlc3QgZGF0YVJlcXVlc3QpIHtcbiAgICAgICAgcmV0dXJuIHN0dWRlbnRTZXJ2aWNlLmZhbWlseU1lbWJlckRlbGV0ZShkYXRhUmVxdWVzdCk7XG4gICAgfVxuLi4uXG5QYXRoOiBqYXZhLXNlcnZlci9zcmMvbWFpbi9qYXZhL2NuL2VkdS9zZHUvamF2YS9zZXJ2ZXIvbW9kZWxzL0ZhbWlseU1lbWJlci5qYXZhXG5wYWNrYWdlIGNuLmVkdS5zZHUuamF2YS5zZXJ2ZXIubW9kZWxzO1xuXG5pbXBvcnQgamFrYXJ0YS5wZXJzaXN0ZW5jZS4qO1xuaW1wb3J0IGpha2FydGEudmFsaWRhdGlvbi5jb25zdHJhaW50cy5TaXplO1xuaW1wb3J0IGxvbWJvay5HZXR0ZXI7XG5pbXBvcnQgbG9tYm9rLlNldHRlcjtcbkBHZXR0ZXJcbkBTZXR0ZXJcbkBFbnRpdHlcbkBUYWJsZShcdG5hbWUgPSBcImZhbWlseV9tZW1iZXJcIixcbiAgICAgICAgdW5pcXVlQ29uc3RyYWludHMgPSB7XG4gICAgICAgIH0pXG5wdWJsaWMgY2xhc3MgRmFtaWx5TWVtYmVyIHtcbiAgICBASWRcbiAgICBAR2VuZXJhdGVkVmFsdWUoc3RyYXRlZ3kgPSBHZW5lcmF0aW9uVHlwZS5JREVOVElUWSlcbiAgICBwcml2YXRlIEludGVnZXIgbWVtYmVySWQ7XG5cbiAgICBATWFueVRvT25lXG4gICAgQC4uLiIsImlzX2Vycm9yIjpmYWxzZSwicmVxdWVzdF9pZCI6IiIsInRvb2xfdXNlX2lkIjoidG9vbHVfdnJ0eF8wMTFTb21uQkU1VFFiTFBaaWVBSGhKRzkifX0seyJpZCI6MiwidHlwZSI6NCwiaWRlX3N0YXRlX25vZGUiOnsid29ya3NwYWNlRm9sZGVycyI6W3sicmVwb3NpdG9yeVJvb3QiOiJDOi9Vc2Vycy9wcmluY2lwL0RvY3VtZW50cy9HaXRIdWIvYmFpY2FpL2phdmEtc2VydmVyIiwiZm9sZGVyUm9vdCI6IkM6L1VzZXJzL3ByaW5jaXAvRG9jdW1lbnRzL0dpdEh1Yi9iYWljYWkvamF2YS1zZXJ2ZXIifV0sIndvcmtzcGFjZUZvbGRlcnNVbmNoYW5nZWQiOmZhbHNlfX1dLCJ0aW1lc3RhbXAiOiIyMDI1LTA1LTE2VDE1OjA1OjQ3Ljc5OVoiLCJyZXNwb25zZV90ZXh0Ijoi6K6p5oiR5p+l55yL5LiA5LiLIGBUZWFjaGVyU2VydmljZXMuamF2YWAg5Lit55qEIGBmYW1pbHlNZW1iZXJTYXZlYCDmlrnms5XnmoTlrozmlbTlrp7njrDvvJpcbiIsIndvcmtzcGFjZV9maWxlX2NodW5rcyI6W119LHsic3RhdHVzIjoic3VjY2VzcyIsInJlcXVlc3RfaWQiOiI4ZWQ2ZmQ5Yy01NGU0LTQzNzYtODFjOS0wNWU5ZWI4NmQ1OTAiLCJyZXF1ZXN0X21lc3NhZ2UiOiIiLCJzdHJ1Y3R1cmVkX291dHB1dF9ub2RlcyI6W3siaWQiOjAsInR5cGUiOjAsImNvbnRlbnQiOiLnjrDlnKjmiJHlt7Lnu4/mib7liLDkuobpl67popjmiYDlnKjjgILmoLnmja7miJHnmoTliIbmnpDvvIzplJnor6/lh7rnjrDlnKggYFRlYWNoZXJTZXJ2aWNlcy5qYXZhYCDmlofku7bkuK3nmoQgYGZhbWlseU1lbWJlclNhdmVgIOaWueazleOAglxuXG7pl67popjnmoTmoLnmupDmmK/vvJpcblxuMS4g5ZyoIGBUZWFjaGVyU2VydmljZXMuamF2YWAg5Lit55qEIGBmYW1pbHlNZW1iZXJTYXZlYCDmlrnms5XkuK3vvIzmnInku6XkuIvku6PnoIHvvJpcbmBgYGphdmFcbmlmKGY9PSBudWxsKSB7XG4gICAgZiA9IG5ldyBGYW1pbHlNZW1iZXIoKTtcbiAgICBhc3NlcnQgcGVyc29uSWQgIT0gbnVsbDtcbiAgICBmLnNldFN0dWRlbnQodGVhY2hlclJlcG9zaXRvcnkuZmluZEJ5SWQocGVyc29uSWQpLmdldCgpKTtcbn1cbmBgYFxuXG4yLiDov5nph4znmoTpl67popjmmK/vvIzlroPlsJ3or5XlsIYgYFRlYWNoZXJgIOWvueixoeiuvue9ruWIsCBgRmFtaWx5TWVtYmVyYCDnmoQgYHN0dWRlbnRgIOWxnuaAp+S4re+8jOS9hiBgRmFtaWx5TWVtYmVyYCDnsbvnmoQgYHN0dWRlbnRgIOWxnuaAp+acn+acm+eahOaYryBgU3R1ZGVudGAg57G75Z6L77yM6ICM5LiN5pivIGBUZWFjaGVyYCDnsbvlnovjgIJcblxuMy4g5ZyoIGBDb21tb25NZXRob2QuZ2V0SW50ZWdlcmAg5pa55rOV5Lit77yM5b2T5LuO6KGo5Y2V6I635Y+WIFwiYWdlXCIg5YC85pe277yM5aaC5p6c5YmN56uv5Lyg6YCS55qE5pivIERvdWJsZSDnsbvlnovnmoTlgLzvvIzmlrnms5XkvJrlsJ3or5XlsIblhbbovazmjaLkuLogSW50ZWdlcu+8mlxuYGBgamF2YVxucHVibGljIHN0YXRpYyBJbnRlZ2VyIGdldEludGVnZXIoTWFwPFN0cmluZyxPYmplY3Q+IGRhdGEsU3RyaW5nIGtleSkge1xuICAgIE9iamVjdCBvYmogPSBkYXRhLmdldChrZXkpO1xuICAgIGlmKG9iaiA9PSBudWxsKVxuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICBpZihvYmogaW5zdGFuY2VvZiBJbnRlZ2VyKVxuICAgICAgICByZXR1cm4gKEludGVnZXIpb2JqO1xuICAgIFN0cmluZyBzdHIgPSBvYmoudG9TdHJpbmcoKTtcbiAgICB0cnkge1xuICAgICAgICByZXR1cm4gKGludClEb3VibGUucGFyc2VEb3VibGUoc3RyKTtcbiAgICB9Y2F0Y2goRXhjZXB0aW9uIGUpIHtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxufVxuYGBgXG5cbjQuIOW9k+aJp+ihjCBgZi5zZXRBZ2UoQ29tbW9uTWV0aG9kLmdldEludGVnZXIoZm9ybSxcImFnZVwiKSk7YCDml7bvvIzlpoLmnpwgXCJhZ2VcIiDnmoTlgLzmmK8gRG91YmxlIOexu+Wei++8jOS8muWwneivleWwhuWFtui9rOaNouS4uiBJbnRlZ2Vy77yM6L+Z5bCx5piv6ZSZ6K+v5raI5oGv5Lit5o+Q5Yiw55qEIFwiY2xhc3MgamF2YS5sYW5nLkRvdWJsZSBjYW5ub3QgYmUgY2FzdCB0byBjbGFzcyBqYXZhLmxhbmcuSW50ZWdlclwiIOeahOWOn+WboOOAglxuXG7op6PlhrPmlrnmoYjmmK/kv67mlLkgYFRlYWNoZXJTZXJ2aWNlcy5qYXZhYCDkuK3nmoQgYGZhbWlseU1lbWJlclNhdmVgIOaWueazle+8jOehruS/neato+ehruWkhOeQhiBUZWFjaGVyIOWSjCBGYW1pbHlNZW1iZXIg5LmL6Ze055qE5YWz57O777yM5bm256Gu5L+dIGFnZSDlgLznmoTnsbvlnovovazmjaLmraPnoa7jgIJcblxu5oiR55qE5YiG5p6Q57uT6K6677yaXG5cbuWcqCBgVGVhY2hlclNlcnZpY2VzLmphdmFgIOS4re+8jGBmYW1pbHlNZW1iZXJTYXZlYCDmlrnms5XlrZjlnKjkuKTkuKrkuLvopoHpl67popjvvJpcblxuMS4g5a6D5bCd6K+V5bCGIGBUZWFjaGVyYCDlr7nosaHorr7nva7liLAgYEZhbWlseU1lbWJlcmAg55qEIGBzdHVkZW50YCDlsZ7mgKfkuK3vvIzov5nmmK/nsbvlnovkuI3ljLnphY3nmoTjgIJcbjIuIOWcqOWkhOeQhiBcImFnZVwiIOWAvOaXtu+8jOWmguaenOWJjeerr+S8oOmAkueahOaYryBEb3VibGUg57G75Z6L77yM5Lya5a+86Ie057G75Z6L6L2s5o2i6ZSZ6K+v44CCXG5cbui/meWwseaYr+aCqOeci+WIsOeahOmUmeivr+a2iOaBryBcImNsYXNzIGphdmEubGFuZy5Eb3VibGUgY2Fubm90IGJlIGNhc3QgdG8gY2xhc3MgamF2YS5sYW5nLkludGVnZXJcIiDnmoTljp/lm6DjgIJcbiJ9LHsiaWQiOjIsInR5cGUiOjIsImNvbnRlbnQiOiIifSx7ImlkIjozLCJ0eXBlIjozLCJjb250ZW50IjoiIn1dLCJzZWVuX3N0YXRlIjoic2VlbiIsInN0cnVjdHVyZWRfcmVxdWVzdF9ub2RlcyI6W3siaWQiOjEsInR5cGUiOjEsInRvb2xfcmVzdWx0X25vZGUiOnsiY29udGVudCI6IlRoZSBmb2xsb3dpbmcgY29kZSBzZWN0aW9ucyB3ZXJlIHJldHJpZXZlZDpcblBhdGg6IHNyYy9tYWluL2phdmEvY24vZWR1L3NkdS9qYXZhL3NlcnZlci9zZXJ2aWNlcy9UZWFjaGVyU2VydmljZXMuamF2YVxuLi4uXG4gICAgcHVibGljIERhdGFSZXNwb25zZSB0ZWFjaGVyRGVsZXRlKERhdGFSZXF1ZXN0IGRhdGFSZXF1ZXN0KSB7XG4gICAgICAgIEludGVnZXIgcGVyc29uSWQgPSBkYXRhUmVxdWVzdC5nZXRJbnRlZ2VyKFwicGVyc29uSWRcIik7ICAvL+iOt+WPlnRlYWNoZXJfaWTlgLxcbiAgICAgICAgVGVhY2hlciBzID0gbnVsbDtcbiAgICAgICAgT3B0aW9uYWw8VGVhY2hlcj4gb3A7XG4gICAgICAgIGlmIChwZXJzb25JZCAhPSBudWxsICYmIHBlcnNvbklkID4gMCkge1xuICAgICAgICAgICAgb3AgPSB0ZWFjaGVyUmVwb3NpdG9yeS5maW5kQnlJZChwZXJzb25JZCk7ICAgLy/mn6Xor6Lojrflvpflrp7kvZPlr7nosaFcbiAgICAgICAgICAgIGlmKG9wLmlzUHJlc2VudCgpKSB7XG4gICAgICAgICAgICAgICAgcyA9IG9wLmdldCgpO1xuICAgICAgICAgICAgICAgIE9wdGlvbmFsPFVzZXI+IHVPcCA9IHVzZXJSZXBvc2l0b3J5LmZpbmRCeUlkKHBlcnNvbklkKTsgLy/mn6Xor6Llr7nlupTor6XmlZnluIjnmoTotKbmiLdcbiAgICAgICAgICAgICAgICAvL+WIoOmZpOWvueW6lOivpeaVmeW4iOeahOi0puaIt1xuICAgICAgICAgICAgICAgIHVPcC5pZlByZXNlbnQodXNlclJlcG9zaXRvcnk6OmRlbGV0ZSk7XG4gICAgICAgICAgICAgICAgUGVyc29uIHAgPSBzLmdldFBlcnNvbigpO1xuICAgICAgICAgICAgICAgIHRlYWNoZXJSZXBvc2l0b3J5LmRlbGV0ZShzKTsgICAgLy/pppblhYjmlbDmja7lupPmsLjkuYXliKDpmaTmlZnluIjkv6Hmga9cbiAgICAgICAgICAgICAgICBwZXJzb25SZXBvc2l0b3J5LmRlbGV0ZShwKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gQ29tbW9uTWV0aG9kLmdldFJldHVybk1lc3NhZ2VPSygpOyAgLy/pgJrnn6XliY3nq6/mk43kvZzmraPluLhcbiAgICB9XG4gICAgcHVibGljIERhdGFSZXNwb25zZSBnZXRUZWFjaGVySW5mbyhEYXRhUmVxdWVzdCBkYXRhUmVxdWVzdCkge1xuICAgICAgICBJbnRlZ2VyIHBlcnNvbklkID0gZGF0YVJlcXVlc3QuZ2V0SW50ZWdlcihcInBlcnNvbklkXCIpO1xuICAgICAgICBUZWFjaGVyIHMgPSBudWxsO1xuICAgICAgICBPcHRpb25hbDxUZWFjaGVyPiBvcDtcbiAgICAgICAgaWYgKHBlcnNvbklkICE9IG51bGwpIHtcbiAgICAgICAgICAgIG9wID0gdGVhY2hlclJlcG9zaXRvcnkuZmluZEJ5SWQocGVyc29uSWQpOyAvL+agueaNruWtpueUn+S4u+mUruS7juaVsOaNruW6k+afpeivouWtpueUn+eahOS/oeaBr1xuICAgICAgICAgICAgaWYgKG9wLmlzUHJlc2VudCgpKSB7XG4gICAgICAgICAgICAgICAgcyA9IG9wLmdldCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBDb21tb25NZXRob2QuZ2V0UmV0dXJuRGF0YShnZXRNYXBGcm9tVGVhY2hlcihzKSk7IC8v6L+Z6YeM5Zue5Lyg5YyF5ZCr5a2m55Sf5L+h5oGv55qETWFw5a+56LGhXG4gICAgfVxuXG4gICAgcHVibGljIERhdGFSZXNwb25zZSB0ZWFjaGVyRWRpdFNhdmUoRGF0YVJlcXVlc3QgZGF0YVJlcXVlc3QpIHtcbiAgICAgICAgSW50ZWdlciBwZXJzb25JZCA9IGRhdGFSZXF1ZXN0LmdldEludGVnZXIoXCJwZXJzb25JZFwiKTtcbiAgICAgICAgTWFwPFN0cmluZyxPYmplY3Q+IGZvcm0gPSBkYXRhUmVxdWVzdC5nZXRNYXAoXCJmb3JtXCIpOyAvL+WPguaVsOiOt+WPlk1hcOWvueixoVxuICAgICAgICBTdHJpbmcgbnVtID0gQ29tbW9uTWV0aG9kLmdldFN0cmluZyhmb3JtLCBcIm51bVwiKTsgIC8vTWFwIOiOt+WPluWxnuaAp+eahOWAvFxuICAgICAgICBUZWFjaGVyIHMgPSBudWxsO1xuICAgICAgICBQZXJzb24gcDtcbiAgICAgICAgVXNlciB1O1xuICAgICAgICBPcHRpb25hbDxUZWFjaGVyPiBvcDtcbiAgICAgICAgYm9vbGVhbiBpc05ldyA9IGZhbHNlO1xuICAgICAgICBpZiAocGVyc29uSWQgIT0gbnVsbCkge1xuICAgICAgICAgICAgb3AgPSB0ZWFjaGVyUmVwb3NpdG9yeS5maW5kQnlJZChwZXJzb25JZCk7ICAvL+afpeivouWvueW6lOaVsOaNruW6k+S4reS4u+mUruS4umlk55qE5YC855qE5a6e5L2T5a+56LGhXG4gICAgICAgICAgICBpZiAob3AuaXNQcmVzZW50KCkpIHtcbiAgICAgICAgICAgICAgICBzID0gb3AuZ2V0KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgT3B0aW9uYWw8UGVyc29uPiBuT3AgPSBwZXJzb25SZXBvc2l0b3J5LmZpbmRCeU51bShudW0pOyAvL+afpeivouaYr+WQpuWtmOWcqG51beeahOS6uuWRmFxuICAgICAgICBpZiAobk9wLmlzUHJlc2VudCgpKSB7XG4gICAgICAgICAgICBpZiAocyA9PSBudWxsIHx8ICFzLmdldFBlcnNvbigpLmdldE51bSgpLmVxdWFscyhudW0pKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIENvbW1vbk1ldGhvZC5nZXRSZXR1cm5NZXNzYWdlRXJyb3IoXCLmlrDlrablj7flt7Lnu4/lrZjlnKjvvIzkuI3og73mt7vliqDmiJbkv67mlLnvvIFcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHMgPT0gbnVsbCkge1xuICAgICAgICAgICAgcCA9IG5ldyBQZXJzb24oKTtcbiAgICAgICAgICAgIHAuc2V0TnVtKG51bSk7XG4gICAgICAgICAgICBwLnNldFR5cGUoXCIxXCIpO1xuICAgICAgICAgICAgcGVyc29uUmVwb3NpdG9yeS5zYXZlQW5kRmx1c2gocCk7ICAvL+aPkuWFpeaWsOeahFBlcnNvbuiusOW9lVxuICAgICAgICAgICAgcGVyc29uSWQgPSBwLmdldFBlcnNvbklkKCk7XG4gICAgICAgICAgICBTdHJpbmcgcGFzc3dvcmQgPSBlbmNvZGVyLmVuY29kZShcIjEyMzQ1NlwiKTtcbiAgICAgICAgICAgIHUgPSBuZXcgVXNlcigpO1xuICAgICAgICAgICAgdS5zZXRQZXJzb25JZChwZXJzb25JZCk7XG4gICAgICAgICAgICB1LnNldFVzZXJOYW1lKG51bSk7XG4gICAgICAgICAgICB1LnNldFBhc3N3b3JkKHBhc3N3b3JkKTtcbiAgICAgICAgICAgIHUuc2V0VXNlclR5cGUodXNlclR5cGVSZXBvc2l0b3J5LmZpbmRCeU5hbWUoRVVzZXJUeXBlLlJPTEVfU1RVREVOVCkpO1xuICAgICAgICAgICAgdS5zZXRDcmVhdGVUaW1lKERhdGVUaW1lVG9vbC5wYXJzZURhdGVUaW1lKG5ldyBEYXRlKCkpKTtcbiAgICAgICAgICAgIHUuc2V0Q3JlYXRvcklkKENvbW1vbk1ldGhvZC5nZXRQZXJzb25JZCgpKTtcbiAgICAgICAgICAgIHVzZXJSZXBvc2l0b3J5LnNhdmVBbmRGbHVzaCh1KTsgLy/mj5LlhaXmlrDnmoRVc2Vy6K6w5b2VXG4gICAgICAgICAgICBzID0gbmV3IFRlYWNoZXIoKTsgICAvLyDliJvlu7rlrp7kvZPlr7nosaFcbiAgICAgICAgICAgIHMuc2V0UGVyc29uSWQocGVyc29uSWQpO1xuICAgICAgICAgICAgdGVhY2hlclJlcG9zaXRvcnkuc2F2ZUFuZEZsdXNoKHMpOyAgLy/mj5LlhaXmlrDnmoRTdHVkZW506K6w5b2VXG4gICAgICAgICAgICBpc05ldyA9IHRydWU7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBwID0gcy5nZXRQZXJzb24oKTtcbiAgICAgICAgfVxuLi4uXG4gICAgICAgIHAuc2V0TmFtZShDb21tb25NZXRob2QuZ2V0U3RyaW5nKGZvcm0sIFwibmFtZVwiKSk7XG4gICAgICAgIHAuc2V0RGVwdChDb21tb25NZXRob2QuZ2V0U3RyaW5nKGZvcm0sIFwiZGVwdFwiKSk7XG4gICAgICAgIHAuc2V0Q2FyZChDb21tb25NZXRob2QuZ2V0U3RyaW5nKGZvcm0sIFwiY2FyZFwiKSk7XG4gICAgICAgIHAuc2V0R2VuZGVyKENvbW1vbk1ldGhvZC5nZXRTdHJpbmcoZm9ybSwgXCJnZW5kZXJcIikpO1xuICAgICAgICBwLnNldEJpcnRoZGF5KENvbW1vbk1ldGhvZC5nZXRTdHJpbmcoZm9ybSwgXCJiaXJ0aGRheVwiKSk7XG4gICAgICAgIHAuc2V0RW1haWwoQ29tbW9uTWV0aG9kLmdldFN0cmluZyhmb3JtLCBcImVtYWlsXCIpKTtcbiAgICAgICAgcC5zZXRQaG9uZShDb21tb25NZXRob2QuZ2V0U3RyaW5nKGZvcm0sIFwicGhvbmVcIikpO1xuICAgICAgICBwLnNldEFkZHJlc3MoQ29tbW9uTWV0aG9kLmdldFN0cmluZyhmb3JtLCBcImFkZHJlc3NcIikpO1xuICAgICAgICBwZXJzb25SZXBvc2l0b3J5LnNhdmUocCk7ICAvLyDkv67mlLnkv53lrZjkurrlkZjkv6Hmga9cbiAgICAgICAgcy5zZXRDbGFzc05hbWUoQ29tbW9uTWV0aG9kLmdldFN0cmluZyhmb3JtLCBcImNsYXNzTmFtZVwiKSk7XG4gICAgICAgIHRlYWNoZXJSZXBvc2l0b3J5LnNhdmUocyk7ICAvL+S/ruaUueS/neWtmOWtpueUn+S/oeaBr1xuICAgICAgICBzeXN0ZW1TZXJ2aWNlLm1vZGlmeUxvZyhzLGlzTmV3KTtcbiAgICAgICAgcmV0dXJuIENvbW1vbk1ldGhvZC5nZXRSZXR1cm5EYXRhKHMuZ2V0UGVyc29uSWQoKSk7ICAvLyDlsIZwZXJzb25JZOi/lOWbnuWJjeerr1xuICAgIH1cbi4uLlxuICAgIHB1YmxpYyBEYXRhUmVzcG9uc2UgZ2V0RmFtaWx5TWVtYmVyTGlzdChEYXRhUmVxdWVzdCBkYXRhUmVxdWVzdCkge1xuICAgICAgICBJbnRlZ2VyIHBlcnNvbklkID0gZGF0YVJlcXVlc3QuZ2V0SW50ZWdlcihcInBlcnNvbklkXCIpO1xuICAgICAgICBMaXN0PEZhbWlseU1lbWJlcj4gZkxpc3QgPSBmYW1pbHlNZW1iZXJSZXBvc2l0b3J5LmZpbmRCeVRlYWNoZXJQZXJzb25JZChwZXJzb25JZCk7XG4gICAgICAgIExpc3Q8TWFwPFN0cmluZyxPYmplY3Q+PiBkYXRhTGlzdCA9IG5ldyBBcnJheUxpc3Q8PigpO1xuICAgICAgICBNYXA8U3RyaW5nLE9iamVjdD4gbTtcbiAgICAgICAgaWYgKGZMaXN0ICE9IG51bGwpIHtcbiAgICAgICAgICAgIGZvciAoRmFtaWx5TWVtYmVyIGYgOiBmTGlzdCkge1xuICAgICAgICAgICAgICAgIG0gPSBuZXcgSGFzaE1hcDw+KCk7XG4gICAgICAgICAgICAgICAgbS5wdXQoXCJtZW1iZXJJZFwiLCBmLmdldE1lbWJlcklkKCkpO1xuICAgICAgICAgICAgICAgIG0ucHV0KFwicGVyc29uSWRcIiwgZi5nZXRUZWFjaGVyKCkuZ2V0UGVyc29uSWQoKSk7XG4gICAgICAgICAgICAgICAgbS5wdXQoXCJyZWxhdGlvblwiLCBmLmdldFJlbGF0aW9uKCkpO1xuICAgICAgICAgICAgICAgIG0ucHV0KFwibmFtZVwiLCBmLmdldE5hbWUoKSk7XG4gICAgICAgICAgICAgICAgbS5wdXQoXCJnZW5kZXJcIiwgZi5nZXRHZW5kZXIoKSk7XG4gICAgICAgICAgICAgICAgbS5wdXQoXCJhZ2VcIiwgZi5nZXRBZ2UoKStcIlwiKTtcbiAgICAgICAgICAgICAgICBtLnB1dChcInVuaXRcIiwgZi5nZXRVbml0KCkpO1xuICAgICAgICAgICAgICAgIGRhdGFMaXN0LmFkZChtKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gQ29tbW9uTWV0aG9kLmdldFJldHVybkRhdGEoZGF0YUxpc3QpO1xuICAgIH1cbiAgICBwdWJsaWMgRGF0YVJlc3BvbnNlIGZhbWlseU1lbWJlclNhdmUoRGF0YVJlcXVlc3QgZGF0YVJlcXVlc3QpIHtcbiAgICAgICAgTWFwPFN0cmluZyxPYmplY3Q+IGZvcm0gPSBkYXRhUmVxdWVzdC5nZXRNYXAoXCJmb3JtXCIpO1xuICAgICAgICBJbnRlZ2VyIHBlcnNvbklkID0gQ29tbW9uTWV0aG9kLmdldEludGVnZXIoZm9ybSxcInBlcnNvbklkXCIpO1xuICAgICAgICBJbnRlZ2VyIG1lbWJlcklkID0gQ29tbW9uTWV0aG9kLmdldEludGVnZXIoZm9ybSxcIm1lbWJlcklkXCIpO1xuICAgICAgICBPcHRpb25hbDxGYW1pbHlNZW1iZXI+IG9wO1xuICAgICAgICBGYW1pbHlNZW1iZXIgZiA9IG51bGw7XG4gICAgICAgIGlmKG1lbWJlcklkICE9IG51bGwpIHtcbiAgICAgICAgICAgIG9wID0gZmFtaWx5TWVtYmVyUmVwb3NpdG9yeS5maW5kQnlJZChtZW1iZXJJZCk7XG4gICAgICAgICAgICBpZihvcC5pc1ByZXNlbnQoKSkge1xuICAgICAgICAgICAgICAgIGYgPSBvcC5nZXQoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZihmPT0gbnVsbCkge1xuICAgICAgICAgICAgZiA9IG5ldyBGYW1pbHlNZW1iZXIoKTtcbiAgICAgICAgICAgIGFzc2VydCBwZXJzb25JZCAhPSBudWxsO1xuICAgICAgICAgICAgZi5zZXRTdHVkZW50KHRlYWNoZXJSZXBvc2l0b3J5LmZpbmRCeUlkKHBlcnNvbklkKS5nZXQoKSk7XG4gICAgICAgIH1cbiAgICAgICAgZi5zZXRSZWxhdGlvbihDb21tb25NZXRob2QuZ2V0U3RyaW5nKGZvcm0sXCJyZWxhdGlvblwiKSk7XG4gICAgICAgIGYuc2V0TmFtZShDb21tb25NZXRob2QuZ2V0U3RyaW5nKGZvcm0sXCJuYW1lXCIpKTtcbiAgICAgICAgZi5zZXRHZW5kZXIoQ29tbW9uTWV0aG9kLmdldFN0cmluZyhmb3JtLFwiZ2VuZGVyXCIpKTtcbiAgICAgICAgZi5zZXRBZ2UoQ29tbW9uTWV0aG9kLmdldEludGVnZXIoZm9ybSxcImFnZVwiKSk7XG4gICAgICAgIGYuc2V0VW5pdChDb21tb25NZXRob2QuZ2V0U3RyaW5nKGZvcm0sXCJ1bml0XCIpKTtcbiAgICAgICAgZmFtaWx5TWVtYmVyUmVwb3NpdG9yeS5zYXZlKGYpO1xuICAgICAgICByZXR1cm4gQ29tbW9uTWV0aG9kLmdldFJldHVybk1lc3NhZ2VPSygpO1xuICAgIH1cbn1cblxuLi4uXG5QYXRoOiBzcmMvbWFpbi9qYXZhL2NuL2VkdS9zZHUvamF2YS9zZXJ2ZXIvc2VydmljZXMvU3R1ZGVudFNlcnZpY2UuamF2YVxuLi4uXG5cbiAgICBwdWJsaWMgRGF0YVJlc3BvbnNlIGZhbWlseU1lbWJlclNhdmUoRGF0YVJlcXVlc3QgZGF0YVJlcXVlc3QpIHtcbiAgICAgICAgTWFwPFN0cmluZyxPYmplY3Q+IGZvcm0gPSBkYXRhUmVxdWVzdC5nZXRNYXAoXCJmb3JtXCIpO1xuICAgICAgICBJbnRlZ2VyIHBlcnNvbklkID0gQ29tbW9uTWV0aG9kLmdldEludGVnZXIoZm9ybSxcInBlcnNvbklkXCIpO1xuICAgICAgICBJbnRlZ2VyIG1lbWJlcklkID0gQ29tbW9uTWV0aG9kLmdldEludGVnZXIoZm9ybSxcIm1lbWJlcklkXCIpO1xuICAgICAgICBPcHRpb25hbDxGYW1pbHlNZW1iZXI+IG9wO1xuICAgICAgICBGYW1pbHlNZW1iZXIgZiA9IG51bGw7XG4gICAgICAgIGlmKG1lbWJlcklkICE9IG51bGwpIHtcbiAgICAgICAgICAgIG9wID0gZmFtaWx5TWVtYmVyUmVwb3NpdG9yeS5maW5kQnlJZChtZW1iZXJJZCk7XG4gICAgICAgICAgICBpZihvcC5pc1ByZXNlbnQoKSkge1xuICAgICAgICAgICAgICAgIGYgPSBvcC5nZXQoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZihmPT0gbnVsbCkge1xuICAgICAgICAgICAgZiA9IG5ldyBGYW1pbHlNZW1iZXIoKTtcbiAgICAgICAgICAgIGFzc2VydCBwZXJzb25JZCAhPSBudWxsO1xuICAgICAgICAgICAgZi5zZXRTdHVkZW50KHN0dWRlbnRSZXBvc2l0b3J5LmZpbmRCeUlkKHBlcnNvbklkKS5nZXQoKSk7XG4gICAgICAgIH1cbiAgICAgICAgZi5zZXRSZWxhdGlvbihDb21tb25NZXRob2QuZ2V0U3RyaW5nKGZvcm0sXCJyZWxhdGlvblwiKSk7XG4gICAgICAgIGYuc2V0TmFtZShDb21tb25NZXRob2QuZ2V0U3RyaW5nKGZvcm0sXCJuYW1lXCIpKTtcbiAgICAgICAgZi5zZXRHZW5kZXIoQ29tbW9uTWV0aG9kLmdldFN0cmluZyhmb3JtLFwiZ2VuZGVyXCIpKTtcbiAgICAgICAgZi5zZXRBZ2UoQ29tbW9uTWV0aG9kLmdldEludGVnZXIoZm9ybSxcImFnZVwiKSk7XG4gICAgICAgIGYuc2V0VW5pdChDb21tb25NZXRob2QuZ2V0U3RyaW5nKGZvcm0sXCJ1bml0XCIpKTtcbiAgICAgICAgZmFtaWx5TWVtYmVyUmVwb3NpdG9yeS5zYXZlKGYpO1xuICAgICAgICByZXR1cm4gQ29tbW9uTWV0aG9kLmdldFJldHVybk1lc3NhZ2VPSygpO1xuICAgIH1cblxuICAgIHB1YmxpYyBEYXRhUmVzcG9uc2UgZmFtaWx5TWVtYmVyRGVsZXRlKERhdGFSZXF1ZXN0IGRhdGFSZXF1ZXN0KSB7XG4gICAgICAgIEludGVnZXIgbWVtYmVySWQgPSBkYXRhUmVxdWVzdC5nZXRJbnRlZ2VyKFwibWVtYmVySWRcIik7XG4gICAgICAgIE9wdGlvbmFsPEZhbWlseU1lbWJlcj4gb3A7XG4gICAgICAgIG9wID0gZmFtaWx5TWVtYmVyUmVwb3NpdG9yeS5maW5kQnlJZChtZW1iZXJJZCk7XG4gICAgICAgIG9wLmlmUHJlc2VudChmYW1pbHlNZW1iZXJSZXBvc2l0b3J5OjpkZWxldGUpO1xuICAgICAgICByZXR1cm4gQ29tbW9uTWV0aG9kLmdldFJldHVybk1lc3NhZ2VPSygpO1xuICAgIH1cbi4uLlxuUGF0aDogamF2YS1zZXJ2ZXIvc3JjL21haW4vamF2YS9jbi9lZHUvc2R1L2phdmEvc2VydmVyL3NlcnZpY2VzL1RlYWNoZXJTZXJ2aWNlcy5qYXZhXG5wYWNrYWdlIGNuLmVkdS5zZHUuamF2YS5zZXJ2ZXIuc2VydmljZXM7XG5cbmltcG9ydCBjbi5lZHUuc2R1LmphdmEuc2VydmVyLm1vZGVscy4qO1xuaW1wb3J0IGNuLmVkdS5zZHUuamF2YS5zZXJ2ZXIubW9kZWxzLlRlYWNoZXI7XG5pbXBvcnQgY24uZWR1LnNkdS5qYXZhLnNlcnZlci5wYXlsb2FkLnJlcXVlc3QuRGF0YVJlcXVlc3Q7XG5pbXBvcnQgY24uZWR1LnNkdS5qYXZhLnNlcnZlci5wYXlsb2FkLnJlc3BvbnNlLkRhdGFSZXNwb25zZTtcbmltcG9ydCBjbi5lZHUuc2R1LmphdmEuc2VydmVyLnJlcG9zaXRvcnlzLio7XG5pbXBvcnQgY24uZWR1LnNkdS5qYXZhLnNlcnZlci51dGlsLkNvbURhdGFVdGlsO1xuaW1wb3J0IGNuLmVkdS5zZHUuamF2YS5zZXJ2ZXIudXRpbC5Db21tb25NZXRob2Q7XG5pbXBvcnQgY24uZWR1LnNkdS5qYXZhLnNlcnZlci51dGlsLkRhdGVUaW1lVG9vbDtcbmltcG9ydCBvcmcuYXBhY2hlLnBvaS54c3NmLnVzZXJtb2RlbC4qO1xuaW1wb3J0IG9yZy5zbGY0ai5Mb2dnZXI7XG5pbXBvcnQgb3JnLnNsZjRqLkxvZ2dlckZhY3Rvcnk7XG5pbXBvcnQgb3JnLnNwcmluZ2ZyYW1ld29yay5kYXRhLmRvbWFpbi5QYWdlO1xuaW1wb3J0IG9yZy5zcHJpbmdmcmFtZXdvcmsuZGF0YS5kb21haW4uUGFnZVJlcXVlc3Q7XG5pbXBvcnQgb3JnLnNwcmluZ2ZyYW1ld29yay5kYXRhLmRvbWFpbi5QYWdlYWJsZTtcbmltcG9ydCBvcmcuc3ByaW5nZnJhbWV3b3JrLmh0dHAuUmVzcG9uc2VFbnRpdHk7XG5pbXBvcnQgb3JnLnNwcmluZ2ZyYW1ld29yay5zZWN1cml0eS5jcnlwdG8ucGFzc3dvcmQuUGFzc3dvcmRFbmNvZGVyO1xuaW1wb3J0IG9yZy5zcHJpbmdmcmFtZXdvcmsuc3RlcmVvdHlwZS5TZXJ2aWNlO1xuaW1wb3J0IG9yZy5zcHJpbmdmcmFtZXdvcmsud2ViLnNlcnZsZXQubXZjLm1ldGhvZC5hbm5vdGF0aW9uLlN0cmVhbWluZ1Jlc3BvbnNlQm9keTtcblxuaW1wb3J0IGphdmEudXRpbC4qO1xuXG5AU2VydmljZVxucHVibGljIGNsYXNzIFRlYWNoZXJTZXJ2aWNlcyB7XG4gICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgTG9nZ2VyIGxvZyA9IExvZ2dlckZhY3RvcnkuZ2V0TG9nZ2VyKFRlYWNoZXJTZXJ2aWNlcy5jbGFzcyk7XG4gICAgcHJpdmF0ZSBmaW5hbCBQZXJzb25SZXBvc2l0b3J5IHBlcnNvblJlcG9zaXRvcnk7ICAvL+S6uuWRmOaVsOaNruaTjeS9nOiHquWKqOazqOWFpVxuICAgIHByaXZhdGUgZmluYWwgVGVhY2hlclJlcG9zaXRvcnkgdGVhY2hlclJlcG9zaXRvcnk7ICAvL+aVmeW4iOaVsOaNruaTjeS9nOiHquWKqOazqOWFpVxuICAgIHByaXZhdGUgZmluYWwgVXNlclJlcG9zaXRvcnkgdXNlclJlcG9zaXRvcnk7ICAvL+aVsOaNruaTjeS9nOiHquWKqOazqOWFpVxuICAgIHByaXZhdGUgZmluYWwgVXNlclR5cGVSZXBvc2l0b3J5IHVzZXJUeXBlUmVwb3NpdG9yeTsgLy/nlKjmiLfnsbvlnovmlbDmja7mk43kvZzoh6rliqjms6jlhaVcbiAgICBwcml2YXRlIGZpbmFsIFBhc3N3b3JkRW5jb2RlciBlbmNvZGVyOyAgLy/lr4bnoIHmnI3liqHoh6rliqjms6jlhaVcbiAgICAvL+a2iOi0ueaVsOaNruaTjeS9nOiHquWKqOazqOWFpVxuICAgIHByaXZhdGUgZmluYWwgRmFtaWx5TWVtYmVyUmVwb3NpdG9yeSBmYW1pbHlNZW1iZXJSZXBvc2l0b3J5O1xuICAgIHByaXZhdGUgZmluYWwgU3lzdGVtU2VydmljZSBzeXN0ZW1TZXJ2aWNlO1xuXG4gICAgcHVibGljIFRlYWNoZXJTZXJ2aWNlcyhQZXJzb25SZXBvc2l0b3J5IHBlcnNvblJlcG9zaXRvcnksIFRlYWNoZXJSZXBvc2l0b3J5IHRlYWNoZXJSZXBvc2l0b3J5LCBVc2VyUmVwb3NpdG9yeSB1c2VyUmVwb3NpdG9yeSwgVXNlclR5cGVSZXBvc2l0b3J5IHVzZXJUeXBlUmVwb3NpdG9yeSwgUGFzc3dvcmRFbmNvZGVyIGVuY29kZXIsIEZlZVJlcG9zaXRvcnkgZmVlUmVwb3NpdG9yeSwgRmFtaWx5TWVtYmVyUmVwb3NpdG9yeSBmYW1pbHlNZW1iZXJSZXBvc2l0b3J5LCBTeXN0ZW1TZXJ2aWNlIHN5c3RlbVNlcnZpY2UpIHtcbiAgICAgICAgdGhpcy5wZXJzb25SZXBvc2l0b3J5ID0gcGVyc29uUmVwb3NpdG9yeTtcbiAgICAgICAgdGhpcy50ZWFjaGVyUmVwb3NpdG9yeSA9IHRlYWNoZXJSZXBvc2l0b3J5O1xuICAgICAgICB0aGlzLnVzZXJSZXBvc2l0b3J5ID0gdXNlclJlcG9zaXRvcnk7XG4gICAgICAgIHRoaXMudXNlclR5cGVSZXBvc2l0b3J5ID0gdXNlclR5cGVSZXBvc2l0b3J5O1xuICAgICAgICB0aGlzLmVuY29kZXIgPSBlbmNvZGVyO1xuICAgICAgICB0aGlzLmZhbWlseU1lbWJlclJlcG9zaXRvcnkgPSBmYW1pbHlNZW1iZXJSZXBvc2l0b3J5O1xuICAgICAgICB0aGlzLnN5c3RlbVNlcnZpY2UgPSBzeXN0ZW1TZXJ2aWNlO1xuICAgIH1cblxuICAgIHB1YmxpYyBNYXA8U3RyaW5nLCBPYmplY3Q+IGdldE1hcEZyb21UZWFjaGVyKFRlYWNoZXIgcykge1xuICAgICAgICBNYXA8U3RyaW5nLCBPYmplY3Q+IG0gPSBuZXcgSGFzaE1hcDw+KCk7XG4gICAgICAgIFBlcnNvbiBwO1xuICAgICAgICBpZiAocyA9PSBudWxsKVxuICAgICAgICAgICAgcmV0dXJuIG07XG4gICAgICAgIG0ucHV0KFwidGl0bGVcIiwgcy5nZXRUaXRsZSgpKTtcbiAgICAgICAgbS5wdXQoXCJkZWdyZWVcIiwgcy5nZXREZWdyZWUoKSk7XG4gICAgICAgIG0ucHV0KFwiY2xhc3NOYW1lXCIsIHMuZ2V0Q2xhc3NOYW1lKCkpO1xuICAgICAgICBwID0gcy5nZXRQZXJzb24oKTtcbiAgICAgICAgaWYgKHAgPT0gbnVsbClcbiAgICAgICAgICAgIHJldHVybiBtO1xuICAgICAgICBtLnB1dChcInBlcnNvbklkXCIsIHMuZ2V0UGVyc29uSWQoKSk7XG4gICAgICAgIG0ucHV0KFwibnVtXCIsIHAuZ2V0TnVtKCkpO1xuICAgICAgICBtLnB1dChcIm5hbWVcIiwgcC5nZXROYW1lKCkpO1xuICAgICAgICBtLnB1dChcImRlcHRcIiwgcC5nZXREZXB0KCkpO1xuICAgICAgICBtLnB1dChcImNhcmRcIiwgcC5nZXRDYXJkKCkpO1xuICAgICAgICBTdHJpbmcgZ2VuZGVyID0gcC5nZXRHZW5kZXIoKTtcbiAgICAgICAgbS5wdXQoXCJnZW5kZXJcIiwgZ2VuZGVyKTtcbiAgICAgICAgbS5wdXQoXCJnZW5kZXJOYW1lXCIsIENvbURhdGFVdGlsLmdldEluc3RhbmNlKCkuZ2V0RGljdGlvbmFyeUxhYmVsQnlWYWx1ZShcIlhCTVwiLCBnZW5kZXIpKTsgLy/mgKfliKvnsbvlnovnmoTlgLzovazmjaLmiJDmlbDmja7nsbvlnovlkI1cbiAgICAgICAgbS5wdXQoXCJiaXJ0aGRheVwiLCBwLmdldEJpcnRoZGF5KCkpOyAgLy/ml7bpl7TmoLzlvI/ovazmjaLlrZfnrKbkuLJcbiAgICAgICAgbS5wdXQoXCJlbWFpbFwiLCBwLmdldEVtYWlsKCkpO1xuICAgICAgICBtLnB1dChcInBob25lXCIsIHAuZ2V0UGhvbmUoKSk7XG4gICAgICAgIG0ucHV0KFwiYWRkcmVzc1wiLCBwLmdldEFkZHJlc3MoKSk7XG4gICAgICAgIG0ucHV0KFwiaW50cm9kdWNlXCIsIHAuZ2V0SW50cm9kdWNlKCkpO1xuICAgICAgICByZXR1cm4gbTtcbiAgICB9XG5cbiAgICBwdWJsaWMgTGlzdDxNYXA8U3RyaW5nLCBPYmplY3Q+PiBnZXRUZWFjaGVyTWFwTGlzdChTdHJpbmcgbnVtTmFtZSkge1xuICAgICAgICBMaXN0PE1hcDxTdHJpbmcsIE9iamVjdD4+IGRhdGFMaXN0ID0gbmV3IEFycmF5TGlzdDw+KCk7XG4gICAgICAgIExpc3Q8VGVhY2hlcj4gc0xpc3QgPSB0ZWFjaGVyUmVwb3NpdG9yeS5maW5kVGVhY2hlckxpc3RCeU51bU5hbWUobnVtTmFtZSk7ICAvL+aVsOaNruW6k+afpeivouaTjeS9nFxuICAgICAgICBpZiAoc0xpc3QgPT0gbnVsbCB8fCBzTGlzdC5pc0VtcHR5KCkpXG4gICAgICAgICAgICByZXR1cm4gZGF0YUxpc3Q7XG4gICAgICAgIGZvciAoVGVhY2hlciB0ZWFjaGVyIDogc0xpc3QpIHtcbiAgICAgICAgICAgIGRhdGFMaXN0LmFkZChnZXRNYXBGcm9tVGVhY2hlcih0ZWFjaGVyKSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGRhdGFMaXN0O1xuICAgIH1cblxuICAgIHB1YmxpYyBEYXRhUmVzcG9uc2UgZ2V0VGVhY2hlckxpc3QoRGF0YVJlcXVlc3QgZGF0YVJlcXVlc3QpIHtcbiAgICAgICAgU3RyaW5nIG51bU5hbWUgPSBkYXRhUmVxdWVzdC5nZXRTdHJpbmcoXCJudW1OYW1lXCIpO1xuICAgICAgICBMaXN0PE1hcDxTdHJpbmcsIE9iamVjdD4+IGRhdGFMaXN0ID0gZ2V0VGVhY2hlck1hcExpc3QobnVtTmFtZSk7XG4gICAgICAgIHJldHVybiBDb21tb25NZXRob2QuZ2V0UmV0dXJuRGF0YShkYXRhTGlzdCk7ICAvL+aMieeFp+a1i+ivleahhuaetuinhOiMg+S8mumAgU1hcOeahGxpc3RcbiAgICB9XG5cbiAgICBwdWJsaWMgRGF0YVJlc3BvbnNlIHRlYWNoZXJEZWxldGUoRGF0YVJlcXVlc3QgZGF0YVJlcXVlc3QpIHtcbiAgICAgICAgSW50ZWdlciBwZXJzb25JZCA9IGRhdGFSZXF1ZXN0LmdldEludGVnZXIoXCJwZXJzb25JZFwiKTsgIC8v6I635Y+WdGVhY2hlcl9pZOWAvFxuICAgICAgICBUZWFjaGVyIHMgPSBudWxsO1xuICAgICAgICBPcHRpb25hbDxUZWFjaGVyPiBvcDtcbiAgICAgICAgaWYgKHBlcnNvbklkICE9IG51bGwgJiYgcGVyc29uSWQgPiAwKSB7XG4gICAgICAgICAgICBvcCA9IHRlYWNoZXJSZXBvc2l0b3J5LmZpbmRCeUlkKHBlcnNvbklkKTsgICAvL+afpeivouiOt+W+l+WunuS9k+WvueixoVxuICAgICAgICAgICAgaWYgKG9wLmlzUHJlc2VudCgpKSB7XG4gICAgICAgICAgICAgICAgcyA9IG9wLmdldCgpO1xuICAgICAgICAgICAgICAgIE9wdGlvbmFsPFVzZXI+IHVPcCA9IHVzZXJSZXBvc2l0b3J5LmZpbmRCeUlkKHBlcnNvbklkKTsgLy/mn6Xor6Llr7nlupTor6XmlZnluIjnmoTotKbmiLdcbiAgICAgICAgICAgICAgICAvL+WIoOmZpOWvueW6lOivpeaVmeW4iOeahOi0puaIt1xuICAgICAgICAgICAgICAgIHVPcC5pZlByZXNlbnQodXNlclJlcG9zaXRvcnk6OmRlbGV0ZSk7XG4gICAgICAgICAgICAgICAgUGVyc29uIHAgPSBzLmdldFBlcnNvbigpO1xuICAgICAgICAgICAgICAgIHRlYWNoZXJSZXBvc2l0b3J5LmRlbGV0ZShzKTsgICAgLy/pppblhYjmlbDmja7lupPmsLjkuYXliKDpmaTmlZnluIjkv6Hmga9cbiAgICAgICAgICAgICAgICBwZXJzb25SZXBvc2l0b3J5LmRlbGV0ZShwKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gQ29tbW9uTWV0aG9kLmdldFJldHVybk1lc3NhZ2VPSygpOyAgLy/pgJrnn6XliY3nq6/mk43kvZzmraPluLhcbiAgICB9XG5cbiAgICBwdWJsaWMgRGF0YVJlc3BvbnNlIGdldFRlYWNoZXJJbmZvKERhdGFSZXF1ZXN0IGRhdGFSZXF1ZXN0KSB7XG4gICAgICAgIEludGVnZXIgcGVyc29uSWQgPSBkYXRhUmVxdWVzdC5nZXRJbnRlZ2VyKFwicGVyc29uSWRcIik7XG4gICAgICAgIFRlYWNoZXIgcyA9IG51bGw7XG4gICAgICAgIE9wdGlvbmFsPFRlYWNoZXI+IG9wO1xuICAgICAgICBpZiAocGVyc29uSWQgIT0gbnVsbCkge1xuICAgICAgICAgICAgb3AgPSB0ZWFjaGVyUmVwb3NpdG9yeS5maW5kQnlJZChwZXJzb25JZCk7IC8v5qC55o2u5a2m55Sf5Li76ZSu5LuO5pWw5o2u5bqT5p+l6K+i5a2m55Sf55qE5L+h5oGvXG4gICAgICAgICAgICBpZiAob3AuaXNQcmVzZW50KCkpIHtcbiAgICAgICAgICAgICAgICBzID0gb3AuZ2V0KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIENvbW1vbk1ldGhvZC5nZXRSZXR1cm5EYXRhKGdldE1hcEZyb21UZWFjaGVyKHMpKTsgLy/ov5nph4zlm57kvKDljIXlkKvlrabnlJ/kv6Hmga/nmoRNYXDlr7nosaFcbiAgICB9XG5cbiAgICBwdWJsaWMgRGF0YVJlc3BvbnNlIHRlYWNoZXJFZGl0U2F2ZShEYXRhUmVxdWVzdCBkYXRhUmVxdWVzdCkge1xuICAgICAgICBJbnRlZ2VyIHBlcnNvbklkID0gZGF0YVJlcXVlc3QuZ2V0SW50ZWdlcihcInBlcnNvbklkXCIpO1xuICAgICAgICBNYXA8U3RyaW5nLCBPYmplY3Q+IGZvcm0gPSBkYXRhUmVxdWVzdC5nZXRNYXAoXCJmb3JtXCIpOyAvL+WPguaVsOiOt+WPlk1hcOWvueixoVxuICAgICAgICBTdHJpbmcgbnVtID0gQ29tbW9uTWV0aG9kLmdldFN0cmluZyhmb3JtLCBcIm51bVwiKTsgIC8vTWFwIOiOt+WPluWxnuaAp+eahOWAvFxuICAgICAgICBUZWFjaGVyIHMgPSBudWxsO1xuICAgICAgICBQZXJzb24gcDtcbiAgICAgICAgVXNlciB1O1xuICAgICAgICBPcHRpb25hbDxUZWFjaGVyPiBvcDtcbiAgICAgICAgYm9vbGVhbiBpc05ldyA9IGZhbHNlO1xuICAgICAgICBpZiAocGVyc29uSWQgIT0gbnVsbCkge1xuICAgICAgICAgICAgb3AgPSB0ZWFjaGVyUmVwb3NpdG9yeS5maW5kQnlJZChwZXJzb25JZCk7ICAvL+afpeivouWvueW6lOaVsOaNruW6k+S4reS4u+mUruS4umlk55qE5YC855qE5a6e5L2T5a+56LGhXG4gICAgICAgICAgICBpZiAob3AuaXNQcmVzZW50KCkpIHtcbiAgICAgICAgICAgICAgICBzID0gb3AuZ2V0KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgT3B0aW9uYWw8UGVyc29uPiBuT3AgPSBwZXJzb25SZXBvc2l0b3J5LmZpbmRCeU51bShudW0pOyAvL+afpeivouaYr+WQpuWtmOWcqG51beeahOS6uuWRmFxuICAgICAgICBpZiAobk9wLmlzUHJlc2VudCgpKSB7XG4gICAgICAgICAgICBpZiAocyA9PSBudWxsIHx8ICFzLmdldFBlcnNvbigpLmdldE51bSgpLmVxdWFscyhudW0pKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIENvbW1vbk1ldGhvZC5nZXRSZXR1cm5NZXNzYWdlRXJyb3IoXCLmlrDlt6Xlj7flt7Lnu4/lrZjlnKjvvIzkuI3og73mt7vliqDmiJbkv67mlLnvvIFcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHMgPT0gbnVsbCkge1xuICAgICAgICAgICAgcCA9IG5ldyBQZXJzb24oKTtcbiAgICAgICAgICAgIHAuc2V0TnVtKG51bSk7XG4gICAgICAgICAgICBwLnNldFR5cGUoXCIyXCIpOyAgLy8gMuihqOekuuaVmeW4iOexu+Wei1xuICAgICAgICAgICAgcGVyc29uUmVwb3NpdG9yeS5zYXZlQW5kRmx1c2gocCk7ICAvL+aPkuWFpeaWsOeahFBlcnNvbuiusOW9lVxuICAgICAgICAgICAgcGVyc29uSWQgPSBwLmdldFBlcnNvbklkKCk7XG4gICAgICAgICAgICBTdHJpbmcgcGFzc3dvcmQgPSBlbmNvZGVyLmVuY29kZShcIjEyMzQ1NlwiKTtcbiAgICAgICAgICAgIHUgPSBuZXcgVXNlcigpO1xuICAgICAgICAgICAgdS5zZXRQZXJzb25JZChwZXJzb25JZCk7XG4gICAgICAgICAgICB1LnNldFVzZXJOYW1lKG51bSk7XG4gICAgICAgICAgICB1LnNldFBhc3N3b3JkKHBhc3N3b3JkKTtcbiAgICAgICAgICAgIHUuc2V0VXNlclR5cGUodXNlclR5cGVSZXBvc2l0b3J5LmZpbmRCeU5hbWUoRVVzZXJUeXBlLlJPTEVfVEVBQ0hFUikpOyAgLy8g6K6+572u5Li65pWZ5biI6KeS6ImyXG4gICAgICAgICAgICB1LnNldENyZWF0ZVRpbWUoRGF0ZVRpbWVUb29sLnBhcnNlRGF0ZVRpbWUobmV3IERhdGUoKSkpO1xuICAgICAgICAgICAgdS5zZXRDcmVhdG9ySWQoQ29tbW9uTWV0aG9kLmdldFBlcnNvbklkKCkpO1xuICAgICAgICAgICAgdXNlclJlcG9zaXRvcnkuc2F2ZUFuZEZsdXNoKHUpOyAvL+aPkuWFpeaWsOeahFVzZXLorrDlvZVcbiAgICAgICAgICAgIHMgPSBuZXcgVGVhY2hlcigpOyAgIC8vIOWIm+W7uuWunuS9k+WvueixoVxuICAgICAgICAgICAgcy5zZXRQZXJzb25JZChwZXJzb25JZCk7XG4gICAgICAgICAgICB0ZWFjaGVyUmVwb3NpdG9yeS5zYXZlQW5kRmx1c2gocyk7ICAvL+aPkuWFpeaWsOeahFRlYWNoZXLorrDlvZVcbiAgICAgICAgICAgIGlzTmV3ID0gdHJ1ZTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHAgPSBzLmdldFBlcnNvbigpO1xuICAgICAgICB9XG4gICAgICAgIHBlcnNvbklkID0gcC5nZXRQZXJzb25JZCgpO1xuICAgICAgICBpZiAoIW51bS5lcXVhbHMocC5nZXROdW0oKSkpIHsgICAvL+WmguaenOS6uuWRmOe8luWPt+WPmOWMlu+8jOS/ruaUueS6uuWRmOe8luWPt+WSjOeZu+W9lei0puWPt1xuICAgICAgICAgICAgT3B0aW9uYWw8VXNlcj4gdU9wID0gdXNlclJlcG9zaXRvcnkuZmluZEJ5UGVyc29uUGVyc29uSWQocGVyc29uSWQpO1xuICAgICAgICAgICAgaWYgKHVPcC5pc1ByZXNlbnQoKSkge1xuICAgICAgICAgICAgICAgIHUgPSB1T3AuZ2V0KCk7XG4gICAgICAgICAgICAgICAgdS5zZXRVc2VyTmFtZShudW0pO1xuICAgICAgICAgICAgICAgIHVzZXJSZXBvc2l0b3J5LnNhdmVBbmRGbHVzaCh1KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHAuc2V0TnVtKG51bSk7ICAvL+iuvue9ruWxnuaAp1xuICAgICAgICB9XG4gICAgICAgIHAuc2V0TmFtZShDb21tb25NZXRob2QuZ2V0U3RyaW5nKGZvcm0sIFwibmFtZVwiKSk7XG4gICAgICAgIHAuc2V0RGVwdChDb21tb25NZXRob2QuZ2V0U3RyaW5nKGZvcm0sIFwiZGVwdFwiKSk7XG4gICAgICAgIHAuc2V0Q2FyZChDb21tb25NZXRob2QuZ2V0U3RyaW5nKGZvcm0sIFwiY2FyZFwiKSk7XG4gICAgICAgIHAuc2V0R2VuZGVyKENvbW1vbk1ldGhvZC5nZXRTdHJpbmcoZm9ybSwgXCJnZW5kZXJcIikpO1xuICAgICAgICBwLnNldEJpcnRoZGF5KENvbW1vbk1ldGhvZC5nZXRTdHJpbmcoZm9ybSwgXCJiaXJ0aGRheVwiKSk7XG4gICAgICAgIHAuc2V0RW1haWwoQ29tbW9uTWV0aG9kLmdldFN0cmluZyhmb3JtLCBcImVtYWlsXCIpKTtcbiAgICAgICAgcC5zZXRQaG9uZShDb21tb25NZXRob2QuZ2V0U3RyaW5nKGZvcm0sIFwicGhvbmVcIikpO1xuICAgICAgICBwLnNldEFkZHJlc3MoQ29tbW9uTWV0aG9kLmdldFN0cmluZyhmb3JtLCBcImFkZHJlc3NcIikpO1xuICAgICAgICBwZXJzb25SZXBvc2l0b3J5LnNhdmUocCk7ICAvLyDkv67mlLnkv53lrZjkurrlkZjkv6Hmga9cbiAgICAgICAgcy5zZXRDbGFzc05hbWUoQ29tbW9uTWV0aG9kLmdldFN0cmluZyhmb3JtLCBcImNsYXNzTmFtZVwiKSk7XG4gICAgICAgIHRlYWNoZXJSZXBvc2l0b3J5LnNhdmUocyk7ICAvL+S/ruaUueS/neWtmOWtpueUn+S/oeaBr1xuICAgICAgICBzeXN0ZW1TZXJ2aWNlLm1vZGlmeUxvZyhzLCBpc05ldyk7XG4gICAgICAgIHJldHVybiBDb21tb25NZXRob2QuZ2V0UmV0dXJuRGF0YShzLmdldFBlcnNvbklkKCkpOyAgLy8g5bCGcGVyc29uSWTov5Tlm57liY3nq69cbiAgICB9XG5cbiAgICBwdWJsaWMgUmVzcG9uc2VFbnRpdHk8U3RyZWFtaW5nUmVzcG9uc2VCb2R5PiBnZXRUZWFjaGVyTGlzdEV4Y2woRGF0YVJlcXVlc3QgZGF0YVJlcXVlc3QpIHtcbiAgICAgICAgU3RyaW5nIG51bU5hbWUgPSBkYXRhUmVxdWVzdC5nZXRTdHJpbmcoXCJudW1OYW1lXCIpO1xuICAgICAgICBMaXN0PE1hcDxTdHJpbmcsIE9iamVjdD4+IGxpc3QgPSBnZXRUZWFjaGVyTWFwTGlzdChudW1OYW1lKTtcblxuICAgICAgICAvLyDosIPmlbTliJflrr3phY3nva5cbiAgICAgICAgSW50ZWdlcltdIHdpZHRocyA9IHs4LCAxNSwgMTAsIDIwLCAxNSwgMTAsIDgsIDI1LCAxNSwgMzB9O1xuICAgICAgICBTdHJpbmdbXSB0aXRsZXMgPSB7XCLluo/lj7dcIiwgXCLlt6Xlj7dcIiwgXCLlp5PlkI1cIiwgXCLlrabpmaJcIiwgXCLogYznp7BcIiwgXCLlrabkvY1cIiwgXCLmgKfliKtcIiwgXCLpgq7nrrFcIiwgXCLnlLXor51cIiwgXCLlnLDlnYBcIn07XG4gICAgICAgIFN0cmluZyBvdXRQdXRTaGVldE5hbWUgPSBcInRlYWNoZXIueGxzeFwiO1xuXG4gICAgICAgIFhTU0ZXb3JrYm9vayB3YiA9IG5ldyBYU1NGV29ya2Jvb2soKTtcbiAgICAgICAgWFNTRlNoZWV0IHNoZWV0ID0gd2IuY3JlYXRlU2hlZXQob3V0UHV0U2hlZXROYW1lKTtcblxuICAgICAgICAvLyDorr7nva7liJflrr1cbiAgICAgICAgZm9yIChpbnQgaiA9IDA7IGogPCB3aWR0aHMubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgICAgIHNoZWV0LnNldENvbHVtbldpZHRoKGosIHdpZHRoc1tqXSAqIDI1Nik7XG4gICAgICAgIH1cblxuICAgICAgICAvLyDliJvlu7rmoIfpopjooYzmoLflvI9cbiAgICAgICAgWFNTRkNlbGxTdHlsZSBzdHlsZSA9IENvbW1vbk1ldGhvZC5jcmVhdGVDZWxsU3R5bGUod2IsIDExKTtcbiAgICAgICAgWFNTRlJvdyByb3cgPSBzaGVldC5jcmVhdGVSb3coMCk7XG4gICAgICAgIFhTU0ZDZWxsW10gY2VsbCA9IG5ldyBYU1NGQ2VsbFt3aWR0aHMubGVuZ3RoXTtcblxuICAgICAgICAvLyDloavlhYXmoIfpopjooYxcbiAgICAgICAgZm9yIChpbnQgaiA9IDA7IGogPCB3aWR0aHMubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgICAgIGNlbGxbal0gPSByb3cuY3JlYXRlQ2VsbChqKTtcbiAgICAgICAgICAgIGNlbGxbal0uc2V0Q2VsbFN0eWxlKHN0eWxlKTtcbiAgICAgICAgICAgIGNlbGxbal0uc2V0Q2VsbFZhbHVlKHRpdGxlc1tqXSk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyDloavlhYXmlbDmja7ooYxcbiAgICAgICAgaWYgKGxpc3QgIT0gbnVsbCAmJiAhbGlzdC5pc0VtcHR5KCkpIHtcbiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgbGlzdC5zaXplKCk7IGkrKykge1xuICAgICAgICAgICAgICAgIHJvdyA9IHNoZWV0LmNyZWF0ZVJvdyhpICsgMSk7XG4gICAgICAgICAgICAgICAgTWFwPFN0cmluZywgT2JqZWN0PiBtID0gbGlzdC5nZXQoaSk7XG5cbiAgICAgICAgICAgICAgICAvLyDliJvlu7rljZXlhYPmoLzlubborr7nva7moLflvI9cbiAgICAgICAgICAgICAgICBmb3IgKGludCBqID0gMDsgaiA8IHdpZHRocy5sZW5ndGg7IGorKykge1xuICAgICAgICAgICAgICAgICAgICBjZWxsW2pdID0gcm93LmNyZWF0ZUNlbGwoaik7XG4gICAgICAgICAgICAgICAgICAgIGNlbGxbal0uc2V0Q2VsbFN0eWxlKHN0eWxlKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvLyDloavlhYXlhbfkvZPmlbDmja5cbiAgICAgICAgICAgICAgICBjZWxsWzBdLnNldENlbGxWYWx1ZSgoaSArIDEpICsgXCJcIik7IC8vIOW6j+WPt1xuICAgICAgICAgICAgICAgIGNlbGxbMV0uc2V0Q2VsbFZhbHVlKENvbW1vbk1ldGhvZC5nZXRTdHJpbmcobSwgXCJudW1cIikpOyAvLyDlt6Xlj7dcbiAgICAgICAgICAgICAgICBjZWxsWzJdLnNldENlbGxWYWx1ZShDb21tb25NZXRob2QuZ2V0U3RyaW5nKG0sIFwibmFtZVwiKSk7IC8vIOWnk+WQjVxuICAgICAgICAgICAgICAgIGNlbGxbM10uc2V0Q2VsbFZhbHVlKENvbW1vbk1ldGhvZC5nZXRTdHJpbmcobSwgXCJkZXB0XCIpKTsgLy8g5a2m6ZmiXG4gICAgICAgICAgICAgICAgY2VsbFs0XS5zZXRDZWxsVmFsdWUoQ29tbW9uTWV0aG9kLmdldFN0cmluZyhtLCBcInRpdGxlXCIpKTsgLy8g6IGM56ewXG4gICAgICAgICAgICAgICAgY2VsbFs1XS5zZXRDZWxsVmFsdWUoQ29tbW9uTWV0aG9kLmdldFN0cmluZyhtLCBcImRlZ3JlZVwiKSk7IC8vIOWtpuS9jVxuICAgICAgICAgICAgICAgIGNlbGxbNl0uc2V0Q2VsbFZhbHVlKENvbW1vbk1ldGhvZC5nZXRTdHJpbmcobSwgXCJnZW5kZXJOYW1lXCIpKTsgLy8g5oCn5YirXG4gICAgICAgICAgICAgICAgY2VsbFs3XS5zZXRDZWxsVmFsdWUoQ29tbW9uTWV0aG9kLmdldFN0cmluZyhtLCBcImVtYWlsXCIpKTsgLy8g6YKu566xXG4gICAgICAgICAgICAgICAgY2VsbFs4XS5zZXRDZWxsVmFsdWUoQ29tbW9uTWV0aG9kLmdldFN0cmluZyhtLCBcInBob25lXCIpKTsgLy8g55S16K+dXG4gICAgICAgICAgICAgICAgY2VsbFs5XS5zZXRDZWxsVmFsdWUoQ29tbW9uTWV0aG9kLmdldFN0cmluZyhtLCBcImFkZHJlc3NcIikpOyAvLyDlnLDlnYBcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBTdHJlYW1pbmdSZXNwb25zZUJvZHkgc3RyZWFtID0gd2I6OndyaXRlO1xuICAgICAgICAgICAgcmV0dXJuIFJlc3BvbnNlRW50aXR5Lm9rKClcbiAgICAgICAgICAgICAgICAgICAgLmNvbnRlbnRUeXBlKENvbW1vbk1ldGhvZC5leGVsVHlwZSlcbiAgICAgICAgICAgICAgICAgICAgLmJvZHkoc3RyZWFtKTtcbiAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHtcbiAgICAgICAgICAgIHJldHVybiBSZXNwb25zZUVudGl0eS5pbnRlcm5hbFNlcnZlckVycm9yKCkuYnVpbGQoKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHB1YmxpYyBEYXRhUmVzcG9uc2UgZ2V0VGVhY2hlclBhZ2VEYXRhKERhdGFSZXF1ZXN0IGRhdGFSZXF1ZXN0KSB7XG4gICAgICAgIFN0cmluZyBudW1OYW1lID0gZGF0YVJlcXVlc3QuZ2V0U3RyaW5nKFwibnVtTmFtZVwiKTtcbiAgICAgICAgSW50ZWdlciBjUGFnZSA9IGRhdGFSZXF1ZXN0LmdldEN1cnJlbnRQYWdlKCk7XG4gICAgICAgIGludCBkYXRhVG90YWwgPSAwO1xuICAgICAgICBpbnQgc2l6ZSA9IDQwO1xuICAgICAgICBMaXN0PE1hcDxTdHJpbmcsIE9iamVjdD4+IGRhdGFMaXN0ID0gbmV3IEFycmF5TGlzdDw+KCk7XG4gICAgICAgIFBhZ2U8VGVhY2hlcj4gcGFnZSA9IG51bGw7XG4gICAgICAgIFBhZ2VhYmxlIHBhZ2VhYmxlID0gUGFnZVJlcXVlc3Qub2YoY1BhZ2UsIHNpemUpO1xuICAgICAgICBwYWdlID0gdGVhY2hlclJlcG9zaXRvcnkuZmluZFRlYWNoZXJMaXN0QnlOdW1OYW1lKG51bU5hbWUsIHBhZ2VhYmxlKTtcbiAgICAgICAgTWFwPFN0cmluZywgT2JqZWN0PiBtO1xuICAgICAgICBpZiAocGFnZSAhPSBudWxsKSB7XG4gICAgICAgICAgICBkYXRhVG90YWwgPSAoaW50KSBwYWdlLmdldFRvdGFsRWxlbWVudHMoKTtcbiAgICAgICAgICAgIExpc3Q8VGVhY2hlcj4gbGlzdCA9IHBhZ2UuZ2V0Q29udGVudCgpO1xuICAgICAgICAgICAgaWYgKCFsaXN0LmlzRW1wdHkoKSkge1xuICAgICAgICAgICAgICAgIGZvciAoVGVhY2hlciB0ZWFjaGVyIDogbGlzdCkge1xuICAgICAgICAgICAgICAgICAgICBtID0gZ2V0TWFwRnJvbVRlYWNoZXIodGVhY2hlcik7XG4gICAgICAgICAgICAgICAgICAgIGRhdGFMaXN0LmFkZChtKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgTWFwPFN0cmluZywgT2JqZWN0PiBkYXRhID0gbmV3IEhhc2hNYXA8PigpO1xuICAgICAgICBkYXRhLnB1dChcImRhdGFUb3RhbFwiLCBkYXRhVG90YWwpO1xuICAgICAgICBkYXRhLnB1dChcInBhZ2VTaXplXCIsIHNpemUpO1xuICAgICAgICBkYXRhLnB1dChcImRhdGFMaXN0XCIsIGRhdGFMaXN0KTtcbiAgICAgICAgcmV0dXJuIENvbW1vbk1ldGhvZC5nZXRSZXR1cm5EYXRhKGRhdGEpO1xuICAgIH1cbn1cblxuLi4uXG5QYXRoOiBqYXZhLXNlcnZlci9zcmMvbWFpbi9qYXZhL2NuL2VkdS9zZHUvamF2YS9zZXJ2ZXIvbW9kZWxzL0ZhbWlseU1lbWJlci5qYXZhXG5wYWNrYWdlIGNuLmVkdS5zZHUuamF2YS5zZXJ2ZXIubW9kZWxzO1xuXG5pbXBvcnQgamFrYXJ0YS5wZXJzaXN0ZW5jZS4qO1xuaW1wb3J0IGpha2FydGEudmFsaWRhdGlvbi5jb25zdHJhaW50cy5TaXplO1xuaW1wb3J0IGxvbWJvay5HZXR0ZXI7XG5pbXBvcnQgbG9tYm9rLlNldHRlcjtcbkBHZXR0ZXJcbkBTZXR0ZXJcbkBFbnRpdHlcbkBUYWJsZShcdG5hbWUgPSBcImZhbWlseV9tZW1iZXJcIixcbiAgICAgICAgdW5pcXVlQ29uc3RyYWludHMgPSB7XG4gICAgICAgIH0pXG5wdWJsaWMgY2xhc3MgRmFtaWx5TWVtYmVyIHtcbiAgICBASWRcbiAgICBAR2VuZXJhdGVkVmFsdWUoc3RyYXRlZ3kgPSBHZW5lcmF0aW9uVHlwZS5JREVOVElUWSlcbiAgICBwcml2YXRlIEludGVnZXIgbWVtYmVySWQ7XG5cbiAgICBATWFueVRvT25lXG4gICAgQEpvaW5Db2x1bW4obmFtZT1cInBlcnNvbklkXCIpXG4gICAgcHJpdmF0ZSBTdHVkZW50IHN0dWRlbnQ7XG4gICAgQFNpemUobWF4PTEwKVxuICAgIHByaXZhdGUgU3RyaW5nIHJlbGF0aW9uO1xuICAgIEBTaXplKG1heD0zMClcbiAgICBwcml2YXRlIFN0cmluZyBuYW1lO1xuICAgIEBTaXplKG1heD0xMClcbiAgICBwcml2YXRlIFN0cmluZyBnZW5kZXI7XG4gICAgcHJpdmF0ZSBJbnRlZ2VyIGFnZTtcbi4uLiIsImlzX2Vycm9yIjpmYWxzZSwicmVxdWVzdF9pZCI6IiIsInRvb2xfdXNlX2lkIjoidG9vbHVfdnJ0eF8wMVBhNFlhZ25jeUd1ZHlNRmE1aUVGMlUifX0seyJpZCI6MiwidHlwZSI6NCwiaWRlX3N0YXRlX25vZGUiOnsid29ya3NwYWNlRm9sZGVycyI6W3sicmVwb3NpdG9yeVJvb3QiOiJDOi9Vc2Vycy9wcmluY2lwL0RvY3VtZW50cy9HaXRIdWIvYmFpY2FpL2phdmEtc2VydmVyIiwiZm9sZGVyUm9vdCI6IkM6L1VzZXJzL3ByaW5jaXAvRG9jdW1lbnRzL0dpdEh1Yi9iYWljYWkvamF2YS1zZXJ2ZXIifV0sIndvcmtzcGFjZUZvbGRlcnNVbmNoYW5nZWQiOmZhbHNlfX1dLCJ0aW1lc3RhbXAiOiIyMDI1LTA1LTE2VDE1OjA2OjA0LjU2MloiLCJyZXNwb25zZV90ZXh0Ijoi546w5Zyo5oiR5bey57uP5om+5Yiw5LqG6Zeu6aKY5omA5Zyo44CC5qC55o2u5oiR55qE5YiG5p6Q77yM6ZSZ6K+v5Ye6546w5ZyoIGBUZWFjaGVyU2VydmljZXMuamF2YWAg5paH5Lu25Lit55qEIGBmYW1pbHlNZW1iZXJTYXZlYCDmlrnms5XjgIJcblxu6Zeu6aKY55qE5qC55rqQ5piv77yaXG5cbjEuIOWcqCBgVGVhY2hlclNlcnZpY2VzLmphdmFgIOS4reeahCBgZmFtaWx5TWVtYmVyU2F2ZWAg5pa55rOV5Lit77yM5pyJ5Lul5LiL5Luj56CB77yaXG5gYGBqYXZhXG5pZihmPT0gbnVsbCkge1xuICAgIGYgPSBuZXcgRmFtaWx5TWVtYmVyKCk7XG4gICAgYXNzZXJ0IHBlcnNvbklkICE9IG51bGw7XG4gICAgZi5zZXRTdHVkZW50KHRlYWNoZXJSZXBvc2l0b3J5LmZpbmRCeUlkKHBlcnNvbklkKS5nZXQoKSk7XG59XG5gYGBcblxuMi4g6L+Z6YeM55qE6Zeu6aKY5piv77yM5a6D5bCd6K+V5bCGIGBUZWFjaGVyYCDlr7nosaHorr7nva7liLAgYEZhbWlseU1lbWJlcmAg55qEIGBzdHVkZW50YCDlsZ7mgKfkuK3vvIzkvYYgYEZhbWlseU1lbWJlcmAg57G755qEIGBzdHVkZW50YCDlsZ7mgKfmnJ/mnJvnmoTmmK8gYFN0dWRlbnRgIOexu+Wei++8jOiAjOS4jeaYryBgVGVhY2hlcmAg57G75Z6L44CCXG5cbjMuIOWcqCBgQ29tbW9uTWV0aG9kLmdldEludGVnZXJgIOaWueazleS4re+8jOW9k+S7juihqOWNleiOt+WPliBcImFnZVwiIOWAvOaXtu+8jOWmguaenOWJjeerr+S8oOmAkueahOaYryBEb3VibGUg57G75Z6L55qE5YC877yM5pa55rOV5Lya5bCd6K+V5bCG5YW26L2s5o2i5Li6IEludGVnZXLvvJpcbmBgYGphdmFcbnB1YmxpYyBzdGF0aWMgSW50ZWdlciBnZXRJbnRlZ2VyKE1hcDxTdHJpbmcsT2JqZWN0PiBkYXRhLFN0cmluZyBrZXkpIHtcbiAgICBPYmplY3Qgb2JqID0gZGF0YS5nZXQoa2V5KTtcbiAgICBpZihvYmogPT0gbnVsbClcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgaWYob2JqIGluc3RhbmNlb2YgSW50ZWdlcilcbiAgICAgICAgcmV0dXJuIChJbnRlZ2VyKW9iajtcbiAgICBTdHJpbmcgc3RyID0gb2JqLnRvU3RyaW5nKCk7XG4gICAgdHJ5IHtcbiAgICAgICAgcmV0dXJuIChpbnQpRG91YmxlLnBhcnNlRG91YmxlKHN0cik7XG4gICAgfWNhdGNoKEV4Y2VwdGlvbiBlKSB7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbn1cbmBgYFxuXG40LiDlvZPmiafooYwgYGYuc2V0QWdlKENvbW1vbk1ldGhvZC5nZXRJbnRlZ2VyKGZvcm0sXCJhZ2VcIikpO2Ag5pe277yM5aaC5p6cIFwiYWdlXCIg55qE5YC85pivIERvdWJsZSDnsbvlnovvvIzkvJrlsJ3or5XlsIblhbbovazmjaLkuLogSW50ZWdlcu+8jOi/meWwseaYr+mUmeivr+a2iOaBr+S4reaPkOWIsOeahCBcImNsYXNzIGphdmEubGFuZy5Eb3VibGUgY2Fubm90IGJlIGNhc3QgdG8gY2xhc3MgamF2YS5sYW5nLkludGVnZXJcIiDnmoTljp/lm6DjgIJcblxu6Kej5Yaz5pa55qGI5piv5L+u5pS5IGBUZWFjaGVyU2VydmljZXMuamF2YWAg5Lit55qEIGBmYW1pbHlNZW1iZXJTYXZlYCDmlrnms5XvvIznoa7kv53mraPnoa7lpITnkIYgVGVhY2hlciDlkowgRmFtaWx5TWVtYmVyIOS5i+mXtOeahOWFs+ezu++8jOW5tuehruS/nSBhZ2Ug5YC855qE57G75Z6L6L2s5o2i5q2j56Gu44CCXG5cbuaIkeeahOWIhuaekOe7k+iuuu+8mlxuXG7lnKggYFRlYWNoZXJTZXJ2aWNlcy5qYXZhYCDkuK3vvIxgZmFtaWx5TWVtYmVyU2F2ZWAg5pa55rOV5a2Y5Zyo5Lik5Liq5Li76KaB6Zeu6aKY77yaXG5cbjEuIOWug+WwneivleWwhiBgVGVhY2hlcmAg5a+56LGh6K6+572u5YiwIGBGYW1pbHlNZW1iZXJgIOeahCBgc3R1ZGVudGAg5bGe5oCn5Lit77yM6L+Z5piv57G75Z6L5LiN5Yy56YWN55qE44CCXG4yLiDlnKjlpITnkIYgXCJhZ2VcIiDlgLzml7bvvIzlpoLmnpzliY3nq6/kvKDpgJLnmoTmmK8gRG91YmxlIOexu+Wei++8jOS8muWvvOiHtOexu+Wei+i9rOaNoumUmeivr+OAglxuXG7ov5nlsLHmmK/mgqjnnIvliLDnmoTplJnor6/mtojmga8gXCJjbGFzcyBqYXZhLmxhbmcuRG91YmxlIGNhbm5vdCBiZSBjYXN0IHRvIGNsYXNzIGphdmEubGFuZy5JbnRlZ2VyXCIg55qE5Y6f5Zug44CCXG4iLCJ3b3Jrc3BhY2VfZmlsZV9jaHVua3MiOltdfSx7InJlcXVlc3RfaWQiOiI4MGM4MzhmMi01ZTVkLTQ5ODYtOTc5OC1lNjZkNDBhMzI5YzIiLCJzdGF0dXMiOiJjYW5jZWxsZWQiLCJjaGF0SXRlbVR5cGUiOiJhZ2VudGljLXR1cm4tZGVsaW1pdGVyIn0seyJzdGF0dXMiOiJzdWNjZXNzIiwicmVxdWVzdF9pZCI6IjRmMDU2NTUzLTBjOGUtNDgyMS05ZjFiLTI2MDVkOTBmMjEzOCIsInJlcXVlc3RfbWVzc2FnZSI6IuW4ruaIkeS/ruaUuSIsInJpY2hfdGV4dF9qc29uX3JlcHIiOnsidHlwZSI6ImRvYyIsImNvbnRlbnQiOlt7InR5cGUiOiJwYXJhZ3JhcGgiLCJjb250ZW50IjpbeyJ0eXBlIjoidGV4dCIsInRleHQiOiLluK7miJHkv67mlLkifV19XX0sIm1lbnRpb25lZF9pdGVtcyI6W10sInN0cnVjdHVyZWRfb3V0cHV0X25vZGVzIjpbeyJpZCI6MSwidHlwZSI6NSwiY29udGVudCI6IiIsInRvb2xfdXNlIjp7InRvb2xfdXNlX2lkIjoidG9vbHVfdnJ0eF8wMUV0SHBaRWtSOWppQzFxTjVGQ1Zhc1giLCJ0b29sX25hbWUiOiJjb2RlYmFzZS1yZXRyaWV2YWwiLCJpbnB1dF9qc29uIjoie1wiaW5mb3JtYXRpb25fcmVxdWVzdFwiOiBcIlxcdTY3ZTVcXHU2MjdlIEZhbWlseU1lbWJlciBcXHU3YzdiXFx1NGUyZFxcdTc2ODQgc2V0VGVhY2hlciBcXHU2NWI5XFx1NmNkNVxcdTYyMTZcXHU0ZTBlIFRlYWNoZXIgXFx1NzZmOFxcdTUxNzNcXHU3Njg0XFx1NWM1ZVxcdTYwMjdcIn0iLCJtY3Bfc2VydmVyX25hbWUiOiIiLCJtY3BfdG9vbF9uYW1lIjoiIn19LHsiaWQiOjAsInR5cGUiOjAsImNvbnRlbnQiOiLlpb3nmoTvvIzmiJHlsIbluK7mgqjkv67mlLkgYFRlYWNoZXJTZXJ2aWNlcy5qYXZhYCDmlofku7bkuK3nmoQgYGZhbWlseU1lbWJlclNhdmVgIOaWueazle+8jOino+WGsyBEb3VibGUg5YiwIEludGVnZXIg55qE57G75Z6L6L2s5o2i6Zeu6aKY5Lul5Y+KIFRlYWNoZXIg5ZKMIEZhbWlseU1lbWJlciDkuYvpl7TnmoTlhbPns7vpl67popjjgIJcblxu6aaW5YWI77yM6K6p5oiR5p+l55yL5LiA5LiLIGBGYW1pbHlNZW1iZXJgIOexu+S4reaYr+WQpuaciSBgc2V0VGVhY2hlcmAg5pa55rOV77yaXG4ifSx7ImlkIjoyLCJ0eXBlIjoyLCJjb250ZW50IjoiIn0seyJpZCI6MywidHlwZSI6MywiY29udGVudCI6IiJ9XSwic2Vlbl9zdGF0ZSI6InNlZW4iLCJzdHJ1Y3R1cmVkX3JlcXVlc3Rfbm9kZXMiOlt7ImlkIjowLCJ0eXBlIjowLCJ0ZXh0X25vZGUiOnsiY29udGVudCI6IuW4ruaIkeS/ruaUuSJ9fSx7ImlkIjoxLCJ0eXBlIjo0LCJpZGVfc3RhdGVfbm9kZSI6eyJ3b3Jrc3BhY2VGb2xkZXJzIjpbeyJyZXBvc2l0b3J5Um9vdCI6IkM6L1VzZXJzL3ByaW5jaXAvRG9jdW1lbnRzL0dpdEh1Yi9iYWljYWkvamF2YS1zZXJ2ZXIiLCJmb2xkZXJSb290IjoiQzovVXNlcnMvcHJpbmNpcC9Eb2N1bWVudHMvR2l0SHViL2JhaWNhaS9qYXZhLXNlcnZlciJ9XSwid29ya3NwYWNlRm9sZGVyc1VuY2hhbmdlZCI6ZmFsc2V9fV0sInRpbWVzdGFtcCI6IjIwMjUtMDUtMTZUMTU6MTQ6MjEuMjQ3WiIsInJlc3BvbnNlX3RleHQiOiLlpb3nmoTvvIzmiJHlsIbluK7mgqjkv67mlLkgYFRlYWNoZXJTZXJ2aWNlcy5qYXZhYCDmlofku7bkuK3nmoQgYGZhbWlseU1lbWJlclNhdmVgIOaWueazle+8jOino+WGsyBEb3VibGUg5YiwIEludGVnZXIg55qE57G75Z6L6L2s5o2i6Zeu6aKY5Lul5Y+KIFRlYWNoZXIg5ZKMIEZhbWlseU1lbWJlciDkuYvpl7TnmoTlhbPns7vpl67popjjgIJcblxu6aaW5YWI77yM6K6p5oiR5p+l55yL5LiA5LiLIGBGYW1pbHlNZW1iZXJgIOexu+S4reaYr+WQpuaciSBgc2V0VGVhY2hlcmAg5pa55rOV77yaXG4iLCJ3b3Jrc3BhY2VfZmlsZV9jaHVua3MiOltdfSx7InN0YXR1cyI6InN1Y2Nlc3MiLCJyZXF1ZXN0X2lkIjoiZmJmZTQ2YzUtZjlmZS00ODAwLThjOTItNjY5ZmFjNzE2ODhlIiwicmVxdWVzdF9tZXNzYWdlIjoiIiwic3RydWN0dXJlZF9vdXRwdXRfbm9kZXMiOlt7ImlkIjoxLCJ0eXBlIjo1LCJjb250ZW50IjoiIiwidG9vbF91c2UiOnsidG9vbF91c2VfaWQiOiJ0b29sdV92cnR4XzAxQmZ6cUY2eThFR0prMUhIMjNLVHROdCIsInRvb2xfbmFtZSI6InN0ci1yZXBsYWNlLWVkaXRvciIsImlucHV0X2pzb24iOiJ7XCJjb21tYW5kXCI6IFwidmlld1wiLCBcInBhdGhcIjogXCJqYXZhLXNlcnZlci9zcmMvbWFpbi9qYXZhL2NuL2VkdS9zZHUvamF2YS9zZXJ2ZXIvc2VydmljZXMvVGVhY2hlclNlcnZpY2VzLmphdmFcIiwgXCJ2aWV3X3JhbmdlXCI6IFsxLCA1MDBdfSIsIm1jcF9zZXJ2ZXJfbmFtZSI6IiIsIm1jcF90b29sX25hbWUiOiIifX0seyJpZCI6MCwidHlwZSI6MCwiY29udGVudCI6IueOsOWcqOaIkeS6huino+S6humXrumimOaJgOWcqOOAguaIkeWwhuS/ruaUuSBgVGVhY2hlclNlcnZpY2VzLmphdmFgIOaWh+S7tuS4reeahCBgZmFtaWx5TWVtYmVyU2F2ZWAg5pa55rOV77yM6Kej5Yaz57G75Z6L6L2s5o2i6Zeu6aKY44CCXG4ifSx7ImlkIjoyLCJ0eXBlIjoyLCJjb250ZW50IjoiIn0seyJpZCI6MywidHlwZSI6MywiY29udGVudCI6IiJ9XSwic2Vlbl9zdGF0ZSI6InNlZW4iLCJzdHJ1Y3R1cmVkX3JlcXVlc3Rfbm9kZXMiOlt7ImlkIjoxLCJ0eXBlIjoxLCJ0b29sX3Jlc3VsdF9ub2RlIjp7ImNvbnRlbnQiOiJUaGUgZm9sbG93aW5nIGNvZGUgc2VjdGlvbnMgd2VyZSByZXRyaWV2ZWQ6XG5QYXRoOiBqYXZhLXNlcnZlci9zcmMvbWFpbi9qYXZhL2NuL2VkdS9zZHUvamF2YS9zZXJ2ZXIvbW9kZWxzL0ZhbWlseU1lbWJlci5qYXZhXG5wYWNrYWdlIGNuLmVkdS5zZHUuamF2YS5zZXJ2ZXIubW9kZWxzO1xuXG5pbXBvcnQgamFrYXJ0YS5wZXJzaXN0ZW5jZS4qO1xuaW1wb3J0IGpha2FydGEudmFsaWRhdGlvbi5jb25zdHJhaW50cy5TaXplO1xuaW1wb3J0IGxvbWJvay5HZXR0ZXI7XG5pbXBvcnQgbG9tYm9rLlNldHRlcjtcbkBHZXR0ZXJcbkBTZXR0ZXJcbkBFbnRpdHlcbkBUYWJsZShcdG5hbWUgPSBcImZhbWlseV9tZW1iZXJcIixcbiAgICAgICAgdW5pcXVlQ29uc3RyYWludHMgPSB7XG4gICAgICAgIH0pXG5wdWJsaWMgY2xhc3MgRmFtaWx5TWVtYmVyIHtcbiAgICBASWRcbiAgICBAR2VuZXJhdGVkVmFsdWUoc3RyYXRlZ3kgPSBHZW5lcmF0aW9uVHlwZS5JREVOVElUWSlcbiAgICBwcml2YXRlIEludGVnZXIgbWVtYmVySWQ7XG5cbiAgICBATWFueVRvT25lXG4gICAgQEpvaW5Db2x1bW4obmFtZT1cInBlcnNvbklkXCIpXG4gICAgcHJpdmF0ZSBTdHVkZW50IHN0dWRlbnQ7XG4gICAgQFNpemUobWF4PTEwKVxuICAgIHByaXZhdGUgU3RyaW5nIHJlbGF0aW9uO1xuICAgIEBTaXplKG1heD0zMClcbiAgICBwcml2YXRlIFN0cmluZyBuYW1lO1xuICAgIEBTaXplKG1heD0xMClcbiAgICBwcml2YXRlIFN0cmluZyBnZW5kZXI7XG4gICAgcHJpdmF0ZSBJbnRlZ2VyIGFnZTtcbiAgICBAU2l6ZShtYXg9NTApXG4gICAgcHJpdmF0ZSBTdHJpbmcgdW5pdDtcblxuICAgIHB1YmxpYyB2b2lkIHNldFRlYWNoZXIoT2JqZWN0IG8pIHtcbiAgICB9XG59XG4uLi5cblBhdGg6IHNyYy9tYWluL2phdmEvY24vZWR1L3NkdS9qYXZhL3NlcnZlci9tb2RlbHMvRmFtaWx5TWVtYmVyLmphdmFcbnBhY2thZ2UgY24uZWR1LnNkdS5qYXZhLnNlcnZlci5tb2RlbHM7XG5cbmltcG9ydCBqYWthcnRhLnBlcnNpc3RlbmNlLio7XG5pbXBvcnQgamFrYXJ0YS52YWxpZGF0aW9uLmNvbnN0cmFpbnRzLlNpemU7XG5pbXBvcnQgbG9tYm9rLkdldHRlcjtcbmltcG9ydCBsb21ib2suU2V0dGVyO1xuQEdldHRlclxuQFNldHRlclxuQEVudGl0eVxuQFRhYmxlKFx0bmFtZSA9IFwiZmFtaWx5X21lbWJlclwiLFxuICAgICAgICB1bmlxdWVDb25zdHJhaW50cyA9IHtcbiAgICAgICAgfSlcbnB1YmxpYyBjbGFzcyBGYW1pbHlNZW1iZXIge1xuICAgIEBJZFxuICAgIEBHZW5lcmF0ZWRWYWx1ZShzdHJhdGVneSA9IEdlbmVyYXRpb25UeXBlLklERU5USVRZKVxuICAgIHByaXZhdGUgSW50ZWdlciBtZW1iZXJJZDtcblxuICAgIEBNYW55VG9PbmVcbiAgICBASm9pbkNvbHVtbihuYW1lPVwicGVyc29uSWRcIilcbiAgICBwcml2YXRlIFN0dWRlbnQgc3R1ZGVudDtcbiAgICBAU2l6ZShtYXg9MTApXG4gICAgcHJpdmF0ZSBTdHJpbmcgcmVsYXRpb247XG4gICAgQFNpemUobWF4PTMwKVxuICAgIHByaXZhdGUgU3RyaW5nIG5hbWU7XG4gICAgQFNpemUobWF4PTEwKVxuICAgIHByaXZhdGUgU3RyaW5nIGdlbmRlcjtcbiAgICBwcml2YXRlIEludGVnZXIgYWdlO1xuICAgIEBTaXplKG1heD01MClcbiAgICBwcml2YXRlIFN0cmluZyB1bml0O1xuXG59XG4uLi5cblBhdGg6IHNyYy9tYWluL2phdmEvY24vZWR1L3NkdS9qYXZhL3NlcnZlci9zZXJ2aWNlcy9UZWFjaGVyU2VydmljZXMuamF2YVxuLi4uXG4gICAgcHVibGljIExpc3Q8TWFwPFN0cmluZyxPYmplY3Q+PiBnZXRUZWFjaGVyTWFwTGlzdChTdHJpbmcgbnVtTmFtZSkge1xuICAgICAgICBMaXN0PE1hcDxTdHJpbmcsT2JqZWN0Pj4gZGF0YUxpc3QgPSBuZXcgQXJyYXlMaXN0PD4oKTtcbiAgICAgICAgTGlzdDxUZWFjaGVyPiBzTGlzdCA9IHRlYWNoZXJSZXBvc2l0b3J5LmZpbmRUZWFjaGVyTGlzdEJ5TnVtTmFtZShudW1OYW1lKTsgIC8v5pWw5o2u5bqT5p+l6K+i5pON5L2cXG4gICAgICAgIGlmIChzTGlzdCA9PSBudWxsIHx8IHNMaXN0LmlzRW1wdHkoKSlcbiAgICAgICAgICAgIHJldHVybiBkYXRhTGlzdDtcbiAgICAgICAgZm9yIChUZWFjaGVyIHRlYWNoZXIgOiBzTGlzdCkge1xuICAgICAgICAgICAgZGF0YUxpc3QuYWRkKGdldE1hcEZyb21UZWFjaGVyKHRlYWNoZXIpKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZGF0YUxpc3Q7XG4gICAgfVxuICAgIHB1YmxpYyBEYXRhUmVzcG9uc2UgZ2V0VGVhY2hlckxpc3QoRGF0YVJlcXVlc3QgZGF0YVJlcXVlc3QpIHtcbiAgICAgICAgU3RyaW5nIG51bU5hbWUgPSBkYXRhUmVxdWVzdC5nZXRTdHJpbmcoXCJudW1OYW1lXCIpO1xuICAgICAgICBMaXN0PE1hcDxTdHJpbmcsT2JqZWN0Pj4gZGF0YUxpc3QgPSAgZ2V0VGVhY2hlckxpc3QobnVtTmFtZSk7XG4gICAgICAgIHJldHVybiBDb21tb25NZXRob2QuZ2V0UmV0dXJuRGF0YShkYXRhTGlzdCk7ICAvL+aMieeFp+a1i+ivleahhuaetuinhOiMg+S8mumAgU1hcOeahGxpc3RcbiAgICB9XG4gICAgcHVibGljIERhdGFSZXNwb25zZSB0ZWFjaGVyRGVsZXRlKERhdGFSZXF1ZXN0IGRhdGFSZXF1ZXN0KSB7XG4gICAgICAgIEludGVnZXIgcGVyc29uSWQgPSBkYXRhUmVxdWVzdC5nZXRJbnRlZ2VyKFwicGVyc29uSWRcIik7ICAvL+iOt+WPlnRlYWNoZXJfaWTlgLxcbiAgICAgICAgVGVhY2hlciBzID0gbnVsbDtcbiAgICAgICAgT3B0aW9uYWw8VGVhY2hlcj4gb3A7XG4gICAgICAgIGlmIChwZXJzb25JZCAhPSBudWxsICYmIHBlcnNvbklkID4gMCkge1xuICAgICAgICAgICAgb3AgPSB0ZWFjaGVyUmVwb3NpdG9yeS5maW5kQnlJZChwZXJzb25JZCk7ICAgLy/mn6Xor6Lojrflvpflrp7kvZPlr7nosaFcbiAgICAgICAgICAgIGlmKG9wLmlzUHJlc2VudCgpKSB7XG4gICAgICAgICAgICAgICAgcyA9IG9wLmdldCgpO1xuICAgICAgICAgICAgICAgIE9wdGlvbmFsPFVzZXI+IHVPcCA9IHVzZXJSZXBvc2l0b3J5LmZpbmRCeUlkKHBlcnNvbklkKTsgLy/mn6Xor6Llr7nlupTor6XmlZnluIjnmoTotKbmiLdcbiAgICAgICAgICAgICAgICAvL+WIoOmZpOWvueW6lOivpeaVmeW4iOeahOi0puaIt1xuICAgICAgICAgICAgICAgIHVPcC5pZlByZXNlbnQodXNlclJlcG9zaXRvcnk6OmRlbGV0ZSk7XG4gICAgICAgICAgICAgICAgUGVyc29uIHAgPSBzLmdldFBlcnNvbigpO1xuICAgICAgICAgICAgICAgIHRlYWNoZXJSZXBvc2l0b3J5LmRlbGV0ZShzKTsgICAgLy/pppblhYjmlbDmja7lupPmsLjkuYXliKDpmaTmlZnluIjkv6Hmga9cbiAgICAgICAgICAgICAgICBwZXJzb25SZXBvc2l0b3J5LmRlbGV0ZShwKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gQ29tbW9uTWV0aG9kLmdldFJldHVybk1lc3NhZ2VPSygpOyAgLy/pgJrnn6XliY3nq6/mk43kvZzmraPluLhcbiAgICB9XG4gICAgcHVibGljIERhdGFSZXNwb25zZSBnZXRUZWFjaGVySW5mbyhEYXRhUmVxdWVzdCBkYXRhUmVxdWVzdCkge1xuICAgICAgICBJbnRlZ2VyIHBlcnNvbklkID0gZGF0YVJlcXVlc3QuZ2V0SW50ZWdlcihcInBlcnNvbklkXCIpO1xuICAgICAgICBUZWFjaGVyIHMgPSBudWxsO1xuICAgICAgICBPcHRpb25hbDxUZWFjaGVyPiBvcDtcbiAgICAgICAgaWYgKHBlcnNvbklkICE9IG51bGwpIHtcbiAgICAgICAgICAgIG9wID0gdGVhY2hlclJlcG9zaXRvcnkuZmluZEJ5SWQocGVyc29uSWQpOyAvL+agueaNruWtpueUn+S4u+mUruS7juaVsOaNruW6k+afpeivouWtpueUn+eahOS/oeaBr1xuICAgICAgICAgICAgaWYgKG9wLmlzUHJlc2VudCgpKSB7XG4gICAgICAgICAgICAgICAgcyA9IG9wLmdldCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBDb21tb25NZXRob2QuZ2V0UmV0dXJuRGF0YShnZXRNYXBGcm9tVGVhY2hlcihzKSk7IC8v6L+Z6YeM5Zue5Lyg5YyF5ZCr5a2m55Sf5L+h5oGv55qETWFw5a+56LGhXG4gICAgfVxuXG4gICAgcHVibGljIERhdGFSZXNwb25zZSB0ZWFjaGVyRWRpdFNhdmUoRGF0YVJlcXVlc3QgZGF0YVJlcXVlc3QpIHtcbiAgICAgICAgSW50ZWdlciBwZXJzb25JZCA9IGRhdGFSZXF1ZXN0LmdldEludGVnZXIoXCJwZXJzb25JZFwiKTtcbiAgICAgICAgTWFwPFN0cmluZyxPYmplY3Q+IGZvcm0gPSBkYXRhUmVxdWVzdC5nZXRNYXAoXCJmb3JtXCIpOyAvL+WPguaVsOiOt+WPlk1hcOWvueixoVxuICAgICAgICBTdHJpbmcgbnVtID0gQ29tbW9uTWV0aG9kLmdldFN0cmluZyhmb3JtLCBcIm51bVwiKTsgIC8vTWFwIOiOt+WPluWxnuaAp+eahOWAvFxuICAgICAgICBUZWFjaGVyIHMgPSBudWxsO1xuICAgICAgICBQZXJzb24gcDtcbiAgICAgICAgVXNlciB1O1xuICAgICAgICBPcHRpb25hbDxUZWFjaGVyPiBvcDtcbiAgICAgICAgYm9vbGVhbiBpc05ldyA9IGZhbHNlO1xuICAgICAgICBpZiAocGVyc29uSWQgIT0gbnVsbCkge1xuICAgICAgICAgICAgb3AgPSB0ZWFjaGVyUmVwb3NpdG9yeS5maW5kQnlJZChwZXJzb25JZCk7ICAvL+afpeivouWvueW6lOaVsOaNruW6k+S4reS4u+mUruS4umlk55qE5YC855qE5a6e5L2T5a+56LGhXG4gICAgICAgICAgICBpZiAob3AuaXNQcmVzZW50KCkpIHtcbiAgICAgICAgICAgICAgICBzID0gb3AuZ2V0KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgT3B0aW9uYWw8UGVyc29uPiBuT3AgPSBwZXJzb25SZXBvc2l0b3J5LmZpbmRCeU51bShudW0pOyAvL+afpeivouaYr+WQpuWtmOWcqG51beeahOS6uuWRmFxuICAgICAgICBpZiAobk9wLmlzUHJlc2VudCgpKSB7XG4gICAgICAgICAgICBpZiAocyA9PSBudWxsIHx8ICFzLmdldFBlcnNvbigpLmdldE51bSgpLmVxdWFscyhudW0pKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIENvbW1vbk1ldGhvZC5nZXRSZXR1cm5NZXNzYWdlRXJyb3IoXCLmlrDlrablj7flt7Lnu4/lrZjlnKjvvIzkuI3og73mt7vliqDmiJbkv67mlLnvvIFcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbi4uLlxuICAgIHB1YmxpYyBSZXNwb25zZUVudGl0eTxTdHJlYW1pbmdSZXNwb25zZUJvZHk+IGdldFRlYWNoZXJMaXN0RXhjbChEYXRhUmVxdWVzdCBkYXRhUmVxdWVzdCkge1xuICAgICAgICBTdHJpbmcgbnVtTmFtZSA9IGRhdGFSZXF1ZXN0LmdldFN0cmluZyhcIm51bU5hbWVcIik7XG4gICAgICAgIExpc3Q8TWFwPFN0cmluZyxPYmplY3Q+PiBsaXN0ID0gZ2V0VGVhY2hlck1hcExpc3QobnVtTmFtZSk7IC8vIOWBh+iuvuW3suaUueS4uuiOt+WPluaVmeW4iOaVsOaNrueahOaWueazlVxuXG4gICAgICAgIC8vIOiwg+aVtOWIl+WuvemFjee9ru+8iOagueaNruaVmeW4iOS/oeaBr+eJueeCueiwg+aVtO+8iVxuICAgICAgICBJbnRlZ2VyW10gd2lkdGhzID0gezgsIDE1LCAxMCwgMjAsIDE1LCAxMCwgOCwgMjUsIDE1LCAzMH07XG4gICAgICAgIFN0cmluZ1tdIHRpdGxlcyA9IHtcIuW6j+WPt1wiLCBcIuW3peWPt1wiLCBcIuWnk+WQjVwiLCBcIuWtpumZolwiLCBcIuiBjOensFwiLCBcIuWtpuS9jVwiLCBcIuaAp+WIq1wiLCBcIumCrueusVwiLCBcIueUteivnVwiLCBcIuWcsOWdgFwifTtcbiAgICAgICAgU3RyaW5nIG91dFB1dFNoZWV0TmFtZSA9IFwidGVhY2hlci54bHN4XCI7XG5cbiAgICAgICAgWFNTRldvcmtib29rIHdiID0gbmV3IFhTU0ZXb3JrYm9vaygpO1xuICAgICAgICBYU1NGU2hlZXQgc2hlZXQgPSB3Yi5jcmVhdGVTaGVldChvdXRQdXRTaGVldE5hbWUpO1xuXG4gICAgICAgIC8vIOiuvue9ruWIl+WuvVxuICAgICAgICBmb3IoaW50IGogPSAwOyBqIDwgd2lkdGhzLmxlbmd0aDsgaisrKSB7XG4gICAgICAgICAgICBzaGVldC5zZXRDb2x1bW5XaWR0aChqLCB3aWR0aHNbal0gKiAyNTYpO1xuICAgICAgICB9XG4uLi5cbiAgICBwdWJsaWMgRGF0YVJlc3BvbnNlIGdldFRlYWNoZXJQYWdlRGF0YShEYXRhUmVxdWVzdCBkYXRhUmVxdWVzdCkge1xuICAgICAgICBTdHJpbmcgbnVtTmFtZSA9IGRhdGFSZXF1ZXN0LmdldFN0cmluZyhcIm51bU5hbWVcIik7XG4gICAgICAgIEludGVnZXIgY1BhZ2UgPSBkYXRhUmVxdWVzdC5nZXRDdXJyZW50UGFnZSgpO1xuICAgICAgICBpbnQgZGF0YVRvdGFsID0gMDtcbiAgICAgICAgaW50IHNpemUgPSA0MDtcbiAgICAgICAgTGlzdDxNYXA8U3RyaW5nLE9iamVjdD4+IGRhdGFMaXN0ID0gbmV3IEFycmF5TGlzdDw+KCk7XG4gICAgICAgIFBhZ2U8VGVhY2hlcj4gcGFnZSA9IG51bGw7XG4gICAgICAgIFBhZ2VhYmxlIHBhZ2VhYmxlID0gUGFnZVJlcXVlc3Qub2YoY1BhZ2UsIHNpemUpO1xuICAgICAgICBwYWdlID0gdGVhY2hlclJlcG9zaXRvcnkuZmluZFRlYWNoZXJMaXN0QnlOdW1OYW1lKG51bU5hbWUsIHBhZ2VhYmxlKTtcbiAgICAgICAgTWFwPFN0cmluZyxPYmplY3Q+IG07XG4gICAgICAgIGlmIChwYWdlICE9IG51bGwpIHtcbiAgICAgICAgICAgIGRhdGFUb3RhbCA9IChpbnQpIHBhZ2UuZ2V0VG90YWxFbGVtZW50cygpO1xuICAgICAgICAgICAgTGlzdDxUZWFjaGVyPiBsaXN0ID0gcGFnZS5nZXRDb250ZW50KCk7XG4gICAgICAgICAgICBpZiAoIWxpc3QuaXNFbXB0eSgpKSB7XG4gICAgICAgICAgICAgICAgZm9yIChUZWFjaGVyIHRlYWNoZXIgOiBsaXN0KSB7XG4gICAgICAgICAgICAgICAgICAgIG0gPSBnZXRNYXBGcm9tVGVhY2hlcih0ZWFjaGVyKTtcbiAgICAgICAgICAgICAgICAgICAgZGF0YUxpc3QuYWRkKG0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuLi4uXG4gICAgcHVibGljIERhdGFSZXNwb25zZSBnZXRGYW1pbHlNZW1iZXJMaXN0KERhdGFSZXF1ZXN0IGRhdGFSZXF1ZXN0KSB7XG4gICAgICAgIEludGVnZXIgcGVyc29uSWQgPSBkYXRhUmVxdWVzdC5nZXRJbnRlZ2VyKFwicGVyc29uSWRcIik7XG4gICAgICAgIExpc3Q8RmFtaWx5TWVtYmVyPiBmTGlzdCA9IGZhbWlseU1lbWJlclJlcG9zaXRvcnkuZmluZEJ5VGVhY2hlclBlcnNvbklkKHBlcnNvbklkKTtcbiAgICAgICAgTGlzdDxNYXA8U3RyaW5nLE9iamVjdD4+IGRhdGFMaXN0ID0gbmV3IEFycmF5TGlzdDw+KCk7XG4gICAgICAgIE1hcDxTdHJpbmcsT2JqZWN0PiBtO1xuICAgICAgICBpZiAoZkxpc3QgIT0gbnVsbCkge1xuICAgICAgICAgICAgZm9yIChGYW1pbHlNZW1iZXIgZiA6IGZMaXN0KSB7XG4gICAgICAgICAgICAgICAgbSA9IG5ldyBIYXNoTWFwPD4oKTtcbiAgICAgICAgICAgICAgICBtLnB1dChcIm1lbWJlcklkXCIsIGYuZ2V0TWVtYmVySWQoKSk7XG4gICAgICAgICAgICAgICAgbS5wdXQoXCJwZXJzb25JZFwiLCBmLmdldFRlYWNoZXIoKS5nZXRQZXJzb25JZCgpKTtcbiAgICAgICAgICAgICAgICBtLnB1dChcInJlbGF0aW9uXCIsIGYuZ2V0UmVsYXRpb24oKSk7XG4gICAgICAgICAgICAgICAgbS5wdXQoXCJuYW1lXCIsIGYuZ2V0TmFtZSgpKTtcbiAgICAgICAgICAgICAgICBtLnB1dChcImdlbmRlclwiLCBmLmdldEdlbmRlcigpKTtcbiAgICAgICAgICAgICAgICBtLnB1dChcImFnZVwiLCBmLmdldEFnZSgpK1wiXCIpO1xuICAgICAgICAgICAgICAgIG0ucHV0KFwidW5pdFwiLCBmLmdldFVuaXQoKSk7XG4gICAgICAgICAgICAgICAgZGF0YUxpc3QuYWRkKG0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBDb21tb25NZXRob2QuZ2V0UmV0dXJuRGF0YShkYXRhTGlzdCk7XG4gICAgfVxuICAgIHB1YmxpYyBEYXRhUmVzcG9uc2UgZmFtaWx5TWVtYmVyU2F2ZShEYXRhUmVxdWVzdCBkYXRhUmVxdWVzdCkge1xuICAgICAgICBNYXA8U3RyaW5nLE9iamVjdD4gZm9ybSA9IGRhdGFSZXF1ZXN0LmdldE1hcChcImZvcm1cIik7XG4gICAgICAgIEludGVnZXIgcGVyc29uSWQgPSBDb21tb25NZXRob2QuZ2V0SW50ZWdlcihmb3JtLFwicGVyc29uSWRcIik7XG4gICAgICAgIEludGVnZXIgbWVtYmVySWQgPSBDb21tb25NZXRob2QuZ2V0SW50ZWdlcihmb3JtLFwibWVtYmVySWRcIik7XG4gICAgICAgIE9wdGlvbmFsPEZhbWlseU1lbWJlcj4gb3A7XG4gICAgICAgIEZhbWlseU1lbWJlciBmID0gbnVsbDtcbiAgICAgICAgaWYobWVtYmVySWQgIT0gbnVsbCkge1xuICAgICAgICAgICAgb3AgPSBmYW1pbHlNZW1iZXJSZXBvc2l0b3J5LmZpbmRCeUlkKG1lbWJlcklkKTtcbiAgICAgICAgICAgIGlmKG9wLmlzUHJlc2VudCgpKSB7XG4gICAgICAgICAgICAgICAgZiA9IG9wLmdldCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmKGY9PSBudWxsKSB7XG4gICAgICAgICAgICBmID0gbmV3IEZhbWlseU1lbWJlcigpO1xuICAgICAgICAgICAgYXNzZXJ0IHBlcnNvbklkICE9IG51bGw7XG4gICAgICAgICAgICBmLnNldFN0dWRlbnQodGVhY2hlclJlcG9zaXRvcnkuZmluZEJ5SWQocGVyc29uSWQpLmdldCgpKTtcbiAgICAgICAgfVxuICAgICAgICBmLnNldFJlbGF0aW9uKENvbW1vbk1ldGhvZC5nZXRTdHJpbmcoZm9ybSxcInJlbGF0aW9uXCIpKTtcbiAgICAgICAgZi5zZXROYW1lKENvbW1vbk1ldGhvZC5nZXRTdHJpbmcoZm9ybSxcIm5hbWVcIikpO1xuICAgICAgICBmLnNldEdlbmRlcihDb21tb25NZXRob2QuZ2V0U3RyaW5nKGZvcm0sXCJnZW5kZXJcIikpO1xuICAgICAgICBmLnNldEFnZShDb21tb25NZXRob2QuZ2V0SW50ZWdlcihmb3JtLFwiYWdlXCIpKTtcbiAgICAgICAgZi5zZXRVbml0KENvbW1vbk1ldGhvZC5nZXRTdHJpbmcoZm9ybSxcInVuaXRcIikpO1xuICAgICAgICBmYW1pbHlNZW1iZXJSZXBvc2l0b3J5LnNhdmUoZik7XG4gICAgICAgIHJldHVybiBDb21tb25NZXRob2QuZ2V0UmV0dXJuTWVzc2FnZU9LKCk7XG4gICAgfVxufVxuXG4uLi5cblBhdGg6IHNyYy9tYWluL2phdmEvY24vZWR1L3NkdS9qYXZhL3NlcnZlci9tb2RlbHMvVGVhY2hlci5qYXZhXG5wYWNrYWdlIGNuLmVkdS5zZHUuamF2YS5zZXJ2ZXIubW9kZWxzO1xuXG5pbXBvcnQgY29tLmZhc3RlcnhtbC5qYWNrc29uLmFubm90YXRpb24uSnNvbklnbm9yZTtcbmltcG9ydCBqYWthcnRhLnBlcnNpc3RlbmNlLio7XG5pbXBvcnQgamFrYXJ0YS52YWxpZGF0aW9uLmNvbnN0cmFpbnRzLlNpemU7XG5pbXBvcnQgbG9tYm9rLkdldHRlcjtcbmltcG9ydCBsb21ib2suU2V0dGVyO1xuXG5pbXBvcnQgamF2YS51dGlsLkRhdGU7XG5cbkBHZXR0ZXJcbiAgICBAU2V0dGVyXG4gICAgQEVudGl0eVxuICAgIEBUYWJsZShcdG5hbWUgPSBcInRlYWNoZXJcIixcbiAgICAgICAgICAgIHVuaXF1ZUNvbnN0cmFpbnRzID0ge1xuICAgICAgICAgICAgfSlcbiAgICBwdWJsaWMgY2xhc3MgVGVhY2hlciB7XG4gICAgICAgIEBJZFxuICAgICAgICBwcml2YXRlIEludGVnZXIgcGVyc29uSWQ7XG5cbiAgICAgICAgQE9uZVRvT25lXG4gICAgICAgIEBKb2luQ29sdW1uKG5hbWU9XCJwZXJzb25JZFwiKVxuICAgICAgICBASnNvbklnbm9yZVxuICAgICAgICBwcml2YXRlIFBlcnNvbiBwZXJzb247XG4gICAgICAgIEBTaXplKG1heD01MClcbiAgICAgICAgcHJpdmF0ZSBTdHJpbmcgdGl0bGU7XG4gICAgICAgIEBTaXplKG1heD0zMClcbiAgICAgICAgcHJpdmF0ZSBTdHJpbmcgZGVncmVlO1xuICAgICAgICBwcml2YXRlIERhdGUgZW50ZXJUaW1lO1xuICAgICAgICBwcml2YXRlIEludGVnZXIgc3R1ZGVudE51bTtcbiAgICAgICAgQFNpemUobWF4ID0gNTApXG4gICAgICAgIHByaXZhdGUgU3RyaW5nIGNsYXNzTmFtZTtcblxuXG59XG5cblxuXG5cblxuLi4uXG5QYXRoOiBqYXZhLXNlcnZlci9zcmMvbWFpbi9qYXZhL2NuL2VkdS9zZHUvamF2YS9zZXJ2ZXIvbW9kZWxzL1RlYWNoZXIuamF2YVxucGFja2FnZSBjbi5lZHUuc2R1LmphdmEuc2VydmVyLm1vZGVscztcblxuaW1wb3J0IGNvbS5mYXN0ZXJ4bWwuamFja3Nvbi5hbm5vdGF0aW9uLkpzb25JZ25vcmU7XG5pbXBvcnQgamFrYXJ0YS5wZXJzaXN0ZW5jZS4qO1xuaW1wb3J0IGpha2FydGEudmFsaWRhdGlvbi5jb25zdHJhaW50cy5TaXplO1xuaW1wb3J0IGxvbWJvay5HZXR0ZXI7XG5pbXBvcnQgbG9tYm9rLlNldHRlcjtcblxuaW1wb3J0IGphdmEudXRpbC5EYXRlO1xuXG4vKipcbiAqIFRlYWNoZXLmlZnluIjooajlrp7kvZPnsbsg5L+d5a2Y5q+P5Liq5pWZ5biI55qE5L+h5oGv77yMXG4gKiBJbnRlZ2VyIHBlcnNvbklkIOaVmeW4iOihqCB0ZWFjaGVyIOS4u+mUriBwZXJzb25faWQg5LiOUGVyc29u6KGo5Li76ZSu55u45ZCMXG4gKiBQZXJzb24gcGVyc29uIOWFs+iBlOWIsOivpeeUqOaIt+aJgOeUqOeahFBlcnNvbuWvueixoe+8jOi0puaIt+aJgOWvueW6lOeahOS6uuWRmOS/oeaBryBwZXJzb25faWQg5YWz6IGUIHBlcnNvbiDooajkuLvplK4gcGVyc29uX2lkXG4gKiBTdHJpbmcgdGl0bGUg6IGM56ewXG4gKiBTdHJpbmcgZGVncmVlIOWtpuS9jVxuICogRGF0ZSBlbnRlclRpbWUg5YWl6IGM5pe26Ze0XG4gKiBJbnRlZ2VyIHN0dWRlbnROdW0g5a2m55Sf5pWw6YePXG4gKiBTdHJpbmcgY2xhc3NOYW1lIOePree6p+WQjeensFxuICovXG5AR2V0dGVyXG5AU2V0dGVyXG5ARW50aXR5XG5AVGFibGUobmFtZSA9IFwidGVhY2hlclwiLFxuICAgICAgICB1bmlxdWVDb25zdHJhaW50cyA9IHtcbiAgICAgICAgfSlcbnB1YmxpYyBjbGFzcyBUZWFjaGVyIHtcbiAgICAvKipcbiAgICAgKiDmlZnluIhJRO+8jOS4jlBlcnNvbuihqOeahHBlcnNvbklk55u45ZCMXG4gICAgICovXG4gICAgQElkXG4gICAgcHJpdmF0ZSBJbnRlZ2VyIHBlcnNvbklkO1xuXG4gICAgLyoqXG4gICAgICog5YWz6IGU55qEUGVyc29u5a+56LGh77yM5YyF5ZCr5Z+65pys5Lq65ZGY5L+h5oGvXG4gICAgICovXG4gICAgQE9uZVRvT25lXG4gICAgQEpvaW5Db2x1bW4obmFtZT1cInBlcnNvbklkXCIpXG4gICAgQEpzb25JZ25vcmVcbiAgICBwcml2YXRlIFBlcnNvbiBwZXJzb247XG5cbiAgICAvKipcbiAgICAgKiDogYznp7DvvIzlpoLmlZnmjojjgIHlia/mlZnmjojjgIHorrLluIjnrYlcbiAgICAgKi9cbiAgICBAU2l6ZShtYXg9NTApXG4gICAgcHJpdmF0ZSBTdHJpbmcgdGl0bGU7XG5cbiAgICAvKipcbiAgICAgKiDlrabkvY3vvIzlpoLlrablo6vjgIHnoZXlo6vjgIHljZrlo6vnrYlcbiAgICAgKi9cbiAgICBAU2l6ZShtYXg9MzApXG4gICAgcHJpdmF0ZSBTdHJpbmcgZGVncmVlO1xuXG4gICAgLyoqXG4gICAgICog5YWl6IGM5pe26Ze0XG4gICAgICovXG4gICAgcHJpdmF0ZSBEYXRlIGVudGVyVGltZTtcblxuICAgIC8qKlxuICAgICAqIOaMh+WvvOeahOWtpueUn+aVsOmHj1xuICAgICAqL1xuICAgIHByaXZhdGUgSW50ZWdlciBzdHVkZW50TnVtO1xuXG4gICAgLyoqXG4gICAgICog5omA5pWZ54+t57qn5ZCN56ewXG4gICAgICovXG4gICAgQFNpemUobWF4ID0gNTApXG4gICAgcHJpdmF0ZSBTdHJpbmcgY2xhc3NOYW1lO1xuXG4gICAgLyoqXG4gICAgICog6I635Y+W5pWZ5biI55qE5aeT5ZCN77yI5LuO5YWz6IGU55qEUGVyc29u5a+56LGh5Lit6I635Y+W77yJXG4gICAgICogQHJldHVybiDmlZnluIjlp5PlkI1cbiAgICAgKi9cbiAgICBAVHJhbnNpZW50XG4gICAgcHVibGljIFN0cmluZyBnZXROYW1lKCkge1xuICAgICAgICByZXR1cm4gcGVyc29uICE9IG51bGwgPyBwZXJzb24uZ2V0TmFtZSgpIDogbnVsbDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiDojrflj5bmlZnluIjnmoTlt6Xlj7fvvIjku47lhbPogZTnmoRQZXJzb27lr7nosaHkuK3ojrflj5bvvIlcbiAgICAgKiBAcmV0dXJuIOaVmeW4iOW3peWPt1xuICAgICAqL1xuICAgIEBUcmFuc2llbnRcbiAgICBwdWJsaWMgU3RyaW5nIGdldE51bSgpIHtcbiAgICAgICAgcmV0dXJuIHBlcnNvbiAhPSBudWxsID8gcGVyc29uLmdldE51bSgpIDogbnVsbDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiDojrflj5bmlZnluIjmiYDlsZ7lrabpmaLvvIjku47lhbPogZTnmoRQZXJzb27lr7nosaHkuK3ojrflj5bvvIlcbiAgICAgKiBAcmV0dXJuIOaJgOWxnuWtpumZolxuICAgICAqL1xuICAgIEBUcmFuc2llbnRcbiAgICBwdWJsaWMgU3RyaW5nIGdldERlcHQoKSB7XG4gICAgICAgIHJldHVybiBwZXJzb24gIT0gbnVsbCA/IHBlcnNvbi5nZXREZXB0KCkgOiBudWxsO1xuICAgIH1cbn1cblxuXG5cblxuXG4uLi5cblBhdGg6IHNyYy9tYWluL2phdmEvY24vZWR1L3NkdS9qYXZhL3NlcnZlci9zZXJ2aWNlcy9TdHVkZW50U2VydmljZS5qYXZhXG4uLi5cblxuXG5cbiAgICAvKlxuICAgICAgICBGYW1pbHlNZW1iZXJcbiAgICAgKi9cbiAgICBwdWJsaWMgRGF0YVJlc3BvbnNlIGdldEZhbWlseU1lbWJlckxpc3QoRGF0YVJlcXVlc3QgZGF0YVJlcXVlc3QpIHtcbiAgICAgICAgSW50ZWdlciBwZXJzb25JZCA9IGRhdGFSZXF1ZXN0LmdldEludGVnZXIoXCJwZXJzb25JZFwiKTtcbiAgICAgICAgTGlzdDxGYW1pbHlNZW1iZXI+IGZMaXN0ID0gZmFtaWx5TWVtYmVyUmVwb3NpdG9yeS5maW5kQnlTdHVkZW50UGVyc29uSWQocGVyc29uSWQpO1xuICAgICAgICBMaXN0PE1hcDxTdHJpbmcsT2JqZWN0Pj4gZGF0YUxpc3QgPSBuZXcgQXJyYXlMaXN0PD4oKTtcbiAgICAgICAgTWFwPFN0cmluZyxPYmplY3Q+IG07XG4gICAgICAgIGlmIChmTGlzdCAhPSBudWxsKSB7XG4gICAgICAgICAgICBmb3IgKEZhbWlseU1lbWJlciBmIDogZkxpc3QpIHtcbiAgICAgICAgICAgICAgICBtID0gbmV3IEhhc2hNYXA8PigpO1xuICAgICAgICAgICAgICAgIG0ucHV0KFwibWVtYmVySWRcIiwgZi5nZXRNZW1iZXJJZCgpKTtcbiAgICAgICAgICAgICAgICBtLnB1dChcInBlcnNvbklkXCIsIGYuZ2V0U3R1ZGVudCgpLmdldFBlcnNvbklkKCkpO1xuICAgICAgICAgICAgICAgIG0ucHV0KFwicmVsYXRpb25cIiwgZi5nZXRSZWxhdGlvbigpKTtcbiAgICAgICAgICAgICAgICBtLnB1dChcIm5hbWVcIiwgZi5nZXROYW1lKCkpO1xuICAgICAgICAgICAgICAgIG0ucHV0KFwiZ2VuZGVyXCIsIGYuZ2V0R2VuZGVyKCkpO1xuICAgICAgICAgICAgICAgIG0ucHV0KFwiYWdlXCIsIGYuZ2V0QWdlKCkrXCJcIik7XG4gICAgICAgICAgICAgICAgbS5wdXQoXCJ1bml0XCIsIGYuZ2V0VW5pdCgpKTtcbiAgICAgICAgICAgICAgICBkYXRhTGlzdC5hZGQobSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIENvbW1vbk1ldGhvZC5nZXRSZXR1cm5EYXRhKGRhdGFMaXN0KTtcbiAgICB9XG5cbiAgICBwdWJsaWMgRGF0YVJlc3BvbnNlIGZhbWlseU1lbWJlclNhdmUoRGF0YVJlcXVlc3QgZGF0YVJlcXVlc3QpIHtcbiAgICAgICAgTWFwPFN0cmluZyxPYmplY3Q+IGZvcm0gPSBkYXRhUmVxdWVzdC5nZXRNYXAoXCJmb3JtXCIpO1xuICAgICAgICBJbnRlZ2VyIHBlcnNvbklkID0gQ29tbW9uTWV0aG9kLmdldEludGVnZXIoZm9ybSxcInBlcnNvbklkXCIpO1xuICAgICAgICBJbnRlZ2VyIG1lbWJlcklkID0gQ29tbW9uTWV0aG9kLmdldEludGVnZXIoZm9ybSxcIm1lbWJlcklkXCIpO1xuICAgICAgICBPcHRpb25hbDxGYW1pbHlNZW1iZXI+IG9wO1xuICAgICAgICBGYW1pbHlNZW1iZXIgZiA9IG51bGw7XG4gICAgICAgIGlmKG1lbWJlcklkICE9IG51bGwpIHtcbiAgICAgICAgICAgIG9wID0gZmFtaWx5TWVtYmVyUmVwb3NpdG9yeS5maW5kQnlJZChtZW1iZXJJZCk7XG4gICAgICAgICAgICBpZihvcC5pc1ByZXNlbnQoKSkge1xuICAgICAgICAgICAgICAgIGYgPSBvcC5nZXQoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZihmPT0gbnVsbCkge1xuICAgICAgICAgICAgZiA9IG5ldyBGYW1pbHlNZW1iZXIoKTtcbiAgICAgICAgICAgIGFzc2VydCBwZXJzb25JZCAhPSBudWxsO1xuICAgICAgICAgICAgZi5zZXRTdHVkZW50KHN0dWRlbnRSZXBvc2l0b3J5LmZpbmRCeUlkKHBlcnNvbklkKS5nZXQoKSk7XG4gICAgICAgIH1cbiAgICAgICAgZi5zZXRSZWxhdGlvbihDb21tb25NZXRob2QuZ2V0U3RyaW5nKGZvcm0sXCJyZWxhdGlvblwiKSk7XG4gICAgICAgIGYuc2V0TmFtZShDb21tb25NZXRob2QuZ2V0U3RyaW5nKGZvcm0sXCJuYW1lXCIpKTtcbiAgICAgICAgZi5zZXRHZW5kZXIoQ29tbW9uTWV0aG9kLmdldFN0cmluZyhmb3JtLFwiZ2VuZGVyXCIpKTtcbiAgICAgICAgZi5zZXRBZ2UoQ29tbW9uTWV0aG9kLmdldEludGVnZXIoZm9ybSxcImFnZVwiKSk7XG4gICAgICAgIGYuc2V0VW5pdChDb21tb25NZXRob2QuZ2V0U3RyaW5nKGZvcm0sXCJ1bml0XCIpKTtcbiAgICAgICAgZmFtaWx5TWVtYmVyUmVwb3NpdG9yeS5zYXZlKGYpO1xuICAgICAgICByZXR1cm4gQ29tbW9uTWV0aG9kLmdldFJldHVybk1lc3NhZ2VPSygpO1xuICAgIH1cblxuICAgIHB1YmxpYyBEYXRhUmVzcG9uc2UgZmFtaWx5TWVtYmVyRGVsZXRlKERhdGFSZXF1ZXN0IGRhdGFSZXF1ZXN0KSB7XG4gICAgICAgIEludGVnZXIgbWVtYmVySWQgPSBkYXRhUmVxdWVzdC5nZXRJbnRlZ2VyKFwibWVtYmVySWRcIik7XG4gICAgICAgIE9wdGlvbmFsPEZhbWlseU1lbWJlcj4gb3A7XG4gICAgICAgIG9wID0gZmFtaWx5TWVtYmVyUmVwb3NpdG9yeS5maW5kQnlJZChtZW1iZXJJZCk7XG4gICAgICAgIG9wLmlmUHJlc2VudChmYW1pbHlNZW1iZXJSZXBvc2l0b3J5OjpkZWxldGUpO1xuICAgICAgICByZXR1cm4gQ29tbW9uTWV0aG9kLmdldFJldHVybk1lc3NhZ2VPSygpO1xuICAgIH1cbi4uLlxuUGF0aDogc3JjL21haW4vamF2YS9jbi9lZHUvc2R1L2phdmEvc2VydmVyL3JlcG9zaXRvcnlzL0ZhbWlseU1lbWJlclJlcG9zaXRvcnkuamF2YVxucGFja2FnZSBjbi5lZHUuc2R1LmphdmEuc2VydmVyLnJlcG9zaXRvcnlzO1xuXG5pbXBvcnQgY24uZWR1LnNkdS5qYXZhLnNlcnZlci5tb2RlbHMuRmFtaWx5TWVtYmVyO1xuaW1wb3J0IG9yZy5zcHJpbmdmcmFtZXdvcmsuZGF0YS5qcGEucmVwb3NpdG9yeS5KcGFSZXBvc2l0b3J5O1xuXG5pbXBvcnQgamF2YS51dGlsLkxpc3Q7XG5cbnB1YmxpYyBpbnRlcmZhY2UgRmFtaWx5TWVtYmVyUmVwb3NpdG9yeSBleHRlbmRzIEpwYVJlcG9zaXRvcnk8RmFtaWx5TWVtYmVyLEludGVnZXI+IHtcbiAgICBMaXN0PEZhbWlseU1lbWJlcj4gZmluZEJ5U3R1ZGVudFBlcnNvbklkKEludGVnZXIgcGVyc29uSWQpO1xufVxuLi4uXG5QYXRoOiBqYXZhLXNlcnZlci9zcmMvbWFpbi9qYXZhL2NuL2VkdS9zZHUvamF2YS9zZXJ2ZXIvc2VydmljZXMvVGVhY2hlclNlcnZpY2VzLmphdmFcbi4uLlxuICAgICAgICByZXR1cm4gbTtcbiAgICB9XG5cbiAgICBwdWJsaWMgTGlzdDxNYXA8U3RyaW5nLCBPYmplY3Q+PiBnZXRUZWFjaGVyTWFwTGlzdChTdHJpbmcgbnVtTmFtZSkge1xuICAgICAgICBMaXN0PE1hcDxTdHJpbmcsIE9iamVjdD4+IGRhdGFMaXN0ID0gbmV3IEFycmF5TGlzdDw+KCk7XG4gICAgICAgIExpc3Q8VGVhY2hlcj4gc0xpc3QgPSB0ZWFjaGVyUmVwb3NpdG9yeS5maW5kVGVhY2hlckxpc3RCeU51bU5hbWUobnVtTmFtZSk7ICAvL+aVsOaNruW6k+afpeivouaTjeS9nFxuICAgICAgICBpZiAoc0xpc3QgPT0gbnVsbCB8fCBzTGlzdC5pc0VtcHR5KCkpXG4gICAgICAgICAgICByZXR1cm4gZGF0YUxpc3Q7XG4gICAgICAgIGZvciAoVGVhY2hlciB0ZWFjaGVyIDogc0xpc3QpIHtcbiAgICAgICAgICAgIGRhdGFMaXN0LmFkZChnZXRNYXBGcm9tVGVhY2hlcih0ZWFjaGVyKSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGRhdGFMaXN0O1xuICAgIH1cblxuICAgIHB1YmxpYyBEYXRhUmVzcG9uc2UgZ2V0VGVhY2hlckxpc3QoRGF0YVJlcXVlc3QgZGF0YVJlcXVlc3QpIHtcbiAgICAgICAgU3RyaW5nIG51bU5hbWUgPSBkYXRhUmVxdWVzdC5nZXRTdHJpbmcoXCJudW1OYW1lXCIpO1xuICAgICAgICBMaXN0PE1hcDxTdHJpbmcsIE9iamVjdD4+IGRhdGFMaXN0ID0gZ2V0VGVhY2hlck1hcExpc3QobnVtTmFtZSk7XG4gICAgICAgIHJldHVybiBDb21tb25NZXRob2QuZ2V0UmV0dXJuRGF0YShkYXRhTGlzdCk7ICAvL+aMieeFp+a1i+ivleahhuaetuinhOiMg+S8mumAgU1hcOeahGxpc3RcbiAgICB9XG5cbiAgICBwdWJsaWMgRGF0YVJlc3BvbnNlIHRlYWNoZXJEZWxldGUoRGF0YVJlcXVlc3QgZGF0YVJlcXVlc3QpIHtcbiAgICAgICAgSW50ZWdlciBwZXJzb25JZCA9IGRhdGFSZXF1ZXN0LmdldEludGVnZXIoXCJwZXJzb25JZFwiKTsgIC8v6I635Y+WdGVhY2hlcl9pZOWAvFxuICAgICAgICBUZWFjaGVyIHMgPSBudWxsO1xuICAgICAgICBPcHRpb25hbDxUZWFjaGVyPiBvcDtcbiAgICAgICAgaWYgKHBlcnNvbklkICE9IG51bGwgJiYgcGVyc29uSWQgPiAwKSB7XG4gICAgICAgICAgICBvcCA9IHRlYWNoZXJSZXBvc2l0b3J5LmZpbmRCeUlkKHBlcnNvbklkKTsgICAvL+afpeivouiOt+W+l+WunuS9k+WvueixoVxuICAgICAgICAgICAgaWYgKG9wLmlzUHJlc2VudCgpKSB7XG4gICAgICAgICAgICAgICAgcyA9IG9wLmdldCgpO1xuICAgICAgICAgICAgICAgIE9wdGlvbmFsPFVzZXI+IHVPcCA9IHVzZXJSZXBvc2l0b3J5LmZpbmRCeUlkKHBlcnNvbklkKTsgLy/mn6Xor6Llr7nlupTor6XmlZnluIjnmoTotKbmiLdcbiAgICAgICAgICAgICAgICAvL+WIoOmZpOWvueW6lOivpeaVmeW4iOeahOi0puaIt1xuICAgICAgICAgICAgICAgIHVPcC5pZlByZXNlbnQodXNlclJlcG9zaXRvcnk6OmRlbGV0ZSk7XG4gICAgICAgICAgICAgICAgUGVyc29uIHAgPSBzLmdldFBlcnNvbigpO1xuICAgICAgICAgICAgICAgIHRlYWNoZXJSZXBvc2l0b3J5LmRlbGV0ZShzKTsgICAgLy/pppblhYjmlbDmja7lupPmsLjkuYXliKDpmaTmlZnluIjkv6Hmga9cbiAgICAgICAgICAgICAgICBwZXJzb25SZXBvc2l0b3J5LmRlbGV0ZShwKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gQ29tbW9uTWV0aG9kLmdldFJldHVybk1lc3NhZ2VPSygpOyAgLy/pgJrnn6XliY3nq6/mk43kvZzmraPluLhcbiAgICB9XG5cbiAgICBwdWJsaWMgRGF0YVJlc3BvbnNlIGdldFRlYWNoZXJJbmZvKERhdGFSZXF1ZXN0IGRhdGFSZXF1ZXN0KSB7XG4gICAgICAgIEludGVnZXIgcGVyc29uSWQgPSBkYXRhUmVxdWVzdC5nZXRJbnRlZ2VyKFwicGVyc29uSWRcIik7XG4gICAgICAgIFRlYWNoZXIgcyA9IG51bGw7XG4gICAgICAgIE9wdGlvbmFsPFRlYWNoZXI+IG9wO1xuICAgICAgICBpZiAocGVyc29uSWQgIT0gbnVsbCkge1xuICAgICAgICAgICAgb3AgPSB0ZWFjaGVyUmVwb3NpdG9yeS5maW5kQnlJZChwZXJzb25JZCk7IC8v5qC55o2u5a2m55Sf5Li76ZSu5LuO5pWw5o2u5bqT5p+l6K+i5a2m55Sf55qE5L+h5oGvXG4gICAgICAgICAgICBpZiAob3AuaXNQcmVzZW50KCkpIHtcbiAgICAgICAgICAgICAgICBzID0gb3AuZ2V0KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIENvbW1vbk1ldGhvZC5nZXRSZXR1cm5EYXRhKGdldE1hcEZyb21UZWFjaGVyKHMpKTsgLy/ov5nph4zlm57kvKDljIXlkKvlrabnlJ/kv6Hmga/nmoRNYXDlr7nosaFcbiAgICB9XG4uLi5cblxuICAgIHB1YmxpYyBSZXNwb25zZUVudGl0eTxTdHJlYW1pbmdSZXNwb25zZUJvZHk+IGdldFRlYWNoZXJMaXN0RXhjbChEYXRhUmVxdWVzdCBkYXRhUmVxdWVzdCkge1xuICAgICAgICBTdHJpbmcgbnVtTmFtZSA9IGRhdGFSZXF1ZXN0LmdldFN0cmluZyhcIm51bU5hbWVcIik7XG4gICAgICAgIExpc3Q8TWFwPFN0cmluZywgT2JqZWN0Pj4gbGlzdCA9IGdldFRlYWNoZXJNYXBMaXN0KG51bU5hbWUpO1xuXG4gICAgICAgIC8vIOiwg+aVtOWIl+WuvemFjee9rlxuICAgICAgICBJbnRlZ2VyW10gd2lkdGhzID0gezgsIDE1LCAxMCwgMjAsIDE1LCAxMCwgOCwgMjUsIDE1LCAzMH07XG4gICAgICAgIFN0cmluZ1tdIHRpdGxlcyA9IHtcIuW6j+WPt1wiLCBcIuW3peWPt1wiLCBcIuWnk+WQjVwiLCBcIuWtpumZolwiLCBcIuiBjOensFwiLCBcIuWtpuS9jVwiLCBcIuaAp+WIq1wiLCBcIumCrueusVwiLCBcIueUteivnVwiLCBcIuWcsOWdgFwifTtcbiAgICAgICAgU3RyaW5nIG91dFB1dFNoZWV0TmFtZSA9IFwidGVhY2hlci54bHN4XCI7XG5cbiAgICAgICAgWFNTRldvcmtib29rIHdiID0gbmV3IFhTU0ZXb3JrYm9vaygpO1xuICAgICAgICBYU1NGU2hlZXQgc2hlZXQgPSB3Yi5jcmVhdGVTaGVldChvdXRQdXRTaGVldE5hbWUpO1xuXG4gICAgICAgIC8vIOiuvue9ruWIl+WuvVxuICAgICAgICBmb3IgKGludCBqID0gMDsgaiA8IHdpZHRocy5sZW5ndGg7IGorKykge1xuICAgICAgICAgICAgc2hlZXQuc2V0Q29sdW1uV2lkdGgoaiwgd2lkdGhzW2pdICogMjU2KTtcbiAgICAgICAgfVxuLi4uXG5cbiAgICBwdWJsaWMgRGF0YVJlc3BvbnNlIGdldFRlYWNoZXJQYWdlRGF0YShEYXRhUmVxdWVzdCBkYXRhUmVxdWVzdCkge1xuICAgICAgICBTdHJpbmcgbnVtTmFtZSA9IGRhdGFSZXF1ZXN0LmdldFN0cmluZyhcIm51bU5hbWVcIik7XG4gICAgICAgIEludGVnZXIgY1BhZ2UgPSBkYXRhUmVxdWVzdC5nZXRDdXJyZW50UGFnZSgpO1xuICAgICAgICBpbnQgZGF0YVRvdGFsID0gMDtcbiAgICAgICAgaW50IHNpemUgPSA0MDtcbiAgICAgICAgTGlzdDxNYXA8U3RyaW5nLCBPYmplY3Q+PiBkYXRhTGlzdCA9IG5ldyBBcnJheUxpc3Q8PigpO1xuICAgICAgICBQYWdlPFRlYWNoZXI+IHBhZ2UgPSBudWxsO1xuICAgICAgICBQYWdlYWJsZSBwYWdlYWJsZSA9IFBhZ2VSZXF1ZXN0Lm9mKGNQYWdlLCBzaXplKTtcbiAgICAgICAgcGFnZSA9IHRlYWNoZXJSZXBvc2l0b3J5LmZpbmRUZWFjaGVyTGlzdEJ5TnVtTmFtZShudW1OYW1lLCBwYWdlYWJsZSk7XG4gICAgICAgIE1hcDxTdHJpbmcsIE9iamVjdD4gbTtcbiAgICAgICAgaWYgKHBhZ2UgIT0gbnVsbCkge1xuICAgICAgICAgICAgZGF0YVRvdGFsID0gKGludCkgcGFnZS5nZXRUb3RhbEVsZW1lbnRzKCk7XG4gICAgICAgICAgICBMaXN0PFRlYWNoZXI+IGxpc3QgPSBwYWdlLmdldENvbnRlbnQoKTtcbiAgICAgICAgICAgIGlmICghbGlzdC5pc0VtcHR5KCkpIHtcbiAgICAgICAgICAgICAgICBmb3IgKFRlYWNoZXIgdGVhY2hlciA6IGxpc3QpIHtcbiAgICAgICAgICAgICAgICAgICAgbSA9IGdldE1hcEZyb21UZWFjaGVyKHRlYWNoZXIpO1xuICAgICAgICAgICAgICAgICAgICBkYXRhTGlzdC5hZGQobSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4uLi5cblBhdGg6IGphdmEtc2VydmVyL3NyYy9tYWluL2phdmEvY24vZWR1L3NkdS9qYXZhL3NlcnZlci9yZXBvc2l0b3J5cy9UZWFjaGVyUmVwb3NpdG9yeS5qYXZhXG4uLi5cblxuQFJlcG9zaXRvcnlcbnB1YmxpYyBpbnRlcmZhY2UgVGVhY2hlclJlcG9zaXRvcnkgZXh0ZW5kcyBKcGFSZXBvc2l0b3J5PFRlYWNoZXIsIEludGVnZXI+IHtcblxuICAgIC8vIOagueaNruW3peWPt+aIluWnk+WQjeaooeeziuafpeivouaVmeW4iOWIl+ihqO+8iOWIhumhte+8iVxuICAgIEBRdWVyeShcIlNFTEVDVCB0IEZST00gVGVhY2hlciB0IEpPSU4gdC5wZXJzb24gcCBcIiArXG4gICAgICAgICAgICBcIldIRVJFICg6bnVtTmFtZSBJUyBOVUxMIE9SIDpudW1OYW1lID0gJycgT1IgXCIgK1xuICAgICAgICAgICAgXCJwLm51bSBMSUtFICU6bnVtTmFtZSUgT1IgcC5uYW1lIExJS0UgJTpudW1OYW1lJSlcIilcbiAgICBQYWdlPFRlYWNoZXI+IGZpbmRUZWFjaGVyTGlzdEJ5TnVtTmFtZShAUGFyYW0oXCJudW1OYW1lXCIpIFN0cmluZyBudW1OYW1lLCBQYWdlYWJsZSBwYWdlYWJsZSk7XG5cbiAgICAvLyDmoLnmja7lt6Xlj7fmiJblp5PlkI3mqKHns4rmn6Xor6LmlZnluIjliJfooajvvIjkuI3liIbpobXvvIlcbiAgICBAUXVlcnkoXCJTRUxFQ1QgdCBGUk9NIFRlYWNoZXIgdCBKT0lOIHQucGVyc29uIHAgXCIgK1xuICAgICAgICAgICAgXCJXSEVSRSAoOm51bU5hbWUgSVMgTlVMTCBPUiA6bnVtTmFtZSA9ICcnIE9SIFwiICtcbiAgICAgICAgICAgIFwicC5udW0gTElLRSAlOm51bU5hbWUlIE9SIHAubmFtZSBMSUtFICU6bnVtTmFtZSUpXCIpXG4gICAgTGlzdDxUZWFjaGVyPiBmaW5kVGVhY2hlckxpc3RCeU51bU5hbWUoQFBhcmFtKFwibnVtTmFtZVwiKSBTdHJpbmcgbnVtTmFtZSk7XG5cbiAgICAvLyDmoLnmja5wZXJzb25JZOafpeivouaVmeW4iOS/oeaBr1xuICAgIE9wdGlvbmFsPFRlYWNoZXI+IGZpbmRCeVBlcnNvbklkKEludGVnZXIgcGVyc29uSWQpO1xuXG4gICAgLy8g5qC55o2u5Lq65ZGY57yW5Y+35p+l6K+i5pWZ5biI5L+h5oGvXG4gICAgQFF1ZXJ5KFwiU0VMRUNUIHQgRlJPTSBUZWFjaGVyIHQgSk9JTiB0LnBlcnNvbiBwIFdIRVJFIHAubnVtID0gOm51bVwiKVxuICAgIE9wdGlvbmFsPFRlYWNoZXI+IGZpbmRCeVBlcnNvbk51bShAUGFyYW0oXCJudW1cIikgU3RyaW5nIG51bSk7XG5cbiAgICAvLyDnu5/orqHmlZnluIjmlbDph49cbiAgICBAUXVlcnkoXCJTRUxFQ1QgQ09VTlQodCkgRlJPTSBUZWFjaGVyIHRcIilcbiAgICBsb25nIGNvdW50QWxsVGVhY2hlcnMoKTtcblxuICAgIC8vIOaMieWtpumZoue7n+iuoeaVmeW4iOaVsOmHj1xuICAgIEBRdWVyeShcIlNFTEVDVCBDT1VOVCh0KSBGUk9NIFRlYWNoZXIgdCBKT0lOIHQucGVyc29uIHAgV0hFUkUgcC5kZXB0ID0gOmRlcHRcIilcbiAgICBsb25nIGNvdW50QnlEZXBhcnRtZW50KEBQYXJhbShcImRlcHRcIikgU3RyaW5nIGRlcHQpO1xuXG4gICAgLy8g6I635Y+W5p+Q5Liq5a2m6Zmi55qE5omA5pyJ5pWZ5biIXG4gICAgQFF1ZXJ5KFwiU0VMRUNUIHQgRlJPTSBUZWFjaGVyIHQgSk9JTiB0LnBlcnNvbiBwIFdIRVJFIHAuZGVwdCA9IDpkZXB0XCIpXG4gICAgTGlzdDxUZWFjaGVyPiBmaW5kQnlEZXBhcnRtZW50KEBQYXJhbShcImRlcHRcIikgU3RyaW5nIGRlcHQpO1xufS4uLlxuUGF0aDogc3JjL21haW4vamF2YS9jbi9lZHUvc2R1L2phdmEvc2VydmVyL21vZGVscy9TdHVkZW50LmphdmFcbnBhY2thZ2UgY24uZWR1LnNkdS5qYXZhLnNlcnZlci5tb2RlbHM7XG5cbmltcG9ydCBjb20uZmFzdGVyeG1sLmphY2tzb24uYW5ub3RhdGlvbi5Kc29uSWdub3JlO1xuXG5pbXBvcnQgamFrYXJ0YS5wZXJzaXN0ZW5jZS4qO1xuaW1wb3J0IGpha2FydGEudmFsaWRhdGlvbi5jb25zdHJhaW50cy5TaXplO1xuXG5cbi8qKlxuICogU3R1ZGVudOWtpueUn+ihqOWunuS9k+exuyDkv53lrZjmr4/kuKrlrabnlJ/nmoTkv6Hmga/vvIxcbiAqIEludGVnZXIgcGVyc29uSWQg5a2m55Sf6KGoIHN0dWRlbnQg5Li76ZSuIHBlcnNvbl9pZCDkuI5QZXJzb27ooajkuLvplK7nm7jlkIxcbiAqIFBlcnNvbiBwZXJzb24g5YWz6IGU5Yiw6K+l55So5oi35omA55So55qEUGVyc29u5a+56LGh77yM6LSm5oi35omA5a+55bqU55qE5Lq65ZGY5L+h5oGvIHBlcnNvbl9pZCDlhbPogZQgcGVyc29uIOihqOS4u+mUriBwZXJzb25faWRcbiAqIFN0cmluZyBtYWpvciDkuJPkuJpcbiAqIFN0cmluZyBjbGFzc05hbWUg54+t57qnXG4gKlxuICovXG5pbXBvcnQgbG9tYm9rLkdldHRlcjtcbmltcG9ydCBsb21ib2suU2V0dGVyO1xuQEdldHRlclxuQFNldHRlclxuQEVudGl0eVxuQFRhYmxlKFx0bmFtZSA9IFwic3R1ZGVudFwiLFxuICAgICAgICB1bmlxdWVDb25zdHJhaW50cyA9IHtcbiAgICAgICAgfSlcbnB1YmxpYyBjbGFzcyBTdHVkZW50IHtcbiAgICBASWRcbiAgICBwcml2YXRlIEludGVnZXIgcGVyc29uSWQ7XG5cbiAgICBAT25lVG9PbmVcbiAgICBASm9pbkNvbHVtbihuYW1lPVwicGVyc29uSWRcIilcbiAgICBASnNvbklnbm9yZVxuICAgIHByaXZhdGUgUGVyc29uIHBlcnNvbjtcblxuICAgIEBTaXplKG1heCA9IDIwKVxuICAgIHByaXZhdGUgU3RyaW5nIG1ham9yO1xuXG4gICAgQFNpemUobWF4ID0gNTApXG4gICAgcHJpdmF0ZSBTdHJpbmcgY2xhc3NOYW1lO1xuXG59XG4uLi5cblBhdGg6IHNyYy9tYWluL2phdmEvY24vZWR1L3NkdS9qYXZhL3NlcnZlci9yZXBvc2l0b3J5cy9NZW51SW5mb1JlcG9zaXRvcnkuamF2YVxuLi4uXG5cbmltcG9ydCBqYXZhLnV0aWwuTGlzdDtcbi8qXG4gKiBNZW51SW5mbyDmlbDmja7mk43kvZzmjqXlj6PvvIzkuLvopoHlrp7njrBNZW51SW5mb+aVsOaNrueahOafpeivouaTjeS9nFxuICogSW50ZWdlciBnZXRNYXhJZCgpICBtZW51IOihqOS4reeahOacgOWkp+eahG1lbnVfaWQ7ICAgIEpQUUwg5rOo6KejXG4gKiBPcHRpb25hbDxQZXJzb24+IGZpbmRCeU51bShTdHJpbmcgbnVtKTsgIOagueaNrm51beafpeivouiOt+W+l09wdGlvbjxQZXJzb24+5a+56LGhLCAg5ZG95ZCN6KeE6IyDXG4gKiBMaXN0PE1lbnVJbmZvPiBmaW5kQnlVc2VyVHlwZUlkKEludGVnZXIgdXNlclR5cGVJZCk7IOagueaNrnVzZXJUeXBlSWTmn6Xor6LojrflvpdwaWTkuLrnqbrnmoQg6I+c5Y2VTGlzdDxNZW51SW5mbz7pm4blkIgg5p+l6K+i55u45bqU6KeS6Imy55qE5omA5pyJ6Lef6I+c5Y2VIEpQUUwg5rOo6KejXG4gKiBMaXN0PE1lbnVJbmZvPiBmaW5kQnlVc2VyVHlwZUlkQW5kUGlkKEludGVnZXIgdXNlclR5cGVJZCwgSW50ZWdlciBwaWQpO+agueaNrnVzZXJUeXBlSWTlkoxwaWTmn6Xor6LojrflvpdwaWTnmoTmiYDmnInlrZDoj5zljZVMaXN0PE1lbnVJbmZvPumbhuWQiCDlkb3lkI3op4TojINcbiAqLi4uIiwiaXNfZXJyb3IiOmZhbHNlLCJyZXF1ZXN0X2lkIjoiIiwidG9vbF91c2VfaWQiOiJ0b29sdV92cnR4XzAxRXRIcFpFa1I5amlDMXFONUZDVmFzWCJ9fSx7ImlkIjoyLCJ0eXBlIjo0LCJpZGVfc3RhdGVfbm9kZSI6eyJ3b3Jrc3BhY2VGb2xkZXJzIjpbeyJyZXBvc2l0b3J5Um9vdCI6IkM6L1VzZXJzL3ByaW5jaXAvRG9jdW1lbnRzL0dpdEh1Yi9iYWljYWkvamF2YS1zZXJ2ZXIiLCJmb2xkZXJSb290IjoiQzovVXNlcnMvcHJpbmNpcC9Eb2N1bWVudHMvR2l0SHViL2JhaWNhaS9qYXZhLXNlcnZlciJ9XSwid29ya3NwYWNlRm9sZGVyc1VuY2hhbmdlZCI6ZmFsc2V9fV0sInRpbWVzdGFtcCI6IjIwMjUtMDUtMTZUMTU6MTQ6MzkuNDczWiIsInJlc3BvbnNlX3RleHQiOiLnjrDlnKjmiJHkuobop6Pkuobpl67popjmiYDlnKjjgILmiJHlsIbkv67mlLkgYFRlYWNoZXJTZXJ2aWNlcy5qYXZhYCDmlofku7bkuK3nmoQgYGZhbWlseU1lbWJlclNhdmVgIOaWueazle+8jOino+WGs+exu+Wei+i9rOaNoumXrumimOOAglxuIiwid29ya3NwYWNlX2ZpbGVfY2h1bmtzIjpbXX0seyJzdGF0dXMiOiJzdWNjZXNzIiwicmVxdWVzdF9pZCI6IjNmZWRhOWI5LTYwOGItNDk0NS1iMTAzLWM1NTEyMTlmNmY5YiIsInJlcXVlc3RfbWVzc2FnZSI6IiIsInN0cnVjdHVyZWRfb3V0cHV0X25vZGVzIjpbeyJpZCI6MSwidHlwZSI6NSwiY29udGVudCI6IiIsInRvb2xfdXNlIjp7InRvb2xfdXNlX2lkIjoidG9vbHVfdnJ0eF8wMVFxdTVvYlBlWW1VVXFmRjVhQ1M3R3YiLCJ0b29sX25hbWUiOiJjb2RlYmFzZS1yZXRyaWV2YWwiLCJpbnB1dF9qc29uIjoie1wiaW5mb3JtYXRpb25fcmVxdWVzdFwiOiBcIlxcdTgzYjdcXHU1M2Q2IGphdmEtc2VydmVyL3NyYy9tYWluL2phdmEvY24vZWR1L3NkdS9qYXZhL3NlcnZlci9zZXJ2aWNlcy9UZWFjaGVyU2VydmljZXMuamF2YSBcXHU2NTg3XFx1NGVmNlxcdTc2ODRcXHU1YjhjXFx1NjU3NFxcdTUxODVcXHU1YmI5XCJ9IiwibWNwX3NlcnZlcl9uYW1lIjoiIiwibWNwX3Rvb2xfbmFtZSI6IiJ9fSx7ImlkIjowLCJ0eXBlIjowLCJjb250ZW50Ijoi6K6p5oiR5bCd6K+V5L2/55So5Luj56CB5bqT5qOA57Si5bel5YW35p2l6I635Y+W5a6M5pW055qEIGBUZWFjaGVyU2VydmljZXMuamF2YWAg5paH5Lu277yaXG4ifSx7ImlkIjoyLCJ0eXBlIjoyLCJjb250ZW50IjoiIn0seyJpZCI6MywidHlwZSI6MywiY29udGVudCI6IiJ9XSwic2Vlbl9zdGF0ZSI6InNlZW4iLCJzdHJ1Y3R1cmVkX3JlcXVlc3Rfbm9kZXMiOlt7ImlkIjoxLCJ0eXBlIjoxLCJ0b29sX3Jlc3VsdF9ub2RlIjp7ImNvbnRlbnQiOiJSYW4gaW50byBVbmtub3duIGVycm9yIHdoaWxlIHRyeWluZyB0byByZWFkIGphdmEtc2VydmVyL3NyYy9tYWluL2phdmEvY24vZWR1L3NkdS9qYXZhL3NlcnZlci9zZXJ2aWNlcy9UZWFjaGVyU2VydmljZXMuamF2YSIsImlzX2Vycm9yIjp0cnVlLCJyZXF1ZXN0X2lkIjoiIiwidG9vbF91c2VfaWQiOiJ0b29sdV92cnR4XzAxQmZ6cUY2eThFR0prMUhIMjNLVHROdCJ9fSx7ImlkIjoyLCJ0eXBlIjo0LCJpZGVfc3RhdGVfbm9kZSI6eyJ3b3Jrc3BhY2VGb2xkZXJzIjpbeyJyZXBvc2l0b3J5Um9vdCI6IkM6L1VzZXJzL3ByaW5jaXAvRG9jdW1lbnRzL0dpdEh1Yi9iYWljYWkvamF2YS1zZXJ2ZXIiLCJmb2xkZXJSb290IjoiQzovVXNlcnMvcHJpbmNpcC9Eb2N1bWVudHMvR2l0SHViL2JhaWNhaS9qYXZhLXNlcnZlciJ9XSwid29ya3NwYWNlRm9sZGVyc1VuY2hhbmdlZCI6ZmFsc2V9fV0sInRpbWVzdGFtcCI6IjIwMjUtMDUtMTZUMTU6MTQ6NDUuMDg4WiIsInJlc3BvbnNlX3RleHQiOiLorqnmiJHlsJ3or5Xkvb/nlKjku6PnoIHlupPmo4DntKLlt6XlhbfmnaXojrflj5blrozmlbTnmoQgYFRlYWNoZXJTZXJ2aWNlcy5qYXZhYCDmlofku7bvvJpcbiIsIndvcmtzcGFjZV9maWxlX2NodW5rcyI6W119LHsic3RhdHVzIjoic3VjY2VzcyIsInJlcXVlc3RfaWQiOiIwNjQ3NTJmYi0yYjg4LTRlMWEtOTgzMS00ZWY4OGFiYWYwYjciLCJyZXF1ZXN0X21lc3NhZ2UiOiIiLCJzdHJ1Y3R1cmVkX291dHB1dF9ub2RlcyI6W3siaWQiOjEsInR5cGUiOjUsImNvbnRlbnQiOiIiLCJ0b29sX3VzZSI6eyJ0b29sX3VzZV9pZCI6InRvb2x1X3ZydHhfMDFINXNiVUVHNkN1SFdReTlkRlJGUFlWIiwidG9vbF9uYW1lIjoiY29kZWJhc2UtcmV0cmlldmFsIiwiaW5wdXRfanNvbiI6IntcImluZm9ybWF0aW9uX3JlcXVlc3RcIjogXCJcXHU2N2U1XFx1NjI3ZSBUZWFjaGVyU2VydmljZXMuamF2YSBcXHU2NTg3XFx1NGVmNlxcdTRlMmRcXHU3Njg0IGZhbWlseU1lbWJlclNhdmUgXFx1NjViOVxcdTZjZDVcXHU3Njg0XFx1NWI4Y1xcdTY1NzRcXHU1YjllXFx1NzNiMFwifSIsIm1jcF9zZXJ2ZXJfbmFtZSI6IiIsIm1jcF90b29sX25hbWUiOiIifX0seyJpZCI6MCwidHlwZSI6MCwiY29udGVudCI6IuaIkemcgOimgeafpeeciyBgZmFtaWx5TWVtYmVyU2F2ZWAg5pa55rOV55qE5a6M5pW05a6e546w77yaXG4ifSx7ImlkIjoyLCJ0eXBlIjoyLCJjb250ZW50IjoiIn0seyJpZCI6MywidHlwZSI6MywiY29udGVudCI6IiJ9XSwic2Vlbl9zdGF0ZSI6InNlZW4iLCJzdHJ1Y3R1cmVkX3JlcXVlc3Rfbm9kZXMiOlt7ImlkIjoxLCJ0eXBlIjoxLCJ0b29sX3Jlc3VsdF9ub2RlIjp7ImNvbnRlbnQiOiJUaGUgZm9sbG93aW5nIGNvZGUgc2VjdGlvbnMgd2VyZSByZXRyaWV2ZWQ6XG5QYXRoOiBqYXZhLXNlcnZlci9zcmMvbWFpbi9qYXZhL2NuL2VkdS9zZHUvamF2YS9zZXJ2ZXIvc2VydmljZXMvVGVhY2hlclNlcnZpY2VzLmphdmFcbnBhY2thZ2UgY24uZWR1LnNkdS5qYXZhLnNlcnZlci5zZXJ2aWNlcztcblxuaW1wb3J0IGNuLmVkdS5zZHUuamF2YS5zZXJ2ZXIubW9kZWxzLio7XG5pbXBvcnQgY24uZWR1LnNkdS5qYXZhLnNlcnZlci5tb2RlbHMuVGVhY2hlcjtcbmltcG9ydCBjbi5lZHUuc2R1LmphdmEuc2VydmVyLnBheWxvYWQucmVxdWVzdC5EYXRhUmVxdWVzdDtcbmltcG9ydCBjbi5lZHUuc2R1LmphdmEuc2VydmVyLnBheWxvYWQucmVzcG9uc2UuRGF0YVJlc3BvbnNlO1xuaW1wb3J0IGNuLmVkdS5zZHUuamF2YS5zZXJ2ZXIucmVwb3NpdG9yeXMuKjtcbmltcG9ydCBjbi5lZHUuc2R1LmphdmEuc2VydmVyLnV0aWwuQ29tRGF0YVV0aWw7XG5pbXBvcnQgY24uZWR1LnNkdS5qYXZhLnNlcnZlci51dGlsLkNvbW1vbk1ldGhvZDtcbmltcG9ydCBjbi5lZHUuc2R1LmphdmEuc2VydmVyLnV0aWwuRGF0ZVRpbWVUb29sO1xuaW1wb3J0IG9yZy5hcGFjaGUucG9pLnhzc2YudXNlcm1vZGVsLio7XG5pbXBvcnQgb3JnLnNsZjRqLkxvZ2dlcjtcbmltcG9ydCBvcmcuc2xmNGouTG9nZ2VyRmFjdG9yeTtcbmltcG9ydCBvcmcuc3ByaW5nZnJhbWV3b3JrLmRhdGEuZG9tYWluLlBhZ2U7XG5pbXBvcnQgb3JnLnNwcmluZ2ZyYW1ld29yay5kYXRhLmRvbWFpbi5QYWdlUmVxdWVzdDtcbmltcG9ydCBvcmcuc3ByaW5nZnJhbWV3b3JrLmRhdGEuZG9tYWluLlBhZ2VhYmxlO1xuaW1wb3J0IG9yZy5zcHJpbmdmcmFtZXdvcmsuaHR0cC5SZXNwb25zZUVudGl0eTtcbmltcG9ydCBvcmcuc3ByaW5nZnJhbWV3b3JrLnNlY3VyaXR5LmNyeXB0by5wYXNzd29yZC5QYXNzd29yZEVuY29kZXI7XG5pbXBvcnQgb3JnLnNwcmluZ2ZyYW1ld29yay5zdGVyZW90eXBlLlNlcnZpY2U7XG5pbXBvcnQgb3JnLnNwcmluZ2ZyYW1ld29yay53ZWIuc2VydmxldC5tdmMubWV0aG9kLmFubm90YXRpb24uU3RyZWFtaW5nUmVzcG9uc2VCb2R5O1xuXG5pbXBvcnQgamF2YS51dGlsLio7XG5cbkBTZXJ2aWNlXG5wdWJsaWMgY2xhc3MgVGVhY2hlclNlcnZpY2VzIHtcbiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBMb2dnZXIgbG9nID0gTG9nZ2VyRmFjdG9yeS5nZXRMb2dnZXIoVGVhY2hlclNlcnZpY2VzLmNsYXNzKTtcbiAgICBwcml2YXRlIGZpbmFsIFBlcnNvblJlcG9zaXRvcnkgcGVyc29uUmVwb3NpdG9yeTsgIC8v5Lq65ZGY5pWw5o2u5pON5L2c6Ieq5Yqo5rOo5YWlXG4gICAgcHJpdmF0ZSBmaW5hbCBUZWFjaGVyUmVwb3NpdG9yeSB0ZWFjaGVyUmVwb3NpdG9yeTsgIC8v5pWZ5biI5pWw5o2u5pON5L2c6Ieq5Yqo5rOo5YWlXG4gICAgcHJpdmF0ZSBmaW5hbCBVc2VyUmVwb3NpdG9yeSB1c2VyUmVwb3NpdG9yeTsgIC8v5pWw5o2u5pON5L2c6Ieq5Yqo5rOo5YWlXG4gICAgcHJpdmF0ZSBmaW5hbCBVc2VyVHlwZVJlcG9zaXRvcnkgdXNlclR5cGVSZXBvc2l0b3J5OyAvL+eUqOaIt+exu+Wei+aVsOaNruaTjeS9nOiHquWKqOazqOWFpVxuICAgIHByaXZhdGUgZmluYWwgUGFzc3dvcmRFbmNvZGVyIGVuY29kZXI7ICAvL+WvhueggeacjeWKoeiHquWKqOazqOWFpVxuICAgIC8v5raI6LS55pWw5o2u5pON5L2c6Ieq5Yqo5rOo5YWlXG4gICAgcHJpdmF0ZSBmaW5hbCBGYW1pbHlNZW1iZXJSZXBvc2l0b3J5IGZhbWlseU1lbWJlclJlcG9zaXRvcnk7XG4gICAgcHJpdmF0ZSBmaW5hbCBTeXN0ZW1TZXJ2aWNlIHN5c3RlbVNlcnZpY2U7XG5cbiAgICBwdWJsaWMgVGVhY2hlclNlcnZpY2VzKFBlcnNvblJlcG9zaXRvcnkgcGVyc29uUmVwb3NpdG9yeSwgVGVhY2hlclJlcG9zaXRvcnkgdGVhY2hlclJlcG9zaXRvcnksIFVzZXJSZXBvc2l0b3J5IHVzZXJSZXBvc2l0b3J5LCBVc2VyVHlwZVJlcG9zaXRvcnkgdXNlclR5cGVSZXBvc2l0b3J5LCBQYXNzd29yZEVuY29kZXIgZW5jb2RlciwgRmVlUmVwb3NpdG9yeSBmZWVSZXBvc2l0b3J5LCBGYW1pbHlNZW1iZXJSZXBvc2l0b3J5IGZhbWlseU1lbWJlclJlcG9zaXRvcnksIFN5c3RlbVNlcnZpY2Ugc3lzdGVtU2VydmljZSkge1xuICAgICAgICB0aGlzLnBlcnNvblJlcG9zaXRvcnkgPSBwZXJzb25SZXBvc2l0b3J5O1xuICAgICAgICB0aGlzLnRlYWNoZXJSZXBvc2l0b3J5ID0gdGVhY2hlclJlcG9zaXRvcnk7XG4gICAgICAgIHRoaXMudXNlclJlcG9zaXRvcnkgPSB1c2VyUmVwb3NpdG9yeTtcbiAgICAgICAgdGhpcy51c2VyVHlwZVJlcG9zaXRvcnkgPSB1c2VyVHlwZVJlcG9zaXRvcnk7XG4gICAgICAgIHRoaXMuZW5jb2RlciA9IGVuY29kZXI7XG4gICAgICAgIHRoaXMuZmFtaWx5TWVtYmVyUmVwb3NpdG9yeSA9IGZhbWlseU1lbWJlclJlcG9zaXRvcnk7XG4gICAgICAgIHRoaXMuc3lzdGVtU2VydmljZSA9IHN5c3RlbVNlcnZpY2U7XG4gICAgfVxuXG4gICAgcHVibGljIE1hcDxTdHJpbmcsIE9iamVjdD4gZ2V0TWFwRnJvbVRlYWNoZXIoVGVhY2hlciBzKSB7XG4gICAgICAgIE1hcDxTdHJpbmcsIE9iamVjdD4gbSA9IG5ldyBIYXNoTWFwPD4oKTtcbiAgICAgICAgUGVyc29uIHA7XG4gICAgICAgIGlmIChzID09IG51bGwpXG4gICAgICAgICAgICByZXR1cm4gbTtcbiAgICAgICAgbS5wdXQoXCJ0aXRsZVwiLCBzLmdldFRpdGxlKCkpO1xuICAgICAgICBtLnB1dChcImRlZ3JlZVwiLCBzLmdldERlZ3JlZSgpKTtcbiAgICAgICAgbS5wdXQoXCJjbGFzc05hbWVcIiwgcy5nZXRDbGFzc05hbWUoKSk7XG4gICAgICAgIHAgPSBzLmdldFBlcnNvbigpO1xuICAgICAgICBpZiAocCA9PSBudWxsKVxuICAgICAgICAgICAgcmV0dXJuIG07XG4gICAgICAgIG0ucHV0KFwicGVyc29uSWRcIiwgcy5nZXRQZXJzb25JZCgpKTtcbiAgICAgICAgbS5wdXQoXCJudW1cIiwgcC5nZXROdW0oKSk7XG4gICAgICAgIG0ucHV0KFwibmFtZVwiLCBwLmdldE5hbWUoKSk7XG4gICAgICAgIG0ucHV0KFwiZGVwdFwiLCBwLmdldERlcHQoKSk7XG4gICAgICAgIG0ucHV0KFwiY2FyZFwiLCBwLmdldENhcmQoKSk7XG4gICAgICAgIFN0cmluZyBnZW5kZXIgPSBwLmdldEdlbmRlcigpO1xuICAgICAgICBtLnB1dChcImdlbmRlclwiLCBnZW5kZXIpO1xuICAgICAgICBtLnB1dChcImdlbmRlck5hbWVcIiwgQ29tRGF0YVV0aWwuZ2V0SW5zdGFuY2UoKS5nZXREaWN0aW9uYXJ5TGFiZWxCeVZhbHVlKFwiWEJNXCIsIGdlbmRlcikpOyAvL+aAp+WIq+exu+Wei+eahOWAvOi9rOaNouaIkOaVsOaNruexu+Wei+WQjVxuICAgICAgICBtLnB1dChcImJpcnRoZGF5XCIsIHAuZ2V0QmlydGhkYXkoKSk7ICAvL+aXtumXtOagvOW8j+i9rOaNouWtl+espuS4slxuICAgICAgICBtLnB1dChcImVtYWlsXCIsIHAuZ2V0RW1haWwoKSk7XG4gICAgICAgIG0ucHV0KFwicGhvbmVcIiwgcC5nZXRQaG9uZSgpKTtcbiAgICAgICAgbS5wdXQoXCJhZGRyZXNzXCIsIHAuZ2V0QWRkcmVzcygpKTtcbiAgICAgICAgbS5wdXQoXCJpbnRyb2R1Y2VcIiwgcC5nZXRJbnRyb2R1Y2UoKSk7XG4gICAgICAgIHJldHVybiBtO1xuICAgIH1cblxuICAgIHB1YmxpYyBMaXN0PE1hcDxTdHJpbmcsIE9iamVjdD4+IGdldFRlYWNoZXJNYXBMaXN0KFN0cmluZyBudW1OYW1lKSB7XG4gICAgICAgIExpc3Q8TWFwPFN0cmluZywgT2JqZWN0Pj4gZGF0YUxpc3QgPSBuZXcgQXJyYXlMaXN0PD4oKTtcbiAgICAgICAgTGlzdDxUZWFjaGVyPiBzTGlzdCA9IHRlYWNoZXJSZXBvc2l0b3J5LmZpbmRUZWFjaGVyTGlzdEJ5TnVtTmFtZShudW1OYW1lKTsgIC8v5pWw5o2u5bqT5p+l6K+i5pON5L2cXG4gICAgICAgIGlmIChzTGlzdCA9PSBudWxsIHx8IHNMaXN0LmlzRW1wdHkoKSlcbiAgICAgICAgICAgIHJldHVybiBkYXRhTGlzdDtcbiAgICAgICAgZm9yIChUZWFjaGVyIHRlYWNoZXIgOiBzTGlzdCkge1xuICAgICAgICAgICAgZGF0YUxpc3QuYWRkKGdldE1hcEZyb21UZWFjaGVyKHRlYWNoZXIpKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZGF0YUxpc3Q7XG4gICAgfVxuXG4gICAgcHVibGljIERhdGFSZXNwb25zZSBnZXRUZWFjaGVyTGlzdChEYXRhUmVxdWVzdCBkYXRhUmVxdWVzdCkge1xuICAgICAgICBTdHJpbmcgbnVtTmFtZSA9IGRhdGFSZXF1ZXN0LmdldFN0cmluZyhcIm51bU5hbWVcIik7XG4gICAgICAgIExpc3Q8TWFwPFN0cmluZywgT2JqZWN0Pj4gZGF0YUxpc3QgPSBnZXRUZWFjaGVyTWFwTGlzdChudW1OYW1lKTtcbiAgICAgICAgcmV0dXJuIENvbW1vbk1ldGhvZC5nZXRSZXR1cm5EYXRhKGRhdGFMaXN0KTsgIC8v5oyJ54Wn5rWL6K+V5qGG5p626KeE6IyD5Lya6YCBTWFw55qEbGlzdFxuICAgIH1cblxuICAgIHB1YmxpYyBEYXRhUmVzcG9uc2UgdGVhY2hlckRlbGV0ZShEYXRhUmVxdWVzdCBkYXRhUmVxdWVzdCkge1xuICAgICAgICBJbnRlZ2VyIHBlcnNvbklkID0gZGF0YVJlcXVlc3QuZ2V0SW50ZWdlcihcInBlcnNvbklkXCIpOyAgLy/ojrflj5Z0ZWFjaGVyX2lk5YC8XG4gICAgICAgIFRlYWNoZXIgcyA9IG51bGw7XG4gICAgICAgIE9wdGlvbmFsPFRlYWNoZXI+IG9wO1xuICAgICAgICBpZiAocGVyc29uSWQgIT0gbnVsbCAmJiBwZXJzb25JZCA+IDApIHtcbiAgICAgICAgICAgIG9wID0gdGVhY2hlclJlcG9zaXRvcnkuZmluZEJ5SWQocGVyc29uSWQpOyAgIC8v5p+l6K+i6I635b6X5a6e5L2T5a+56LGhXG4gICAgICAgICAgICBpZiAob3AuaXNQcmVzZW50KCkpIHtcbiAgICAgICAgICAgICAgICBzID0gb3AuZ2V0KCk7XG4gICAgICAgICAgICAgICAgT3B0aW9uYWw8VXNlcj4gdU9wID0gdXNlclJlcG9zaXRvcnkuZmluZEJ5SWQocGVyc29uSWQpOyAvL+afpeivouWvueW6lOivpeaVmeW4iOeahOi0puaIt1xuICAgICAgICAgICAgICAgIC8v5Yig6Zmk5a+55bqU6K+l5pWZ5biI55qE6LSm5oi3XG4gICAgICAgICAgICAgICAgdU9wLmlmUHJlc2VudCh1c2VyUmVwb3NpdG9yeTo6ZGVsZXRlKTtcbiAgICAgICAgICAgICAgICBQZXJzb24gcCA9IHMuZ2V0UGVyc29uKCk7XG4gICAgICAgICAgICAgICAgdGVhY2hlclJlcG9zaXRvcnkuZGVsZXRlKHMpOyAgICAvL+mmluWFiOaVsOaNruW6k+awuOS5heWIoOmZpOaVmeW4iOS/oeaBr1xuICAgICAgICAgICAgICAgIHBlcnNvblJlcG9zaXRvcnkuZGVsZXRlKHApO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBDb21tb25NZXRob2QuZ2V0UmV0dXJuTWVzc2FnZU9LKCk7ICAvL+mAmuefpeWJjeerr+aTjeS9nOato+W4uFxuICAgIH1cblxuICAgIHB1YmxpYyBEYXRhUmVzcG9uc2UgZ2V0VGVhY2hlckluZm8oRGF0YVJlcXVlc3QgZGF0YVJlcXVlc3QpIHtcbiAgICAgICAgSW50ZWdlciBwZXJzb25JZCA9IGRhdGFSZXF1ZXN0LmdldEludGVnZXIoXCJwZXJzb25JZFwiKTtcbiAgICAgICAgVGVhY2hlciBzID0gbnVsbDtcbiAgICAgICAgT3B0aW9uYWw8VGVhY2hlcj4gb3A7XG4gICAgICAgIGlmIChwZXJzb25JZCAhPSBudWxsKSB7XG4gICAgICAgICAgICBvcCA9IHRlYWNoZXJSZXBvc2l0b3J5LmZpbmRCeUlkKHBlcnNvbklkKTsgLy/moLnmja7lrabnlJ/kuLvplK7ku47mlbDmja7lupPmn6Xor6LlrabnlJ/nmoTkv6Hmga9cbiAgICAgICAgICAgIGlmIChvcC5pc1ByZXNlbnQoKSkge1xuICAgICAgICAgICAgICAgIHMgPSBvcC5nZXQoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gQ29tbW9uTWV0aG9kLmdldFJldHVybkRhdGEoZ2V0TWFwRnJvbVRlYWNoZXIocykpOyAvL+i/memHjOWbnuS8oOWMheWQq+WtpueUn+S/oeaBr+eahE1hcOWvueixoVxuICAgIH1cblxuICAgIHB1YmxpYyBEYXRhUmVzcG9uc2UgdGVhY2hlckVkaXRTYXZlKERhdGFSZXF1ZXN0IGRhdGFSZXF1ZXN0KSB7XG4gICAgICAgIEludGVnZXIgcGVyc29uSWQgPSBkYXRhUmVxdWVzdC5nZXRJbnRlZ2VyKFwicGVyc29uSWRcIik7XG4gICAgICAgIE1hcDxTdHJpbmcsIE9iamVjdD4gZm9ybSA9IGRhdGFSZXF1ZXN0LmdldE1hcChcImZvcm1cIik7IC8v5Y+C5pWw6I635Y+WTWFw5a+56LGhXG4gICAgICAgIFN0cmluZyBudW0gPSBDb21tb25NZXRob2QuZ2V0U3RyaW5nKGZvcm0sIFwibnVtXCIpOyAgLy9NYXAg6I635Y+W5bGe5oCn55qE5YC8XG4gICAgICAgIFRlYWNoZXIgcyA9IG51bGw7XG4gICAgICAgIFBlcnNvbiBwO1xuICAgICAgICBVc2VyIHU7XG4gICAgICAgIE9wdGlvbmFsPFRlYWNoZXI+IG9wO1xuICAgICAgICBib29sZWFuIGlzTmV3ID0gZmFsc2U7XG4gICAgICAgIGlmIChwZXJzb25JZCAhPSBudWxsKSB7XG4gICAgICAgICAgICBvcCA9IHRlYWNoZXJSZXBvc2l0b3J5LmZpbmRCeUlkKHBlcnNvbklkKTsgIC8v5p+l6K+i5a+55bqU5pWw5o2u5bqT5Lit5Li76ZSu5Li6aWTnmoTlgLznmoTlrp7kvZPlr7nosaFcbiAgICAgICAgICAgIGlmIChvcC5pc1ByZXNlbnQoKSkge1xuICAgICAgICAgICAgICAgIHMgPSBvcC5nZXQoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBPcHRpb25hbDxQZXJzb24+IG5PcCA9IHBlcnNvblJlcG9zaXRvcnkuZmluZEJ5TnVtKG51bSk7IC8v5p+l6K+i5piv5ZCm5a2Y5ZyobnVt55qE5Lq65ZGYXG4gICAgICAgIGlmIChuT3AuaXNQcmVzZW50KCkpIHtcbiAgICAgICAgICAgIGlmIChzID09IG51bGwgfHwgIXMuZ2V0UGVyc29uKCkuZ2V0TnVtKCkuZXF1YWxzKG51bSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gQ29tbW9uTWV0aG9kLmdldFJldHVybk1lc3NhZ2VFcnJvcihcIuaWsOW3peWPt+W3sue7j+WtmOWcqO+8jOS4jeiDvea3u+WKoOaIluS/ruaUue+8gVwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAocyA9PSBudWxsKSB7XG4gICAgICAgICAgICBwID0gbmV3IFBlcnNvbigpO1xuICAgICAgICAgICAgcC5zZXROdW0obnVtKTtcbiAgICAgICAgICAgIHAuc2V0VHlwZShcIjJcIik7ICAvLyAy6KGo56S65pWZ5biI57G75Z6LXG4gICAgICAgICAgICBwZXJzb25SZXBvc2l0b3J5LnNhdmVBbmRGbHVzaChwKTsgIC8v5o+S5YWl5paw55qEUGVyc29u6K6w5b2VXG4gICAgICAgICAgICBwZXJzb25JZCA9IHAuZ2V0UGVyc29uSWQoKTtcbiAgICAgICAgICAgIFN0cmluZyBwYXNzd29yZCA9IGVuY29kZXIuZW5jb2RlKFwiMTIzNDU2XCIpO1xuICAgICAgICAgICAgdSA9IG5ldyBVc2VyKCk7XG4gICAgICAgICAgICB1LnNldFBlcnNvbklkKHBlcnNvbklkKTtcbiAgICAgICAgICAgIHUuc2V0VXNlck5hbWUobnVtKTtcbiAgICAgICAgICAgIHUuc2V0UGFzc3dvcmQocGFzc3dvcmQpO1xuICAgICAgICAgICAgdS5zZXRVc2VyVHlwZSh1c2VyVHlwZVJlcG9zaXRvcnkuZmluZEJ5TmFtZShFVXNlclR5cGUuUk9MRV9URUFDSEVSKSk7ICAvLyDorr7nva7kuLrmlZnluIjop5LoibJcbiAgICAgICAgICAgIHUuc2V0Q3JlYXRlVGltZShEYXRlVGltZVRvb2wucGFyc2VEYXRlVGltZShuZXcgRGF0ZSgpKSk7XG4gICAgICAgICAgICB1LnNldENyZWF0b3JJZChDb21tb25NZXRob2QuZ2V0UGVyc29uSWQoKSk7XG4gICAgICAgICAgICB1c2VyUmVwb3NpdG9yeS5zYXZlQW5kRmx1c2godSk7IC8v5o+S5YWl5paw55qEVXNlcuiusOW9lVxuICAgICAgICAgICAgcyA9IG5ldyBUZWFjaGVyKCk7ICAgLy8g5Yib5bu65a6e5L2T5a+56LGhXG4gICAgICAgICAgICBzLnNldFBlcnNvbklkKHBlcnNvbklkKTtcbiAgICAgICAgICAgIHRlYWNoZXJSZXBvc2l0b3J5LnNhdmVBbmRGbHVzaChzKTsgIC8v5o+S5YWl5paw55qEVGVhY2hlcuiusOW9lVxuICAgICAgICAgICAgaXNOZXcgPSB0cnVlO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcCA9IHMuZ2V0UGVyc29uKCk7XG4gICAgICAgIH1cbiAgICAgICAgcGVyc29uSWQgPSBwLmdldFBlcnNvbklkKCk7XG4gICAgICAgIGlmICghbnVtLmVxdWFscyhwLmdldE51bSgpKSkgeyAgIC8v5aaC5p6c5Lq65ZGY57yW5Y+35Y+Y5YyW77yM5L+u5pS55Lq65ZGY57yW5Y+35ZKM55m75b2V6LSm5Y+3XG4gICAgICAgICAgICBPcHRpb25hbDxVc2VyPiB1T3AgPSB1c2VyUmVwb3NpdG9yeS5maW5kQnlQZXJzb25QZXJzb25JZChwZXJzb25JZCk7XG4gICAgICAgICAgICBpZiAodU9wLmlzUHJlc2VudCgpKSB7XG4gICAgICAgICAgICAgICAgdSA9IHVPcC5nZXQoKTtcbiAgICAgICAgICAgICAgICB1LnNldFVzZXJOYW1lKG51bSk7XG4gICAgICAgICAgICAgICAgdXNlclJlcG9zaXRvcnkuc2F2ZUFuZEZsdXNoKHUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcC5zZXROdW0obnVtKTsgIC8v6K6+572u5bGe5oCnXG4gICAgICAgIH1cbiAgICAgICAgcC5zZXROYW1lKENvbW1vbk1ldGhvZC5nZXRTdHJpbmcoZm9ybSwgXCJuYW1lXCIpKTtcbiAgICAgICAgcC5zZXREZXB0KENvbW1vbk1ldGhvZC5nZXRTdHJpbmcoZm9ybSwgXCJkZXB0XCIpKTtcbiAgICAgICAgcC5zZXRDYXJkKENvbW1vbk1ldGhvZC5nZXRTdHJpbmcoZm9ybSwgXCJjYXJkXCIpKTtcbiAgICAgICAgcC5zZXRHZW5kZXIoQ29tbW9uTWV0aG9kLmdldFN0cmluZyhmb3JtLCBcImdlbmRlclwiKSk7XG4gICAgICAgIHAuc2V0QmlydGhkYXkoQ29tbW9uTWV0aG9kLmdldFN0cmluZyhmb3JtLCBcImJpcnRoZGF5XCIpKTtcbiAgICAgICAgcC5zZXRFbWFpbChDb21tb25NZXRob2QuZ2V0U3RyaW5nKGZvcm0sIFwiZW1haWxcIikpO1xuICAgICAgICBwLnNldFBob25lKENvbW1vbk1ldGhvZC5nZXRTdHJpbmcoZm9ybSwgXCJwaG9uZVwiKSk7XG4gICAgICAgIHAuc2V0QWRkcmVzcyhDb21tb25NZXRob2QuZ2V0U3RyaW5nKGZvcm0sIFwiYWRkcmVzc1wiKSk7XG4gICAgICAgIHBlcnNvblJlcG9zaXRvcnkuc2F2ZShwKTsgIC8vIOS/ruaUueS/neWtmOS6uuWRmOS/oeaBr1xuICAgICAgICBzLnNldENsYXNzTmFtZShDb21tb25NZXRob2QuZ2V0U3RyaW5nKGZvcm0sIFwiY2xhc3NOYW1lXCIpKTtcbiAgICAgICAgdGVhY2hlclJlcG9zaXRvcnkuc2F2ZShzKTsgIC8v5L+u5pS55L+d5a2Y5a2m55Sf5L+h5oGvXG4gICAgICAgIHN5c3RlbVNlcnZpY2UubW9kaWZ5TG9nKHMsIGlzTmV3KTtcbiAgICAgICAgcmV0dXJuIENvbW1vbk1ldGhvZC5nZXRSZXR1cm5EYXRhKHMuZ2V0UGVyc29uSWQoKSk7ICAvLyDlsIZwZXJzb25JZOi/lOWbnuWJjeerr1xuICAgIH1cblxuICAgIHB1YmxpYyBSZXNwb25zZUVudGl0eTxTdHJlYW1pbmdSZXNwb25zZUJvZHk+IGdldFRlYWNoZXJMaXN0RXhjbChEYXRhUmVxdWVzdCBkYXRhUmVxdWVzdCkge1xuICAgICAgICBTdHJpbmcgbnVtTmFtZSA9IGRhdGFSZXF1ZXN0LmdldFN0cmluZyhcIm51bU5hbWVcIik7XG4gICAgICAgIExpc3Q8TWFwPFN0cmluZywgT2JqZWN0Pj4gbGlzdCA9IGdldFRlYWNoZXJNYXBMaXN0KG51bU5hbWUpO1xuXG4gICAgICAgIC8vIOiwg+aVtOWIl+WuvemFjee9rlxuICAgICAgICBJbnRlZ2VyW10gd2lkdGhzID0gezgsIDE1LCAxMCwgMjAsIDE1LCAxMCwgOCwgMjUsIDE1LCAzMH07XG4gICAgICAgIFN0cmluZ1tdIHRpdGxlcyA9IHtcIuW6j+WPt1wiLCBcIuW3peWPt1wiLCBcIuWnk+WQjVwiLCBcIuWtpumZolwiLCBcIuiBjOensFwiLCBcIuWtpuS9jVwiLCBcIuaAp+WIq1wiLCBcIumCrueusVwiLCBcIueUteivnVwiLCBcIuWcsOWdgFwifTtcbiAgICAgICAgU3RyaW5nIG91dFB1dFNoZWV0TmFtZSA9IFwidGVhY2hlci54bHN4XCI7XG5cbiAgICAgICAgWFNTRldvcmtib29rIHdiID0gbmV3IFhTU0ZXb3JrYm9vaygpO1xuICAgICAgICBYU1NGU2hlZXQgc2hlZXQgPSB3Yi5jcmVhdGVTaGVldChvdXRQdXRTaGVldE5hbWUpO1xuXG4gICAgICAgIC8vIOiuvue9ruWIl+WuvVxuICAgICAgICBmb3IgKGludCBqID0gMDsgaiA8IHdpZHRocy5sZW5ndGg7IGorKykge1xuICAgICAgICAgICAgc2hlZXQuc2V0Q29sdW1uV2lkdGgoaiwgd2lkdGhzW2pdICogMjU2KTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIOWIm+W7uuagh+mimOihjOagt+W8j1xuICAgICAgICBYU1NGQ2VsbFN0eWxlIHN0eWxlID0gQ29tbW9uTWV0aG9kLmNyZWF0ZUNlbGxTdHlsZSh3YiwgMTEpO1xuICAgICAgICBYU1NGUm93IHJvdyA9IHNoZWV0LmNyZWF0ZVJvdygwKTtcbiAgICAgICAgWFNTRkNlbGxbXSBjZWxsID0gbmV3IFhTU0ZDZWxsW3dpZHRocy5sZW5ndGhdO1xuXG4gICAgICAgIC8vIOWhq+WFheagh+mimOihjFxuICAgICAgICBmb3IgKGludCBqID0gMDsgaiA8IHdpZHRocy5sZW5ndGg7IGorKykge1xuICAgICAgICAgICAgY2VsbFtqXSA9IHJvdy5jcmVhdGVDZWxsKGopO1xuICAgICAgICAgICAgY2VsbFtqXS5zZXRDZWxsU3R5bGUoc3R5bGUpO1xuICAgICAgICAgICAgY2VsbFtqXS5zZXRDZWxsVmFsdWUodGl0bGVzW2pdKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIOWhq+WFheaVsOaNruihjFxuICAgICAgICBpZiAobGlzdCAhPSBudWxsICYmICFsaXN0LmlzRW1wdHkoKSkge1xuICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBsaXN0LnNpemUoKTsgaSsrKSB7XG4gICAgICAgICAgICAgICAgcm93ID0gc2hlZXQuY3JlYXRlUm93KGkgKyAxKTtcbiAgICAgICAgICAgICAgICBNYXA8U3RyaW5nLCBPYmplY3Q+IG0gPSBsaXN0LmdldChpKTtcblxuICAgICAgICAgICAgICAgIC8vIOWIm+W7uuWNleWFg+agvOW5tuiuvue9ruagt+W8j1xuICAgICAgICAgICAgICAgIGZvciAoaW50IGogPSAwOyBqIDwgd2lkdGhzLmxlbmd0aDsgaisrKSB7XG4gICAgICAgICAgICAgICAgICAgIGNlbGxbal0gPSByb3cuY3JlYXRlQ2VsbChqKTtcbiAgICAgICAgICAgICAgICAgICAgY2VsbFtqXS5zZXRDZWxsU3R5bGUoc3R5bGUpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIC8vIOWhq+WFheWFt+S9k+aVsOaNrlxuICAgICAgICAgICAgICAgIGNlbGxbMF0uc2V0Q2VsbFZhbHVlKChpICsgMSkgKyBcIlwiKTsgLy8g5bqP5Y+3XG4gICAgICAgICAgICAgICAgY2VsbFsxXS5zZXRDZWxsVmFsdWUoQ29tbW9uTWV0aG9kLmdldFN0cmluZyhtLCBcIm51bVwiKSk7IC8vIOW3peWPt1xuICAgICAgICAgICAgICAgIGNlbGxbMl0uc2V0Q2VsbFZhbHVlKENvbW1vbk1ldGhvZC5nZXRTdHJpbmcobSwgXCJuYW1lXCIpKTsgLy8g5aeT5ZCNXG4gICAgICAgICAgICAgICAgY2VsbFszXS5zZXRDZWxsVmFsdWUoQ29tbW9uTWV0aG9kLmdldFN0cmluZyhtLCBcImRlcHRcIikpOyAvLyDlrabpmaJcbiAgICAgICAgICAgICAgICBjZWxsWzRdLnNldENlbGxWYWx1ZShDb21tb25NZXRob2QuZ2V0U3RyaW5nKG0sIFwidGl0bGVcIikpOyAvLyDogYznp7BcbiAgICAgICAgICAgICAgICBjZWxsWzVdLnNldENlbGxWYWx1ZShDb21tb25NZXRob2QuZ2V0U3RyaW5nKG0sIFwiZGVncmVlXCIpKTsgLy8g5a2m5L2NXG4gICAgICAgICAgICAgICAgY2VsbFs2XS5zZXRDZWxsVmFsdWUoQ29tbW9uTWV0aG9kLmdldFN0cmluZyhtLCBcImdlbmRlck5hbWVcIikpOyAvLyDmgKfliKtcbiAgICAgICAgICAgICAgICBjZWxsWzddLnNldENlbGxWYWx1ZShDb21tb25NZXRob2QuZ2V0U3RyaW5nKG0sIFwiZW1haWxcIikpOyAvLyDpgq7nrrFcbiAgICAgICAgICAgICAgICBjZWxsWzhdLnNldENlbGxWYWx1ZShDb21tb25NZXRob2QuZ2V0U3RyaW5nKG0sIFwicGhvbmVcIikpOyAvLyDnlLXor51cbiAgICAgICAgICAgICAgICBjZWxsWzldLnNldENlbGxWYWx1ZShDb21tb25NZXRob2QuZ2V0U3RyaW5nKG0sIFwiYWRkcmVzc1wiKSk7IC8vIOWcsOWdgFxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIFN0cmVhbWluZ1Jlc3BvbnNlQm9keSBzdHJlYW0gPSB3Yjo6d3JpdGU7XG4gICAgICAgICAgICByZXR1cm4gUmVzcG9uc2VFbnRpdHkub2soKVxuICAgICAgICAgICAgICAgICAgICAuY29udGVudFR5cGUoQ29tbW9uTWV0aG9kLmV4ZWxUeXBlKVxuICAgICAgICAgICAgICAgICAgICAuYm9keShzdHJlYW0pO1xuICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkge1xuICAgICAgICAgICAgcmV0dXJuIFJlc3BvbnNlRW50aXR5LmludGVybmFsU2VydmVyRXJyb3IoKS5idWlsZCgpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHVibGljIERhdGFSZXNwb25zZSBnZXRUZWFjaGVyUGFnZURhdGEoRGF0YVJlcXVlc3QgZGF0YVJlcXVlc3QpIHtcbiAgICAgICAgU3RyaW5nIG51bU5hbWUgPSBkYXRhUmVxdWVzdC5nZXRTdHJpbmcoXCJudW1OYW1lXCIpO1xuICAgICAgICBJbnRlZ2VyIGNQYWdlID0gZGF0YVJlcXVlc3QuZ2V0Q3VycmVudFBhZ2UoKTtcbiAgICAgICAgaW50IGRhdGFUb3RhbCA9IDA7XG4gICAgICAgIGludCBzaXplID0gNDA7XG4gICAgICAgIExpc3Q8TWFwPFN0cmluZywgT2JqZWN0Pj4gZGF0YUxpc3QgPSBuZXcgQXJyYXlMaXN0PD4oKTtcbiAgICAgICAgUGFnZTxUZWFjaGVyPiBwYWdlID0gbnVsbDtcbiAgICAgICAgUGFnZWFibGUgcGFnZWFibGUgPSBQYWdlUmVxdWVzdC5vZihjUGFnZSwgc2l6ZSk7XG4gICAgICAgIHBhZ2UgPSB0ZWFjaGVyUmVwb3NpdG9yeS5maW5kVGVhY2hlckxpc3RCeU51bU5hbWUobnVtTmFtZSwgcGFnZWFibGUpO1xuICAgICAgICBNYXA8U3RyaW5nLCBPYmplY3Q+IG07XG4gICAgICAgIGlmIChwYWdlICE9IG51bGwpIHtcbiAgICAgICAgICAgIGRhdGFUb3RhbCA9IChpbnQpIHBhZ2UuZ2V0VG90YWxFbGVtZW50cygpO1xuICAgICAgICAgICAgTGlzdDxUZWFjaGVyPiBsaXN0ID0gcGFnZS5nZXRDb250ZW50KCk7XG4gICAgICAgICAgICBpZiAoIWxpc3QuaXNFbXB0eSgpKSB7XG4gICAgICAgICAgICAgICAgZm9yIChUZWFjaGVyIHRlYWNoZXIgOiBsaXN0KSB7XG4gICAgICAgICAgICAgICAgICAgIG0gPSBnZXRNYXBGcm9tVGVhY2hlcih0ZWFjaGVyKTtcbiAgICAgICAgICAgICAgICAgICAgZGF0YUxpc3QuYWRkKG0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBNYXA8U3RyaW5nLCBPYmplY3Q+IGRhdGEgPSBuZXcgSGFzaE1hcDw+KCk7XG4gICAgICAgIGRhdGEucHV0KFwiZGF0YVRvdGFsXCIsIGRhdGFUb3RhbCk7XG4gICAgICAgIGRhdGEucHV0KFwicGFnZVNpemVcIiwgc2l6ZSk7XG4gICAgICAgIGRhdGEucHV0KFwiZGF0YUxpc3RcIiwgZGF0YUxpc3QpO1xuICAgICAgICByZXR1cm4gQ29tbW9uTWV0aG9kLmdldFJldHVybkRhdGEoZGF0YSk7XG4gICAgfVxufVxuXG4uLi5cblBhdGg6IHNyYy9tYWluL2phdmEvY24vZWR1L3NkdS9qYXZhL3NlcnZlci9zZXJ2aWNlcy9UZWFjaGVyU2VydmljZXMuamF2YVxucGFja2FnZSBjbi5lZHUuc2R1LmphdmEuc2VydmVyLnNlcnZpY2VzO1xuXG5pbXBvcnQgY24uZWR1LnNkdS5qYXZhLnNlcnZlci5tb2RlbHMuKjtcbmltcG9ydCBjbi5lZHUuc2R1LmphdmEuc2VydmVyLm1vZGVscy5UZWFjaGVyO1xuaW1wb3J0IGNuLmVkdS5zZHUuamF2YS5zZXJ2ZXIucGF5bG9hZC5yZXF1ZXN0LkRhdGFSZXF1ZXN0O1xuaW1wb3J0IGNuLmVkdS5zZHUuamF2YS5zZXJ2ZXIucGF5bG9hZC5yZXNwb25zZS5EYXRhUmVzcG9uc2U7XG5pbXBvcnQgY24uZWR1LnNkdS5qYXZhLnNlcnZlci5yZXBvc2l0b3J5cy4qO1xuaW1wb3J0IGNuLmVkdS5zZHUuamF2YS5zZXJ2ZXIudXRpbC5Db21EYXRhVXRpbDtcbmltcG9ydCBjbi5lZHUuc2R1LmphdmEuc2VydmVyLnV0aWwuQ29tbW9uTWV0aG9kO1xuaW1wb3J0IGNuLmVkdS5zZHUuamF2YS5zZXJ2ZXIudXRpbC5EYXRlVGltZVRvb2w7XG5pbXBvcnQgb3JnLmFwYWNoZS5wb2kuc3MudXNlcm1vZGVsLkNlbGw7XG5pbXBvcnQgb3JnLmFwYWNoZS5wb2kuc3MudXNlcm1vZGVsLlJvdztcbmltcG9ydCBvcmcuYXBhY2hlLnBvaS54c3NmLnVzZXJtb2RlbC4qO1xuaW1wb3J0IG9yZy5zbGY0ai5Mb2dnZXI7XG5pbXBvcnQgb3JnLnNsZjRqLkxvZ2dlckZhY3Rvcnk7XG5pbXBvcnQgb3JnLnNwcmluZ2ZyYW1ld29yay5kYXRhLmRvbWFpbi5QYWdlO1xuaW1wb3J0IG9yZy5zcHJpbmdmcmFtZXdvcmsuZGF0YS5kb21haW4uUGFnZVJlcXVlc3Q7XG5pbXBvcnQgb3JnLnNwcmluZ2ZyYW1ld29yay5kYXRhLmRvbWFpbi5QYWdlYWJsZTtcbi4uLlxuXG5AU2VydmljZVxucHVibGljIGNsYXNzIFRlYWNoZXJTZXJ2aWNlIHtcbiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBMb2dnZXIgbG9nID0gTG9nZ2VyRmFjdG9yeS5nZXRMb2dnZXIoY24uZWR1LnNkdS5qYXZhLnNlcnZlci5zZXJ2aWNlcy5UZWFjaGVyU2VydmljZS5jbGFzcyk7XG4gICAgcHJpdmF0ZSBmaW5hbCBQZXJzb25SZXBvc2l0b3J5IHBlcnNvblJlcG9zaXRvcnk7ICAvL+S6uuWRmOaVsOaNruaTjeS9nOiHquWKqOazqOWFpVxuICAgIHByaXZhdGUgZmluYWwgVGVhY2hlclJlcG9zaXRvcnkgdGVhY2hlclJlcG9zaXRvcnk7ICAvL+aVmeW4iOaVsOaNruaTjeS9nOiHquWKqOazqOWFpVxuICAgIHByaXZhdGUgZmluYWwgVXNlclJlcG9zaXRvcnkgdXNlclJlcG9zaXRvcnk7ICAvL+aVsOaNruaTjeS9nOiHquWKqOazqOWFpVxuICAgIHByaXZhdGUgZmluYWwgVXNlclR5cGVSZXBvc2l0b3J5IHVzZXJUeXBlUmVwb3NpdG9yeTsgLy/nlKjmiLfnsbvlnovmlbDmja7mk43kvZzoh6rliqjms6jlhaVcbiAgICBwcml2YXRlIGZpbmFsIFBhc3N3b3JkRW5jb2RlciBlbmNvZGVyOyAgLy/lr4bnoIHmnI3liqHoh6rliqjms6jlhaVcbiAgICBwcml2YXRlIGZpbmFsIEZlZVJlcG9zaXRvcnkgZmVlUmVwb3NpdG9yeTsgIC8v5raI6LS55pWw5o2u5pON5L2c6Ieq5Yqo5rOo5YWlXG4gICAgcHJpdmF0ZSBmaW5hbCBGYW1pbHlNZW1iZXJSZXBvc2l0b3J5IGZhbWlseU1lbWJlclJlcG9zaXRvcnk7XG4gICAgcHJpdmF0ZSBmaW5hbCBTeXN0ZW1TZXJ2aWNlIHN5c3RlbVNlcnZpY2U7XG4uLi5cbiAgICBwdWJsaWMgTWFwPFN0cmluZyxPYmplY3Q+IGdldE1hcEZyb21UZWFjaGVyKFRlYWNoZXIgcykge1xuICAgICAgICBNYXA8U3RyaW5nLE9iamVjdD4gbSA9IG5ldyBIYXNoTWFwPD4oKTtcbiAgICAgICAgUGVyc29uIHA7XG4gICAgICAgIGlmKHMgPT0gbnVsbClcbiAgICAgICAgICAgIHJldHVybiBtO1xuICAgICAgICBtLnB1dChcInRpdGxlXCIscy5nZXRUaXRsZSgpKTtcbiAgICAgICAgbS5wdXQoXCJkZWdyZWVcIixzLmdldERlZ3JlZSgpKTtcbiAgICAgICAgbS5wdXQoXCJjbGFzc05hbWVcIixzLmdldENsYXNzTmFtZSgpKTtcbiAgICAgICAgcCA9IHMuZ2V0UGVyc29uKCk7XG4gICAgICAgIGlmKHAgPT0gbnVsbClcbiAgICAgICAgICAgIHJldHVybiBtO1xuICAgICAgICBtLnB1dChcInBlcnNvbklkXCIsIHMuZ2V0UGVyc29uSWQoKSk7XG4gICAgICAgIG0ucHV0KFwibnVtXCIscC5nZXROdW0oKSk7XG4gICAgICAgIG0ucHV0KFwibmFtZVwiLHAuZ2V0TmFtZSgpKTtcbiAgICAgICAgbS5wdXQoXCJkZXB0XCIscC5nZXREZXB0KCkpO1xuICAgICAgICBtLnB1dChcImNhcmRcIixwLmdldENhcmQoKSk7XG4gICAgICAgIFN0cmluZyBnZW5kZXIgPSBwLmdldEdlbmRlcigpO1xuICAgICAgICBtLnB1dChcImdlbmRlclwiLGdlbmRlcik7XG4gICAgICAgIG0ucHV0KFwiZ2VuZGVyTmFtZVwiLCBDb21EYXRhVXRpbC5nZXRJbnN0YW5jZSgpLmdldERpY3Rpb25hcnlMYWJlbEJ5VmFsdWUoXCJYQk1cIiwgZ2VuZGVyKSk7IC8v5oCn5Yir57G75Z6L55qE5YC86L2s5o2i5oiQ5pWw5o2u57G75Z6L5ZCNXG4gICAgICAgIG0ucHV0KFwiYmlydGhkYXlcIiwgcC5nZXRCaXJ0aGRheSgpKTsgIC8v5pe26Ze05qC85byP6L2s5o2i5a2X56ym5LiyXG4gICAgICAgIG0ucHV0KFwiZW1haWxcIixwLmdldEVtYWlsKCkpO1xuICAgICAgICBtLnB1dChcInBob25lXCIscC5nZXRQaG9uZSgpKTtcbiAgICAgICAgbS5wdXQoXCJhZGRyZXNzXCIscC5nZXRBZGRyZXNzKCkpO1xuICAgICAgICBtLnB1dChcImludHJvZHVjZVwiLHAuZ2V0SW50cm9kdWNlKCkpO1xuICAgICAgICByZXR1cm4gbTtcbiAgICB9XG4gICAgcHVibGljIExpc3Q8TWFwPFN0cmluZyxPYmplY3Q+PiBnZXRUZWFjaGVyTWFwTGlzdChTdHJpbmcgbnVtTmFtZSkge1xuICAgICAgICBMaXN0PE1hcDxTdHJpbmcsT2JqZWN0Pj4gZGF0YUxpc3QgPSBuZXcgQXJyYXlMaXN0PD4oKTtcbiAgICAgICAgTGlzdDxUZWFjaGVyPiBzTGlzdCA9IHRlYWNoZXJSZXBvc2l0b3J5LmZpbmRUZWFjaGVyTGlzdEJ5TnVtTmFtZShudW1OYW1lKTsgIC8v5pWw5o2u5bqT5p+l6K+i5pON5L2cXG4gICAgICAgIGlmIChzTGlzdCA9PSBudWxsIHx8IHNMaXN0LmlzRW1wdHkoKSlcbiAgICAgICAgICAgIHJldHVybiBkYXRhTGlzdDtcbiAgICAgICAgZm9yIChUZWFjaGVyIHRlYWNoZXIgOiBzTGlzdCkge1xuICAgICAgICAgICAgZGF0YUxpc3QuYWRkKGdldE1hcEZyb21UZWFjaGVyKHRlYWNoZXIpKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZGF0YUxpc3Q7XG4gICAgfVxuICAgIHB1YmxpYyBEYXRhUmVzcG9uc2UgZ2V0VGVhY2hlckxpc3QoRGF0YVJlcXVlc3QgZGF0YVJlcXVlc3QpIHtcbiAgICAgICAgU3RyaW5nIG51bU5hbWUgPSBkYXRhUmVxdWVzdC5nZXRTdHJpbmcoXCJudW1OYW1lXCIpO1xuICAgICAgICBMaXN0PE1hcDxTdHJpbmcsT2JqZWN0Pj4gZGF0YUxpc3QgPSAgZ2V0VGVhY2hlckxpc3QobnVtTmFtZSk7XG4gICAgICAgIHJldHVybiBDb21tb25NZXRob2QuZ2V0UmV0dXJuRGF0YShkYXRhTGlzdCk7ICAvL+aMieeFp+a1i+ivleahhuaetuinhOiMg+S8mumAgU1hcOeahGxpc3RcbiAgICB9XG4gICAgcHVibGljIERhdGFSZXNwb25zZSB0ZWFjaGVyRGVsZXRlKERhdGFSZXF1ZXN0IGRhdGFSZXF1ZXN0KSB7XG4gICAgICAgIEludGVnZXIgcGVyc29uSWQgPSBkYXRhUmVxdWVzdC5nZXRJbnRlZ2VyKFwicGVyc29uSWRcIik7ICAvL+iOt+WPlnRlYWNoZXJfaWTlgLxcbiAgICAgICAgVGVhY2hlciBzID0gbnVsbDtcbiAgICAgICAgT3B0aW9uYWw8VGVhY2hlcj4gb3A7XG4gICAgICAgIGlmIChwZXJzb25JZCAhPSBudWxsICYmIHBlcnNvbklkID4gMCkge1xuICAgICAgICAgICAgb3AgPSB0ZWFjaGVyUmVwb3NpdG9yeS5maW5kQnlJZChwZXJzb25JZCk7ICAgLy/mn6Xor6Lojrflvpflrp7kvZPlr7nosaFcbiAgICAgICAgICAgIGlmKG9wLmlzUHJlc2VudCgpKSB7XG4gICAgICAgICAgICAgICAgcyA9IG9wLmdldCgpO1xuICAgICAgICAgICAgICAgIE9wdGlvbmFsPFVzZXI+IHVPcCA9IHVzZXJSZXBvc2l0b3J5LmZpbmRCeUlkKHBlcnNvbklkKTsgLy/mn6Xor6Llr7nlupTor6XmlZnluIjnmoTotKbmiLdcbiAgICAgICAgICAgICAgICAvL+WIoOmZpOWvueW6lOivpeaVmeW4iOeahOi0puaIt1xuICAgICAgICAgICAgICAgIHVPcC5pZlByZXNlbnQodXNlclJlcG9zaXRvcnk6OmRlbGV0ZSk7XG4gICAgICAgICAgICAgICAgUGVyc29uIHAgPSBzLmdldFBlcnNvbigpO1xuICAgICAgICAgICAgICAgIHRlYWNoZXJSZXBvc2l0b3J5LmRlbGV0ZShzKTsgICAgLy/pppblhYjmlbDmja7lupPmsLjkuYXliKDpmaTmlZnluIjkv6Hmga9cbiAgICAgICAgICAgICAgICBwZXJzb25SZXBvc2l0b3J5LmRlbGV0ZShwKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gQ29tbW9uTWV0aG9kLmdldFJldHVybk1lc3NhZ2VPSygpOyAgLy/pgJrnn6XliY3nq6/mk43kvZzmraPluLhcbiAgICB9XG4gICAgcHVibGljIERhdGFSZXNwb25zZSBnZXRUZWFjaGVySW5mbyhEYXRhUmVxdWVzdCBkYXRhUmVxdWVzdCkge1xuICAgICAgICBJbnRlZ2VyIHBlcnNvbklkID0gZGF0YVJlcXVlc3QuZ2V0SW50ZWdlcihcInBlcnNvbklkXCIpO1xuICAgICAgICBUZWFjaGVyIHMgPSBudWxsO1xuICAgICAgICBPcHRpb25hbDxUZWFjaGVyPiBvcDtcbiAgICAgICAgaWYgKHBlcnNvbklkICE9IG51bGwpIHtcbiAgICAgICAgICAgIG9wID0gdGVhY2hlclJlcG9zaXRvcnkuZmluZEJ5SWQocGVyc29uSWQpOyAvL+agueaNruWtpueUn+S4u+mUruS7juaVsOaNruW6k+afpeivouWtpueUn+eahOS/oeaBr1xuICAgICAgICAgICAgaWYgKG9wLmlzUHJlc2VudCgpKSB7XG4gICAgICAgICAgICAgICAgcyA9IG9wLmdldCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBDb21tb25NZXRob2QuZ2V0UmV0dXJuRGF0YShnZXRNYXBGcm9tVGVhY2hlcihzKSk7IC8v6L+Z6YeM5Zue5Lyg5YyF5ZCr5a2m55Sf5L+h5oGv55qETWFw5a+56LGhXG4gICAgfVxuXG4gICAgcHVibGljIERhdGFSZXNwb25zZSB0ZWFjaGVyRWRpdFNhdmUoRGF0YVJlcXVlc3QgZGF0YVJlcXVlc3QpIHtcbiAgICAgICAgSW50ZWdlciBwZXJzb25JZCA9IGRhdGFSZXF1ZXN0LmdldEludGVnZXIoXCJwZXJzb25JZFwiKTtcbiAgICAgICAgTWFwPFN0cmluZyxPYmplY3Q+IGZvcm0gPSBkYXRhUmVxdWVzdC5nZXRNYXAoXCJmb3JtXCIpOyAvL+WPguaVsOiOt+WPlk1hcOWvueixoVxuICAgICAgICBTdHJpbmcgbnVtID0gQ29tbW9uTWV0aG9kLmdldFN0cmluZyhmb3JtLCBcIm51bVwiKTsgIC8vTWFwIOiOt+WPluWxnuaAp+eahOWAvFxuICAgICAgICBUZWFjaGVyIHMgPSBudWxsO1xuICAgICAgICBQZXJzb24gcDtcbiAgICAgICAgVXNlciB1O1xuICAgICAgICBPcHRpb25hbDxUZWFjaGVyPiBvcDtcbiAgICAgICAgYm9vbGVhbiBpc05ldyA9IGZhbHNlO1xuICAgICAgICBpZiAocGVyc29uSWQgIT0gbnVsbCkge1xuICAgICAgICAgICAgb3AgPSB0ZWFjaGVyUmVwb3NpdG9yeS5maW5kQnlJZChwZXJzb25JZCk7ICAvL+afpeivouWvueW6lOaVsOaNruW6k+S4reS4u+mUruS4umlk55qE5YC855qE5a6e5L2T5a+56LGhXG4gICAgICAgICAgICBpZiAob3AuaXNQcmVzZW50KCkpIHtcbiAgICAgICAgICAgICAgICBzID0gb3AuZ2V0KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgT3B0aW9uYWw8UGVyc29uPiBuT3AgPSBwZXJzb25SZXBvc2l0b3J5LmZpbmRCeU51bShudW0pOyAvL+afpeivouaYr+WQpuWtmOWcqG51beeahOS6uuWRmFxuICAgICAgICBpZiAobk9wLmlzUHJlc2VudCgpKSB7XG4gICAgICAgICAgICBpZiAocyA9PSBudWxsIHx8ICFzLmdldFBlcnNvbigpLmdldE51bSgpLmVxdWFscyhudW0pKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIENvbW1vbk1ldGhvZC5nZXRSZXR1cm5NZXNzYWdlRXJyb3IoXCLmlrDlrablj7flt7Lnu4/lrZjlnKjvvIzkuI3og73mt7vliqDmiJbkv67mlLnvvIFcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbi4uLlxuICAgIHB1YmxpYyBSZXNwb25zZUVudGl0eTxTdHJlYW1pbmdSZXNwb25zZUJvZHk+IGdldFRlYWNoZXJMaXN0RXhjbChEYXRhUmVxdWVzdCBkYXRhUmVxdWVzdCkge1xuICAgICAgICBTdHJpbmcgbnVtTmFtZSA9IGRhdGFSZXF1ZXN0LmdldFN0cmluZyhcIm51bU5hbWVcIik7XG4gICAgICAgIExpc3Q8TWFwPFN0cmluZyxPYmplY3Q+PiBsaXN0ID0gZ2V0VGVhY2hlck1hcExpc3QobnVtTmFtZSk7IC8vIOWBh+iuvuW3suaUueS4uuiOt+WPluaVmeW4iOaVsOaNrueahOaWueazlVxuXG4gICAgICAgIC8vIOiwg+aVtOWIl+WuvemFjee9ru+8iOagueaNruaVmeW4iOS/oeaBr+eJueeCueiwg+aVtO+8iVxuICAgICAgICBJbnRlZ2VyW10gd2lkdGhzID0gezgsIDE1LCAxMCwgMjAsIDE1LCAxMCwgOCwgMjUsIDE1LCAzMH07XG4gICAgICAgIFN0cmluZ1tdIHRpdGxlcyA9IHtcIuW6j+WPt1wiLCBcIuW3peWPt1wiLCBcIuWnk+WQjVwiLCBcIuWtpumZolwiLCBcIuiBjOensFwiLCBcIuWtpuS9jVwiLCBcIuaAp+WIq1wiLCBcIumCrueusVwiLCBcIueUteivnVwiLCBcIuWcsOWdgFwifTtcbiAgICAgICAgU3RyaW5nIG91dFB1dFNoZWV0TmFtZSA9IFwidGVhY2hlci54bHN4XCI7XG5cbiAgICAgICAgWFNTRldvcmtib29rIHdiID0gbmV3IFhTU0ZXb3JrYm9vaygpO1xuICAgICAgICBYU1NGU2hlZXQgc2hlZXQgPSB3Yi5jcmVhdGVTaGVldChvdXRQdXRTaGVldE5hbWUpO1xuXG4gICAgICAgIC8vIOiuvue9ruWIl+WuvVxuICAgICAgICBmb3IoaW50IGogPSAwOyBqIDwgd2lkdGhzLmxlbmd0aDsgaisrKSB7XG4gICAgICAgICAgICBzaGVldC5zZXRDb2x1bW5XaWR0aChqLCB3aWR0aHNbal0gKiAyNTYpO1xuICAgICAgICB9XG4uLi5cbiAgICBwdWJsaWMgRGF0YVJlc3BvbnNlIGdldFRlYWNoZXJQYWdlRGF0YShEYXRhUmVxdWVzdCBkYXRhUmVxdWVzdCkge1xuICAgICAgICBTdHJpbmcgbnVtTmFtZSA9IGRhdGFSZXF1ZXN0LmdldFN0cmluZyhcIm51bU5hbWVcIik7XG4gICAgICAgIEludGVnZXIgY1BhZ2UgPSBkYXRhUmVxdWVzdC5nZXRDdXJyZW50UGFnZSgpO1xuICAgICAgICBpbnQgZGF0YVRvdGFsID0gMDtcbiAgICAgICAgaW50IHNpemUgPSA0MDtcbiAgICAgICAgTGlzdDxNYXA8U3RyaW5nLE9iamVjdD4+IGRhdGFMaXN0ID0gbmV3IEFycmF5TGlzdDw+KCk7XG4gICAgICAgIFBhZ2U8VGVhY2hlcj4gcGFnZSA9IG51bGw7XG4gICAgICAgIFBhZ2VhYmxlIHBhZ2VhYmxlID0gUGFnZVJlcXVlc3Qub2YoY1BhZ2UsIHNpemUpO1xuICAgICAgICBwYWdlID0gdGVhY2hlclJlcG9zaXRvcnkuZmluZFRlYWNoZXJMaXN0QnlOdW1OYW1lKG51bU5hbWUsIHBhZ2VhYmxlKTtcbiAgICAgICAgTWFwPFN0cmluZyxPYmplY3Q+IG07XG4gICAgICAgIGlmIChwYWdlICE9IG51bGwpIHtcbiAgICAgICAgICAgIGRhdGFUb3RhbCA9IChpbnQpIHBhZ2UuZ2V0VG90YWxFbGVtZW50cygpO1xuICAgICAgICAgICAgTGlzdDxUZWFjaGVyPiBsaXN0ID0gcGFnZS5nZXRDb250ZW50KCk7XG4gICAgICAgICAgICBpZiAoIWxpc3QuaXNFbXB0eSgpKSB7XG4gICAgICAgICAgICAgICAgZm9yIChUZWFjaGVyIHRlYWNoZXIgOiBsaXN0KSB7XG4gICAgICAgICAgICAgICAgICAgIG0gPSBnZXRNYXBGcm9tVGVhY2hlcih0ZWFjaGVyKTtcbiAgICAgICAgICAgICAgICAgICAgZGF0YUxpc3QuYWRkKG0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuLi4uXG4gICAgcHVibGljIERhdGFSZXNwb25zZSBnZXRGYW1pbHlNZW1iZXJMaXN0KERhdGFSZXF1ZXN0IGRhdGFSZXF1ZXN0KSB7XG4gICAgICAgIEludGVnZXIgcGVyc29uSWQgPSBkYXRhUmVxdWVzdC5nZXRJbnRlZ2VyKFwicGVyc29uSWRcIik7XG4gICAgICAgIExpc3Q8RmFtaWx5TWVtYmVyPiBmTGlzdCA9IGZhbWlseU1lbWJlclJlcG9zaXRvcnkuZmluZEJ5VGVhY2hlclBlcnNvbklkKHBlcnNvbklkKTtcbiAgICAgICAgTGlzdDxNYXA8U3RyaW5nLE9iamVjdD4+IGRhdGFMaXN0ID0gbmV3IEFycmF5TGlzdDw+KCk7XG4gICAgICAgIE1hcDxTdHJpbmcsT2JqZWN0PiBtO1xuICAgICAgICBpZiAoZkxpc3QgIT0gbnVsbCkge1xuICAgICAgICAgICAgZm9yIChGYW1pbHlNZW1iZXIgZiA6IGZMaXN0KSB7XG4gICAgICAgICAgICAgICAgbSA9IG5ldyBIYXNoTWFwPD4oKTtcbiAgICAgICAgICAgICAgICBtLnB1dChcIm1lbWJlcklkXCIsIGYuZ2V0TWVtYmVySWQoKSk7XG4gICAgICAgICAgICAgICAgbS5wdXQoXCJwZXJzb25JZFwiLCBmLmdldFRlYWNoZXIoKS5nZXRQZXJzb25JZCgpKTtcbiAgICAgICAgICAgICAgICBtLnB1dChcInJlbGF0aW9uXCIsIGYuZ2V0UmVsYXRpb24oKSk7XG4gICAgICAgICAgICAgICAgbS5wdXQoXCJuYW1lXCIsIGYuZ2V0TmFtZSgpKTtcbiAgICAgICAgICAgICAgICBtLnB1dChcImdlbmRlclwiLCBmLmdldEdlbmRlcigpKTtcbiAgICAgICAgICAgICAgICBtLnB1dChcImFnZVwiLCBmLmdldEFnZSgpK1wiXCIpO1xuICAgICAgICAgICAgICAgIG0ucHV0KFwidW5pdFwiLCBmLmdldFVuaXQoKSk7XG4gICAgICAgICAgICAgICAgZGF0YUxpc3QuYWRkKG0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBDb21tb25NZXRob2QuZ2V0UmV0dXJuRGF0YShkYXRhTGlzdCk7XG4gICAgfVxuLi4uXG4iLCJpc19lcnJvciI6ZmFsc2UsInJlcXVlc3RfaWQiOiIiLCJ0b29sX3VzZV9pZCI6InRvb2x1X3ZydHhfMDFRcXU1b2JQZVltVVVxZkY1YUNTN0d2In19LHsiaWQiOjIsInR5cGUiOjQsImlkZV9zdGF0ZV9ub2RlIjp7IndvcmtzcGFjZUZvbGRlcnMiOlt7InJlcG9zaXRvcnlSb290IjoiQzovVXNlcnMvcHJpbmNpcC9Eb2N1bWVudHMvR2l0SHViL2JhaWNhaS9qYXZhLXNlcnZlciIsImZvbGRlclJvb3QiOiJDOi9Vc2Vycy9wcmluY2lwL0RvY3VtZW50cy9HaXRIdWIvYmFpY2FpL2phdmEtc2VydmVyIn1dLCJ3b3Jrc3BhY2VGb2xkZXJzVW5jaGFuZ2VkIjpmYWxzZX19XSwidGltZXN0YW1wIjoiMjAyNS0wNS0xNlQxNToxNDo1NC4yMDlaIiwicmVzcG9uc2VfdGV4dCI6IuaIkemcgOimgeafpeeciyBgZmFtaWx5TWVtYmVyU2F2ZWAg5pa55rOV55qE5a6M5pW05a6e546w77yaXG4iLCJ3b3Jrc3BhY2VfZmlsZV9jaHVua3MiOltdfSx7InN0YXR1cyI6InN1Y2Nlc3MiLCJyZXF1ZXN0X2lkIjoiMzY0MTRjOGUtN2NjMy00NTM5LWFlYjQtYTBhMWUyZmExNjU5IiwicmVxdWVzdF9tZXNzYWdlIjoiIiwic3RydWN0dXJlZF9vdXRwdXRfbm9kZXMiOlt7ImlkIjoxLCJ0eXBlIjo1LCJjb250ZW50IjoiIiwidG9vbF91c2UiOnsidG9vbF91c2VfaWQiOiJ0b29sdV92cnR4XzAxUUZOSExLellRWGVicWFEd25mMW5pVCIsInRvb2xfbmFtZSI6InNhdmUtZmlsZSIsImlucHV0X2pzb24iOiJ7XCJmaWxlX3BhdGhcIjogXCJqYXZhLXNlcnZlci9zcmMvbWFpbi9qYXZhL2NuL2VkdS9zZHUvamF2YS9zZXJ2ZXIvc2VydmljZXMvVGVhY2hlclNlcnZpY2VzLmphdmFcIiwgXCJmaWxlX2NvbnRlbnRcIjogXCJwYWNrYWdlIGNuLmVkdS5zZHUuamF2YS5zZXJ2ZXIuc2VydmljZXM7XFxuXFxuaW1wb3J0IGNuLmVkdS5zZHUuamF2YS5zZXJ2ZXIubW9kZWxzLio7XFxuaW1wb3J0IGNuLmVkdS5zZHUuamF2YS5zZXJ2ZXIubW9kZWxzLlRlYWNoZXI7XFxuaW1wb3J0IGNuLmVkdS5zZHUuamF2YS5zZXJ2ZXIucGF5bG9hZC5yZXF1ZXN0LkRhdGFSZXF1ZXN0O1xcbmltcG9ydCBjbi5lZHUuc2R1LmphdmEuc2VydmVyLnBheWxvYWQucmVzcG9uc2UuRGF0YVJlc3BvbnNlO1xcbmltcG9ydCBjbi5lZHUuc2R1LmphdmEuc2VydmVyLnJlcG9zaXRvcnlzLio7XFxuaW1wb3J0IGNuLmVkdS5zZHUuamF2YS5zZXJ2ZXIudXRpbC5Db21EYXRhVXRpbDtcXG5pbXBvcnQgY24uZWR1LnNkdS5qYXZhLnNlcnZlci51dGlsLkNvbW1vbk1ldGhvZDtcXG5pbXBvcnQgY24uZWR1LnNkdS5qYXZhLnNlcnZlci51dGlsLkRhdGVUaW1lVG9vbDtcXG5pbXBvcnQgb3JnLmFwYWNoZS5wb2kueHNzZi51c2VybW9kZWwuKjtcXG5pbXBvcnQgb3JnLnNsZjRqLkxvZ2dlcjtcXG5pbXBvcnQgb3JnLnNsZjRqLkxvZ2dlckZhY3Rvcnk7XFxuaW1wb3J0IG9yZy5zcHJpbmdmcmFtZXdvcmsuZGF0YS5kb21haW4uUGFnZTtcXG5pbXBvcnQgb3JnLnNwcmluZ2ZyYW1ld29yay5kYXRhLmRvbWFpbi5QYWdlUmVxdWVzdDtcXG5pbXBvcnQgb3JnLnNwcmluZ2ZyYW1ld29yay5kYXRhLmRvbWFpbi5QYWdlYWJsZTtcXG5pbXBvcnQgb3JnLnNwcmluZ2ZyYW1ld29yay5odHRwLlJlc3BvbnNlRW50aXR5O1xcbmltcG9ydCBvcmcuc3ByaW5nZnJhbWV3b3JrLnNlY3VyaXR5LmNyeXB0by5wYXNzd29yZC5QYXNzd29yZEVuY29kZXI7XFxuaW1wb3J0IG9yZy5zcHJpbmdmcmFtZXdvcmsuc3RlcmVvdHlwZS5TZXJ2aWNlO1xcbmltcG9ydCBvcmcuc3ByaW5nZnJhbWV3b3JrLndlYi5zZXJ2bGV0Lm12Yy5tZXRob2QuYW5ub3RhdGlvbi5TdHJlYW1pbmdSZXNwb25zZUJvZHk7XFxuXFxuaW1wb3J0IGphdmEudXRpbC4qO1xcblxcbkBTZXJ2aWNlXFxucHVibGljIGNsYXNzIFRlYWNoZXJTZXJ2aWNlcyB7XFxuICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIExvZ2dlciBsb2cgPSBMb2dnZXJGYWN0b3J5LmdldExvZ2dlcihUZWFjaGVyU2VydmljZXMuY2xhc3MpO1xcbiAgICBwcml2YXRlIGZpbmFsIFBlcnNvblJlcG9zaXRvcnkgcGVyc29uUmVwb3NpdG9yeTsgIC8vXFx1NGViYVxcdTU0NThcXHU2NTcwXFx1NjM2ZVxcdTY0Y2RcXHU0ZjVjXFx1ODFlYVxcdTUyYThcXHU2Y2U4XFx1NTE2NVxcbiAgICBwcml2YXRlIGZpbmFsIFRlYWNoZXJSZXBvc2l0b3J5IHRlYWNoZXJSZXBvc2l0b3J5OyAgLy9cXHU2NTU5XFx1NWUwOFxcdTY1NzBcXHU2MzZlXFx1NjRjZFxcdTRmNWNcXHU4MWVhXFx1NTJhOFxcdTZjZThcXHU1MTY1XFxuICAgIHByaXZhdGUgZmluYWwgVXNlclJlcG9zaXRvcnkgdXNlclJlcG9zaXRvcnk7ICAvL1xcdTY1NzBcXHU2MzZlXFx1NjRjZFxcdTRmNWNcXHU4MWVhXFx1NTJhOFxcdTZjZThcXHU1MTY1XFxuICAgIHByaXZhdGUgZmluYWwgVXNlclR5cGVSZXBvc2l0b3J5IHVzZXJUeXBlUmVwb3NpdG9yeTsgLy9cXHU3NTI4XFx1NjIzN1xcdTdjN2JcXHU1NzhiXFx1NjU3MFxcdTYzNmVcXHU2NGNkXFx1NGY1Y1xcdTgxZWFcXHU1MmE4XFx1NmNlOFxcdTUxNjVcXG4gICAgcHJpdmF0ZSBmaW5hbCBQYXNzd29yZEVuY29kZXIgZW5jb2RlcjsgIC8vXFx1NWJjNlxcdTc4MDFcXHU2NzBkXFx1NTJhMVxcdTgxZWFcXHU1MmE4XFx1NmNlOFxcdTUxNjVcXG4gICAgLy9cXHU2ZDg4XFx1OGQzOVxcdTY1NzBcXHU2MzZlXFx1NjRjZFxcdTRmNWNcXHU4MWVhXFx1NTJhOFxcdTZjZThcXHU1MTY1XFxuICAgIHByaXZhdGUgZmluYWwgRmFtaWx5TWVtYmVyUmVwb3NpdG9yeSBmYW1pbHlNZW1iZXJSZXBvc2l0b3J5O1xcbiAgICBwcml2YXRlIGZpbmFsIFN5c3RlbVNlcnZpY2Ugc3lzdGVtU2VydmljZTtcXG4gICAgcHJpdmF0ZSBmaW5hbCBTdHVkZW50UmVwb3NpdG9yeSBzdHVkZW50UmVwb3NpdG9yeTsgLy8gXFx1NmRmYlxcdTUyYTBTdHVkZW50UmVwb3NpdG9yeVxcblxcbiAgICBwdWJsaWMgVGVhY2hlclNlcnZpY2VzKFBlcnNvblJlcG9zaXRvcnkgcGVyc29uUmVwb3NpdG9yeSwgVGVhY2hlclJlcG9zaXRvcnkgdGVhY2hlclJlcG9zaXRvcnksIFVzZXJSZXBvc2l0b3J5IHVzZXJSZXBvc2l0b3J5LCBVc2VyVHlwZVJlcG9zaXRvcnkgdXNlclR5cGVSZXBvc2l0b3J5LCBQYXNzd29yZEVuY29kZXIgZW5jb2RlciwgRmVlUmVwb3NpdG9yeSBmZWVSZXBvc2l0b3J5LCBGYW1pbHlNZW1iZXJSZXBvc2l0b3J5IGZhbWlseU1lbWJlclJlcG9zaXRvcnksIFN5c3RlbVNlcnZpY2Ugc3lzdGVtU2VydmljZSwgU3R1ZGVudFJlcG9zaXRvcnkgc3R1ZGVudFJlcG9zaXRvcnkpIHtcXG4gICAgICAgIHRoaXMucGVyc29uUmVwb3NpdG9yeSA9IHBlcnNvblJlcG9zaXRvcnk7XFxuICAgICAgICB0aGlzLnRlYWNoZXJSZXBvc2l0b3J5ID0gdGVhY2hlclJlcG9zaXRvcnk7XFxuICAgICAgICB0aGlzLnVzZXJSZXBvc2l0b3J5ID0gdXNlclJlcG9zaXRvcnk7XFxuICAgICAgICB0aGlzLnVzZXJUeXBlUmVwb3NpdG9yeSA9IHVzZXJUeXBlUmVwb3NpdG9yeTtcXG4gICAgICAgIHRoaXMuZW5jb2RlciA9IGVuY29kZXI7XFxuICAgICAgICB0aGlzLmZhbWlseU1lbWJlclJlcG9zaXRvcnkgPSBmYW1pbHlNZW1iZXJSZXBvc2l0b3J5O1xcbiAgICAgICAgdGhpcy5zeXN0ZW1TZXJ2aWNlID0gc3lzdGVtU2VydmljZTtcXG4gICAgICAgIHRoaXMuc3R1ZGVudFJlcG9zaXRvcnkgPSBzdHVkZW50UmVwb3NpdG9yeTsgLy8gXFx1NTIxZFxcdTU5Y2JcXHU1MzE2U3R1ZGVudFJlcG9zaXRvcnlcXG4gICAgfVxcblxcbiAgICBwdWJsaWMgTWFwPFN0cmluZywgT2JqZWN0PiBnZXRNYXBGcm9tVGVhY2hlcihUZWFjaGVyIHMpIHtcXG4gICAgICAgIE1hcDxTdHJpbmcsIE9iamVjdD4gbSA9IG5ldyBIYXNoTWFwPD4oKTtcXG4gICAgICAgIFBlcnNvbiBwO1xcbiAgICAgICAgaWYgKHMgPT0gbnVsbClcXG4gICAgICAgICAgICByZXR1cm4gbTtcXG4gICAgICAgIG0ucHV0KFxcXCJ0aXRsZVxcXCIsIHMuZ2V0VGl0bGUoKSk7XFxuICAgICAgICBtLnB1dChcXFwiZGVncmVlXFxcIiwgcy5nZXREZWdyZWUoKSk7XFxuICAgICAgICBtLnB1dChcXFwiY2xhc3NOYW1lXFxcIiwgcy5nZXRDbGFzc05hbWUoKSk7XFxuICAgICAgICBwID0gcy5nZXRQZXJzb24oKTtcXG4gICAgICAgIGlmIChwID09IG51bGwpXFxuICAgICAgICAgICAgcmV0dXJuIG07XFxuICAgICAgICBtLnB1dChcXFwicGVyc29uSWRcXFwiLCBzLmdldFBlcnNvbklkKCkpO1xcbiAgICAgICAgbS5wdXQoXFxcIm51bVxcXCIsIHAuZ2V0TnVtKCkpO1xcbiAgICAgICAgbS5wdXQoXFxcIm5hbWVcXFwiLCBwLmdldE5hbWUoKSk7XFxuICAgICAgICBtLnB1dChcXFwiZGVwdFxcXCIsIHAuZ2V0RGVwdCgpKTtcXG4gICAgICAgIG0ucHV0KFxcXCJjYXJkXFxcIiwgcC5nZXRDYXJkKCkpO1xcbiAgICAgICAgU3RyaW5nIGdlbmRlciA9IHAuZ2V0R2VuZGVyKCk7XFxuICAgICAgICBtLnB1dChcXFwiZ2VuZGVyXFxcIiwgZ2VuZGVyKTtcXG4gICAgICAgIG0ucHV0KFxcXCJnZW5kZXJOYW1lXFxcIiwgQ29tRGF0YVV0aWwuZ2V0SW5zdGFuY2UoKS5nZXREaWN0aW9uYXJ5TGFiZWxCeVZhbHVlKFxcXCJYQk1cXFwiLCBnZW5kZXIpKTsgLy9cXHU2MDI3XFx1NTIyYlxcdTdjN2JcXHU1NzhiXFx1NzY4NFxcdTUwM2NcXHU4ZjZjXFx1NjM2MlxcdTYyMTBcXHU2NTcwXFx1NjM2ZVxcdTdjN2JcXHU1NzhiXFx1NTQwZFxcbiAgICAgICAgbS5wdXQoXFxcImJpcnRoZGF5XFxcIiwgcC5nZXRCaXJ0aGRheSgpKTsgIC8vXFx1NjVmNlxcdTk1ZjRcXHU2ODNjXFx1NWYwZlxcdThmNmNcXHU2MzYyXFx1NWI1N1xcdTdiMjZcXHU0ZTMyXFxuICAgICAgICBtLnB1dChcXFwiZW1haWxcXFwiLCBwLmdldEVtYWlsKCkpO1xcbiAgICAgICAgbS5wdXQoXFxcInBob25lXFxcIiwgcC5nZXRQaG9uZSgpKTtcXG4gICAgICAgIG0ucHV0KFxcXCJhZGRyZXNzXFxcIiwgcC5nZXRBZGRyZXNzKCkpO1xcbiAgICAgICAgbS5wdXQoXFxcImludHJvZHVjZVxcXCIsIHAuZ2V0SW50cm9kdWNlKCkpO1xcbiAgICAgICAgcmV0dXJuIG07XFxuICAgIH1cXG5cXG4gICAgcHVibGljIExpc3Q8TWFwPFN0cmluZywgT2JqZWN0Pj4gZ2V0VGVhY2hlck1hcExpc3QoU3RyaW5nIG51bU5hbWUpIHtcXG4gICAgICAgIExpc3Q8TWFwPFN0cmluZywgT2JqZWN0Pj4gZGF0YUxpc3QgPSBuZXcgQXJyYXlMaXN0PD4oKTtcXG4gICAgICAgIExpc3Q8VGVhY2hlcj4gc0xpc3QgPSB0ZWFjaGVyUmVwb3NpdG9yeS5maW5kVGVhY2hlckxpc3RCeU51bU5hbWUobnVtTmFtZSk7ICAvL1xcdTY1NzBcXHU2MzZlXFx1NWU5M1xcdTY3ZTVcXHU4YmUyXFx1NjRjZFxcdTRmNWNcXG4gICAgICAgIGlmIChzTGlzdCA9PSBudWxsIHx8IHNMaXN0LmlzRW1wdHkoKSlcXG4gICAgICAgICAgICByZXR1cm4gZGF0YUxpc3Q7XFxuICAgICAgICBmb3IgKFRlYWNoZXIgdGVhY2hlciA6IHNMaXN0KSB7XFxuICAgICAgICAgICAgZGF0YUxpc3QuYWRkKGdldE1hcEZyb21UZWFjaGVyKHRlYWNoZXIpKTtcXG4gICAgICAgIH1cXG4gICAgICAgIHJldHVybiBkYXRhTGlzdDtcXG4gICAgfVxcblxcbiAgICBwdWJsaWMgRGF0YVJlc3BvbnNlIGdldFRlYWNoZXJMaXN0KERhdGFSZXF1ZXN0IGRhdGFSZXF1ZXN0KSB7XFxuICAgICAgICBTdHJpbmcgbnVtTmFtZSA9IGRhdGFSZXF1ZXN0LmdldFN0cmluZyhcXFwibnVtTmFtZVxcXCIpO1xcbiAgICAgICAgTGlzdDxNYXA8U3RyaW5nLCBPYmplY3Q+PiBkYXRhTGlzdCA9IGdldFRlYWNoZXJNYXBMaXN0KG51bU5hbWUpO1xcbiAgICAgICAgcmV0dXJuIENvbW1vbk1ldGhvZC5nZXRSZXR1cm5EYXRhKGRhdGFMaXN0KTsgIC8vXFx1NjMwOVxcdTcxNjdcXHU2ZDRiXFx1OGJkNVxcdTY4NDZcXHU2N2I2XFx1ODljNFxcdTgzMDNcXHU0ZjFhXFx1OTAwMU1hcFxcdTc2ODRsaXN0XFxuICAgIH1cXG5cXG4gICAgcHVibGljIERhdGFSZXNwb25zZSB0ZWFjaGVyRGVsZXRlKERhdGFSZXF1ZXN0IGRhdGFSZXF1ZXN0KSB7XFxuICAgICAgICBJbnRlZ2VyIHBlcnNvbklkID0gZGF0YVJlcXVlc3QuZ2V0SW50ZWdlcihcXFwicGVyc29uSWRcXFwiKTsgIC8vXFx1ODNiN1xcdTUzZDZ0ZWFjaGVyX2lkXFx1NTAzY1xcbiAgICAgICAgVGVhY2hlciBzID0gbnVsbDtcXG4gICAgICAgIE9wdGlvbmFsPFRlYWNoZXI+IG9wO1xcbiAgICAgICAgaWYgKHBlcnNvbklkICE9IG51bGwgJiYgcGVyc29uSWQgPiAwKSB7XFxuICAgICAgICAgICAgb3AgPSB0ZWFjaGVyUmVwb3NpdG9yeS5maW5kQnlJZChwZXJzb25JZCk7ICAgLy9cXHU2N2U1XFx1OGJlMlxcdTgzYjdcXHU1Zjk3XFx1NWI5ZVxcdTRmNTNcXHU1YmY5XFx1OGM2MVxcbiAgICAgICAgICAgIGlmIChvcC5pc1ByZXNlbnQoKSkge1xcbiAgICAgICAgICAgICAgICBzID0gb3AuZ2V0KCk7XFxuICAgICAgICAgICAgICAgIE9wdGlvbmFsPFVzZXI+IHVPcCA9IHVzZXJSZXBvc2l0b3J5LmZpbmRCeUlkKHBlcnNvbklkKTsgLy9cXHU2N2U1XFx1OGJlMlxcdTViZjlcXHU1ZTk0XFx1OGJlNVxcdTY1NTlcXHU1ZTA4XFx1NzY4NFxcdThkMjZcXHU2MjM3XFxuICAgICAgICAgICAgICAgIC8vXFx1NTIyMFxcdTk2NjRcXHU1YmY5XFx1NWU5NFxcdThiZTVcXHU2NTU5XFx1NWUwOFxcdTc2ODRcXHU4ZDI2XFx1NjIzN1xcbiAgICAgICAgICAgICAgICB1T3AuaWZQcmVzZW50KHVzZXJSZXBvc2l0b3J5OjpkZWxldGUpO1xcbiAgICAgICAgICAgICAgICBQZXJzb24gcCA9IHMuZ2V0UGVyc29uKCk7XFxuICAgICAgICAgICAgICAgIHRlYWNoZXJSZXBvc2l0b3J5LmRlbGV0ZShzKTsgICAgLy9cXHU5OTk2XFx1NTE0OFxcdTY1NzBcXHU2MzZlXFx1NWU5M1xcdTZjMzhcXHU0ZTQ1XFx1NTIyMFxcdTk2NjRcXHU2NTU5XFx1NWUwOFxcdTRmZTFcXHU2MDZmXFxuICAgICAgICAgICAgICAgIHBlcnNvblJlcG9zaXRvcnkuZGVsZXRlKHApO1xcbiAgICAgICAgICAgIH1cXG4gICAgICAgIH1cXG4gICAgICAgIHJldHVybiBDb21tb25NZXRob2QuZ2V0UmV0dXJuTWVzc2FnZU9LKCk7ICAvL1xcdTkwMWFcXHU3N2U1XFx1NTI0ZFxcdTdhZWZcXHU2NGNkXFx1NGY1Y1xcdTZiNjNcXHU1ZTM4XFxuICAgIH1cXG5cXG4gICAgcHVibGljIERhdGFSZXNwb25zZSBnZXRUZWFjaGVySW5mbyhEYXRhUmVxdWVzdCBkYXRhUmVxdWVzdCkge1xcbiAgICAgICAgSW50ZWdlciBwZXJzb25JZCA9IGRhdGFSZXF1ZXN0LmdldEludGVnZXIoXFxcInBlcnNvbklkXFxcIik7XFxuICAgICAgICBUZWFjaGVyIHMgPSBudWxsO1xcbiAgICAgICAgT3B0aW9uYWw8VGVhY2hlcj4gb3A7XFxuICAgICAgICBpZiAocGVyc29uSWQgIT0gbnVsbCkge1xcbiAgICAgICAgICAgIG9wID0gdGVhY2hlclJlcG9zaXRvcnkuZmluZEJ5SWQocGVyc29uSWQpOyAvL1xcdTY4MzlcXHU2MzZlXFx1NWI2NlxcdTc1MWZcXHU0ZTNiXFx1OTUyZVxcdTRlY2VcXHU2NTcwXFx1NjM2ZVxcdTVlOTNcXHU2N2U1XFx1OGJlMlxcdTViNjZcXHU3NTFmXFx1NzY4NFxcdTRmZTFcXHU2MDZmXFxuICAgICAgICAgICAgaWYgKG9wLmlzUHJlc2VudCgpKSB7XFxuICAgICAgICAgICAgICAgIHMgPSBvcC5nZXQoKTtcXG4gICAgICAgICAgICB9XFxuICAgICAgICB9XFxuICAgICAgICByZXR1cm4gQ29tbW9uTWV0aG9kLmdldFJldHVybkRhdGEoZ2V0TWFwRnJvbVRlYWNoZXIocykpOyAvL1xcdThmZDlcXHU5MWNjXFx1NTZkZVxcdTRmMjBcXHU1MzA1XFx1NTQyYlxcdTViNjZcXHU3NTFmXFx1NGZlMVxcdTYwNmZcXHU3Njg0TWFwXFx1NWJmOVxcdThjNjFcXG4gICAgfVxcblxcbiAgICBwdWJsaWMgRGF0YVJlc3BvbnNlIHRlYWNoZXJFZGl0U2F2ZShEYXRhUmVxdWVzdCBkYXRhUmVxdWVzdCkge1xcbiAgICAgICAgSW50ZWdlciBwZXJzb25JZCA9IGRhdGFSZXF1ZXN0LmdldEludGVnZXIoXFxcInBlcnNvbklkXFxcIik7XFxuICAgICAgICBNYXA8U3RyaW5nLCBPYmplY3Q+IGZvcm0gPSBkYXRhUmVxdWVzdC5nZXRNYXAoXFxcImZvcm1cXFwiKTsgLy9cXHU1M2MyXFx1NjU3MFxcdTgzYjdcXHU1M2Q2TWFwXFx1NWJmOVxcdThjNjFcXG4gICAgICAgIFN0cmluZyBudW0gPSBDb21tb25NZXRob2QuZ2V0U3RyaW5nKGZvcm0sIFxcXCJudW1cXFwiKTsgIC8vTWFwIFxcdTgzYjdcXHU1M2Q2XFx1NWM1ZVxcdTYwMjdcXHU3Njg0XFx1NTAzY1xcbiAgICAgICAgVGVhY2hlciBzID0gbnVsbDtcXG4gICAgICAgIFBlcnNvbiBwO1xcbiAgICAgICAgVXNlciB1O1xcbiAgICAgICAgT3B0aW9uYWw8VGVhY2hlcj4gb3A7XFxuICAgICAgICBib29sZWFuIGlzTmV3ID0gZmFsc2U7XFxuICAgICAgICBpZiAocGVyc29uSWQgIT0gbnVsbCkge1xcbiAgICAgICAgICAgIG9wID0gdGVhY2hlclJlcG9zaXRvcnkuZmluZEJ5SWQocGVyc29uSWQpOyAgLy9cXHU2N2U1XFx1OGJlMlxcdTViZjlcXHU1ZTk0XFx1NjU3MFxcdTYzNmVcXHU1ZTkzXFx1NGUyZFxcdTRlM2JcXHU5NTJlXFx1NGUzYWlkXFx1NzY4NFxcdTUwM2NcXHU3Njg0XFx1NWI5ZVxcdTRmNTNcXHU1YmY5XFx1OGM2MVxcbiAgICAgICAgICAgIGlmIChvcC5pc1ByZXNlbnQoKSkge1xcbiAgICAgICAgICAgICAgICBzID0gb3AuZ2V0KCk7XFxuICAgICAgICAgICAgfVxcbiAgICAgICAgfVxcbiAgICAgICAgT3B0aW9uYWw8UGVyc29uPiBuT3AgPSBwZXJzb25SZXBvc2l0b3J5LmZpbmRCeU51bShudW0pOyAvL1xcdTY3ZTVcXHU4YmUyXFx1NjYyZlxcdTU0MjZcXHU1YjU4XFx1NTcyOG51bVxcdTc2ODRcXHU0ZWJhXFx1NTQ1OFxcbiAgICAgICAgaWYgKG5PcC5pc1ByZXNlbnQoKSkge1xcbiAgICAgICAgICAgIGlmIChzID09IG51bGwgfHwgIXMuZ2V0UGVyc29uKCkuZ2V0TnVtKCkuZXF1YWxzKG51bSkpIHtcXG4gICAgICAgICAgICAgICAgcmV0dXJuIENvbW1vbk1ldGhvZC5nZXRSZXR1cm5NZXNzYWdlRXJyb3IoXFxcIlxcdTY1YjBcXHU1ZGU1XFx1NTNmN1xcdTVkZjJcXHU3ZWNmXFx1NWI1OFxcdTU3MjhcXHVmZjBjXFx1NGUwZFxcdTgwZmRcXHU2ZGZiXFx1NTJhMFxcdTYyMTZcXHU0ZmVlXFx1NjUzOVxcdWZmMDFcXFwiKTtcXG4gICAgICAgICAgICB9XFxuICAgICAgICB9XFxuICAgICAgICBpZiAocyA9PSBudWxsKSB7XFxuICAgICAgICAgICAgcCA9IG5ldyBQZXJzb24oKTtcXG4gICAgICAgICAgICBwLnNldE51bShudW0pO1xcbiAgICAgICAgICAgIHAuc2V0VHlwZShcXFwiMlxcXCIpOyAgLy8gMlxcdTg4NjhcXHU3OTNhXFx1NjU1OVxcdTVlMDhcXHU3YzdiXFx1NTc4YlxcbiAgICAgICAgICAgIHBlcnNvblJlcG9zaXRvcnkuc2F2ZUFuZEZsdXNoKHApOyAgLy9cXHU2M2QyXFx1NTE2NVxcdTY1YjBcXHU3Njg0UGVyc29uXFx1OGJiMFxcdTVmNTVcXG4gICAgICAgICAgICBwZXJzb25JZCA9IHAuZ2V0UGVyc29uSWQoKTtcXG4gICAgICAgICAgICBTdHJpbmcgcGFzc3dvcmQgPSBlbmNvZGVyLmVuY29kZShcXFwiMTIzNDU2XFxcIik7XFxuICAgICAgICAgICAgdSA9IG5ldyBVc2VyKCk7XFxuICAgICAgICAgICAgdS5zZXRQZXJzb25JZChwZXJzb25JZCk7XFxuICAgICAgICAgICAgdS5zZXRVc2VyTmFtZShudW0pO1xcbiAgICAgICAgICAgIHUuc2V0UGFzc3dvcmQocGFzc3dvcmQpO1xcbiAgICAgICAgICAgIHUuc2V0VXNlclR5cGUodXNlclR5cGVSZXBvc2l0b3J5LmZpbmRCeU5hbWUoRVVzZXJUeXBlLlJPTEVfVEVBQ0hFUikpOyAgLy8gXFx1OGJiZVxcdTdmNmVcXHU0ZTNhXFx1NjU1OVxcdTVlMDhcXHU4OWQyXFx1ODI3MlxcbiAgICAgICAgICAgIHUuc2V0Q3JlYXRlVGltZShEYXRlVGltZVRvb2wucGFyc2VEYXRlVGltZShuZXcgRGF0ZSgpKSk7XFxuICAgICAgICAgICAgdS5zZXRDcmVhdG9ySWQoQ29tbW9uTWV0aG9kLmdldFBlcnNvbklkKCkpO1xcbiAgICAgICAgICAgIHVzZXJSZXBvc2l0b3J5LnNhdmVBbmRGbHVzaCh1KTsgLy9cXHU2M2QyXFx1NTE2NVxcdTY1YjBcXHU3Njg0VXNlclxcdThiYjBcXHU1ZjU1XFxuICAgICAgICAgICAgcyA9IG5ldyBUZWFjaGVyKCk7ICAgLy8gXFx1NTIxYlxcdTVlZmFcXHU1YjllXFx1NGY1M1xcdTViZjlcXHU4YzYxXFxuICAgICAgICAgICAgcy5zZXRQZXJzb25JZChwZXJzb25JZCk7XFxuICAgICAgICAgICAgdGVhY2hlclJlcG9zaXRvcnkuc2F2ZUFuZEZsdXNoKHMpOyAgLy9cXHU2M2QyXFx1NTE2NVxcdTY1YjBcXHU3Njg0VGVhY2hlclxcdThiYjBcXHU1ZjU1XFxuICAgICAgICAgICAgaXNOZXcgPSB0cnVlO1xcbiAgICAgICAgfSBlbHNlIHtcXG4gICAgICAgICAgICBwID0gcy5nZXRQZXJzb24oKTtcXG4gICAgICAgIH1cXG4gICAgICAgIHBlcnNvbklkID0gcC5nZXRQZXJzb25JZCgpO1xcbiAgICAgICAgaWYgKCFudW0uZXF1YWxzKHAuZ2V0TnVtKCkpKSB7ICAgLy9cXHU1OTgyXFx1Njc5Y1xcdTRlYmFcXHU1NDU4XFx1N2YxNlxcdTUzZjdcXHU1M2Q4XFx1NTMxNlxcdWZmMGNcXHU0ZmVlXFx1NjUzOVxcdTRlYmFcXHU1NDU4XFx1N2YxNlxcdTUzZjdcXHU1NDhjXFx1NzY3YlxcdTVmNTVcXHU4ZDI2XFx1NTNmN1xcbiAgICAgICAgICAgIE9wdGlvbmFsPFVzZXI+IHVPcCA9IHVzZXJSZXBvc2l0b3J5LmZpbmRCeVBlcnNvblBlcnNvbklkKHBlcnNvbklkKTtcXG4gICAgICAgICAgICBpZiAodU9wLmlzUHJlc2VudCgpKSB7XFxuICAgICAgICAgICAgICAgIHUgPSB1T3AuZ2V0KCk7XFxuICAgICAgICAgICAgICAgIHUuc2V0VXNlck5hbWUobnVtKTtcXG4gICAgICAgICAgICAgICAgdXNlclJlcG9zaXRvcnkuc2F2ZUFuZEZsdXNoKHUpO1xcbiAgICAgICAgICAgIH1cXG4gICAgICAgICAgICBwLnNldE51bShudW0pOyAgLy9cXHU4YmJlXFx1N2Y2ZVxcdTVjNWVcXHU2MDI3XFxuICAgICAgICB9XFxuICAgICAgICBwLnNldE5hbWUoQ29tbW9uTWV0aG9kLmdldFN0cmluZyhmb3JtLCBcXFwibmFtZVxcXCIpKTtcXG4gICAgICAgIHAuc2V0RGVwdChDb21tb25NZXRob2QuZ2V0U3RyaW5nKGZvcm0sIFxcXCJkZXB0XFxcIikpO1xcbiAgICAgICAgcC5zZXRDYXJkKENvbW1vbk1ldGhvZC5nZXRTdHJpbmcoZm9ybSwgXFxcImNhcmRcXFwiKSk7XFxuICAgICAgICBwLnNldEdlbmRlcihDb21tb25NZXRob2QuZ2V0U3RyaW5nKGZvcm0sIFxcXCJnZW5kZXJcXFwiKSk7XFxuICAgICAgICBwLnNldEJpcnRoZGF5KENvbW1vbk1ldGhvZC5nZXRTdHJpbmcoZm9ybSwgXFxcImJpcnRoZGF5XFxcIikpO1xcbiAgICAgICAgcC5zZXRFbWFpbChDb21tb25NZXRob2QuZ2V0U3RyaW5nKGZvcm0sIFxcXCJlbWFpbFxcXCIpKTtcXG4gICAgICAgIHAuc2V0UGhvbmUoQ29tbW9uTWV0aG9kLmdldFN0cmluZyhmb3JtLCBcXFwicGhvbmVcXFwiKSk7XFxuICAgICAgICBwLnNldEFkZHJlc3MoQ29tbW9uTWV0aG9kLmdldFN0cmluZyhmb3JtLCBcXFwiYWRkcmVzc1xcXCIpKTtcXG4gICAgICAgIHBlcnNvblJlcG9zaXRvcnkuc2F2ZShwKTsgIC8vIFxcdTRmZWVcXHU2NTM5XFx1NGZkZFxcdTViNThcXHU0ZWJhXFx1NTQ1OFxcdTRmZTFcXHU2MDZmXFxuICAgICAgICBzLnNldENsYXNzTmFtZShDb21tb25NZXRob2QuZ2V0U3RyaW5nKGZvcm0sIFxcXCJjbGFzc05hbWVcXFwiKSk7XFxuICAgICAgICB0ZWFjaGVyUmVwb3NpdG9yeS5zYXZlKHMpOyAgLy9cXHU0ZmVlXFx1NjUzOVxcdTRmZGRcXHU1YjU4XFx1NWI2NlxcdTc1MWZcXHU0ZmUxXFx1NjA2ZlxcbiAgICAgICAgc3lzdGVtU2VydmljZS5tb2RpZnlMb2cocywgaXNOZXcpO1xcbiAgICAgICAgcmV0dXJuIENvbW1vbk1ldGhvZC5nZXRSZXR1cm5EYXRhKHMuZ2V0UGVyc29uSWQoKSk7ICAvLyBcXHU1YzA2cGVyc29uSWRcXHU4ZmQ0XFx1NTZkZVxcdTUyNGRcXHU3YWVmXFxuICAgIH1cXG5cXG4gICAgcHVibGljIFJlc3BvbnNlRW50aXR5PFN0cmVhbWluZ1Jlc3BvbnNlQm9keT4gZ2V0VGVhY2hlckxpc3RFeGNsKERhdGFSZXF1ZXN0IGRhdGFSZXF1ZXN0KSB7XFxuICAgICAgICBTdHJpbmcgbnVtTmFtZSA9IGRhdGFSZXF1ZXN0LmdldFN0cmluZyhcXFwibnVtTmFtZVxcXCIpO1xcbiAgICAgICAgTGlzdDxNYXA8U3RyaW5nLCBPYmplY3Q+PiBsaXN0ID0gZ2V0VGVhY2hlck1hcExpc3QobnVtTmFtZSk7XFxuXFxuICAgICAgICAvLyBcXHU4YzAzXFx1NjU3NFxcdTUyMTdcXHU1YmJkXFx1OTE0ZFxcdTdmNmVcXG4gICAgICAgIEludGVnZXJbXSB3aWR0aHMgPSB7OCwgMTUsIDEwLCAyMCwgMTUsIDEwLCA4LCAyNSwgMTUsIDMwfTtcXG4gICAgICAgIFN0cmluZ1tdIHRpdGxlcyA9IHtcXFwiXFx1NWU4ZlxcdTUzZjdcXFwiLCBcXFwiXFx1NWRlNVxcdTUzZjdcXFwiLCBcXFwiXFx1NTlkM1xcdTU0MGRcXFwiLCBcXFwiXFx1NWI2NlxcdTk2NjJcXFwiLCBcXFwiXFx1ODA0Y1xcdTc5ZjBcXFwiLCBcXFwiXFx1NWI2NlxcdTRmNGRcXFwiLCBcXFwiXFx1NjAyN1xcdTUyMmJcXFwiLCBcXFwiXFx1OTBhZVxcdTdiYjFcXFwiLCBcXFwiXFx1NzUzNVxcdThiZGRcXFwiLCBcXFwiXFx1NTczMFxcdTU3NDBcXFwifTtcXG4gICAgICAgIFN0cmluZyBvdXRQdXRTaGVldE5hbWUgPSBcXFwidGVhY2hlci54bHN4XFxcIjtcXG5cXG4gICAgICAgIFhTU0ZXb3JrYm9vayB3YiA9IG5ldyBYU1NGV29ya2Jvb2soKTtcXG4gICAgICAgIFhTU0ZTaGVldCBzaGVldCA9IHdiLmNyZWF0ZVNoZWV0KG91dFB1dFNoZWV0TmFtZSk7XFxuXFxuICAgICAgICAvLyBcXHU4YmJlXFx1N2Y2ZVxcdTUyMTdcXHU1YmJkXFxuICAgICAgICBmb3IgKGludCBqID0gMDsgaiA8IHdpZHRocy5sZW5ndGg7IGorKykge1xcbiAgICAgICAgICAgIHNoZWV0LnNldENvbHVtbldpZHRoKGosIHdpZHRoc1tqXSAqIDI1Nik7XFxuICAgICAgICB9XFxuXFxuICAgICAgICAvLyBcXHU1MjFiXFx1NWVmYVxcdTY4MDdcXHU5ODk4XFx1ODg0Y1xcdTY4MzdcXHU1ZjBmXFxuICAgICAgICBYU1NGQ2VsbFN0eWxlIHN0eWxlID0gQ29tbW9uTWV0aG9kLmNyZWF0ZUNlbGxTdHlsZSh3YiwgMTEpO1xcbiAgICAgICAgWFNTRlJvdyByb3cgPSBzaGVldC5jcmVhdGVSb3coMCk7XFxuICAgICAgICBYU1NGQ2VsbFtdIGNlbGwgPSBuZXcgWFNTRkNlbGxbd2lkdGhzLmxlbmd0aF07XFxuXFxuICAgICAgICAvLyBcXHU1ODZiXFx1NTE0NVxcdTY4MDdcXHU5ODk4XFx1ODg0Y1xcbiAgICAgICAgZm9yIChpbnQgaiA9IDA7IGogPCB3aWR0aHMubGVuZ3RoOyBqKyspIHtcXG4gICAgICAgICAgICBjZWxsW2pdID0gcm93LmNyZWF0ZUNlbGwoaik7XFxuICAgICAgICAgICAgY2VsbFtqXS5zZXRDZWxsU3R5bGUoc3R5bGUpO1xcbiAgICAgICAgICAgIGNlbGxbal0uc2V0Q2VsbFZhbHVlKHRpdGxlc1tqXSk7XFxuICAgICAgICB9XFxuXFxuICAgICAgICAvLyBcXHU1ODZiXFx1NTE0NVxcdTY1NzBcXHU2MzZlXFx1ODg0Y1xcbiAgICAgICAgaWYgKGxpc3QgIT0gbnVsbCAmJiAhbGlzdC5pc0VtcHR5KCkpIHtcXG4gICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGxpc3Quc2l6ZSgpOyBpKyspIHtcXG4gICAgICAgICAgICAgICAgcm93ID0gc2hlZXQuY3JlYXRlUm93KGkgKyAxKTtcXG4gICAgICAgICAgICAgICAgTWFwPFN0cmluZywgT2JqZWN0PiBtID0gbGlzdC5nZXQoaSk7XFxuXFxuICAgICAgICAgICAgICAgIC8vIFxcdTUyMWJcXHU1ZWZhXFx1NTM1NVxcdTUxNDNcXHU2ODNjXFx1NWU3NlxcdThiYmVcXHU3ZjZlXFx1NjgzN1xcdTVmMGZcXG4gICAgICAgICAgICAgICAgZm9yIChpbnQgaiA9IDA7IGogPCB3aWR0aHMubGVuZ3RoOyBqKyspIHtcXG4gICAgICAgICAgICAgICAgICAgIGNlbGxbal0gPSByb3cuY3JlYXRlQ2VsbChqKTtcXG4gICAgICAgICAgICAgICAgICAgIGNlbGxbal0uc2V0Q2VsbFN0eWxlKHN0eWxlKTtcXG4gICAgICAgICAgICAgICAgfVxcblxcbiAgICAgICAgICAgICAgICAvLyBcXHU1ODZiXFx1NTE0NVxcdTUxNzdcXHU0ZjUzXFx1NjU3MFxcdTYzNmVcXG4gICAgICAgICAgICAgICAgY2VsbFswXS5zZXRDZWxsVmFsdWUoKGkgKyAxKSArIFxcXCJcXFwiKTsgLy8gXFx1NWU4ZlxcdTUzZjdcXG4gICAgICAgICAgICAgICAgY2VsbFsxXS5zZXRDZWxsVmFsdWUoQ29tbW9uTWV0aG9kLmdldFN0cmluZyhtLCBcXFwibnVtXFxcIikpOyAvLyBcXHU1ZGU1XFx1NTNmN1xcbiAgICAgICAgICAgICAgICBjZWxsWzJdLnNldENlbGxWYWx1ZShDb21tb25NZXRob2QuZ2V0U3RyaW5nKG0sIFxcXCJuYW1lXFxcIikpOyAvLyBcXHU1OWQzXFx1NTQwZFxcbiAgICAgICAgICAgICAgICBjZWxsWzNdLnNldENlbGxWYWx1ZShDb21tb25NZXRob2QuZ2V0U3RyaW5nKG0sIFxcXCJkZXB0XFxcIikpOyAvLyBcXHU1YjY2XFx1OTY2MlxcbiAgICAgICAgICAgICAgICBjZWxsWzRdLnNldENlbGxWYWx1ZShDb21tb25NZXRob2QuZ2V0U3RyaW5nKG0sIFxcXCJ0aXRsZVxcXCIpKTsgLy8gXFx1ODA0Y1xcdTc5ZjBcXG4gICAgICAgICAgICAgICAgY2VsbFs1XS5zZXRDZWxsVmFsdWUoQ29tbW9uTWV0aG9kLmdldFN0cmluZyhtLCBcXFwiZGVncmVlXFxcIikpOyAvLyBcXHU1YjY2XFx1NGY0ZFxcbiAgICAgICAgICAgICAgICBjZWxsWzZdLnNldENlbGxWYWx1ZShDb21tb25NZXRob2QuZ2V0U3RyaW5nKG0sIFxcXCJnZW5kZXJOYW1lXFxcIikpOyAvLyBcXHU2MDI3XFx1NTIyYlxcbiAgICAgICAgICAgICAgICBjZWxsWzddLnNldENlbGxWYWx1ZShDb21tb25NZXRob2QuZ2V0U3RyaW5nKG0sIFxcXCJlbWFpbFxcXCIpKTsgLy8gXFx1OTBhZVxcdTdiYjFcXG4gICAgICAgICAgICAgICAgY2VsbFs4XS5zZXRDZWxsVmFsdWUoQ29tbW9uTWV0aG9kLmdldFN0cmluZyhtLCBcXFwicGhvbmVcXFwiKSk7IC8vIFxcdTc1MzVcXHU4YmRkXFxuICAgICAgICAgICAgICAgIGNlbGxbOV0uc2V0Q2VsbFZhbHVlKENvbW1vbk1ldGhvZC5nZXRTdHJpbmcobSwgXFxcImFkZHJlc3NcXFwiKSk7IC8vIFxcdTU3MzBcXHU1NzQwXFxuICAgICAgICAgICAgfVxcbiAgICAgICAgfVxcblxcbiAgICAgICAgdHJ5IHtcXG4gICAgICAgICAgICBTdHJlYW1pbmdSZXNwb25zZUJvZHkgc3RyZWFtID0gd2I6OndyaXRlO1xcbiAgICAgICAgICAgIHJldHVybiBSZXNwb25zZUVudGl0eS5vaygpXFxuICAgICAgICAgICAgICAgICAgICAuY29udGVudFR5cGUoQ29tbW9uTWV0aG9kLmV4ZWxUeXBlKVxcbiAgICAgICAgICAgICAgICAgICAgLmJvZHkoc3RyZWFtKTtcXG4gICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7XFxuICAgICAgICAgICAgcmV0dXJuIFJlc3BvbnNlRW50aXR5LmludGVybmFsU2VydmVyRXJyb3IoKS5idWlsZCgpO1xcbiAgICAgICAgfVxcbiAgICB9XFxuXFxuICAgIHB1YmxpYyBEYXRhUmVzcG9uc2UgZ2V0VGVhY2hlclBhZ2VEYXRhKERhdGFSZXF1ZXN0IGRhdGFSZXF1ZXN0KSB7XFxuICAgICAgICBTdHJpbmcgbnVtTmFtZSA9IGRhdGFSZXF1ZXN0LmdldFN0cmluZyhcXFwibnVtTmFtZVxcXCIpO1xcbiAgICAgICAgSW50ZWdlciBjUGFnZSA9IGRhdGFSZXF1ZXN0LmdldEN1cnJlbnRQYWdlKCk7XFxuICAgICAgICBpbnQgZGF0YVRvdGFsID0gMDtcXG4gICAgICAgIGludCBzaXplID0gNDA7XFxuICAgICAgICBMaXN0PE1hcDxTdHJpbmcsIE9iamVjdD4+IGRhdGFMaXN0ID0gbmV3IEFycmF5TGlzdDw+KCk7XFxuICAgICAgICBQYWdlPFRlYWNoZXI+IHBhZ2UgPSBudWxsO1xcbiAgICAgICAgUGFnZWFibGUgcGFnZWFibGUgPSBQYWdlUmVxdWVzdC5vZihjUGFnZSwgc2l6ZSk7XFxuICAgICAgICBwYWdlID0gdGVhY2hlclJlcG9zaXRvcnkuZmluZFRlYWNoZXJMaXN0QnlOdW1OYW1lKG51bU5hbWUsIHBhZ2VhYmxlKTtcXG4gICAgICAgIE1hcDxTdHJpbmcsIE9iamVjdD4gbTtcXG4gICAgICAgIGlmIChwYWdlICE9IG51bGwpIHtcXG4gICAgICAgICAgICBkYXRhVG90YWwgPSAoaW50KSBwYWdlLmdldFRvdGFsRWxlbWVudHMoKTtcXG4gICAgICAgICAgICBMaXN0PFRlYWNoZXI+IGxpc3QgPSBwYWdlLmdldENvbnRlbnQoKTtcXG4gICAgICAgICAgICBpZiAoIWxpc3QuaXNFbXB0eSgpKSB7XFxuICAgICAgICAgICAgICAgIGZvciAoVGVhY2hlciB0ZWFjaGVyIDogbGlzdCkge1xcbiAgICAgICAgICAgICAgICAgICAgbSA9IGdldE1hcEZyb21UZWFjaGVyKHRlYWNoZXIpO1xcbiAgICAgICAgICAgICAgICAgICAgZGF0YUxpc3QuYWRkKG0pO1xcbiAgICAgICAgICAgICAgICB9XFxuICAgICAgICAgICAgfVxcbiAgICAgICAgfVxcbiAgICAgICAgTWFwPFN0cmluZywgT2JqZWN0PiBkYXRhID0gbmV3IEhhc2hNYXA8PigpO1xcbiAgICAgICAgZGF0YS5wdXQoXFxcImRhdGFUb3RhbFxcXCIsIGRhdGFUb3RhbCk7XFxuICAgICAgICBkYXRhLnB1dChcXFwicGFnZVNpemVcXFwiLCBzaXplKTtcXG4gICAgICAgIGRhdGEucHV0KFxcXCJkYXRhTGlzdFxcXCIsIGRhdGFMaXN0KTtcXG4gICAgICAgIHJldHVybiBDb21tb25NZXRob2QuZ2V0UmV0dXJuRGF0YShkYXRhKTtcXG4gICAgfVxcbiAgICBcXG4gICAgcHVibGljIERhdGFSZXNwb25zZSBnZXRGYW1pbHlNZW1iZXJMaXN0KERhdGFSZXF1ZXN0IGRhdGFSZXF1ZXN0KSB7XFxuICAgICAgICBJbnRlZ2VyIHBlcnNvbklkID0gZGF0YVJlcXVlc3QuZ2V0SW50ZWdlcihcXFwicGVyc29uSWRcXFwiKTtcXG4gICAgICAgIExpc3Q8RmFtaWx5TWVtYmVyPiBmTGlzdCA9IGZhbWlseU1lbWJlclJlcG9zaXRvcnkuZmluZEJ5U3R1ZGVudFBlcnNvbklkKHBlcnNvbklkKTtcXG4gICAgICAgIExpc3Q8TWFwPFN0cmluZyxPYmplY3Q+PiBkYXRhTGlzdCA9IG5ldyBBcnJheUxpc3Q8PigpO1xcbiAgICAgICAgTWFwPFN0cmluZyxPYmplY3Q+IG07XFxuICAgICAgICBpZiAoZkxpc3QgIT0gbnVsbCkge1xcbiAgICAgICAgICAgIGZvciAoRmFtaWx5TWVtYmVyIGYgOiBmTGlzdCkge1xcbiAgICAgICAgICAgICAgICBtID0gbmV3IEhhc2hNYXA8PigpO1xcbiAgICAgICAgICAgICAgICBtLnB1dChcXFwibWVtYmVySWRcXFwiLCBmLmdldE1lbWJlcklkKCkpO1xcbiAgICAgICAgICAgICAgICBtLnB1dChcXFwicGVyc29uSWRcXFwiLCBmLmdldFN0dWRlbnQoKS5nZXRQZXJzb25JZCgpKTtcXG4gICAgICAgICAgICAgICAgbS5wdXQoXFxcInJlbGF0aW9uXFxcIiwgZi5nZXRSZWxhdGlvbigpKTtcXG4gICAgICAgICAgICAgICAgbS5wdXQoXFxcIm5hbWVcXFwiLCBmLmdldE5hbWUoKSk7XFxuICAgICAgICAgICAgICAgIG0ucHV0KFxcXCJnZW5kZXJcXFwiLCBmLmdldEdlbmRlcigpKTtcXG4gICAgICAgICAgICAgICAgbS5wdXQoXFxcImFnZVxcXCIsIGYuZ2V0QWdlKCkrXFxcIlxcXCIpO1xcbiAgICAgICAgICAgICAgICBtLnB1dChcXFwidW5pdFxcXCIsIGYuZ2V0VW5pdCgpKTtcXG4gICAgICAgICAgICAgICAgZGF0YUxpc3QuYWRkKG0pO1xcbiAgICAgICAgICAgIH1cXG4gICAgICAgIH1cXG4gICAgICAgIHJldHVybiBDb21tb25NZXRob2QuZ2V0UmV0dXJuRGF0YShkYXRhTGlzdCk7XFxuICAgIH1cXG4gICAgXFxuICAgIHB1YmxpYyBEYXRhUmVzcG9uc2UgZmFtaWx5TWVtYmVyU2F2ZShEYXRhUmVxdWVzdCBkYXRhUmVxdWVzdCkge1xcbiAgICAgICAgTWFwPFN0cmluZyxPYmplY3Q+IGZvcm0gPSBkYXRhUmVxdWVzdC5nZXRNYXAoXFxcImZvcm1cXFwiKTtcXG4gICAgICAgIEludGVnZXIgcGVyc29uSWQgPSBDb21tb25NZXRob2QuZ2V0SW50ZWdlcihmb3JtLFxcXCJwZXJzb25JZFxcXCIpO1xcbiAgICAgICAgSW50ZWdlciBtZW1iZXJJZCA9IENvbW1vbk1ldGhvZC5nZXRJbnRlZ2VyKGZvcm0sXFxcIm1lbWJlcklkXFxcIik7XFxuICAgICAgICBPcHRpb25hbDxGYW1pbHlNZW1iZXI+IG9wO1xcbiAgICAgICAgRmFtaWx5TWVtYmVyIGYgPSBudWxsO1xcbiAgICAgICAgaWYobWVtYmVySWQgIT0gbnVsbCkge1xcbiAgICAgICAgICAgIG9wID0gZmFtaWx5TWVtYmVyUmVwb3NpdG9yeS5maW5kQnlJZChtZW1iZXJJZCk7XFxuICAgICAgICAgICAgaWYob3AuaXNQcmVzZW50KCkpIHtcXG4gICAgICAgICAgICAgICAgZiA9IG9wLmdldCgpO1xcbiAgICAgICAgICAgIH1cXG4gICAgICAgIH1cXG4gICAgICAgIGlmKGYgPT0gbnVsbCkge1xcbiAgICAgICAgICAgIGYgPSBuZXcgRmFtaWx5TWVtYmVyKCk7XFxuICAgICAgICAgICAgYXNzZXJ0IHBlcnNvbklkICE9IG51bGw7XFxuICAgICAgICAgICAgLy8gXFx1NTIxYlxcdTVlZmFcXHU0ZTAwXFx1NGUyYVN0dWRlbnRcXHU1YmY5XFx1OGM2MVxcdTVlNzZcXHU4YmJlXFx1N2Y2ZVxcdTUyMzBGYW1pbHlNZW1iZXJcXHU0ZTJkXFxuICAgICAgICAgICAgT3B0aW9uYWw8U3R1ZGVudD4gc3R1ZGVudE9wID0gc3R1ZGVudFJlcG9zaXRvcnkuZmluZEJ5SWQocGVyc29uSWQpO1xcbiAgICAgICAgICAgIGlmKHN0dWRlbnRPcC5pc1ByZXNlbnQoKSkge1xcbiAgICAgICAgICAgICAgICBmLnNldFN0dWRlbnQoc3R1ZGVudE9wLmdldCgpKTtcXG4gICAgICAgICAgICB9IGVsc2Uge1xcbiAgICAgICAgICAgICAgICAvLyBcXHU1OTgyXFx1Njc5Y1xcdTYyN2VcXHU0ZTBkXFx1NTIzMFxcdTViZjlcXHU1ZTk0XFx1NzY4NFN0dWRlbnRcXHVmZjBjXFx1OGZkNFxcdTU2ZGVcXHU5NTE5XFx1OGJlZlxcdTRmZTFcXHU2MDZmXFxuICAgICAgICAgICAgICAgIHJldHVybiBDb21tb25NZXRob2QuZ2V0UmV0dXJuTWVzc2FnZUVycm9yKFxcXCJcXHU2MjdlXFx1NGUwZFxcdTUyMzBcXHU1YmY5XFx1NWU5NFxcdTc2ODRcXHU1YjY2XFx1NzUxZlxcdTRmZTFcXHU2MDZmXFx1ZmYwMVxcXCIpO1xcbiAgICAgICAgICAgIH1cXG4gICAgICAgIH1cXG4gICAgICAgIGYuc2V0UmVsYXRpb24oQ29tbW9uTWV0aG9kLmdldFN0cmluZyhmb3JtLFxcXCJyZWxhdGlvblxcXCIpKTtcXG4gICAgICAgIGYuc2V0TmFtZShDb21tb25NZXRob2QuZ2V0U3RyaW5nKGZvcm0sXFxcIm5hbWVcXFwiKSk7XFxuICAgICAgICBmLnNldEdlbmRlcihDb21tb25NZXRob2QuZ2V0U3RyaW5nKGZvcm0sXFxcImdlbmRlclxcXCIpKTtcXG4gICAgICAgIFxcbiAgICAgICAgLy8gXFx1NWI4OVxcdTUxNjhcXHU1NzMwXFx1NTkwNFxcdTc0MDZhZ2VcXHU1YjU3XFx1NmJiNVxcdWZmMGNcXHU5MDdmXFx1NTE0ZERvdWJsZVxcdTUyMzBJbnRlZ2VyXFx1NzY4NFxcdTc2ZjRcXHU2M2E1XFx1OGY2Y1xcdTYzNjJcXG4gICAgICAgIHRyeSB7XFxuICAgICAgICAgICAgT2JqZWN0IGFnZU9iaiA9IGZvcm0uZ2V0KFxcXCJhZ2VcXFwiKTtcXG4gICAgICAgICAgICBpZihhZ2VPYmogIT0gbnVsbCkge1xcbiAgICAgICAgICAgICAgICBpZihhZ2VPYmogaW5zdGFuY2VvZiBJbnRlZ2VyKSB7XFxuICAgICAgICAgICAgICAgICAgICBmLnNldEFnZSgoSW50ZWdlcilhZ2VPYmopO1xcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYoYWdlT2JqIGluc3RhbmNlb2YgRG91YmxlKSB7XFxuICAgICAgICAgICAgICAgICAgICAvLyBcXHU1YzA2RG91YmxlXFx1OGY2Y1xcdTYzNjJcXHU0ZTNhSW50ZWdlclxcbiAgICAgICAgICAgICAgICAgICAgZi5zZXRBZ2UoKChEb3VibGUpYWdlT2JqKS5pbnRWYWx1ZSgpKTtcXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcXG4gICAgICAgICAgICAgICAgICAgIC8vIFxcdTVjMWRcXHU4YmQ1XFx1NGVjZVxcdTViNTdcXHU3YjI2XFx1NGUzMlxcdTg5ZTNcXHU2NzkwXFxuICAgICAgICAgICAgICAgICAgICBTdHJpbmcgYWdlU3RyID0gYWdlT2JqLnRvU3RyaW5nKCk7XFxuICAgICAgICAgICAgICAgICAgICBmLnNldEFnZSgoaW50KURvdWJsZS5wYXJzZURvdWJsZShhZ2VTdHIpKTtcXG4gICAgICAgICAgICAgICAgfVxcbiAgICAgICAgICAgIH1cXG4gICAgICAgIH0gY2F0Y2goRXhjZXB0aW9uIGUpIHtcXG4gICAgICAgICAgICBsb2cuZXJyb3IoXFxcIlxcdTU5MDRcXHU3NDA2XFx1NWU3NFxcdTlmODRcXHU1YjU3XFx1NmJiNVxcdTY1ZjZcXHU1MWZhXFx1OTUxOVxcXCIsIGUpO1xcbiAgICAgICAgICAgIHJldHVybiBDb21tb25NZXRob2QuZ2V0UmV0dXJuTWVzc2FnZUVycm9yKFxcXCJcXHU1ZTc0XFx1OWY4NFxcdTY4M2NcXHU1ZjBmXFx1NGUwZFxcdTZiNjNcXHU3ODZlXFx1ZmYwMVxcXCIpO1xcbiAgICAgICAgfVxcbiAgICAgICAgXFxuICAgICAgICBmLnNldFVuaXQoQ29tbW9uTWV0aG9kLmdldFN0cmluZyhmb3JtLFxcXCJ1bml0XFxcIikpO1xcbiAgICAgICAgZmFtaWx5TWVtYmVyUmVwb3NpdG9yeS5zYXZlKGYpO1xcbiAgICAgICAgcmV0dXJuIENvbW1vbk1ldGhvZC5nZXRSZXR1cm5NZXNzYWdlT0soKTtcXG4gICAgfVxcbiAgICBcXG4gICAgcHVibGljIERhdGFSZXNwb25zZSBmYW1pbHlNZW1iZXJEZWxldGUoRGF0YVJlcXVlc3QgZGF0YVJlcXVlc3QpIHtcXG4gICAgICAgIEludGVnZXIgbWVtYmVySWQgPSBkYXRhUmVxdWVzdC5nZXRJbnRlZ2VyKFxcXCJtZW1iZXJJZFxcXCIpO1xcbiAgICAgICAgT3B0aW9uYWw8RmFtaWx5TWVtYmVyPiBvcDtcXG4gICAgICAgIG9wID0gZmFtaWx5TWVtYmVyUmVwb3NpdG9yeS5maW5kQnlJZChtZW1iZXJJZCk7XFxuICAgICAgICBvcC5pZlByZXNlbnQoZmFtaWx5TWVtYmVyUmVwb3NpdG9yeTo6ZGVsZXRlKTtcXG4gICAgICAgIHJldHVybiBDb21tb25NZXRob2QuZ2V0UmV0dXJuTWVzc2FnZU9LKCk7XFxuICAgIH1cXG59XCJ9IiwibWNwX3NlcnZlcl9uYW1lIjoiIiwibWNwX3Rvb2xfbmFtZSI6IiJ9fSx7ImlkIjowLCJ0eXBlIjowLCJjb250ZW50Ijoi546w5Zyo5oiR6ZyA6KaB5Yib5bu65LiA5Liq5paw5paH5Lu25p2l5L+u5aSNIGBUZWFjaGVyU2VydmljZXMuamF2YWAg5Lit55qEIGBmYW1pbHlNZW1iZXJTYXZlYCDmlrnms5XvvJpcbiJ9LHsiaWQiOjIsInR5cGUiOjIsImNvbnRlbnQiOiIifSx7ImlkIjozLCJ0eXBlIjozLCJjb250ZW50IjoiIn1dLCJzZWVuX3N0YXRlIjoic2VlbiIsInN0cnVjdHVyZWRfcmVxdWVzdF9ub2RlcyI6W3siaWQiOjEsInR5cGUiOjEsInRvb2xfcmVzdWx0X25vZGUiOnsiY29udGVudCI6IlRoZSBmb2xsb3dpbmcgY29kZSBzZWN0aW9ucyB3ZXJlIHJldHJpZXZlZDpcblBhdGg6IHNyYy9tYWluL2phdmEvY24vZWR1L3NkdS9qYXZhL3NlcnZlci9zZXJ2aWNlcy9UZWFjaGVyU2VydmljZXMuamF2YVxuLi4uXG5cbkBTZXJ2aWNlXG5wdWJsaWMgY2xhc3MgVGVhY2hlclNlcnZpY2Uge1xuICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIExvZ2dlciBsb2cgPSBMb2dnZXJGYWN0b3J5LmdldExvZ2dlcihjbi5lZHUuc2R1LmphdmEuc2VydmVyLnNlcnZpY2VzLlRlYWNoZXJTZXJ2aWNlLmNsYXNzKTtcbiAgICBwcml2YXRlIGZpbmFsIFBlcnNvblJlcG9zaXRvcnkgcGVyc29uUmVwb3NpdG9yeTsgIC8v5Lq65ZGY5pWw5o2u5pON5L2c6Ieq5Yqo5rOo5YWlXG4gICAgcHJpdmF0ZSBmaW5hbCBUZWFjaGVyUmVwb3NpdG9yeSB0ZWFjaGVyUmVwb3NpdG9yeTsgIC8v5pWZ5biI5pWw5o2u5pON5L2c6Ieq5Yqo5rOo5YWlXG4gICAgcHJpdmF0ZSBmaW5hbCBVc2VyUmVwb3NpdG9yeSB1c2VyUmVwb3NpdG9yeTsgIC8v5pWw5o2u5pON5L2c6Ieq5Yqo5rOo5YWlXG4gICAgcHJpdmF0ZSBmaW5hbCBVc2VyVHlwZVJlcG9zaXRvcnkgdXNlclR5cGVSZXBvc2l0b3J5OyAvL+eUqOaIt+exu+Wei+aVsOaNruaTjeS9nOiHquWKqOazqOWFpVxuICAgIHByaXZhdGUgZmluYWwgUGFzc3dvcmRFbmNvZGVyIGVuY29kZXI7ICAvL+WvhueggeacjeWKoeiHquWKqOazqOWFpVxuICAgIHByaXZhdGUgZmluYWwgRmVlUmVwb3NpdG9yeSBmZWVSZXBvc2l0b3J5OyAgLy/mtojotLnmlbDmja7mk43kvZzoh6rliqjms6jlhaVcbiAgICBwcml2YXRlIGZpbmFsIEZhbWlseU1lbWJlclJlcG9zaXRvcnkgZmFtaWx5TWVtYmVyUmVwb3NpdG9yeTtcbiAgICBwcml2YXRlIGZpbmFsIFN5c3RlbVNlcnZpY2Ugc3lzdGVtU2VydmljZTtcbi4uLlxuICAgIHB1YmxpYyBNYXA8U3RyaW5nLE9iamVjdD4gZ2V0TWFwRnJvbVRlYWNoZXIoVGVhY2hlciBzKSB7XG4gICAgICAgIE1hcDxTdHJpbmcsT2JqZWN0PiBtID0gbmV3IEhhc2hNYXA8PigpO1xuICAgICAgICBQZXJzb24gcDtcbiAgICAgICAgaWYocyA9PSBudWxsKVxuICAgICAgICAgICAgcmV0dXJuIG07XG4gICAgICAgIG0ucHV0KFwidGl0bGVcIixzLmdldFRpdGxlKCkpO1xuICAgICAgICBtLnB1dChcImRlZ3JlZVwiLHMuZ2V0RGVncmVlKCkpO1xuICAgICAgICBtLnB1dChcImNsYXNzTmFtZVwiLHMuZ2V0Q2xhc3NOYW1lKCkpO1xuICAgICAgICBwID0gcy5nZXRQZXJzb24oKTtcbiAgICAgICAgaWYocCA9PSBudWxsKVxuICAgICAgICAgICAgcmV0dXJuIG07XG4gICAgICAgIG0ucHV0KFwicGVyc29uSWRcIiwgcy5nZXRQZXJzb25JZCgpKTtcbiAgICAgICAgbS5wdXQoXCJudW1cIixwLmdldE51bSgpKTtcbiAgICAgICAgbS5wdXQoXCJuYW1lXCIscC5nZXROYW1lKCkpO1xuICAgICAgICBtLnB1dChcImRlcHRcIixwLmdldERlcHQoKSk7XG4gICAgICAgIG0ucHV0KFwiY2FyZFwiLHAuZ2V0Q2FyZCgpKTtcbiAgICAgICAgU3RyaW5nIGdlbmRlciA9IHAuZ2V0R2VuZGVyKCk7XG4gICAgICAgIG0ucHV0KFwiZ2VuZGVyXCIsZ2VuZGVyKTtcbiAgICAgICAgbS5wdXQoXCJnZW5kZXJOYW1lXCIsIENvbURhdGFVdGlsLmdldEluc3RhbmNlKCkuZ2V0RGljdGlvbmFyeUxhYmVsQnlWYWx1ZShcIlhCTVwiLCBnZW5kZXIpKTsgLy/mgKfliKvnsbvlnovnmoTlgLzovazmjaLmiJDmlbDmja7nsbvlnovlkI1cbiAgICAgICAgbS5wdXQoXCJiaXJ0aGRheVwiLCBwLmdldEJpcnRoZGF5KCkpOyAgLy/ml7bpl7TmoLzlvI/ovazmjaLlrZfnrKbkuLJcbiAgICAgICAgbS5wdXQoXCJlbWFpbFwiLHAuZ2V0RW1haWwoKSk7XG4gICAgICAgIG0ucHV0KFwicGhvbmVcIixwLmdldFBob25lKCkpO1xuICAgICAgICBtLnB1dChcImFkZHJlc3NcIixwLmdldEFkZHJlc3MoKSk7XG4gICAgICAgIG0ucHV0KFwiaW50cm9kdWNlXCIscC5nZXRJbnRyb2R1Y2UoKSk7XG4gICAgICAgIHJldHVybiBtO1xuICAgIH1cbiAgICBwdWJsaWMgTGlzdDxNYXA8U3RyaW5nLE9iamVjdD4+IGdldFRlYWNoZXJNYXBMaXN0KFN0cmluZyBudW1OYW1lKSB7XG4gICAgICAgIExpc3Q8TWFwPFN0cmluZyxPYmplY3Q+PiBkYXRhTGlzdCA9IG5ldyBBcnJheUxpc3Q8PigpO1xuICAgICAgICBMaXN0PFRlYWNoZXI+IHNMaXN0ID0gdGVhY2hlclJlcG9zaXRvcnkuZmluZFRlYWNoZXJMaXN0QnlOdW1OYW1lKG51bU5hbWUpOyAgLy/mlbDmja7lupPmn6Xor6Lmk43kvZxcbiAgICAgICAgaWYgKHNMaXN0ID09IG51bGwgfHwgc0xpc3QuaXNFbXB0eSgpKVxuICAgICAgICAgICAgcmV0dXJuIGRhdGFMaXN0O1xuICAgICAgICBmb3IgKFRlYWNoZXIgdGVhY2hlciA6IHNMaXN0KSB7XG4gICAgICAgICAgICBkYXRhTGlzdC5hZGQoZ2V0TWFwRnJvbVRlYWNoZXIodGVhY2hlcikpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBkYXRhTGlzdDtcbiAgICB9XG4gICAgcHVibGljIERhdGFSZXNwb25zZSBnZXRUZWFjaGVyTGlzdChEYXRhUmVxdWVzdCBkYXRhUmVxdWVzdCkge1xuICAgICAgICBTdHJpbmcgbnVtTmFtZSA9IGRhdGFSZXF1ZXN0LmdldFN0cmluZyhcIm51bU5hbWVcIik7XG4gICAgICAgIExpc3Q8TWFwPFN0cmluZyxPYmplY3Q+PiBkYXRhTGlzdCA9ICBnZXRUZWFjaGVyTGlzdChudW1OYW1lKTtcbiAgICAgICAgcmV0dXJuIENvbW1vbk1ldGhvZC5nZXRSZXR1cm5EYXRhKGRhdGFMaXN0KTsgIC8v5oyJ54Wn5rWL6K+V5qGG5p626KeE6IyD5Lya6YCBTWFw55qEbGlzdFxuICAgIH1cbiAgICBwdWJsaWMgRGF0YVJlc3BvbnNlIHRlYWNoZXJEZWxldGUoRGF0YVJlcXVlc3QgZGF0YVJlcXVlc3QpIHtcbiAgICAgICAgSW50ZWdlciBwZXJzb25JZCA9IGRhdGFSZXF1ZXN0LmdldEludGVnZXIoXCJwZXJzb25JZFwiKTsgIC8v6I635Y+WdGVhY2hlcl9pZOWAvFxuICAgICAgICBUZWFjaGVyIHMgPSBudWxsO1xuICAgICAgICBPcHRpb25hbDxUZWFjaGVyPiBvcDtcbiAgICAgICAgaWYgKHBlcnNvbklkICE9IG51bGwgJiYgcGVyc29uSWQgPiAwKSB7XG4gICAgICAgICAgICBvcCA9IHRlYWNoZXJSZXBvc2l0b3J5LmZpbmRCeUlkKHBlcnNvbklkKTsgICAvL+afpeivouiOt+W+l+WunuS9k+WvueixoVxuICAgICAgICAgICAgaWYob3AuaXNQcmVzZW50KCkpIHtcbiAgICAgICAgICAgICAgICBzID0gb3AuZ2V0KCk7XG4gICAgICAgICAgICAgICAgT3B0aW9uYWw8VXNlcj4gdU9wID0gdXNlclJlcG9zaXRvcnkuZmluZEJ5SWQocGVyc29uSWQpOyAvL+afpeivouWvueW6lOivpeaVmeW4iOeahOi0puaIt1xuICAgICAgICAgICAgICAgIC8v5Yig6Zmk5a+55bqU6K+l5pWZ5biI55qE6LSm5oi3XG4gICAgICAgICAgICAgICAgdU9wLmlmUHJlc2VudCh1c2VyUmVwb3NpdG9yeTo6ZGVsZXRlKTtcbiAgICAgICAgICAgICAgICBQZXJzb24gcCA9IHMuZ2V0UGVyc29uKCk7XG4gICAgICAgICAgICAgICAgdGVhY2hlclJlcG9zaXRvcnkuZGVsZXRlKHMpOyAgICAvL+mmluWFiOaVsOaNruW6k+awuOS5heWIoOmZpOaVmeW4iOS/oeaBr1xuICAgICAgICAgICAgICAgIHBlcnNvblJlcG9zaXRvcnkuZGVsZXRlKHApO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBDb21tb25NZXRob2QuZ2V0UmV0dXJuTWVzc2FnZU9LKCk7ICAvL+mAmuefpeWJjeerr+aTjeS9nOato+W4uFxuICAgIH1cbiAgICBwdWJsaWMgRGF0YVJlc3BvbnNlIGdldFRlYWNoZXJJbmZvKERhdGFSZXF1ZXN0IGRhdGFSZXF1ZXN0KSB7XG4gICAgICAgIEludGVnZXIgcGVyc29uSWQgPSBkYXRhUmVxdWVzdC5nZXRJbnRlZ2VyKFwicGVyc29uSWRcIik7XG4gICAgICAgIFRlYWNoZXIgcyA9IG51bGw7XG4gICAgICAgIE9wdGlvbmFsPFRlYWNoZXI+IG9wO1xuICAgICAgICBpZiAocGVyc29uSWQgIT0gbnVsbCkge1xuICAgICAgICAgICAgb3AgPSB0ZWFjaGVyUmVwb3NpdG9yeS5maW5kQnlJZChwZXJzb25JZCk7IC8v5qC55o2u5a2m55Sf5Li76ZSu5LuO5pWw5o2u5bqT5p+l6K+i5a2m55Sf55qE5L+h5oGvXG4gICAgICAgICAgICBpZiAob3AuaXNQcmVzZW50KCkpIHtcbiAgICAgICAgICAgICAgICBzID0gb3AuZ2V0KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIENvbW1vbk1ldGhvZC5nZXRSZXR1cm5EYXRhKGdldE1hcEZyb21UZWFjaGVyKHMpKTsgLy/ov5nph4zlm57kvKDljIXlkKvlrabnlJ/kv6Hmga/nmoRNYXDlr7nosaFcbiAgICB9XG5cbiAgICBwdWJsaWMgRGF0YVJlc3BvbnNlIHRlYWNoZXJFZGl0U2F2ZShEYXRhUmVxdWVzdCBkYXRhUmVxdWVzdCkge1xuICAgICAgICBJbnRlZ2VyIHBlcnNvbklkID0gZGF0YVJlcXVlc3QuZ2V0SW50ZWdlcihcInBlcnNvbklkXCIpO1xuICAgICAgICBNYXA8U3RyaW5nLE9iamVjdD4gZm9ybSA9IGRhdGFSZXF1ZXN0LmdldE1hcChcImZvcm1cIik7IC8v5Y+C5pWw6I635Y+WTWFw5a+56LGhXG4gICAgICAgIFN0cmluZyBudW0gPSBDb21tb25NZXRob2QuZ2V0U3RyaW5nKGZvcm0sIFwibnVtXCIpOyAgLy9NYXAg6I635Y+W5bGe5oCn55qE5YC8XG4gICAgICAgIFRlYWNoZXIgcyA9IG51bGw7XG4gICAgICAgIFBlcnNvbiBwO1xuICAgICAgICBVc2VyIHU7XG4gICAgICAgIE9wdGlvbmFsPFRlYWNoZXI+IG9wO1xuICAgICAgICBib29sZWFuIGlzTmV3ID0gZmFsc2U7XG4gICAgICAgIGlmIChwZXJzb25JZCAhPSBudWxsKSB7XG4gICAgICAgICAgICBvcCA9IHRlYWNoZXJSZXBvc2l0b3J5LmZpbmRCeUlkKHBlcnNvbklkKTsgIC8v5p+l6K+i5a+55bqU5pWw5o2u5bqT5Lit5Li76ZSu5Li6aWTnmoTlgLznmoTlrp7kvZPlr7nosaFcbiAgICAgICAgICAgIGlmIChvcC5pc1ByZXNlbnQoKSkge1xuICAgICAgICAgICAgICAgIHMgPSBvcC5nZXQoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBPcHRpb25hbDxQZXJzb24+IG5PcCA9IHBlcnNvblJlcG9zaXRvcnkuZmluZEJ5TnVtKG51bSk7IC8v5p+l6K+i5piv5ZCm5a2Y5ZyobnVt55qE5Lq65ZGYXG4gICAgICAgIGlmIChuT3AuaXNQcmVzZW50KCkpIHtcbiAgICAgICAgICAgIGlmIChzID09IG51bGwgfHwgIXMuZ2V0UGVyc29uKCkuZ2V0TnVtKCkuZXF1YWxzKG51bSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gQ29tbW9uTWV0aG9kLmdldFJldHVybk1lc3NhZ2VFcnJvcihcIuaWsOWtpuWPt+W3sue7j+WtmOWcqO+8jOS4jeiDvea3u+WKoOaIluS/ruaUue+8gVwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAocyA9PSBudWxsKSB7XG4gICAgICAgICAgICBwID0gbmV3IFBlcnNvbigpO1xuICAgICAgICAgICAgcC5zZXROdW0obnVtKTtcbiAgICAgICAgICAgIHAuc2V0VHlwZShcIjFcIik7XG4gICAgICAgICAgICBwZXJzb25SZXBvc2l0b3J5LnNhdmVBbmRGbHVzaChwKTsgIC8v5o+S5YWl5paw55qEUGVyc29u6K6w5b2VXG4gICAgICAgICAgICBwZXJzb25JZCA9IHAuZ2V0UGVyc29uSWQoKTtcbiAgICAgICAgICAgIFN0cmluZyBwYXNzd29yZCA9IGVuY29kZXIuZW5jb2RlKFwiMTIzNDU2XCIpO1xuICAgICAgICAgICAgdSA9IG5ldyBVc2VyKCk7XG4gICAgICAgICAgICB1LnNldFBlcnNvbklkKHBlcnNvbklkKTtcbiAgICAgICAgICAgIHUuc2V0VXNlck5hbWUobnVtKTtcbiAgICAgICAgICAgIHUuc2V0UGFzc3dvcmQocGFzc3dvcmQpO1xuICAgICAgICAgICAgdS5zZXRVc2VyVHlwZSh1c2VyVHlwZVJlcG9zaXRvcnkuZmluZEJ5TmFtZShFVXNlclR5cGUuUk9MRV9TVFVERU5UKSk7XG4gICAgICAgICAgICB1LnNldENyZWF0ZVRpbWUoRGF0ZVRpbWVUb29sLnBhcnNlRGF0ZVRpbWUobmV3IERhdGUoKSkpO1xuICAgICAgICAgICAgdS5zZXRDcmVhdG9ySWQoQ29tbW9uTWV0aG9kLmdldFBlcnNvbklkKCkpO1xuICAgICAgICAgICAgdXNlclJlcG9zaXRvcnkuc2F2ZUFuZEZsdXNoKHUpOyAvL+aPkuWFpeaWsOeahFVzZXLorrDlvZVcbiAgICAgICAgICAgIHMgPSBuZXcgVGVhY2hlcigpOyAgIC8vIOWIm+W7uuWunuS9k+WvueixoVxuICAgICAgICAgICAgcy5zZXRQZXJzb25JZChwZXJzb25JZCk7XG4gICAgICAgICAgICB0ZWFjaGVyUmVwb3NpdG9yeS5zYXZlQW5kRmx1c2gocyk7ICAvL+aPkuWFpeaWsOeahFN0dWRlbnTorrDlvZVcbiAgICAgICAgICAgIGlzTmV3ID0gdHJ1ZTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHAgPSBzLmdldFBlcnNvbigpO1xuICAgICAgICB9XG4gICAgICAgIHBlcnNvbklkID0gcC5nZXRQZXJzb25JZCgpO1xuICAgICAgICBpZiAoIW51bS5lcXVhbHMocC5nZXROdW0oKSkpIHsgICAvL+WmguaenOS6uuWRmOe8luWPt+WPmOWMlu+8jOS/ruaUueS6uuWRmOe8luWPt+WSjOeZu+W9lei0puWPt1xuICAgICAgICAgICAgT3B0aW9uYWw8VXNlcj4gdU9wID0gdXNlclJlcG9zaXRvcnkuZmluZEJ5UGVyc29uUGVyc29uSWQocGVyc29uSWQpO1xuICAgICAgICAgICAgaWYgKHVPcC5pc1ByZXNlbnQoKSkge1xuICAgICAgICAgICAgICAgIHUgPSB1T3AuZ2V0KCk7XG4gICAgICAgICAgICAgICAgdS5zZXRVc2VyTmFtZShudW0pO1xuICAgICAgICAgICAgICAgIHVzZXJSZXBvc2l0b3J5LnNhdmVBbmRGbHVzaCh1KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHAuc2V0TnVtKG51bSk7ICAvL+iuvue9ruWxnuaAp1xuICAgICAgICB9XG4gICAgICAgIHAuc2V0TmFtZShDb21tb25NZXRob2QuZ2V0U3RyaW5nKGZvcm0sIFwibmFtZVwiKSk7XG4gICAgICAgIHAuc2V0RGVwdChDb21tb25NZXRob2QuZ2V0U3RyaW5nKGZvcm0sIFwiZGVwdFwiKSk7XG4gICAgICAgIHAuc2V0Q2FyZChDb21tb25NZXRob2QuZ2V0U3RyaW5nKGZvcm0sIFwiY2FyZFwiKSk7XG4gICAgICAgIHAuc2V0R2VuZGVyKENvbW1vbk1ldGhvZC5nZXRTdHJpbmcoZm9ybSwgXCJnZW5kZXJcIikpO1xuICAgICAgICBwLnNldEJpcnRoZGF5KENvbW1vbk1ldGhvZC5nZXRTdHJpbmcoZm9ybSwgXCJiaXJ0aGRheVwiKSk7XG4gICAgICAgIHAuc2V0RW1haWwoQ29tbW9uTWV0aG9kLmdldFN0cmluZyhmb3JtLCBcImVtYWlsXCIpKTtcbiAgICAgICAgcC5zZXRQaG9uZShDb21tb25NZXRob2QuZ2V0U3RyaW5nKGZvcm0sIFwicGhvbmVcIikpO1xuICAgICAgICBwLnNldEFkZHJlc3MoQ29tbW9uTWV0aG9kLmdldFN0cmluZyhmb3JtLCBcImFkZHJlc3NcIikpO1xuICAgICAgICBwZXJzb25SZXBvc2l0b3J5LnNhdmUocCk7ICAvLyDkv67mlLnkv53lrZjkurrlkZjkv6Hmga9cbiAgICAgICAgcy5zZXRDbGFzc05hbWUoQ29tbW9uTWV0aG9kLmdldFN0cmluZyhmb3JtLCBcImNsYXNzTmFtZVwiKSk7XG4gICAgICAgIHRlYWNoZXJSZXBvc2l0b3J5LnNhdmUocyk7ICAvL+S/ruaUueS/neWtmOWtpueUn+S/oeaBr1xuICAgICAgICBzeXN0ZW1TZXJ2aWNlLm1vZGlmeUxvZyhzLGlzTmV3KTtcbiAgICAgICAgcmV0dXJuIENvbW1vbk1ldGhvZC5nZXRSZXR1cm5EYXRhKHMuZ2V0UGVyc29uSWQoKSk7ICAvLyDlsIZwZXJzb25JZOi/lOWbnuWJjeerr1xuICAgIH1cbi4uLlxuXG4gICAgICAgICAgICAgICAgLy8g5aGr5YWF5YW35L2T5pWw5o2u77yI5a2X5q615ZCN6ZyA6KaB5qC55o2u5a6e6ZmF5pWZ5biI5pWw5o2u57uT5p6E6LCD5pW077yJXG4gICAgICAgICAgICAgICAgY2VsbFswXS5zZXRDZWxsVmFsdWUoKGkgKyAxKSArIFwiXCIpOyAvLyDluo/lj7dcbiAgICAgICAgICAgICAgICBjZWxsWzFdLnNldENlbGxWYWx1ZShDb21tb25NZXRob2QuZ2V0U3RyaW5nKG0sIFwidGVhY2hlck51bVwiKSk7IC8vIOW3peWPt1xuICAgICAgICAgICAgICAgIGNlbGxbMl0uc2V0Q2VsbFZhbHVlKENvbW1vbk1ldGhvZC5nZXRTdHJpbmcobSwgXCJuYW1lXCIpKTsgLy8g5aeT5ZCNXG4gICAgICAgICAgICAgICAgY2VsbFszXS5zZXRDZWxsVmFsdWUoQ29tbW9uTWV0aG9kLmdldFN0cmluZyhtLCBcImRlcGFydFwiKSk7IC8vIOWtpumZolxuICAgICAgICAgICAgICAgIGNlbGxbNF0uc2V0Q2VsbFZhbHVlKENvbW1vbk1ldGhvZC5nZXRTdHJpbmcobSwgXCJ0aXRsZVwiKSk7IC8vIOiBjOensFxuICAgICAgICAgICAgICAgIGNlbGxbNV0uc2V0Q2VsbFZhbHVlKENvbW1vbk1ldGhvZC5nZXRTdHJpbmcobSwgXCJkZWdyZWVcIikpOyAvLyDlrabkvY1cbiAgICAgICAgICAgICAgICBjZWxsWzZdLnNldENlbGxWYWx1ZShDb21tb25NZXRob2QuZ2V0U3RyaW5nKG0sIFwiZ2VuZGVyXCIpKTsgLy8g5oCn5YirXG4gICAgICAgICAgICAgICAgY2VsbFs3XS5zZXRDZWxsVmFsdWUoQ29tbW9uTWV0aG9kLmdldFN0cmluZyhtLCBcImVtYWlsXCIpKTsgLy8g6YKu566xXG4gICAgICAgICAgICAgICAgY2VsbFs4XS5zZXRDZWxsVmFsdWUoQ29tbW9uTWV0aG9kLmdldFN0cmluZyhtLCBcInBob25lXCIpKTsgLy8g55S16K+dXG4gICAgICAgICAgICAgICAgY2VsbFs5XS5zZXRDZWxsVmFsdWUoQ29tbW9uTWV0aG9kLmdldFN0cmluZyhtLCBcImFkZHJlc3NcIikpOyAvLyDlnLDlnYBcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuLi4uXG4gICAgcHVibGljIERhdGFSZXNwb25zZSBnZXRUZWFjaGVyUGFnZURhdGEoRGF0YVJlcXVlc3QgZGF0YVJlcXVlc3QpIHtcbiAgICAgICAgU3RyaW5nIG51bU5hbWUgPSBkYXRhUmVxdWVzdC5nZXRTdHJpbmcoXCJudW1OYW1lXCIpO1xuICAgICAgICBJbnRlZ2VyIGNQYWdlID0gZGF0YVJlcXVlc3QuZ2V0Q3VycmVudFBhZ2UoKTtcbiAgICAgICAgaW50IGRhdGFUb3RhbCA9IDA7XG4gICAgICAgIGludCBzaXplID0gNDA7XG4gICAgICAgIExpc3Q8TWFwPFN0cmluZyxPYmplY3Q+PiBkYXRhTGlzdCA9IG5ldyBBcnJheUxpc3Q8PigpO1xuICAgICAgICBQYWdlPFRlYWNoZXI+IHBhZ2UgPSBudWxsO1xuICAgICAgICBQYWdlYWJsZSBwYWdlYWJsZSA9IFBhZ2VSZXF1ZXN0Lm9mKGNQYWdlLCBzaXplKTtcbiAgICAgICAgcGFnZSA9IHRlYWNoZXJSZXBvc2l0b3J5LmZpbmRUZWFjaGVyTGlzdEJ5TnVtTmFtZShudW1OYW1lLCBwYWdlYWJsZSk7XG4gICAgICAgIE1hcDxTdHJpbmcsT2JqZWN0PiBtO1xuICAgICAgICBpZiAocGFnZSAhPSBudWxsKSB7XG4gICAgICAgICAgICBkYXRhVG90YWwgPSAoaW50KSBwYWdlLmdldFRvdGFsRWxlbWVudHMoKTtcbiAgICAgICAgICAgIExpc3Q8VGVhY2hlcj4gbGlzdCA9IHBhZ2UuZ2V0Q29udGVudCgpO1xuICAgICAgICAgICAgaWYgKCFsaXN0LmlzRW1wdHkoKSkge1xuICAgICAgICAgICAgICAgIGZvciAoVGVhY2hlciB0ZWFjaGVyIDogbGlzdCkge1xuICAgICAgICAgICAgICAgICAgICBtID0gZ2V0TWFwRnJvbVRlYWNoZXIodGVhY2hlcik7XG4gICAgICAgICAgICAgICAgICAgIGRhdGFMaXN0LmFkZChtKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbi4uLlxuICAgIHB1YmxpYyBEYXRhUmVzcG9uc2UgZ2V0RmFtaWx5TWVtYmVyTGlzdChEYXRhUmVxdWVzdCBkYXRhUmVxdWVzdCkge1xuICAgICAgICBJbnRlZ2VyIHBlcnNvbklkID0gZGF0YVJlcXVlc3QuZ2V0SW50ZWdlcihcInBlcnNvbklkXCIpO1xuICAgICAgICBMaXN0PEZhbWlseU1lbWJlcj4gZkxpc3QgPSBmYW1pbHlNZW1iZXJSZXBvc2l0b3J5LmZpbmRCeVRlYWNoZXJQZXJzb25JZChwZXJzb25JZCk7XG4gICAgICAgIExpc3Q8TWFwPFN0cmluZyxPYmplY3Q+PiBkYXRhTGlzdCA9IG5ldyBBcnJheUxpc3Q8PigpO1xuICAgICAgICBNYXA8U3RyaW5nLE9iamVjdD4gbTtcbiAgICAgICAgaWYgKGZMaXN0ICE9IG51bGwpIHtcbiAgICAgICAgICAgIGZvciAoRmFtaWx5TWVtYmVyIGYgOiBmTGlzdCkge1xuICAgICAgICAgICAgICAgIG0gPSBuZXcgSGFzaE1hcDw+KCk7XG4gICAgICAgICAgICAgICAgbS5wdXQoXCJtZW1iZXJJZFwiLCBmLmdldE1lbWJlcklkKCkpO1xuICAgICAgICAgICAgICAgIG0ucHV0KFwicGVyc29uSWRcIiwgZi5nZXRUZWFjaGVyKCkuZ2V0UGVyc29uSWQoKSk7XG4gICAgICAgICAgICAgICAgbS5wdXQoXCJyZWxhdGlvblwiLCBmLmdldFJlbGF0aW9uKCkpO1xuICAgICAgICAgICAgICAgIG0ucHV0KFwibmFtZVwiLCBmLmdldE5hbWUoKSk7XG4gICAgICAgICAgICAgICAgbS5wdXQoXCJnZW5kZXJcIiwgZi5nZXRHZW5kZXIoKSk7XG4gICAgICAgICAgICAgICAgbS5wdXQoXCJhZ2VcIiwgZi5nZXRBZ2UoKStcIlwiKTtcbiAgICAgICAgICAgICAgICBtLnB1dChcInVuaXRcIiwgZi5nZXRVbml0KCkpO1xuICAgICAgICAgICAgICAgIGRhdGFMaXN0LmFkZChtKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gQ29tbW9uTWV0aG9kLmdldFJldHVybkRhdGEoZGF0YUxpc3QpO1xuICAgIH1cbiAgICBwdWJsaWMgRGF0YVJlc3BvbnNlIGZhbWlseU1lbWJlclNhdmUoRGF0YVJlcXVlc3QgZGF0YVJlcXVlc3QpIHtcbiAgICAgICAgTWFwPFN0cmluZyxPYmplY3Q+IGZvcm0gPSBkYXRhUmVxdWVzdC5nZXRNYXAoXCJmb3JtXCIpO1xuICAgICAgICBJbnRlZ2VyIHBlcnNvbklkID0gQ29tbW9uTWV0aG9kLmdldEludGVnZXIoZm9ybSxcInBlcnNvbklkXCIpO1xuICAgICAgICBJbnRlZ2VyIG1lbWJlcklkID0gQ29tbW9uTWV0aG9kLmdldEludGVnZXIoZm9ybSxcIm1lbWJlcklkXCIpO1xuICAgICAgICBPcHRpb25hbDxGYW1pbHlNZW1iZXI+IG9wO1xuICAgICAgICBGYW1pbHlNZW1iZXIgZiA9IG51bGw7XG4gICAgICAgIGlmKG1lbWJlcklkICE9IG51bGwpIHtcbiAgICAgICAgICAgIG9wID0gZmFtaWx5TWVtYmVyUmVwb3NpdG9yeS5maW5kQnlJZChtZW1iZXJJZCk7XG4gICAgICAgICAgICBpZihvcC5pc1ByZXNlbnQoKSkge1xuICAgICAgICAgICAgICAgIGYgPSBvcC5nZXQoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZihmPT0gbnVsbCkge1xuICAgICAgICAgICAgZiA9IG5ldyBGYW1pbHlNZW1iZXIoKTtcbiAgICAgICAgICAgIGFzc2VydCBwZXJzb25JZCAhPSBudWxsO1xuICAgICAgICAgICAgZi5zZXRTdHVkZW50KHRlYWNoZXJSZXBvc2l0b3J5LmZpbmRCeUlkKHBlcnNvbklkKS5nZXQoKSk7XG4gICAgICAgIH1cbiAgICAgICAgZi5zZXRSZWxhdGlvbihDb21tb25NZXRob2QuZ2V0U3RyaW5nKGZvcm0sXCJyZWxhdGlvblwiKSk7XG4gICAgICAgIGYuc2V0TmFtZShDb21tb25NZXRob2QuZ2V0U3RyaW5nKGZvcm0sXCJuYW1lXCIpKTtcbiAgICAgICAgZi5zZXRHZW5kZXIoQ29tbW9uTWV0aG9kLmdldFN0cmluZyhmb3JtLFwiZ2VuZGVyXCIpKTtcbiAgICAgICAgZi5zZXRBZ2UoQ29tbW9uTWV0aG9kLmdldEludGVnZXIoZm9ybSxcImFnZVwiKSk7XG4gICAgICAgIGYuc2V0VW5pdChDb21tb25NZXRob2QuZ2V0U3RyaW5nKGZvcm0sXCJ1bml0XCIpKTtcbiAgICAgICAgZmFtaWx5TWVtYmVyUmVwb3NpdG9yeS5zYXZlKGYpO1xuICAgICAgICByZXR1cm4gQ29tbW9uTWV0aG9kLmdldFJldHVybk1lc3NhZ2VPSygpO1xuICAgIH1cbn1cblxuLi4uXG5QYXRoOiBzcmMvbWFpbi9qYXZhL2NuL2VkdS9zZHUvamF2YS9zZXJ2ZXIvc2VydmljZXMvU3R1ZGVudFNlcnZpY2UuamF2YVxuLi4uXG5cbiAgICBwdWJsaWMgRGF0YVJlc3BvbnNlIGZhbWlseU1lbWJlclNhdmUoRGF0YVJlcXVlc3QgZGF0YVJlcXVlc3QpIHtcbiAgICAgICAgTWFwPFN0cmluZyxPYmplY3Q+IGZvcm0gPSBkYXRhUmVxdWVzdC5nZXRNYXAoXCJmb3JtXCIpO1xuICAgICAgICBJbnRlZ2VyIHBlcnNvbklkID0gQ29tbW9uTWV0aG9kLmdldEludGVnZXIoZm9ybSxcInBlcnNvbklkXCIpO1xuICAgICAgICBJbnRlZ2VyIG1lbWJlcklkID0gQ29tbW9uTWV0aG9kLmdldEludGVnZXIoZm9ybSxcIm1lbWJlcklkXCIpO1xuICAgICAgICBPcHRpb25hbDxGYW1pbHlNZW1iZXI+IG9wO1xuICAgICAgICBGYW1pbHlNZW1iZXIgZiA9IG51bGw7XG4gICAgICAgIGlmKG1lbWJlcklkICE9IG51bGwpIHtcbiAgICAgICAgICAgIG9wID0gZmFtaWx5TWVtYmVyUmVwb3NpdG9yeS5maW5kQnlJZChtZW1iZXJJZCk7XG4gICAgICAgICAgICBpZihvcC5pc1ByZXNlbnQoKSkge1xuICAgICAgICAgICAgICAgIGYgPSBvcC5nZXQoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZihmPT0gbnVsbCkge1xuICAgICAgICAgICAgZiA9IG5ldyBGYW1pbHlNZW1iZXIoKTtcbiAgICAgICAgICAgIGFzc2VydCBwZXJzb25JZCAhPSBudWxsO1xuICAgICAgICAgICAgZi5zZXRTdHVkZW50KHN0dWRlbnRSZXBvc2l0b3J5LmZpbmRCeUlkKHBlcnNvbklkKS5nZXQoKSk7XG4gICAgICAgIH1cbiAgICAgICAgZi5zZXRSZWxhdGlvbihDb21tb25NZXRob2QuZ2V0U3RyaW5nKGZvcm0sXCJyZWxhdGlvblwiKSk7XG4gICAgICAgIGYuc2V0TmFtZShDb21tb25NZXRob2QuZ2V0U3RyaW5nKGZvcm0sXCJuYW1lXCIpKTtcbiAgICAgICAgZi5zZXRHZW5kZXIoQ29tbW9uTWV0aG9kLmdldFN0cmluZyhmb3JtLFwiZ2VuZGVyXCIpKTtcbiAgICAgICAgZi5zZXRBZ2UoQ29tbW9uTWV0aG9kLmdldEludGVnZXIoZm9ybSxcImFnZVwiKSk7XG4gICAgICAgIGYuc2V0VW5pdChDb21tb25NZXRob2QuZ2V0U3RyaW5nKGZvcm0sXCJ1bml0XCIpKTtcbiAgICAgICAgZmFtaWx5TWVtYmVyUmVwb3NpdG9yeS5zYXZlKGYpO1xuICAgICAgICByZXR1cm4gQ29tbW9uTWV0aG9kLmdldFJldHVybk1lc3NhZ2VPSygpO1xuICAgIH1cblxuICAgIHB1YmxpYyBEYXRhUmVzcG9uc2UgZmFtaWx5TWVtYmVyRGVsZXRlKERhdGFSZXF1ZXN0IGRhdGFSZXF1ZXN0KSB7XG4gICAgICAgIEludGVnZXIgbWVtYmVySWQgPSBkYXRhUmVxdWVzdC5nZXRJbnRlZ2VyKFwibWVtYmVySWRcIik7XG4gICAgICAgIE9wdGlvbmFsPEZhbWlseU1lbWJlcj4gb3A7XG4gICAgICAgIG9wID0gZmFtaWx5TWVtYmVyUmVwb3NpdG9yeS5maW5kQnlJZChtZW1iZXJJZCk7XG4gICAgICAgIG9wLmlmUHJlc2VudChmYW1pbHlNZW1iZXJSZXBvc2l0b3J5OjpkZWxldGUpO1xuICAgICAgICByZXR1cm4gQ29tbW9uTWV0aG9kLmdldFJldHVybk1lc3NhZ2VPSygpO1xuICAgIH1cbi4uLlxuUGF0aDogamF2YS1zZXJ2ZXIvc3JjL21haW4vamF2YS9jbi9lZHUvc2R1L2phdmEvc2VydmVyL3NlcnZpY2VzL1RlYWNoZXJTZXJ2aWNlcy5qYXZhXG4uLi5cbmltcG9ydCBvcmcuc3ByaW5nZnJhbWV3b3JrLnN0ZXJlb3R5cGUuU2VydmljZTtcbmltcG9ydCBvcmcuc3ByaW5nZnJhbWV3b3JrLndlYi5zZXJ2bGV0Lm12Yy5tZXRob2QuYW5ub3RhdGlvbi5TdHJlYW1pbmdSZXNwb25zZUJvZHk7XG5cbmltcG9ydCBqYXZhLnV0aWwuKjtcblxuQFNlcnZpY2VcbnB1YmxpYyBjbGFzcyBUZWFjaGVyU2VydmljZXMge1xuICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIExvZ2dlciBsb2cgPSBMb2dnZXJGYWN0b3J5LmdldExvZ2dlcihUZWFjaGVyU2VydmljZXMuY2xhc3MpO1xuICAgIHByaXZhdGUgZmluYWwgUGVyc29uUmVwb3NpdG9yeSBwZXJzb25SZXBvc2l0b3J5OyAgLy/kurrlkZjmlbDmja7mk43kvZzoh6rliqjms6jlhaVcbiAgICBwcml2YXRlIGZpbmFsIFRlYWNoZXJSZXBvc2l0b3J5IHRlYWNoZXJSZXBvc2l0b3J5OyAgLy/mlZnluIjmlbDmja7mk43kvZzoh6rliqjms6jlhaVcbiAgICBwcml2YXRlIGZpbmFsIFVzZXJSZXBvc2l0b3J5IHVzZXJSZXBvc2l0b3J5OyAgLy/mlbDmja7mk43kvZzoh6rliqjms6jlhaVcbiAgICBwcml2YXRlIGZpbmFsIFVzZXJUeXBlUmVwb3NpdG9yeSB1c2VyVHlwZVJlcG9zaXRvcnk7IC8v55So5oi357G75Z6L5pWw5o2u5pON5L2c6Ieq5Yqo5rOo5YWlXG4gICAgcHJpdmF0ZSBmaW5hbCBQYXNzd29yZEVuY29kZXIgZW5jb2RlcjsgIC8v5a+G56CB5pyN5Yqh6Ieq5Yqo5rOo5YWlXG4gICAgLy/mtojotLnmlbDmja7mk43kvZzoh6rliqjms6jlhaVcbiAgICBwcml2YXRlIGZpbmFsIEZhbWlseU1lbWJlclJlcG9zaXRvcnkgZmFtaWx5TWVtYmVyUmVwb3NpdG9yeTtcbiAgICBwcml2YXRlIGZpbmFsIFN5c3RlbVNlcnZpY2Ugc3lzdGVtU2VydmljZTtcblxuICAgIHB1YmxpYyBUZWFjaGVyU2VydmljZXMoUGVyc29uUmVwb3NpdG9yeSBwZXJzb25SZXBvc2l0b3J5LCBUZWFjaGVyUmVwb3NpdG9yeSB0ZWFjaGVyUmVwb3NpdG9yeSwgVXNlclJlcG9zaXRvcnkgdXNlclJlcG9zaXRvcnksIFVzZXJUeXBlUmVwb3NpdG9yeSB1c2VyVHlwZVJlcG9zaXRvcnksIFBhc3N3b3JkRW5jb2RlciBlbmNvZGVyLCBGZWVSZXBvc2l0b3J5IGZlZVJlcG9zaXRvcnksIEZhbWlseU1lbWJlclJlcG9zaXRvcnkgZmFtaWx5TWVtYmVyUmVwb3NpdG9yeSwgU3lzdGVtU2VydmljZSBzeXN0ZW1TZXJ2aWNlKSB7XG4gICAgICAgIHRoaXMucGVyc29uUmVwb3NpdG9yeSA9IHBlcnNvblJlcG9zaXRvcnk7XG4gICAgICAgIHRoaXMudGVhY2hlclJlcG9zaXRvcnkgPSB0ZWFjaGVyUmVwb3NpdG9yeTtcbiAgICAgICAgdGhpcy51c2VyUmVwb3NpdG9yeSA9IHVzZXJSZXBvc2l0b3J5O1xuICAgICAgICB0aGlzLnVzZXJUeXBlUmVwb3NpdG9yeSA9IHVzZXJUeXBlUmVwb3NpdG9yeTtcbiAgICAgICAgdGhpcy5lbmNvZGVyID0gZW5jb2RlcjtcbiAgICAgICAgdGhpcy5mYW1pbHlNZW1iZXJSZXBvc2l0b3J5ID0gZmFtaWx5TWVtYmVyUmVwb3NpdG9yeTtcbiAgICAgICAgdGhpcy5zeXN0ZW1TZXJ2aWNlID0gc3lzdGVtU2VydmljZTtcbiAgICB9XG5cbiAgICBwdWJsaWMgTWFwPFN0cmluZywgT2JqZWN0PiBnZXRNYXBGcm9tVGVhY2hlcihUZWFjaGVyIHMpIHtcbiAgICAgICAgTWFwPFN0cmluZywgT2JqZWN0PiBtID0gbmV3IEhhc2hNYXA8PigpO1xuICAgICAgICBQZXJzb24gcDtcbiAgICAgICAgaWYgKHMgPT0gbnVsbClcbiAgICAgICAgICAgIHJldHVybiBtO1xuICAgICAgICBtLnB1dChcInRpdGxlXCIsIHMuZ2V0VGl0bGUoKSk7XG4gICAgICAgIG0ucHV0KFwiZGVncmVlXCIsIHMuZ2V0RGVncmVlKCkpO1xuICAgICAgICBtLnB1dChcImNsYXNzTmFtZVwiLCBzLmdldENsYXNzTmFtZSgpKTtcbiAgICAgICAgcCA9IHMuZ2V0UGVyc29uKCk7XG4gICAgICAgIGlmIChwID09IG51bGwpXG4gICAgICAgICAgICByZXR1cm4gbTtcbiAgICAgICAgbS5wdXQoXCJwZXJzb25JZFwiLCBzLmdldFBlcnNvbklkKCkpO1xuICAgICAgICBtLnB1dChcIm51bVwiLCBwLmdldE51bSgpKTtcbiAgICAgICAgbS5wdXQoXCJuYW1lXCIsIHAuZ2V0TmFtZSgpKTtcbiAgICAgICAgbS5wdXQoXCJkZXB0XCIsIHAuZ2V0RGVwdCgpKTtcbiAgICAgICAgbS5wdXQoXCJjYXJkXCIsIHAuZ2V0Q2FyZCgpKTtcbiAgICAgICAgU3RyaW5nIGdlbmRlciA9IHAuZ2V0R2VuZGVyKCk7XG4gICAgICAgIG0ucHV0KFwiZ2VuZGVyXCIsIGdlbmRlcik7XG4gICAgICAgIG0ucHV0KFwiZ2VuZGVyTmFtZVwiLCBDb21EYXRhVXRpbC5nZXRJbnN0YW5jZSgpLmdldERpY3Rpb25hcnlMYWJlbEJ5VmFsdWUoXCJYQk1cIiwgZ2VuZGVyKSk7IC8v5oCn5Yir57G75Z6L55qE5YC86L2s5o2i5oiQ5pWw5o2u57G75Z6L5ZCNXG4gICAgICAgIG0ucHV0KFwiYmlydGhkYXlcIiwgcC5nZXRCaXJ0aGRheSgpKTsgIC8v5pe26Ze05qC85byP6L2s5o2i5a2X56ym5LiyXG4gICAgICAgIG0ucHV0KFwiZW1haWxcIiwgcC5nZXRFbWFpbCgpKTtcbiAgICAgICAgbS5wdXQoXCJwaG9uZVwiLCBwLmdldFBob25lKCkpO1xuICAgICAgICBtLnB1dChcImFkZHJlc3NcIiwgcC5nZXRBZGRyZXNzKCkpO1xuICAgICAgICBtLnB1dChcImludHJvZHVjZVwiLCBwLmdldEludHJvZHVjZSgpKTtcbiAgICAgICAgcmV0dXJuIG07XG4gICAgfVxuXG4gICAgcHVibGljIExpc3Q8TWFwPFN0cmluZywgT2JqZWN0Pj4gZ2V0VGVhY2hlck1hcExpc3QoU3RyaW5nIG51bU5hbWUpIHtcbiAgICAgICAgTGlzdDxNYXA8U3RyaW5nLCBPYmplY3Q+PiBkYXRhTGlzdCA9IG5ldyBBcnJheUxpc3Q8PigpO1xuICAgICAgICBMaXN0PFRlYWNoZXI+IHNMaXN0ID0gdGVhY2hlclJlcG9zaXRvcnkuZmluZFRlYWNoZXJMaXN0QnlOdW1OYW1lKG51bU5hbWUpOyAgLy/mlbDmja7lupPmn6Xor6Lmk43kvZxcbiAgICAgICAgaWYgKHNMaXN0ID09IG51bGwgfHwgc0xpc3QuaXNFbXB0eSgpKVxuICAgICAgICAgICAgcmV0dXJuIGRhdGFMaXN0O1xuICAgICAgICBmb3IgKFRlYWNoZXIgdGVhY2hlciA6IHNMaXN0KSB7XG4gICAgICAgICAgICBkYXRhTGlzdC5hZGQoZ2V0TWFwRnJvbVRlYWNoZXIodGVhY2hlcikpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBkYXRhTGlzdDtcbiAgICB9XG5cbiAgICBwdWJsaWMgRGF0YVJlc3BvbnNlIGdldFRlYWNoZXJMaXN0KERhdGFSZXF1ZXN0IGRhdGFSZXF1ZXN0KSB7XG4gICAgICAgIFN0cmluZyBudW1OYW1lID0gZGF0YVJlcXVlc3QuZ2V0U3RyaW5nKFwibnVtTmFtZVwiKTtcbiAgICAgICAgTGlzdDxNYXA8U3RyaW5nLCBPYmplY3Q+PiBkYXRhTGlzdCA9IGdldFRlYWNoZXJNYXBMaXN0KG51bU5hbWUpO1xuICAgICAgICByZXR1cm4gQ29tbW9uTWV0aG9kLmdldFJldHVybkRhdGEoZGF0YUxpc3QpOyAgLy/mjInnhafmtYvor5XmoYbmnrbop4TojIPkvJrpgIFNYXDnmoRsaXN0XG4gICAgfVxuXG4gICAgcHVibGljIERhdGFSZXNwb25zZSB0ZWFjaGVyRGVsZXRlKERhdGFSZXF1ZXN0IGRhdGFSZXF1ZXN0KSB7XG4gICAgICAgIEludGVnZXIgcGVyc29uSWQgPSBkYXRhUmVxdWVzdC5nZXRJbnRlZ2VyKFwicGVyc29uSWRcIik7ICAvL+iOt+WPlnRlYWNoZXJfaWTlgLxcbiAgICAgICAgVGVhY2hlciBzID0gbnVsbDtcbiAgICAgICAgT3B0aW9uYWw8VGVhY2hlcj4gb3A7XG4gICAgICAgIGlmIChwZXJzb25JZCAhPSBudWxsICYmIHBlcnNvbklkID4gMCkge1xuICAgICAgICAgICAgb3AgPSB0ZWFjaGVyUmVwb3NpdG9yeS5maW5kQnlJZChwZXJzb25JZCk7ICAgLy/mn6Xor6Lojrflvpflrp7kvZPlr7nosaFcbiAgICAgICAgICAgIGlmIChvcC5pc1ByZXNlbnQoKSkge1xuICAgICAgICAgICAgICAgIHMgPSBvcC5nZXQoKTtcbiAgICAgICAgICAgICAgICBPcHRpb25hbDxVc2VyPiB1T3AgPSB1c2VyUmVwb3NpdG9yeS5maW5kQnlJZChwZXJzb25JZCk7IC8v5p+l6K+i5a+55bqU6K+l5pWZ5biI55qE6LSm5oi3XG4gICAgICAgICAgICAgICAgLy/liKDpmaTlr7nlupTor6XmlZnluIjnmoTotKbmiLdcbiAgICAgICAgICAgICAgICB1T3AuaWZQcmVzZW50KHVzZXJSZXBvc2l0b3J5OjpkZWxldGUpO1xuICAgICAgICAgICAgICAgIFBlcnNvbiBwID0gcy5nZXRQZXJzb24oKTtcbiAgICAgICAgICAgICAgICB0ZWFjaGVyUmVwb3NpdG9yeS5kZWxldGUocyk7ICAgIC8v6aaW5YWI5pWw5o2u5bqT5rC45LmF5Yig6Zmk5pWZ5biI5L+h5oGvXG4gICAgICAgICAgICAgICAgcGVyc29uUmVwb3NpdG9yeS5kZWxldGUocCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIENvbW1vbk1ldGhvZC5nZXRSZXR1cm5NZXNzYWdlT0soKTsgIC8v6YCa55+l5YmN56uv5pON5L2c5q2j5bi4XG4gICAgfVxuXG4gICAgcHVibGljIERhdGFSZXNwb25zZSBnZXRUZWFjaGVySW5mbyhEYXRhUmVxdWVzdCBkYXRhUmVxdWVzdCkge1xuICAgICAgICBJbnRlZ2VyIHBlcnNvbklkID0gZGF0YVJlcXVlc3QuZ2V0SW50ZWdlcihcInBlcnNvbklkXCIpO1xuICAgICAgICBUZWFjaGVyIHMgPSBudWxsO1xuICAgICAgICBPcHRpb25hbDxUZWFjaGVyPiBvcDtcbiAgICAgICAgaWYgKHBlcnNvbklkICE9IG51bGwpIHtcbiAgICAgICAgICAgIG9wID0gdGVhY2hlclJlcG9zaXRvcnkuZmluZEJ5SWQocGVyc29uSWQpOyAvL+agueaNruWtpueUn+S4u+mUruS7juaVsOaNruW6k+afpeivouWtpueUn+eahOS/oeaBr1xuICAgICAgICAgICAgaWYgKG9wLmlzUHJlc2VudCgpKSB7XG4gICAgICAgICAgICAgICAgcyA9IG9wLmdldCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBDb21tb25NZXRob2QuZ2V0UmV0dXJuRGF0YShnZXRNYXBGcm9tVGVhY2hlcihzKSk7IC8v6L+Z6YeM5Zue5Lyg5YyF5ZCr5a2m55Sf5L+h5oGv55qETWFw5a+56LGhXG4gICAgfVxuXG4gICAgcHVibGljIERhdGFSZXNwb25zZSB0ZWFjaGVyRWRpdFNhdmUoRGF0YVJlcXVlc3QgZGF0YVJlcXVlc3QpIHtcbiAgICAgICAgSW50ZWdlciBwZXJzb25JZCA9IGRhdGFSZXF1ZXN0LmdldEludGVnZXIoXCJwZXJzb25JZFwiKTtcbiAgICAgICAgTWFwPFN0cmluZywgT2JqZWN0PiBmb3JtID0gZGF0YVJlcXVlc3QuZ2V0TWFwKFwiZm9ybVwiKTsgLy/lj4LmlbDojrflj5ZNYXDlr7nosaFcbiAgICAgICAgU3RyaW5nIG51bSA9IENvbW1vbk1ldGhvZC5nZXRTdHJpbmcoZm9ybSwgXCJudW1cIik7ICAvL01hcCDojrflj5blsZ7mgKfnmoTlgLxcbiAgICAgICAgVGVhY2hlciBzID0gbnVsbDtcbiAgICAgICAgUGVyc29uIHA7XG4gICAgICAgIFVzZXIgdTtcbiAgICAgICAgT3B0aW9uYWw8VGVhY2hlcj4gb3A7XG4gICAgICAgIGJvb2xlYW4gaXNOZXcgPSBmYWxzZTtcbiAgICAgICAgaWYgKHBlcnNvbklkICE9IG51bGwpIHtcbiAgICAgICAgICAgIG9wID0gdGVhY2hlclJlcG9zaXRvcnkuZmluZEJ5SWQocGVyc29uSWQpOyAgLy/mn6Xor6Llr7nlupTmlbDmja7lupPkuK3kuLvplK7kuLppZOeahOWAvOeahOWunuS9k+WvueixoVxuICAgICAgICAgICAgaWYgKG9wLmlzUHJlc2VudCgpKSB7XG4gICAgICAgICAgICAgICAgcyA9IG9wLmdldCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIE9wdGlvbmFsPFBlcnNvbj4gbk9wID0gcGVyc29uUmVwb3NpdG9yeS5maW5kQnlOdW0obnVtKTsgLy/mn6Xor6LmmK/lkKblrZjlnKhudW3nmoTkurrlkZhcbiAgICAgICAgaWYgKG5PcC5pc1ByZXNlbnQoKSkge1xuICAgICAgICAgICAgaWYgKHMgPT0gbnVsbCB8fCAhcy5nZXRQZXJzb24oKS5nZXROdW0oKS5lcXVhbHMobnVtKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBDb21tb25NZXRob2QuZ2V0UmV0dXJuTWVzc2FnZUVycm9yKFwi5paw5bel5Y+35bey57uP5a2Y5Zyo77yM5LiN6IO95re75Yqg5oiW5L+u5pS577yBXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmIChzID09IG51bGwpIHtcbiAgICAgICAgICAgIHAgPSBuZXcgUGVyc29uKCk7XG4gICAgICAgICAgICBwLnNldE51bShudW0pO1xuICAgICAgICAgICAgcC5zZXRUeXBlKFwiMlwiKTsgIC8vIDLooajnpLrmlZnluIjnsbvlnotcbiAgICAgICAgICAgIHBlcnNvblJlcG9zaXRvcnkuc2F2ZUFuZEZsdXNoKHApOyAgLy/mj5LlhaXmlrDnmoRQZXJzb27orrDlvZVcbiAgICAgICAgICAgIHBlcnNvbklkID0gcC5nZXRQZXJzb25JZCgpO1xuICAgICAgICAgICAgU3RyaW5nIHBhc3N3b3JkID0gZW5jb2Rlci5lbmNvZGUoXCIxMjM0NTZcIik7XG4gICAgICAgICAgICB1ID0gbmV3IFVzZXIoKTtcbiAgICAgICAgICAgIHUuc2V0UGVyc29uSWQocGVyc29uSWQpO1xuICAgICAgICAgICAgdS5zZXRVc2VyTmFtZShudW0pO1xuICAgICAgICAgICAgdS5zZXRQYXNzd29yZChwYXNzd29yZCk7XG4gICAgICAgICAgICB1LnNldFVzZXJUeXBlKHVzZXJUeXBlUmVwb3NpdG9yeS5maW5kQnlOYW1lKEVVc2VyVHlwZS5ST0xFX1RFQUNIRVIpKTsgIC8vIOiuvue9ruS4uuaVmeW4iOinkuiJslxuICAgICAgICAgICAgdS5zZXRDcmVhdGVUaW1lKERhdGVUaW1lVG9vbC5wYXJzZURhdGVUaW1lKG5ldyBEYXRlKCkpKTtcbiAgICAgICAgICAgIHUuc2V0Q3JlYXRvcklkKENvbW1vbk1ldGhvZC5nZXRQZXJzb25JZCgpKTtcbiAgICAgICAgICAgIHVzZXJSZXBvc2l0b3J5LnNhdmVBbmRGbHVzaCh1KTsgLy/mj5LlhaXmlrDnmoRVc2Vy6K6w5b2VXG4gICAgICAgICAgICBzID0gbmV3IFRlYWNoZXIoKTsgICAvLyDliJvlu7rlrp7kvZPlr7nosaFcbiAgICAgICAgICAgIHMuc2V0UGVyc29uSWQocGVyc29uSWQpO1xuICAgICAgICAgICAgdGVhY2hlclJlcG9zaXRvcnkuc2F2ZUFuZEZsdXNoKHMpOyAgLy/mj5LlhaXmlrDnmoRUZWFjaGVy6K6w5b2VXG4gICAgICAgICAgICBpc05ldyA9IHRydWU7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBwID0gcy5nZXRQZXJzb24oKTtcbiAgICAgICAgfVxuICAgICAgICBwZXJzb25JZCA9IHAuZ2V0UGVyc29uSWQoKTtcbiAgICAgICAgaWYgKCFudW0uZXF1YWxzKHAuZ2V0TnVtKCkpKSB7ICAgLy/lpoLmnpzkurrlkZjnvJblj7flj5jljJbvvIzkv67mlLnkurrlkZjnvJblj7flkoznmbvlvZXotKblj7dcbiAgICAgICAgICAgIE9wdGlvbmFsPFVzZXI+IHVPcCA9IHVzZXJSZXBvc2l0b3J5LmZpbmRCeVBlcnNvblBlcnNvbklkKHBlcnNvbklkKTtcbiAgICAgICAgICAgIGlmICh1T3AuaXNQcmVzZW50KCkpIHtcbiAgICAgICAgICAgICAgICB1ID0gdU9wLmdldCgpO1xuICAgICAgICAgICAgICAgIHUuc2V0VXNlck5hbWUobnVtKTtcbiAgICAgICAgICAgICAgICB1c2VyUmVwb3NpdG9yeS5zYXZlQW5kRmx1c2godSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBwLnNldE51bShudW0pOyAgLy/orr7nva7lsZ7mgKdcbiAgICAgICAgfVxuICAgICAgICBwLnNldE5hbWUoQ29tbW9uTWV0aG9kLmdldFN0cmluZyhmb3JtLCBcIm5hbWVcIikpO1xuICAgICAgICBwLnNldERlcHQoQ29tbW9uTWV0aG9kLmdldFN0cmluZyhmb3JtLCBcImRlcHRcIikpO1xuICAgICAgICBwLnNldENhcmQoQ29tbW9uTWV0aG9kLmdldFN0cmluZyhmb3JtLCBcImNhcmRcIikpO1xuICAgICAgICBwLnNldEdlbmRlcihDb21tb25NZXRob2QuZ2V0U3RyaW5nKGZvcm0sIFwiZ2VuZGVyXCIpKTtcbiAgICAgICAgcC5zZXRCaXJ0aGRheShDb21tb25NZXRob2QuZ2V0U3RyaW5nKGZvcm0sIFwiYmlydGhkYXlcIikpO1xuICAgICAgICBwLnNldEVtYWlsKENvbW1vbk1ldGhvZC5nZXRTdHJpbmcoZm9ybSwgXCJlbWFpbFwiKSk7XG4gICAgICAgIHAuc2V0UGhvbmUoQ29tbW9uTWV0aG9kLmdldFN0cmluZyhmb3JtLCBcInBob25lXCIpKTtcbiAgICAgICAgcC5zZXRBZGRyZXNzKENvbW1vbk1ldGhvZC5nZXRTdHJpbmcoZm9ybSwgXCJhZGRyZXNzXCIpKTtcbiAgICAgICAgcGVyc29uUmVwb3NpdG9yeS5zYXZlKHApOyAgLy8g5L+u5pS55L+d5a2Y5Lq65ZGY5L+h5oGvXG4gICAgICAgIHMuc2V0Q2xhc3NOYW1lKENvbW1vbk1ldGhvZC5nZXRTdHJpbmcoZm9ybSwgXCJjbGFzc05hbWVcIikpO1xuICAgICAgICB0ZWFjaGVyUmVwb3NpdG9yeS5zYXZlKHMpOyAgLy/kv67mlLnkv53lrZjlrabnlJ/kv6Hmga9cbiAgICAgICAgc3lzdGVtU2VydmljZS5tb2RpZnlMb2cocywgaXNOZXcpO1xuICAgICAgICByZXR1cm4gQ29tbW9uTWV0aG9kLmdldFJldHVybkRhdGEocy5nZXRQZXJzb25JZCgpKTsgIC8vIOWwhnBlcnNvbklk6L+U5Zue5YmN56uvXG4gICAgfVxuLi4uXG5cbiAgICAgICAgICAgICAgICAvLyDloavlhYXlhbfkvZPmlbDmja5cbiAgICAgICAgICAgICAgICBjZWxsWzBdLnNldENlbGxWYWx1ZSgoaSArIDEpICsgXCJcIik7IC8vIOW6j+WPt1xuICAgICAgICAgICAgICAgIGNlbGxbMV0uc2V0Q2VsbFZhbHVlKENvbW1vbk1ldGhvZC5nZXRTdHJpbmcobSwgXCJudW1cIikpOyAvLyDlt6Xlj7dcbiAgICAgICAgICAgICAgICBjZWxsWzJdLnNldENlbGxWYWx1ZShDb21tb25NZXRob2QuZ2V0U3RyaW5nKG0sIFwibmFtZVwiKSk7IC8vIOWnk+WQjVxuICAgICAgICAgICAgICAgIGNlbGxbM10uc2V0Q2VsbFZhbHVlKENvbW1vbk1ldGhvZC5nZXRTdHJpbmcobSwgXCJkZXB0XCIpKTsgLy8g5a2m6ZmiXG4gICAgICAgICAgICAgICAgY2VsbFs0XS5zZXRDZWxsVmFsdWUoQ29tbW9uTWV0aG9kLmdldFN0cmluZyhtLCBcInRpdGxlXCIpKTsgLy8g6IGM56ewXG4gICAgICAgICAgICAgICAgY2VsbFs1XS5zZXRDZWxsVmFsdWUoQ29tbW9uTWV0aG9kLmdldFN0cmluZyhtLCBcImRlZ3JlZVwiKSk7IC8vIOWtpuS9jVxuICAgICAgICAgICAgICAgIGNlbGxbNl0uc2V0Q2VsbFZhbHVlKENvbW1vbk1ldGhvZC5nZXRTdHJpbmcobSwgXCJnZW5kZXJOYW1lXCIpKTsgLy8g5oCn5YirXG4gICAgICAgICAgICAgICAgY2VsbFs3XS5zZXRDZWxsVmFsdWUoQ29tbW9uTWV0aG9kLmdldFN0cmluZyhtLCBcImVtYWlsXCIpKTsgLy8g6YKu566xXG4gICAgICAgICAgICAgICAgY2VsbFs4XS5zZXRDZWxsVmFsdWUoQ29tbW9uTWV0aG9kLmdldFN0cmluZyhtLCBcInBob25lXCIpKTsgLy8g55S16K+dXG4gICAgICAgICAgICAgICAgY2VsbFs5XS5zZXRDZWxsVmFsdWUoQ29tLi4uIiwiaXNfZXJyb3IiOmZhbHNlLCJyZXF1ZXN0X2lkIjoiIiwidG9vbF91c2VfaWQiOiJ0b29sdV92cnR4XzAxSDVzYlVFRzZDdUhXUXk5ZEZSRlBZViJ9fSx7ImlkIjoyLCJ0eXBlIjo0LCJpZGVfc3RhdGVfbm9kZSI6eyJ3b3Jrc3BhY2VGb2xkZXJzIjpbeyJyZXBvc2l0b3J5Um9vdCI6IkM6L1VzZXJzL3ByaW5jaXAvRG9jdW1lbnRzL0dpdEh1Yi9iYWljYWkvamF2YS1zZXJ2ZXIiLCJmb2xkZXJSb290IjoiQzovVXNlcnMvcHJpbmNpcC9Eb2N1bWVudHMvR2l0SHViL2JhaWNhaS9qYXZhLXNlcnZlciJ9XSwid29ya3NwYWNlRm9sZGVyc1VuY2hhbmdlZCI6ZmFsc2V9fV0sInRpbWVzdGFtcCI6IjIwMjUtMDUtMTZUMTU6MTU6MDkuNTc3WiIsInJlc3BvbnNlX3RleHQiOiLnjrDlnKjmiJHpnIDopoHliJvlu7rkuIDkuKrmlrDmlofku7bmnaXkv67lpI0gYFRlYWNoZXJTZXJ2aWNlcy5qYXZhYCDkuK3nmoQgYGZhbWlseU1lbWJlclNhdmVgIOaWueazle+8mlxuIiwid29ya3NwYWNlX2ZpbGVfY2h1bmtzIjpbXX0seyJzdGF0dXMiOiJzdWNjZXNzIiwicmVxdWVzdF9pZCI6ImM1OGVjNTJjLTEyZDAtNGFkYS04ZTcyLTM2OTgzOGNhYzEwMyIsInJlcXVlc3RfbWVzc2FnZSI6IiIsInN0cnVjdHVyZWRfb3V0cHV0X25vZGVzIjpbeyJpZCI6MCwidHlwZSI6MCwiY29udGVudCI6IuaIkeW3sue7j+S/ruaUueS6hiBgVGVhY2hlclNlcnZpY2VzLmphdmFgIOaWh+S7tu+8jOino+WGs+S6hiBEb3VibGUg5YiwIEludGVnZXIg55qE57G75Z6L6L2s5o2i6Zeu6aKY44CC5Lul5LiL5piv5oiR5omA5YGa55qE5Li76KaB5L+u5pS577yaXG5cbjEuIOa3u+WKoOS6hiBgU3R1ZGVudFJlcG9zaXRvcnlgIOS9nOS4uuS+nei1luazqOWFpe+8jOWboOS4uiBgRmFtaWx5TWVtYmVyYCDpnIDopoHlhbPogZTliLAgYFN0dWRlbnRgIOWvueixoeOAglxuXG4yLiDkv67mlLnkuoYgYGZhbWlseU1lbWJlclNhdmVgIOaWueazleS4reeahOexu+Wei+i9rOaNoumAu+i+ke+8mlxuICAgLSDkuI3lho3kvb/nlKggYENvbW1vbk1ldGhvZC5nZXRJbnRlZ2VyKGZvcm0sXCJhZ2VcIilgIOebtOaOpei9rOaNou+8jOiAjOaYr+mHh+eUqOabtOWuieWFqOeahOaWueW8j+WkhOeQhiBhZ2Ug5a2X5q61XG4gICAtIOa3u+WKoOS6huexu+Wei+ajgOafpe+8jOagueaNruS4jeWQjOexu+Wei+mHh+eUqOS4jeWQjOeahOi9rOaNouaWueazlVxuICAgLSDlr7nkuo4gRG91YmxlIOexu+Wei++8jOS9v+eUqCBgaW50VmFsdWUoKWAg5pa55rOV6L2s5o2i5Li6IEludGVnZXJcbiAgIC0g5re75Yqg5LqG5byC5bi45aSE55CG77yM56Gu5L+d6L2s5o2i6L+H56iL5Lit55qE6ZSZ6K+v6IO95aSf6KKr5o2V6I635bm26L+U5Zue5Y+L5aW955qE6ZSZ6K+v5L+h5oGvXG5cbjMuIOS/ruWkjeS6hiBgZ2V0RmFtaWx5TWVtYmVyTGlzdGAg5pa55rOV77yM5L2/55SoIGBmaW5kQnlTdHVkZW50UGVyc29uSWRgIOiAjOS4jeaYryBgZmluZEJ5VGVhY2hlclBlcnNvbklkYO+8jOehruS/neS4jiBgRmFtaWx5TWVtYmVyYCDnsbvnmoTnu5PmnoTkuIDoh7TjgIJcblxuNC4g5re75Yqg5LqGIGBmYW1pbHlNZW1iZXJEZWxldGVgIOaWueazle+8jOS7peaUr+aMgeWIoOmZpOWutuW6reaIkOWRmOeahOWKn+iDveOAglxuXG7ov5nkupvkv67mlLnlupTor6Xog73lpJ/op6PlhrPmgqjpgYfliLDnmoQgXCJjbGFzcyBqYXZhLmxhbmcuRG91YmxlIGNhbm5vdCBiZSBjYXN0IHRvIGNsYXNzIGphdmEubGFuZy5JbnRlZ2VyXCIg6ZSZ6K+v77yM5ZCM5pe256Gu5L+dIGBGYW1pbHlNZW1iZXJgIOS4jiBgU3R1ZGVudGAg5LmL6Ze055qE5YWz57O75q2j56Gu5bu656uL44CCXG5cbuaCqOWPr+S7peWwneivlemHjeaWsOi/kOihjOW6lOeUqOeoi+W6j++8jOeci+eci+mXrumimOaYr+WQpuW3sue7j+ino+WGs+OAguWmguaenOi/mOacieWFtuS7lumXrumimO+8jOivt+maj+aXtuWRiuivieaIkeOAglxuIn0seyJpZCI6MiwidHlwZSI6MiwiY29udGVudCI6IiJ9LHsiaWQiOjMsInR5cGUiOjMsImNvbnRlbnQiOiIifV0sInNlZW5fc3RhdGUiOiJzZWVuIiwic3RydWN0dXJlZF9yZXF1ZXN0X25vZGVzIjpbeyJpZCI6MSwidHlwZSI6MSwidG9vbF9yZXN1bHRfbm9kZSI6eyJjb250ZW50IjoiRmlsZSBzYXZlZCBzdWNjZXNzZnVsbHkuIiwiaXNfZXJyb3IiOmZhbHNlLCJyZXF1ZXN0X2lkIjoiIiwidG9vbF91c2VfaWQiOiJ0b29sdV92cnR4XzAxUUZOSExLellRWGVicWFEd25mMW5pVCJ9fSx7ImlkIjoyLCJ0eXBlIjo0LCJpZGVfc3RhdGVfbm9kZSI6eyJ3b3Jrc3BhY2VGb2xkZXJzIjpbeyJyZXBvc2l0b3J5Um9vdCI6IkM6L1VzZXJzL3ByaW5jaXAvRG9jdW1lbnRzL0dpdEh1Yi9iYWljYWkvamF2YS1zZXJ2ZXIiLCJmb2xkZXJSb290IjoiQzovVXNlcnMvcHJpbmNpcC9Eb2N1bWVudHMvR2l0SHViL2JhaWNhaS9qYXZhLXNlcnZlciJ9XSwid29ya3NwYWNlRm9sZGVyc1VuY2hhbmdlZCI6ZmFsc2V9fV0sInRpbWVzdGFtcCI6IjIwMjUtMDUtMTZUMTU6MTY6MTIuNTkwWiIsInJlc3BvbnNlX3RleHQiOiLmiJHlt7Lnu4/kv67mlLnkuoYgYFRlYWNoZXJTZXJ2aWNlcy5qYXZhYCDmlofku7bvvIzop6PlhrPkuoYgRG91YmxlIOWIsCBJbnRlZ2VyIOeahOexu+Wei+i9rOaNoumXrumimOOAguS7peS4i+aYr+aIkeaJgOWBmueahOS4u+imgeS/ruaUue+8mlxuXG4xLiDmt7vliqDkuoYgYFN0dWRlbnRSZXBvc2l0b3J5YCDkvZzkuLrkvp3otZbms6jlhaXvvIzlm6DkuLogYEZhbWlseU1lbWJlcmAg6ZyA6KaB5YWz6IGU5YiwIGBTdHVkZW50YCDlr7nosaHjgIJcblxuMi4g5L+u5pS55LqGIGBmYW1pbHlNZW1iZXJTYXZlYCDmlrnms5XkuK3nmoTnsbvlnovovazmjaLpgLvovpHvvJpcbiAgIC0g5LiN5YaN5L2/55SoIGBDb21tb25NZXRob2QuZ2V0SW50ZWdlcihmb3JtLFwiYWdlXCIpYCDnm7TmjqXovazmjaLvvIzogIzmmK/ph4fnlKjmm7TlronlhajnmoTmlrnlvI/lpITnkIYgYWdlIOWtl+autVxuICAgLSDmt7vliqDkuobnsbvlnovmo4Dmn6XvvIzmoLnmja7kuI3lkIznsbvlnovph4fnlKjkuI3lkIznmoTovazmjaLmlrnms5VcbiAgIC0g5a+55LqOIERvdWJsZSDnsbvlnovvvIzkvb/nlKggYGludFZhbHVlKClgIOaWueazlei9rOaNouS4uiBJbnRlZ2VyXG4gICAtIOa3u+WKoOS6huW8guW4uOWkhOeQhu+8jOehruS/nei9rOaNoui/h+eoi+S4reeahOmUmeivr+iDveWkn+iiq+aNleiOt+W5tui/lOWbnuWPi+WlveeahOmUmeivr+S/oeaBr1xuXG4zLiDkv67lpI3kuoYgYGdldEZhbWlseU1lbWJlckxpc3RgIOaWueazle+8jOS9v+eUqCBgZmluZEJ5U3R1ZGVudFBlcnNvbklkYCDogIzkuI3mmK8gYGZpbmRCeVRlYWNoZXJQZXJzb25JZGDvvIznoa7kv53kuI4gYEZhbWlseU1lbWJlcmAg57G755qE57uT5p6E5LiA6Ie044CCXG5cbjQuIOa3u+WKoOS6hiBgZmFtaWx5TWVtYmVyRGVsZXRlYCDmlrnms5XvvIzku6XmlK/mjIHliKDpmaTlrrbluq3miJDlkZjnmoTlip/og73jgIJcblxu6L+Z5Lqb5L+u5pS55bqU6K+l6IO95aSf6Kej5Yaz5oKo6YGH5Yiw55qEIFwiY2xhc3MgamF2YS5sYW5nLkRvdWJsZSBjYW5ub3QgYmUgY2FzdCB0byBjbGFzcyBqYXZhLmxhbmcuSW50ZWdlclwiIOmUmeivr++8jOWQjOaXtuehruS/nSBgRmFtaWx5TWVtYmVyYCDkuI4gYFN0dWRlbnRgIOS5i+mXtOeahOWFs+ezu+ato+ehruW7uueri+OAglxuXG7mgqjlj6/ku6XlsJ3or5Xph43mlrDov5DooYzlupTnlKjnqIvluo/vvIznnIvnnIvpl67popjmmK/lkKblt7Lnu4/op6PlhrPjgILlpoLmnpzov5jmnInlhbbku5bpl67popjvvIzor7fpmo/ml7blkYror4nmiJHjgIJcbiIsIndvcmtzcGFjZV9maWxlX2NodW5rcyI6W119LHsicmVxdWVzdF9pZCI6ImIzOGQzNTQxLWE3M2YtNGZjNy05NmMyLWZlZDRkODNkZmZhMCIsInN0YXR1cyI6ImNhbmNlbGxlZCIsImNoYXRJdGVtVHlwZSI6ImFnZW50aWMtdHVybi1kZWxpbWl0ZXIifSx7InN0YXR1cyI6InN1Y2Nlc3MiLCJyZXF1ZXN0X2lkIjoiODAxMWM4MTUtOGE0Mi00YTlmLTkzMDUtYTJiOTE4OTg1YjhjIiwicmVxdWVzdF9tZXNzYWdlIjoi5biu5oiR5om+5Yiw5L2g5L+u5pS555qE5Zyw5pa5IiwicmljaF90ZXh0X2pzb25fcmVwciI6eyJ0eXBlIjoiZG9jIiwiY29udGVudCI6W3sidHlwZSI6InBhcmFncmFwaCIsImNvbnRlbnQiOlt7InR5cGUiOiJ0ZXh0IiwidGV4dCI6IuW4ruaIkeaJvuWIsOS9oOS/ruaUueeahOWcsOaWuSJ9XX1dfSwibWVudGlvbmVkX2l0ZW1zIjpbXSwic3RydWN0dXJlZF9vdXRwdXRfbm9kZXMiOlt7ImlkIjowLCJ0eXBlIjowLCJjb250ZW50Ijoi5aW955qE77yM5oiR5p2l5biu5oKo5om+5Ye65oiR5ZyoIGBUZWFjaGVyU2VydmljZXMuamF2YWAg5paH5Lu25Lit5omA5YGa55qE5Li76KaB5L+u5pS577yaXG5cbjEuICoq5re75Yqg5LqGIFN0dWRlbnRSZXBvc2l0b3J5IOS+nei1lioq77yaXG48YXVnbWVudF9jb2RlX3NuaXBwZXQgcGF0aD1cImphdmEtc2VydmVyL3NyYy9tYWluL2phdmEvY24vZWR1L3NkdS9qYXZhL3NlcnZlci9zZXJ2aWNlcy9UZWFjaGVyU2VydmljZXMuamF2YVwiIG1vZGU9XCJFWENFUlBUXCI+XG5gYGBqYXZhXG5wcml2YXRlIGZpbmFsIFN0dWRlbnRSZXBvc2l0b3J5IHN0dWRlbnRSZXBvc2l0b3J5OyAvLyDmt7vliqBTdHVkZW50UmVwb3NpdG9yeVxuXG5wdWJsaWMgVGVhY2hlclNlcnZpY2VzKFBlcnNvblJlcG9zaXRvcnkgcGVyc29uUmVwb3NpdG9yeSwgVGVhY2hlclJlcG9zaXRvcnkgdGVhY2hlclJlcG9zaXRvcnksIFVzZXJSZXBvc2l0b3J5IHVzZXJSZXBvc2l0b3J5LCBVc2VyVHlwZVJlcG9zaXRvcnkgdXNlclR5cGVSZXBvc2l0b3J5LCBQYXNzd29yZEVuY29kZXIgZW5jb2RlciwgRmVlUmVwb3NpdG9yeSBmZWVSZXBvc2l0b3J5LCBGYW1pbHlNZW1iZXJSZXBvc2l0b3J5IGZhbWlseU1lbWJlclJlcG9zaXRvcnksIFN5c3RlbVNlcnZpY2Ugc3lzdGVtU2VydmljZSwgU3R1ZGVudFJlcG9zaXRvcnkgc3R1ZGVudFJlcG9zaXRvcnkpIHtcbiAgICAvLyAuLi7lhbbku5bku6PnoIEuLi5cbiAgICB0aGlzLnN0dWRlbnRSZXBvc2l0b3J5ID0gc3R1ZGVudFJlcG9zaXRvcnk7IC8vIOWIneWni+WMllN0dWRlbnRSZXBvc2l0b3J5XG59XG5gYGBcbjwvYXVnbWVudF9jb2RlX3NuaXBwZXQ+XG5cbjIuICoq5L+u5pS55LqGIGZhbWlseU1lbWJlclNhdmUg5pa55rOV5Lit55qE57G75Z6L6L2s5o2i6YC76L6RKirvvJpcbjxhdWdtZW50X2NvZGVfc25pcHBldCBwYXRoPVwiamF2YS1zZXJ2ZXIvc3JjL21haW4vamF2YS9jbi9lZHUvc2R1L2phdmEvc2VydmVyL3NlcnZpY2VzL1RlYWNoZXJTZXJ2aWNlcy5qYXZhXCIgbW9kZT1cIkVYQ0VSUFRcIj5cbmBgYGphdmFcbnB1YmxpYyBEYXRhUmVzcG9uc2UgZmFtaWx5TWVtYmVyU2F2ZShEYXRhUmVxdWVzdCBkYXRhUmVxdWVzdCkge1xuICAgIE1hcDxTdHJpbmcsT2JqZWN0PiBmb3JtID0gZGF0YVJlcXVlc3QuZ2V0TWFwKFwiZm9ybVwiKTtcbiAgICBJbnRlZ2VyIHBlcnNvbklkID0gQ29tbW9uTWV0aG9kLmdldEludGVnZXIoZm9ybSxcInBlcnNvbklkXCIpO1xuICAgIEludGVnZXIgbWVtYmVySWQgPSBDb21tb25NZXRob2QuZ2V0SW50ZWdlcihmb3JtLFwibWVtYmVySWRcIik7XG4gICAgT3B0aW9uYWw8RmFtaWx5TWVtYmVyPiBvcDtcbiAgICBGYW1pbHlNZW1iZXIgZiA9IG51bGw7XG4gICAgaWYobWVtYmVySWQgIT0gbnVsbCkge1xuICAgICAgICBvcCA9IGZhbWlseU1lbWJlclJlcG9zaXRvcnkuZmluZEJ5SWQobWVtYmVySWQpO1xuICAgICAgICBpZihvcC5pc1ByZXNlbnQoKSkge1xuICAgICAgICAgICAgZiA9IG9wLmdldCgpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGlmKGYgPT0gbnVsbCkge1xuICAgICAgICBmID0gbmV3IEZhbWlseU1lbWJlcigpO1xuICAgICAgICBhc3NlcnQgcGVyc29uSWQgIT0gbnVsbDtcbiAgICAgICAgLy8g5Yib5bu65LiA5LiqU3R1ZGVudOWvueixoeW5tuiuvue9ruWIsEZhbWlseU1lbWJlcuS4rVxuICAgICAgICBPcHRpb25hbDxTdHVkZW50PiBzdHVkZW50T3AgPSBzdHVkZW50UmVwb3NpdG9yeS5maW5kQnlJZChwZXJzb25JZCk7XG4gICAgICAgIGlmKHN0dWRlbnRPcC5pc1ByZXNlbnQoKSkge1xuICAgICAgICAgICAgZi5zZXRTdHVkZW50KHN0dWRlbnRPcC5nZXQoKSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAvLyDlpoLmnpzmib7kuI3liLDlr7nlupTnmoRTdHVkZW5077yM6L+U5Zue6ZSZ6K+v5L+h5oGvXG4gICAgICAgICAgICByZXR1cm4gQ29tbW9uTWV0aG9kLmdldFJldHVybk1lc3NhZ2VFcnJvcihcIuaJvuS4jeWIsOWvueW6lOeahOWtpueUn+S/oeaBr++8gVwiKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBmLnNldFJlbGF0aW9uKENvbW1vbk1ldGhvZC5nZXRTdHJpbmcoZm9ybSxcInJlbGF0aW9uXCIpKTtcbiAgICBmLnNldE5hbWUoQ29tbW9uTWV0aG9kLmdldFN0cmluZyhmb3JtLFwibmFtZVwiKSk7XG4gICAgZi5zZXRHZW5kZXIoQ29tbW9uTWV0aG9kLmdldFN0cmluZyhmb3JtLFwiZ2VuZGVyXCIpKTtcbiAgICBcbiAgICAvLyDlronlhajlnLDlpITnkIZhZ2XlrZfmrrXvvIzpgb/lhY1Eb3VibGXliLBJbnRlZ2Vy55qE55u05o6l6L2s5o2iXG4gICAgdHJ5IHtcbiAgICAgICAgT2JqZWN0IGFnZU9iaiA9IGZvcm0uZ2V0KFwiYWdlXCIpO1xuICAgICAgICBpZihhZ2VPYmogIT0gbnVsbCkge1xuICAgICAgICAgICAgaWYoYWdlT2JqIGluc3RhbmNlb2YgSW50ZWdlcikge1xuICAgICAgICAgICAgICAgIGYuc2V0QWdlKChJbnRlZ2VyKWFnZU9iaik7XG4gICAgICAgICAgICB9IGVsc2UgaWYoYWdlT2JqIGluc3RhbmNlb2YgRG91YmxlKSB7XG4gICAgICAgICAgICAgICAgLy8g5bCGRG91Ymxl6L2s5o2i5Li6SW50ZWdlclxuICAgICAgICAgICAgICAgIGYuc2V0QWdlKCgoRG91YmxlKWFnZU9iaikuaW50VmFsdWUoKSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIC8vIOWwneivleS7juWtl+espuS4suino+aekFxuICAgICAgICAgICAgICAgIFN0cmluZyBhZ2VTdHIgPSBhZ2VPYmoudG9TdHJpbmcoKTtcbiAgICAgICAgICAgICAgICBmLnNldEFnZSgoaW50KURvdWJsZS5wYXJzZURvdWJsZShhZ2VTdHIpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0gY2F0Y2goRXhjZXB0aW9uIGUpIHtcbiAgICAgICAgbG9nLmVycm9yKFwi5aSE55CG5bm06b6E5a2X5q615pe25Ye66ZSZXCIsIGUpO1xuICAgICAgICByZXR1cm4gQ29tbW9uTWV0aG9kLmdldFJldHVybk1lc3NhZ2VFcnJvcihcIuW5tOm+hOagvOW8j+S4jeato+ehru+8gVwiKTtcbiAgICB9XG4gICAgXG4gICAgZi5zZXRVbml0KENvbW1vbk1ldGhvZC5nZXRTdHJpbmcoZm9ybSxcInVuaXRcIikpO1xuICAgIGZhbWlseU1lbWJlclJlcG9zaXRvcnkuc2F2ZShmKTtcbiAgICByZXR1cm4gQ29tbW9uTWV0aG9kLmdldFJldHVybk1lc3NhZ2VPSygpO1xufVxuYGBgXG48L2F1Z21lbnRfY29kZV9zbmlwcGV0PlxuXG4zLiAqKuS/ruaUueS6hiBnZXRGYW1pbHlNZW1iZXJMaXN0IOaWueazlSoq77yaXG48YXVnbWVudF9jb2RlX3NuaXBwZXQgcGF0aD1cImphdmEtc2VydmVyL3NyYy9tYWluL2phdmEvY24vZWR1L3NkdS9qYXZhL3NlcnZlci9zZXJ2aWNlcy9UZWFjaGVyU2VydmljZXMuamF2YVwiIG1vZGU9XCJFWENFUlBUXCI+XG5gYGBqYXZhXG5wdWJsaWMgRGF0YVJlc3BvbnNlIGdldEZhbWlseU1lbWJlckxpc3QoRGF0YVJlcXVlc3QgZGF0YVJlcXVlc3QpIHtcbiAgICBJbnRlZ2VyIHBlcnNvbklkID0gZGF0YVJlcXVlc3QuZ2V0SW50ZWdlcihcInBlcnNvbklkXCIpO1xuICAgIExpc3Q8RmFtaWx5TWVtYmVyPiBmTGlzdCA9IGZhbWlseU1lbWJlclJlcG9zaXRvcnkuZmluZEJ5U3R1ZGVudFBlcnNvbklkKHBlcnNvbklkKTtcbiAgICBMaXN0PE1hcDxTdHJpbmcsT2JqZWN0Pj4gZGF0YUxpc3QgPSBuZXcgQXJyYXlMaXN0PD4oKTtcbiAgICBNYXA8U3RyaW5nLE9iamVjdD4gbTtcbiAgICBpZiAoZkxpc3QgIT0gbnVsbCkge1xuICAgICAgICBmb3IgKEZhbWlseU1lbWJlciBmIDogZkxpc3QpIHtcbiAgICAgICAgICAgIG0gPSBuZXcgSGFzaE1hcDw+KCk7XG4gICAgICAgICAgICBtLnB1dChcIm1lbWJlcklkXCIsIGYuZ2V0TWVtYmVySWQoKSk7XG4gICAgICAgICAgICBtLnB1dChcInBlcnNvbklkXCIsIGYuZ2V0U3R1ZGVudCgpLmdldFBlcnNvbklkKCkpO1xuICAgICAgICAgICAgbS5wdXQoXCJyZWxhdGlvblwiLCBmLmdldFJlbGF0aW9uKCkpO1xuICAgICAgICAgICAgbS5wdXQoXCJuYW1lXCIsIGYuZ2V0TmFtZSgpKTtcbiAgICAgICAgICAgIG0ucHV0KFwiZ2VuZGVyXCIsIGYuZ2V0R2VuZGVyKCkpO1xuICAgICAgICAgICAgbS5wdXQoXCJhZ2VcIiwgZi5nZXRBZ2UoKStcIlwiKTtcbiAgICAgICAgICAgIG0ucHV0KFwidW5pdFwiLCBmLmdldFVuaXQoKSk7XG4gICAgICAgICAgICBkYXRhTGlzdC5hZGQobSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIENvbW1vbk1ldGhvZC5nZXRSZXR1cm5EYXRhKGRhdGFMaXN0KTtcbn1cbmBgYFxuPC9hdWdtZW50X2NvZGVfc25pcHBldD5cblxuNC4gKirmt7vliqDkuoYgZmFtaWx5TWVtYmVyRGVsZXRlIOaWueazlSoq77yaXG48YXVnbWVudF9jb2RlX3NuaXBwZXQgcGF0aD1cImphdmEtc2VydmVyL3NyYy9tYWluL2phdmEvY24vZWR1L3NkdS9qYXZhL3NlcnZlci9zZXJ2aWNlcy9UZWFjaGVyU2VydmljZXMuamF2YVwiIG1vZGU9XCJFWENFUlBUXCI+XG5gYGBqYXZhXG5wdWJsaWMgRGF0YVJlc3BvbnNlIGZhbWlseU1lbWJlckRlbGV0ZShEYXRhUmVxdWVzdCBkYXRhUmVxdWVzdCkge1xuICAgIEludGVnZXIgbWVtYmVySWQgPSBkYXRhUmVxdWVzdC5nZXRJbnRlZ2VyKFwibWVtYmVySWRcIik7XG4gICAgT3B0aW9uYWw8RmFtaWx5TWVtYmVyPiBvcDtcbiAgICBvcCA9IGZhbWlseU1lbWJlclJlcG9zaXRvcnkuZmluZEJ5SWQobWVtYmVySWQpO1xuICAgIG9wLmlmUHJlc2VudChmYW1pbHlNZW1iZXJSZXBvc2l0b3J5OjpkZWxldGUpO1xuICAgIHJldHVybiBDb21tb25NZXRob2QuZ2V0UmV0dXJuTWVzc2FnZU9LKCk7XG59XG5gYGBcbjwvYXVnbWVudF9jb2RlX3NuaXBwZXQ+XG5cbuS4u+imgeeahOS/ruaUuembhuS4reWcqCBgZmFtaWx5TWVtYmVyU2F2ZWAg5pa55rOV5Lit77yM54m55Yir5piv5a+5IGFnZSDlrZfmrrXnmoTlpITnkIbpg6jliIbjgILljp/mnaXnmoTku6PnoIHnm7TmjqXkvb/nlKggYENvbW1vbk1ldGhvZC5nZXRJbnRlZ2VyKGZvcm0sXCJhZ2VcIilgIOi/m+ihjOi9rOaNou+8jOi/meWcqCBhZ2Ug5pivIERvdWJsZSDnsbvlnovml7bkvJrlr7zoh7TnsbvlnovovazmjaLplJnor6/jgILnjrDlnKjnmoTku6PnoIHkvJrmo4Dmn6UgYWdlIOeahOWunumZheexu+Wei++8jOW5tuagueaNruS4jeWQjOexu+Wei+mHh+eUqOS4jeWQjOeahOi9rOaNouaWueazle+8jOeJueWIq+aYr+WvueS6jiBEb3VibGUg57G75Z6L77yM5L2/55SoIGBpbnRWYWx1ZSgpYCDmlrnms5XlronlhajlnLDovazmjaLkuLogSW50ZWdlcuOAglxuXG7ov5nkupvkv67mlLnlupTor6Xog73lpJ/op6PlhrPmgqjpgYfliLDnmoQgXCJjbGFzcyBqYXZhLmxhbmcuRG91YmxlIGNhbm5vdCBiZSBjYXN0IHRvIGNsYXNzIGphdmEubGFuZy5JbnRlZ2VyXCIg6ZSZ6K+v44CCIn0seyJpZCI6MiwidHlwZSI6MiwiY29udGVudCI6IuWlveeahO+8jOaIkeadpeW4ruaCqOaJvuWHuuaIkeWcqCBgVGVhY2hlclNlcnZpY2VzLmphdmFgIOaWh+S7tuS4reaJgOWBmueahOS4u+imgeS/ruaUue+8mlxuXG4xLiAqKua3u+WKoOS6hiBTdHVkZW50UmVwb3NpdG9yeSDkvp3otZYqKu+8mlxuYGBgYGphdmEgcGF0aD1qYXZhLXNlcnZlci9zcmMvbWFpbi9qYXZhL2NuL2VkdS9zZHUvamF2YS9zZXJ2ZXIvc2VydmljZXMvVGVhY2hlclNlcnZpY2VzLmphdmEgbW9kZT1FWENFUlBUXG5wcml2YXRlIGZpbmFsIFN0dWRlbnRSZXBvc2l0b3J5IHN0dWRlbnRSZXBvc2l0b3J5OyAvLyDmt7vliqBTdHVkZW50UmVwb3NpdG9yeVxuXG5wdWJsaWMgVGVhY2hlclNlcnZpY2VzKFBlcnNvblJlcG9zaXRvcnkgcGVyc29uUmVwb3NpdG9yeSwgVGVhY2hlclJlcG9zaXRvcnkgdGVhY2hlclJlcG9zaXRvcnksIFVzZXJSZXBvc2l0b3J5IHVzZXJSZXBvc2l0b3J5LCBVc2VyVHlwZVJlcG9zaXRvcnkgdXNlclR5cGVSZXBvc2l0b3J5LCBQYXNzd29yZEVuY29kZXIgZW5jb2RlciwgRmVlUmVwb3NpdG9yeSBmZWVSZXBvc2l0b3J5LCBGYW1pbHlNZW1iZXJSZXBvc2l0b3J5IGZhbWlseU1lbWJlclJlcG9zaXRvcnksIFN5c3RlbVNlcnZpY2Ugc3lzdGVtU2VydmljZSwgU3R1ZGVudFJlcG9zaXRvcnkgc3R1ZGVudFJlcG9zaXRvcnkpIHtcbiAgICAvLyAuLi7lhbbku5bku6PnoIEuLi5cbiAgICB0aGlzLnN0dWRlbnRSZXBvc2l0b3J5ID0gc3R1ZGVudFJlcG9zaXRvcnk7IC8vIOWIneWni+WMllN0dWRlbnRSZXBvc2l0b3J5XG59XG5gYGBgXG5cbjIuICoq5L+u5pS55LqGIGZhbWlseU1lbWJlclNhdmUg5pa55rOV5Lit55qE57G75Z6L6L2s5o2i6YC76L6RKirvvJpcbmBgYGBqYXZhIHBhdGg9amF2YS1zZXJ2ZXIvc3JjL21haW4vamF2YS9jbi9lZHUvc2R1L2phdmEvc2VydmVyL3NlcnZpY2VzL1RlYWNoZXJTZXJ2aWNlcy5qYXZhIG1vZGU9RVhDRVJQVFxucHVibGljIERhdGFSZXNwb25zZSBmYW1pbHlNZW1iZXJTYXZlKERhdGFSZXF1ZXN0IGRhdGFSZXF1ZXN0KSB7XG4gICAgTWFwPFN0cmluZyxPYmplY3Q+IGZvcm0gPSBkYXRhUmVxdWVzdC5nZXRNYXAoXCJmb3JtXCIpO1xuICAgIEludGVnZXIgcGVyc29uSWQgPSBDb21tb25NZXRob2QuZ2V0SW50ZWdlcihmb3JtLFwicGVyc29uSWRcIik7XG4gICAgSW50ZWdlciBtZW1iZXJJZCA9IENvbW1vbk1ldGhvZC5nZXRJbnRlZ2VyKGZvcm0sXCJtZW1iZXJJZFwiKTtcbiAgICBPcHRpb25hbDxGYW1pbHlNZW1iZXI+IG9wO1xuICAgIEZhbWlseU1lbWJlciBmID0gbnVsbDtcbiAgICBpZihtZW1iZXJJZCAhPSBudWxsKSB7XG4gICAgICAgIG9wID0gZmFtaWx5TWVtYmVyUmVwb3NpdG9yeS5maW5kQnlJZChtZW1iZXJJZCk7XG4gICAgICAgIGlmKG9wLmlzUHJlc2VudCgpKSB7XG4gICAgICAgICAgICBmID0gb3AuZ2V0KCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgaWYoZiA9PSBudWxsKSB7XG4gICAgICAgIGYgPSBuZXcgRmFtaWx5TWVtYmVyKCk7XG4gICAgICAgIGFzc2VydCBwZXJzb25JZCAhPSBudWxsO1xuICAgICAgICAvLyDliJvlu7rkuIDkuKpTdHVkZW505a+56LGh5bm26K6+572u5YiwRmFtaWx5TWVtYmVy5LitXG4gICAgICAgIE9wdGlvbmFsPFN0dWRlbnQ+IHN0dWRlbnRPcCA9IHN0dWRlbnRSZXBvc2l0b3J5LmZpbmRCeUlkKHBlcnNvbklkKTtcbiAgICAgICAgaWYoc3R1ZGVudE9wLmlzUHJlc2VudCgpKSB7XG4gICAgICAgICAgICBmLnNldFN0dWRlbnQoc3R1ZGVudE9wLmdldCgpKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIC8vIOWmguaenOaJvuS4jeWIsOWvueW6lOeahFN0dWRlbnTvvIzov5Tlm57plJnor6/kv6Hmga9cbiAgICAgICAgICAgIHJldHVybiBDb21tb25NZXRob2QuZ2V0UmV0dXJuTWVzc2FnZUVycm9yKFwi5om+5LiN5Yiw5a+55bqU55qE5a2m55Sf5L+h5oGv77yBXCIpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGYuc2V0UmVsYXRpb24oQ29tbW9uTWV0aG9kLmdldFN0cmluZyhmb3JtLFwicmVsYXRpb25cIikpO1xuICAgIGYuc2V0TmFtZShDb21tb25NZXRob2QuZ2V0U3RyaW5nKGZvcm0sXCJuYW1lXCIpKTtcbiAgICBmLnNldEdlbmRlcihDb21tb25NZXRob2QuZ2V0U3RyaW5nKGZvcm0sXCJnZW5kZXJcIikpO1xuICAgIFxuICAgIC8vIOWuieWFqOWcsOWkhOeQhmFnZeWtl+aute+8jOmBv+WFjURvdWJsZeWIsEludGVnZXLnmoTnm7TmjqXovazmjaJcbiAgICB0cnkge1xuICAgICAgICBPYmplY3QgYWdlT2JqID0gZm9ybS5nZXQoXCJhZ2VcIik7XG4gICAgICAgIGlmKGFnZU9iaiAhPSBudWxsKSB7XG4gICAgICAgICAgICBpZihhZ2VPYmogaW5zdGFuY2VvZiBJbnRlZ2VyKSB7XG4gICAgICAgICAgICAgICAgZi5zZXRBZ2UoKEludGVnZXIpYWdlT2JqKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZihhZ2VPYmogaW5zdGFuY2VvZiBEb3VibGUpIHtcbiAgICAgICAgICAgICAgICAvLyDlsIZEb3VibGXovazmjaLkuLpJbnRlZ2VyXG4gICAgICAgICAgICAgICAgZi5zZXRBZ2UoKChEb3VibGUpYWdlT2JqKS5pbnRWYWx1ZSgpKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgLy8g5bCd6K+V5LuO5a2X56ym5Liy6Kej5p6QXG4gICAgICAgICAgICAgICAgU3RyaW5nIGFnZVN0ciA9IGFnZU9iai50b1N0cmluZygpO1xuICAgICAgICAgICAgICAgIGYuc2V0QWdlKChpbnQpRG91YmxlLnBhcnNlRG91YmxlKGFnZVN0cikpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSBjYXRjaChFeGNlcHRpb24gZSkge1xuICAgICAgICBsb2cuZXJyb3IoXCLlpITnkIblubTpvoTlrZfmrrXml7blh7rplJlcIiwgZSk7XG4gICAgICAgIHJldHVybiBDb21tb25NZXRob2QuZ2V0UmV0dXJuTWVzc2FnZUVycm9yKFwi5bm06b6E5qC85byP5LiN5q2j56Gu77yBXCIpO1xuICAgIH1cbiAgICBcbiAgICBmLnNldFVuaXQoQ29tbW9uTWV0aG9kLmdldFN0cmluZyhmb3JtLFwidW5pdFwiKSk7XG4gICAgZmFtaWx5TWVtYmVyUmVwb3NpdG9yeS5zYXZlKGYpO1xuICAgIHJldHVybiBDb21tb25NZXRob2QuZ2V0UmV0dXJuTWVzc2FnZU9LKCk7XG59XG5gYGBgXG5cbjMuICoq5L+u5pS55LqGIGdldEZhbWlseU1lbWJlckxpc3Qg5pa55rOVKirvvJpcbmBgYGBqYXZhIHBhdGg9amF2YS1zZXJ2ZXIvc3JjL21haW4vamF2YS9jbi9lZHUvc2R1L2phdmEvc2VydmVyL3NlcnZpY2VzL1RlYWNoZXJTZXJ2aWNlcy5qYXZhIG1vZGU9RVhDRVJQVFxucHVibGljIERhdGFSZXNwb25zZSBnZXRGYW1pbHlNZW1iZXJMaXN0KERhdGFSZXF1ZXN0IGRhdGFSZXF1ZXN0KSB7XG4gICAgSW50ZWdlciBwZXJzb25JZCA9IGRhdGFSZXF1ZXN0LmdldEludGVnZXIoXCJwZXJzb25JZFwiKTtcbiAgICBMaXN0PEZhbWlseU1lbWJlcj4gZkxpc3QgPSBmYW1pbHlNZW1iZXJSZXBvc2l0b3J5LmZpbmRCeVN0dWRlbnRQZXJzb25JZChwZXJzb25JZCk7XG4gICAgTGlzdDxNYXA8U3RyaW5nLE9iamVjdD4+IGRhdGFMaXN0ID0gbmV3IEFycmF5TGlzdDw+KCk7XG4gICAgTWFwPFN0cmluZyxPYmplY3Q+IG07XG4gICAgaWYgKGZMaXN0ICE9IG51bGwpIHtcbiAgICAgICAgZm9yIChGYW1pbHlNZW1iZXIgZiA6IGZMaXN0KSB7XG4gICAgICAgICAgICBtID0gbmV3IEhhc2hNYXA8PigpO1xuICAgICAgICAgICAgbS5wdXQoXCJtZW1iZXJJZFwiLCBmLmdldE1lbWJlcklkKCkpO1xuICAgICAgICAgICAgbS5wdXQoXCJwZXJzb25JZFwiLCBmLmdldFN0dWRlbnQoKS5nZXRQZXJzb25JZCgpKTtcbiAgICAgICAgICAgIG0ucHV0KFwicmVsYXRpb25cIiwgZi5nZXRSZWxhdGlvbigpKTtcbiAgICAgICAgICAgIG0ucHV0KFwibmFtZVwiLCBmLmdldE5hbWUoKSk7XG4gICAgICAgICAgICBtLnB1dChcImdlbmRlclwiLCBmLmdldEdlbmRlcigpKTtcbiAgICAgICAgICAgIG0ucHV0KFwiYWdlXCIsIGYuZ2V0QWdlKCkrXCJcIik7XG4gICAgICAgICAgICBtLnB1dChcInVuaXRcIiwgZi5nZXRVbml0KCkpO1xuICAgICAgICAgICAgZGF0YUxpc3QuYWRkKG0pO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiBDb21tb25NZXRob2QuZ2V0UmV0dXJuRGF0YShkYXRhTGlzdCk7XG59XG5gYGBgXG5cbjQuICoq5re75Yqg5LqGIGZhbWlseU1lbWJlckRlbGV0ZSDmlrnms5UqKu+8mlxuYGBgYGphdmEgcGF0aD1qYXZhLXNlcnZlci9zcmMvbWFpbi9qYXZhL2NuL2VkdS9zZHUvamF2YS9zZXJ2ZXIvc2VydmljZXMvVGVhY2hlclNlcnZpY2VzLmphdmEgbW9kZT1FWENFUlBUXG5wdWJsaWMgRGF0YVJlc3BvbnNlIGZhbWlseU1lbWJlckRlbGV0ZShEYXRhUmVxdWVzdCBkYXRhUmVxdWVzdCkge1xuICAgIEludGVnZXIgbWVtYmVySWQgPSBkYXRhUmVxdWVzdC5nZXRJbnRlZ2VyKFwibWVtYmVySWRcIik7XG4gICAgT3B0aW9uYWw8RmFtaWx5TWVtYmVyPiBvcDtcbiAgICBvcCA9IGZhbWlseU1lbWJlclJlcG9zaXRvcnkuZmluZEJ5SWQobWVtYmVySWQpO1xuICAgIG9wLmlmUHJlc2VudChmYW1pbHlNZW1iZXJSZXBvc2l0b3J5OjpkZWxldGUpO1xuICAgIHJldHVybiBDb21tb25NZXRob2QuZ2V0UmV0dXJuTWVzc2FnZU9LKCk7XG59XG5gYGBgXG5cbuS4u+imgeeahOS/ruaUuembhuS4reWcqCBgZmFtaWx5TWVtYmVyU2F2ZWAg5pa55rOV5Lit77yM54m55Yir5piv5a+5IGFnZSDlrZfmrrXnmoTlpITnkIbpg6jliIbjgILljp/mnaXnmoTku6PnoIHnm7TmjqXkvb/nlKggYENvbW1vbk1ldGhvZC5nZXRJbnRlZ2VyKGZvcm0sXCJhZ2VcIilgIOi/m+ihjOi9rOaNou+8jOi/meWcqCBhZ2Ug5pivIERvdWJsZSDnsbvlnovml7bkvJrlr7zoh7TnsbvlnovovazmjaLplJnor6/jgILnjrDlnKjnmoTku6PnoIHkvJrmo4Dmn6UgYWdlIOeahOWunumZheexu+Wei++8jOW5tuagueaNruS4jeWQjOexu+Wei+mHh+eUqOS4jeWQjOeahOi9rOaNouaWueazle+8jOeJueWIq+aYr+WvueS6jiBEb3VibGUg57G75Z6L77yM5L2/55SoIGBpbnRWYWx1ZSgpYCDmlrnms5XlronlhajlnLDovazmjaLkuLogSW50ZWdlcuOAglxuXG7ov5nkupvkv67mlLnlupTor6Xog73lpJ/op6PlhrPmgqjpgYfliLDnmoQgXCJjbGFzcyBqYXZhLmxhbmcuRG91YmxlIGNhbm5vdCBiZSBjYXN0IHRvIGNsYXNzIGphdmEubGFuZy5JbnRlZ2VyXCIg6ZSZ6K+v44CCXG4ifSx7ImlkIjozLCJ0eXBlIjozLCJjb250ZW50IjoiIn1dLCJzZWVuX3N0YXRlIjoidW5zZWVuIiwic3RydWN0dXJlZF9yZXF1ZXN0X25vZGVzIjpbeyJpZCI6MCwidHlwZSI6MCwidGV4dF9ub2RlIjp7ImNvbnRlbnQiOiLluK7miJHmib7liLDkvaDkv67mlLnnmoTlnLDmlrkifX0seyJpZCI6MSwidHlwZSI6NCwiaWRlX3N0YXRlX25vZGUiOnsid29ya3NwYWNlRm9sZGVycyI6W3sicmVwb3NpdG9yeVJvb3QiOiJDOi9Vc2Vycy9wcmluY2lwL0RvY3VtZW50cy9HaXRIdWIvYmFpY2FpL2phdmEtc2VydmVyIiwiZm9sZGVyUm9vdCI6IkM6L1VzZXJzL3ByaW5jaXAvRG9jdW1lbnRzL0dpdEh1Yi9iYWljYWkvamF2YS1zZXJ2ZXIifV0sIndvcmtzcGFjZUZvbGRlcnNVbmNoYW5nZWQiOmZhbHNlfX1dLCJ0aW1lc3RhbXAiOiIyMDI1LTA1LTE2VDE1OjE5OjUxLjY2N1oiLCJyZXNwb25zZV90ZXh0Ijoi5aW955qE77yM5oiR5p2l5biu5oKo5om+5Ye65oiR5ZyoIGBUZWFjaGVyU2VydmljZXMuamF2YWAg5paH5Lu25Lit5omA5YGa55qE5Li76KaB5L+u5pS577yaXG5cbjEuICoq5re75Yqg5LqGIFN0dWRlbnRSZXBvc2l0b3J5IOS+nei1lioq77yaXG5gYGBgamF2YSBwYXRoPWphdmEtc2VydmVyL3NyYy9tYWluL2phdmEvY24vZWR1L3NkdS9qYXZhL3NlcnZlci9zZXJ2aWNlcy9UZWFjaGVyU2VydmljZXMuamF2YSBtb2RlPUVYQ0VSUFRcbnByaXZhdGUgZmluYWwgU3R1ZGVudFJlcG9zaXRvcnkgc3R1ZGVudFJlcG9zaXRvcnk7IC8vIOa3u+WKoFN0dWRlbnRSZXBvc2l0b3J5XG5cbnB1YmxpYyBUZWFjaGVyU2VydmljZXMoUGVyc29uUmVwb3NpdG9yeSBwZXJzb25SZXBvc2l0b3J5LCBUZWFjaGVyUmVwb3NpdG9yeSB0ZWFjaGVyUmVwb3NpdG9yeSwgVXNlclJlcG9zaXRvcnkgdXNlclJlcG9zaXRvcnksIFVzZXJUeXBlUmVwb3NpdG9yeSB1c2VyVHlwZVJlcG9zaXRvcnksIFBhc3N3b3JkRW5jb2RlciBlbmNvZGVyLCBGZWVSZXBvc2l0b3J5IGZlZVJlcG9zaXRvcnksIEZhbWlseU1lbWJlclJlcG9zaXRvcnkgZmFtaWx5TWVtYmVyUmVwb3NpdG9yeSwgU3lzdGVtU2VydmljZSBzeXN0ZW1TZXJ2aWNlLCBTdHVkZW50UmVwb3NpdG9yeSBzdHVkZW50UmVwb3NpdG9yeSkge1xuICAgIC8vIC4uLuWFtuS7luS7o+eggS4uLlxuICAgIHRoaXMuc3R1ZGVudFJlcG9zaXRvcnkgPSBzdHVkZW50UmVwb3NpdG9yeTsgLy8g5Yid5aeL5YyWU3R1ZGVudFJlcG9zaXRvcnlcbn1cbmBgYGBcblxuMi4gKirkv67mlLnkuoYgZmFtaWx5TWVtYmVyU2F2ZSDmlrnms5XkuK3nmoTnsbvlnovovazmjaLpgLvovpEqKu+8mlxuYGBgYGphdmEgcGF0aD1qYXZhLXNlcnZlci9zcmMvbWFpbi9qYXZhL2NuL2VkdS9zZHUvamF2YS9zZXJ2ZXIvc2VydmljZXMvVGVhY2hlclNlcnZpY2VzLmphdmEgbW9kZT1FWENFUlBUXG5wdWJsaWMgRGF0YVJlc3BvbnNlIGZhbWlseU1lbWJlclNhdmUoRGF0YVJlcXVlc3QgZGF0YVJlcXVlc3QpIHtcbiAgICBNYXA8U3RyaW5nLE9iamVjdD4gZm9ybSA9IGRhdGFSZXF1ZXN0LmdldE1hcChcImZvcm1cIik7XG4gICAgSW50ZWdlciBwZXJzb25JZCA9IENvbW1vbk1ldGhvZC5nZXRJbnRlZ2VyKGZvcm0sXCJwZXJzb25JZFwiKTtcbiAgICBJbnRlZ2VyIG1lbWJlcklkID0gQ29tbW9uTWV0aG9kLmdldEludGVnZXIoZm9ybSxcIm1lbWJlcklkXCIpO1xuICAgIE9wdGlvbmFsPEZhbWlseU1lbWJlcj4gb3A7XG4gICAgRmFtaWx5TWVtYmVyIGYgPSBudWxsO1xuICAgIGlmKG1lbWJlcklkICE9IG51bGwpIHtcbiAgICAgICAgb3AgPSBmYW1pbHlNZW1iZXJSZXBvc2l0b3J5LmZpbmRCeUlkKG1lbWJlcklkKTtcbiAgICAgICAgaWYob3AuaXNQcmVzZW50KCkpIHtcbiAgICAgICAgICAgIGYgPSBvcC5nZXQoKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBpZihmID09IG51bGwpIHtcbiAgICAgICAgZiA9IG5ldyBGYW1pbHlNZW1iZXIoKTtcbiAgICAgICAgYXNzZXJ0IHBlcnNvbklkICE9IG51bGw7XG4gICAgICAgIC8vIOWIm+W7uuS4gOS4qlN0dWRlbnTlr7nosaHlubborr7nva7liLBGYW1pbHlNZW1iZXLkuK1cbiAgICAgICAgT3B0aW9uYWw8U3R1ZGVudD4gc3R1ZGVudE9wID0gc3R1ZGVudFJlcG9zaXRvcnkuZmluZEJ5SWQocGVyc29uSWQpO1xuICAgICAgICBpZihzdHVkZW50T3AuaXNQcmVzZW50KCkpIHtcbiAgICAgICAgICAgIGYuc2V0U3R1ZGVudChzdHVkZW50T3AuZ2V0KCkpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgLy8g5aaC5p6c5om+5LiN5Yiw5a+55bqU55qEU3R1ZGVudO+8jOi/lOWbnumUmeivr+S/oeaBr1xuICAgICAgICAgICAgcmV0dXJuIENvbW1vbk1ldGhvZC5nZXRSZXR1cm5NZXNzYWdlRXJyb3IoXCLmib7kuI3liLDlr7nlupTnmoTlrabnlJ/kv6Hmga/vvIFcIik7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZi5zZXRSZWxhdGlvbihDb21tb25NZXRob2QuZ2V0U3RyaW5nKGZvcm0sXCJyZWxhdGlvblwiKSk7XG4gICAgZi5zZXROYW1lKENvbW1vbk1ldGhvZC5nZXRTdHJpbmcoZm9ybSxcIm5hbWVcIikpO1xuICAgIGYuc2V0R2VuZGVyKENvbW1vbk1ldGhvZC5nZXRTdHJpbmcoZm9ybSxcImdlbmRlclwiKSk7XG4gICAgXG4gICAgLy8g5a6J5YWo5Zyw5aSE55CGYWdl5a2X5q6177yM6YG/5YWNRG91Ymxl5YiwSW50ZWdlcueahOebtOaOpei9rOaNolxuICAgIHRyeSB7XG4gICAgICAgIE9iamVjdCBhZ2VPYmogPSBmb3JtLmdldChcImFnZVwiKTtcbiAgICAgICAgaWYoYWdlT2JqICE9IG51bGwpIHtcbiAgICAgICAgICAgIGlmKGFnZU9iaiBpbnN0YW5jZW9mIEludGVnZXIpIHtcbiAgICAgICAgICAgICAgICBmLnNldEFnZSgoSW50ZWdlcilhZ2VPYmopO1xuICAgICAgICAgICAgfSBlbHNlIGlmKGFnZU9iaiBpbnN0YW5jZW9mIERvdWJsZSkge1xuICAgICAgICAgICAgICAgIC8vIOWwhkRvdWJsZei9rOaNouS4ukludGVnZXJcbiAgICAgICAgICAgICAgICBmLnNldEFnZSgoKERvdWJsZSlhZ2VPYmopLmludFZhbHVlKCkpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAvLyDlsJ3or5Xku47lrZfnrKbkuLLop6PmnpBcbiAgICAgICAgICAgICAgICBTdHJpbmcgYWdlU3RyID0gYWdlT2JqLnRvU3RyaW5nKCk7XG4gICAgICAgICAgICAgICAgZi5zZXRBZ2UoKGludClEb3VibGUucGFyc2VEb3VibGUoYWdlU3RyKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9IGNhdGNoKEV4Y2VwdGlvbiBlKSB7XG4gICAgICAgIGxvZy5lcnJvcihcIuWkhOeQhuW5tOm+hOWtl+auteaXtuWHuumUmVwiLCBlKTtcbiAgICAgICAgcmV0dXJuIENvbW1vbk1ldGhvZC5nZXRSZXR1cm5NZXNzYWdlRXJyb3IoXCLlubTpvoTmoLzlvI/kuI3mraPnoa7vvIFcIik7XG4gICAgfVxuICAgIFxuICAgIGYuc2V0VW5pdChDb21tb25NZXRob2QuZ2V0U3RyaW5nKGZvcm0sXCJ1bml0XCIpKTtcbiAgICBmYW1pbHlNZW1iZXJSZXBvc2l0b3J5LnNhdmUoZik7XG4gICAgcmV0dXJuIENvbW1vbk1ldGhvZC5nZXRSZXR1cm5NZXNzYWdlT0soKTtcbn1cbmBgYGBcblxuMy4gKirkv67mlLnkuoYgZ2V0RmFtaWx5TWVtYmVyTGlzdCDmlrnms5UqKu+8mlxuYGBgYGphdmEgcGF0aD1qYXZhLXNlcnZlci9zcmMvbWFpbi9qYXZhL2NuL2VkdS9zZHUvamF2YS9zZXJ2ZXIvc2VydmljZXMvVGVhY2hlclNlcnZpY2VzLmphdmEgbW9kZT1FWENFUlBUXG5wdWJsaWMgRGF0YVJlc3BvbnNlIGdldEZhbWlseU1lbWJlckxpc3QoRGF0YVJlcXVlc3QgZGF0YVJlcXVlc3QpIHtcbiAgICBJbnRlZ2VyIHBlcnNvbklkID0gZGF0YVJlcXVlc3QuZ2V0SW50ZWdlcihcInBlcnNvbklkXCIpO1xuICAgIExpc3Q8RmFtaWx5TWVtYmVyPiBmTGlzdCA9IGZhbWlseU1lbWJlclJlcG9zaXRvcnkuZmluZEJ5U3R1ZGVudFBlcnNvbklkKHBlcnNvbklkKTtcbiAgICBMaXN0PE1hcDxTdHJpbmcsT2JqZWN0Pj4gZGF0YUxpc3QgPSBuZXcgQXJyYXlMaXN0PD4oKTtcbiAgICBNYXA8U3RyaW5nLE9iamVjdD4gbTtcbiAgICBpZiAoZkxpc3QgIT0gbnVsbCkge1xuICAgICAgICBmb3IgKEZhbWlseU1lbWJlciBmIDogZkxpc3QpIHtcbiAgICAgICAgICAgIG0gPSBuZXcgSGFzaE1hcDw+KCk7XG4gICAgICAgICAgICBtLnB1dChcIm1lbWJlcklkXCIsIGYuZ2V0TWVtYmVySWQoKSk7XG4gICAgICAgICAgICBtLnB1dChcInBlcnNvbklkXCIsIGYuZ2V0U3R1ZGVudCgpLmdldFBlcnNvbklkKCkpO1xuICAgICAgICAgICAgbS5wdXQoXCJyZWxhdGlvblwiLCBmLmdldFJlbGF0aW9uKCkpO1xuICAgICAgICAgICAgbS5wdXQoXCJuYW1lXCIsIGYuZ2V0TmFtZSgpKTtcbiAgICAgICAgICAgIG0ucHV0KFwiZ2VuZGVyXCIsIGYuZ2V0R2VuZGVyKCkpO1xuICAgICAgICAgICAgbS5wdXQoXCJhZ2VcIiwgZi5nZXRBZ2UoKStcIlwiKTtcbiAgICAgICAgICAgIG0ucHV0KFwidW5pdFwiLCBmLmdldFVuaXQoKSk7XG4gICAgICAgICAgICBkYXRhTGlzdC5hZGQobSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIENvbW1vbk1ldGhvZC5nZXRSZXR1cm5EYXRhKGRhdGFMaXN0KTtcbn1cbmBgYGBcblxuNC4gKirmt7vliqDkuoYgZmFtaWx5TWVtYmVyRGVsZXRlIOaWueazlSoq77yaXG5gYGBgamF2YSBwYXRoPWphdmEtc2VydmVyL3NyYy9tYWluL2phdmEvY24vZWR1L3NkdS9qYXZhL3NlcnZlci9zZXJ2aWNlcy9UZWFjaGVyU2VydmljZXMuamF2YSBtb2RlPUVYQ0VSUFRcbnB1YmxpYyBEYXRhUmVzcG9uc2UgZmFtaWx5TWVtYmVyRGVsZXRlKERhdGFSZXF1ZXN0IGRhdGFSZXF1ZXN0KSB7XG4gICAgSW50ZWdlciBtZW1iZXJJZCA9IGRhdGFSZXF1ZXN0LmdldEludGVnZXIoXCJtZW1iZXJJZFwiKTtcbiAgICBPcHRpb25hbDxGYW1pbHlNZW1iZXI+IG9wO1xuICAgIG9wID0gZmFtaWx5TWVtYmVyUmVwb3NpdG9yeS5maW5kQnlJZChtZW1iZXJJZCk7XG4gICAgb3AuaWZQcmVzZW50KGZhbWlseU1lbWJlclJlcG9zaXRvcnk6OmRlbGV0ZSk7XG4gICAgcmV0dXJuIENvbW1vbk1ldGhvZC5nZXRSZXR1cm5NZXNzYWdlT0soKTtcbn1cbmBgYGBcblxu5Li76KaB55qE5L+u5pS56ZuG5Lit5ZyoIGBmYW1pbHlNZW1iZXJTYXZlYCDmlrnms5XkuK3vvIznibnliKvmmK/lr7kgYWdlIOWtl+auteeahOWkhOeQhumDqOWIhuOAguWOn+adpeeahOS7o+eggeebtOaOpeS9v+eUqCBgQ29tbW9uTWV0aG9kLmdldEludGVnZXIoZm9ybSxcImFnZVwiKWAg6L+b6KGM6L2s5o2i77yM6L+Z5ZyoIGFnZSDmmK8gRG91YmxlIOexu+Wei+aXtuS8muWvvOiHtOexu+Wei+i9rOaNoumUmeivr+OAgueOsOWcqOeahOS7o+eggeS8muajgOafpSBhZ2Ug55qE5a6e6ZmF57G75Z6L77yM5bm25qC55o2u5LiN5ZCM57G75Z6L6YeH55So5LiN5ZCM55qE6L2s5o2i5pa55rOV77yM54m55Yir5piv5a+55LqOIERvdWJsZSDnsbvlnovvvIzkvb/nlKggYGludFZhbHVlKClgIOaWueazleWuieWFqOWcsOi9rOaNouS4uiBJbnRlZ2Vy44CCXG5cbui/meS6m+S/ruaUueW6lOivpeiDveWkn+ino+WGs+aCqOmBh+WIsOeahCBcImNsYXNzIGphdmEubGFuZy5Eb3VibGUgY2Fubm90IGJlIGNhc3QgdG8gY2xhc3MgamF2YS5sYW5nLkludGVnZXJcIiDplJnor6/jgIJcbiIsIndvcmtzcGFjZV9maWxlX2NodW5rcyI6W119XSwiZmVlZGJhY2tTdGF0ZXMiOnsidGVtcC1mZS1mMWM1M2M0YS1iZWJiLTQ4Y2QtYWM3ZC00YTE3MWM4OTM1YzYiOnsic2VsZWN0ZWRSYXRpbmciOjAsImZlZWRiYWNrTm90ZSI6IiJ9LCJ0ZW1wLWZlLTQ5MGZkZGQ2LTg0MzQtNDYzNi1hYWM4LTdhYzMyODYzMzM1OCI6eyJzZWxlY3RlZFJhdGluZyI6MCwiZmVlZGJhY2tOb3RlIjoiIn0sInRlbXAtZmUtNmMyYTE2ZTktYzQ5My00MzIxLWI0MDAtNzZkNzI5ZjlkNGVjIjp7InNlbGVjdGVkUmF0aW5nIjowLCJmZWVkYmFja05vdGUiOiIifSwidGVtcC1mZS1lZjE5MzU4Ny0wNDhkLTRhMTQtYTdlNy0xY2RjOGY3NGNjZTgiOnsic2VsZWN0ZWRSYXRpbmciOjAsImZlZWRiYWNrTm90ZSI6IiJ9LCJ0ZW1wLWZlLTBjZjQ0ZGM2LTU4OTUtNGM1MS04ZGQyLTU2MmExODU3MjYwMiI6eyJzZWxlY3RlZFJhdGluZyI6MCwiZmVlZGJhY2tOb3RlIjoiIn0sInRlbXAtZmUtMmU4OGNmNTYtMjI5Ni00MTkzLWExODYtMTNkZDg2ZGNhOGEzIjp7InNlbGVjdGVkUmF0aW5nIjowLCJmZWVkYmFja05vdGUiOiIifSwidGVtcC1mZS0xZmE3MDMyZC0zNzdiLTRkY2QtOWE3OS04OGMzOWYyMWEwMWMiOnsic2VsZWN0ZWRSYXRpbmciOjAsImZlZWRiYWNrTm90ZSI6IiJ9LCJ0ZW1wLWZlLWYyNjZjNmIzLTFkZDQtNDk1Mi1hODg3LWM4YWE3ODMyNTZjZiI6eyJzZWxlY3RlZFJhdGluZyI6MCwiZmVlZGJhY2tOb3RlIjoiIn0sInRlbXAtZmUtMDFjOWNjOTktYzk5Yy00MmZkLTk0ZTEtNGYwZWU3MGVjMzRhIjp7InNlbGVjdGVkUmF0aW5nIjowLCJmZWVkYmFja05vdGUiOiIifSwidGVtcC1mZS02MjI2Yjk4MS0xN2MyLTQxMGEtOGE2Zi04MDI5ZGI2ZDg0NzEiOnsic2VsZWN0ZWRSYXRpbmciOjAsImZlZWRiYWNrTm90ZSI6IiJ9LCJ0ZW1wLWZlLTYzY2NlNWNiLWU4NzctNDI0YS05ZjViLTE1MjRhMjZhMGVjYiI6eyJzZWxlY3RlZFJhdGluZyI6MCwiZmVlZGJhY2tOb3RlIjoiIn0sInRlbXAtZmUtOGRlNzhjMjEtZWRjYi00Yjc2LWI5ODItMWFhZDY3ZjEwMGVhIjp7InNlbGVjdGVkUmF0aW5nIjowLCJmZWVkYmFja05vdGUiOiIifSwidGVtcC1mZS02MzcwNzVkYi01YjI2LTRjZjEtOTIxMC01YTE3NDViMjEyMmQiOnsic2VsZWN0ZWRSYXRpbmciOjAsImZlZWRiYWNrTm90ZSI6IiJ9LCJ0ZW1wLWZlLTczMDBhZDc4LWRhM2MtNDhjZi1iNjY4LTNlZTA1ZDdhNmZiMSI6eyJzZWxlY3RlZFJhdGluZyI6MCwiZmVlZGJhY2tOb3RlIjoiIn0sInRlbXAtZmUtNTcwODJhMDYtY2EwMC00ODBlLWE4OTUtY2I0ZTRjNWM0MjhiIjp7InNlbGVjdGVkUmF0aW5nIjowLCJmZWVkYmFja05vdGUiOiIifSwidGVtcC1mZS1lZGRmMmY4My1jMjVkLTQ5Y2QtYmIzOS02MDZhN2JhZjQ3N2YiOnsic2VsZWN0ZWRSYXRpbmciOjAsImZlZWRiYWNrTm90ZSI6IiJ9fSwidG9vbFVzZVN0YXRlcyI6eyI1MWUzNjI4Yi0zZjMzLTQ4ZDItOGQ5Zi01OTg3OGY1MDE5NTM7dG9vbHVfdnJ0eF8wMVdzTURyclY5dXFMS0NQbWJkV2p0bW4iOnsicmVxdWVzdElkIjoiNTFlMzYyOGItM2YzMy00OGQyLThkOWYtNTk4NzhmNTAxOTUzIiwidG9vbFVzZUlkIjoidG9vbHVfdnJ0eF8wMVdzTURyclY5dXFMS0NQbWJkV2p0bW4iLCJwaGFzZSI6NiwicmVzdWx0Ijp7InRleHQiOiJSYW4gaW50byBVbmtub3duIGVycm9yIHdoaWxlIHRyeWluZyB0byByZWFkIGphdmEtc2VydmVyL3NyYy9tYWluL2phdmEvY24vZWR1L3NkdS9qYXZhL3NlcnZlci9zZXJ2aWNlcy9UZWFjaGVyU2VydmljZXMuamF2YSIsImlzRXJyb3IiOnRydWUsInJlcXVlc3RJZCI6IiJ9fSwiZWYzZGIyNDItZjZkNC00MzY3LWIxZDktYjU5MGMyNWQ2NTcxO3Rvb2x1X3ZydHhfMDFTVTRNYks1eDVjeXhuYzZ0UTJCVk1XIjp7InJlcXVlc3RJZCI6ImVmM2RiMjQyLWY2ZDQtNDM2Ny1iMWQ5LWI1OTBjMjVkNjU3MSIsInRvb2xVc2VJZCI6InRvb2x1X3ZydHhfMDFTVTRNYks1eDVjeXhuYzZ0UTJCVk1XIiwicGhhc2UiOjUsInJlc3VsdCI6eyJ0ZXh0IjoiVGhlIGZvbGxvd2luZyBjb2RlIHNlY3Rpb25zIHdlcmUgcmV0cmlldmVkOlxuUGF0aDogc3JjL21haW4vamF2YS9jbi9lZHUvc2R1L2phdmEvc2VydmVyL3NlcnZpY2VzL1RlYWNoZXJTZXJ2aWNlcy5qYXZhXG5wYWNrYWdlIGNuLmVkdS5zZHUuamF2YS5zZXJ2ZXIuc2VydmljZXM7XG5cbmltcG9ydCBjbi5lZHUuc2R1LmphdmEuc2VydmVyLm1vZGVscy4qO1xuaW1wb3J0IGNuLmVkdS5zZHUuamF2YS5zZXJ2ZXIubW9kZWxzLlRlYWNoZXI7XG5pbXBvcnQgY24uZWR1LnNkdS5qYXZhLnNlcnZlci5wYXlsb2FkLnJlcXVlc3QuRGF0YVJlcXVlc3Q7XG5pbXBvcnQgY24uZWR1LnNkdS5qYXZhLnNlcnZlci5wYXlsb2FkLnJlc3BvbnNlLkRhdGFSZXNwb25zZTtcbmltcG9ydCBjbi5lZHUuc2R1LmphdmEuc2VydmVyLnJlcG9zaXRvcnlzLio7XG5pbXBvcnQgY24uZWR1LnNkdS5qYXZhLnNlcnZlci51dGlsLkNvbURhdGFVdGlsO1xuaW1wb3J0IGNuLmVkdS5zZHUuamF2YS5zZXJ2ZXIudXRpbC5Db21tb25NZXRob2Q7XG5pbXBvcnQgY24uZWR1LnNkdS5qYXZhLnNlcnZlci51dGlsLkRhdGVUaW1lVG9vbDtcbmltcG9ydCBvcmcuYXBhY2hlLnBvaS5zcy51c2VybW9kZWwuQ2VsbDtcbmltcG9ydCBvcmcuYXBhY2hlLnBvaS5zcy51c2VybW9kZWwuUm93O1xuaW1wb3J0IG9yZy5hcGFjaGUucG9pLnhzc2YudXNlcm1vZGVsLio7XG5pbXBvcnQgb3JnLnNsZjRqLkxvZ2dlcjtcbmltcG9ydCBvcmcuc2xmNGouTG9nZ2VyRmFjdG9yeTtcbmltcG9ydCBvcmcuc3ByaW5nZnJhbWV3b3JrLmRhdGEuZG9tYWluLlBhZ2U7XG5pbXBvcnQgb3JnLnNwcmluZ2ZyYW1ld29yay5kYXRhLmRvbWFpbi5QYWdlUmVxdWVzdDtcbmltcG9ydCBvcmcuc3ByaW5nZnJhbWV3b3JrLmRhdGEuZG9tYWluLlBhZ2VhYmxlO1xuLi4uXG4gICAgcHVibGljIE1hcDxTdHJpbmcsT2JqZWN0PiBnZXRNYXBGcm9tVGVhY2hlcihUZWFjaGVyIHMpIHtcbiAgICAgICAgTWFwPFN0cmluZyxPYmplY3Q+IG0gPSBuZXcgSGFzaE1hcDw+KCk7XG4gICAgICAgIFBlcnNvbiBwO1xuICAgICAgICBpZihzID09IG51bGwpXG4gICAgICAgICAgICByZXR1cm4gbTtcbiAgICAgICAgbS5wdXQoXCJ0aXRsZVwiLHMuZ2V0VGl0bGUoKSk7XG4gICAgICAgIG0ucHV0KFwiZGVncmVlXCIscy5nZXREZWdyZWUoKSk7XG4gICAgICAgIG0ucHV0KFwiY2xhc3NOYW1lXCIscy5nZXRDbGFzc05hbWUoKSk7XG4gICAgICAgIHAgPSBzLmdldFBlcnNvbigpO1xuICAgICAgICBpZihwID09IG51bGwpXG4gICAgICAgICAgICByZXR1cm4gbTtcbiAgICAgICAgbS5wdXQoXCJwZXJzb25JZFwiLCBzLmdldFBlcnNvbklkKCkpO1xuICAgICAgICBtLnB1dChcIm51bVwiLHAuZ2V0TnVtKCkpO1xuICAgICAgICBtLnB1dChcIm5hbWVcIixwLmdldE5hbWUoKSk7XG4gICAgICAgIG0ucHV0KFwiZGVwdFwiLHAuZ2V0RGVwdCgpKTtcbiAgICAgICAgbS5wdXQoXCJjYXJkXCIscC5nZXRDYXJkKCkpO1xuICAgICAgICBTdHJpbmcgZ2VuZGVyID0gcC5nZXRHZW5kZXIoKTtcbiAgICAgICAgbS5wdXQoXCJnZW5kZXJcIixnZW5kZXIpO1xuICAgICAgICBtLnB1dChcImdlbmRlck5hbWVcIiwgQ29tRGF0YVV0aWwuZ2V0SW5zdGFuY2UoKS5nZXREaWN0aW9uYXJ5TGFiZWxCeVZhbHVlKFwiWEJNXCIsIGdlbmRlcikpOyAvL+aAp+WIq+exu+Wei+eahOWAvOi9rOaNouaIkOaVsOaNruexu+Wei+WQjVxuICAgICAgICBtLnB1dChcImJpcnRoZGF5XCIsIHAuZ2V0QmlydGhkYXkoKSk7ICAvL+aXtumXtOagvOW8j+i9rOaNouWtl+espuS4slxuICAgICAgICBtLnB1dChcImVtYWlsXCIscC5nZXRFbWFpbCgpKTtcbiAgICAgICAgbS5wdXQoXCJwaG9uZVwiLHAuZ2V0UGhvbmUoKSk7XG4gICAgICAgIG0ucHV0KFwiYWRkcmVzc1wiLHAuZ2V0QWRkcmVzcygpKTtcbiAgICAgICAgbS5wdXQoXCJpbnRyb2R1Y2VcIixwLmdldEludHJvZHVjZSgpKTtcbiAgICAgICAgcmV0dXJuIG07XG4gICAgfVxuICAgIHB1YmxpYyBMaXN0PE1hcDxTdHJpbmcsT2JqZWN0Pj4gZ2V0VGVhY2hlck1hcExpc3QoU3RyaW5nIG51bU5hbWUpIHtcbiAgICAgICAgTGlzdDxNYXA8U3RyaW5nLE9iamVjdD4+IGRhdGFMaXN0ID0gbmV3IEFycmF5TGlzdDw+KCk7XG4gICAgICAgIExpc3Q8VGVhY2hlcj4gc0xpc3QgPSB0ZWFjaGVyUmVwb3NpdG9yeS5maW5kVGVhY2hlckxpc3RCeU51bU5hbWUobnVtTmFtZSk7ICAvL+aVsOaNruW6k+afpeivouaTjeS9nFxuICAgICAgICBpZiAoc0xpc3QgPT0gbnVsbCB8fCBzTGlzdC5pc0VtcHR5KCkpXG4gICAgICAgICAgICByZXR1cm4gZGF0YUxpc3Q7XG4gICAgICAgIGZvciAoVGVhY2hlciB0ZWFjaGVyIDogc0xpc3QpIHtcbiAgICAgICAgICAgIGRhdGFMaXN0LmFkZChnZXRNYXBGcm9tVGVhY2hlcih0ZWFjaGVyKSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGRhdGFMaXN0O1xuICAgIH1cbiAgICBwdWJsaWMgRGF0YVJlc3BvbnNlIGdldFRlYWNoZXJMaXN0KERhdGFSZXF1ZXN0IGRhdGFSZXF1ZXN0KSB7XG4gICAgICAgIFN0cmluZyBudW1OYW1lID0gZGF0YVJlcXVlc3QuZ2V0U3RyaW5nKFwibnVtTmFtZVwiKTtcbiAgICAgICAgTGlzdDxNYXA8U3RyaW5nLE9iamVjdD4+IGRhdGFMaXN0ID0gIGdldFRlYWNoZXJMaXN0KG51bU5hbWUpO1xuICAgICAgICByZXR1cm4gQ29tbW9uTWV0aG9kLmdldFJldHVybkRhdGEoZGF0YUxpc3QpOyAgLy/mjInnhafmtYvor5XmoYbmnrbop4TojIPkvJrpgIFNYXDnmoRsaXN0XG4gICAgfVxuICAgIHB1YmxpYyBEYXRhUmVzcG9uc2UgdGVhY2hlckRlbGV0ZShEYXRhUmVxdWVzdCBkYXRhUmVxdWVzdCkge1xuICAgICAgICBJbnRlZ2VyIHBlcnNvbklkID0gZGF0YVJlcXVlc3QuZ2V0SW50ZWdlcihcInBlcnNvbklkXCIpOyAgLy/ojrflj5Z0ZWFjaGVyX2lk5YC8XG4gICAgICAgIFRlYWNoZXIgcyA9IG51bGw7XG4gICAgICAgIE9wdGlvbmFsPFRlYWNoZXI+IG9wO1xuICAgICAgICBpZiAocGVyc29uSWQgIT0gbnVsbCAmJiBwZXJzb25JZCA+IDApIHtcbiAgICAgICAgICAgIG9wID0gdGVhY2hlclJlcG9zaXRvcnkuZmluZEJ5SWQocGVyc29uSWQpOyAgIC8v5p+l6K+i6I635b6X5a6e5L2T5a+56LGhXG4gICAgICAgICAgICBpZihvcC5pc1ByZXNlbnQoKSkge1xuICAgICAgICAgICAgICAgIHMgPSBvcC5nZXQoKTtcbiAgICAgICAgICAgICAgICBPcHRpb25hbDxVc2VyPiB1T3AgPSB1c2VyUmVwb3NpdG9yeS5maW5kQnlJZChwZXJzb25JZCk7IC8v5p+l6K+i5a+55bqU6K+l5pWZ5biI55qE6LSm5oi3XG4gICAgICAgICAgICAgICAgLy/liKDpmaTlr7nlupTor6XmlZnluIjnmoTotKbmiLdcbiAgICAgICAgICAgICAgICB1T3AuaWZQcmVzZW50KHVzZXJSZXBvc2l0b3J5OjpkZWxldGUpO1xuICAgICAgICAgICAgICAgIFBlcnNvbiBwID0gcy5nZXRQZXJzb24oKTtcbiAgICAgICAgICAgICAgICB0ZWFjaGVyUmVwb3NpdG9yeS5kZWxldGUocyk7ICAgIC8v6aaW5YWI5pWw5o2u5bqT5rC45LmF5Yig6Zmk5pWZ5biI5L+h5oGvXG4gICAgICAgICAgICAgICAgcGVyc29uUmVwb3NpdG9yeS5kZWxldGUocCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIENvbW1vbk1ldGhvZC5nZXRSZXR1cm5NZXNzYWdlT0soKTsgIC8v6YCa55+l5YmN56uv5pON5L2c5q2j5bi4XG4gICAgfVxuICAgIHB1YmxpYyBEYXRhUmVzcG9uc2UgZ2V0VGVhY2hlckluZm8oRGF0YVJlcXVlc3QgZGF0YVJlcXVlc3QpIHtcbiAgICAgICAgSW50ZWdlciBwZXJzb25JZCA9IGRhdGFSZXF1ZXN0LmdldEludGVnZXIoXCJwZXJzb25JZFwiKTtcbiAgICAgICAgVGVhY2hlciBzID0gbnVsbDtcbiAgICAgICAgT3B0aW9uYWw8VGVhY2hlcj4gb3A7XG4gICAgICAgIGlmIChwZXJzb25JZCAhPSBudWxsKSB7XG4gICAgICAgICAgICBvcCA9IHRlYWNoZXJSZXBvc2l0b3J5LmZpbmRCeUlkKHBlcnNvbklkKTsgLy/moLnmja7lrabnlJ/kuLvplK7ku47mlbDmja7lupPmn6Xor6LlrabnlJ/nmoTkv6Hmga9cbiAgICAgICAgICAgIGlmIChvcC5pc1ByZXNlbnQoKSkge1xuICAgICAgICAgICAgICAgIHMgPSBvcC5nZXQoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gQ29tbW9uTWV0aG9kLmdldFJldHVybkRhdGEoZ2V0TWFwRnJvbVRlYWNoZXIocykpOyAvL+i/memHjOWbnuS8oOWMheWQq+WtpueUn+S/oeaBr+eahE1hcOWvueixoVxuICAgIH1cblxuICAgIHB1YmxpYyBEYXRhUmVzcG9uc2UgdGVhY2hlckVkaXRTYXZlKERhdGFSZXF1ZXN0IGRhdGFSZXF1ZXN0KSB7XG4gICAgICAgIEludGVnZXIgcGVyc29uSWQgPSBkYXRhUmVxdWVzdC5nZXRJbnRlZ2VyKFwicGVyc29uSWRcIik7XG4gICAgICAgIE1hcDxTdHJpbmcsT2JqZWN0PiBmb3JtID0gZGF0YVJlcXVlc3QuZ2V0TWFwKFwiZm9ybVwiKTsgLy/lj4LmlbDojrflj5ZNYXDlr7nosaFcbiAgICAgICAgU3RyaW5nIG51bSA9IENvbW1vbk1ldGhvZC5nZXRTdHJpbmcoZm9ybSwgXCJudW1cIik7ICAvL01hcCDojrflj5blsZ7mgKfnmoTlgLxcbiAgICAgICAgVGVhY2hlciBzID0gbnVsbDtcbiAgICAgICAgUGVyc29uIHA7XG4gICAgICAgIFVzZXIgdTtcbiAgICAgICAgT3B0aW9uYWw8VGVhY2hlcj4gb3A7XG4gICAgICAgIGJvb2xlYW4gaXNOZXcgPSBmYWxzZTtcbiAgICAgICAgaWYgKHBlcnNvbklkICE9IG51bGwpIHtcbiAgICAgICAgICAgIG9wID0gdGVhY2hlclJlcG9zaXRvcnkuZmluZEJ5SWQocGVyc29uSWQpOyAgLy/mn6Xor6Llr7nlupTmlbDmja7lupPkuK3kuLvplK7kuLppZOeahOWAvOeahOWunuS9k+WvueixoVxuICAgICAgICAgICAgaWYgKG9wLmlzUHJlc2VudCgpKSB7XG4gICAgICAgICAgICAgICAgcyA9IG9wLmdldCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIE9wdGlvbmFsPFBlcnNvbj4gbk9wID0gcGVyc29uUmVwb3NpdG9yeS5maW5kQnlOdW0obnVtKTsgLy/mn6Xor6LmmK/lkKblrZjlnKhudW3nmoTkurrlkZhcbiAgICAgICAgaWYgKG5PcC5pc1ByZXNlbnQoKSkge1xuICAgICAgICAgICAgaWYgKHMgPT0gbnVsbCB8fCAhcy5nZXRQZXJzb24oKS5nZXROdW0oKS5lcXVhbHMobnVtKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBDb21tb25NZXRob2QuZ2V0UmV0dXJuTWVzc2FnZUVycm9yKFwi5paw5a2m5Y+35bey57uP5a2Y5Zyo77yM5LiN6IO95re75Yqg5oiW5L+u5pS577yBXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmIChzID09IG51bGwpIHtcbiAgICAgICAgICAgIHAgPSBuZXcgUGVyc29uKCk7XG4gICAgICAgICAgICBwLnNldE51bShudW0pO1xuICAgICAgICAgICAgcC5zZXRUeXBlKFwiMVwiKTtcbiAgICAgICAgICAgIHBlcnNvblJlcG9zaXRvcnkuc2F2ZUFuZEZsdXNoKHApOyAgLy/mj5LlhaXmlrDnmoRQZXJzb27orrDlvZVcbiAgICAgICAgICAgIHBlcnNvbklkID0gcC5nZXRQZXJzb25JZCgpO1xuICAgICAgICAgICAgU3RyaW5nIHBhc3N3b3JkID0gZW5jb2Rlci5lbmNvZGUoXCIxMjM0NTZcIik7XG4gICAgICAgICAgICB1ID0gbmV3IFVzZXIoKTtcbiAgICAgICAgICAgIHUuc2V0UGVyc29uSWQocGVyc29uSWQpO1xuICAgICAgICAgICAgdS5zZXRVc2VyTmFtZShudW0pO1xuICAgICAgICAgICAgdS5zZXRQYXNzd29yZChwYXNzd29yZCk7XG4gICAgICAgICAgICB1LnNldFVzZXJUeXBlKHVzZXJUeXBlUmVwb3NpdG9yeS5maW5kQnlOYW1lKEVVc2VyVHlwZS5ST0xFX1NUVURFTlQpKTtcbiAgICAgICAgICAgIHUuc2V0Q3JlYXRlVGltZShEYXRlVGltZVRvb2wucGFyc2VEYXRlVGltZShuZXcgRGF0ZSgpKSk7XG4gICAgICAgICAgICB1LnNldENyZWF0b3JJZChDb21tb25NZXRob2QuZ2V0UGVyc29uSWQoKSk7XG4gICAgICAgICAgICB1c2VyUmVwb3NpdG9yeS5zYXZlQW5kRmx1c2godSk7IC8v5o+S5YWl5paw55qEVXNlcuiusOW9lVxuICAgICAgICAgICAgcyA9IG5ldyBUZWFjaGVyKCk7ICAgLy8g5Yib5bu65a6e5L2T5a+56LGhXG4gICAgICAgICAgICBzLnNldFBlcnNvbklkKHBlcnNvbklkKTtcbiAgICAgICAgICAgIHRlYWNoZXJSZXBvc2l0b3J5LnNhdmVBbmRGbHVzaChzKTsgIC8v5o+S5YWl5paw55qEU3R1ZGVudOiusOW9lVxuICAgICAgICAgICAgaXNOZXcgPSB0cnVlO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcCA9IHMuZ2V0UGVyc29uKCk7XG4gICAgICAgIH1cbi4uLlxuICAgICAgICBwLnNldE5hbWUoQ29tbW9uTWV0aG9kLmdldFN0cmluZyhmb3JtLCBcIm5hbWVcIikpO1xuICAgICAgICBwLnNldERlcHQoQ29tbW9uTWV0aG9kLmdldFN0cmluZyhmb3JtLCBcImRlcHRcIikpO1xuICAgICAgICBwLnNldENhcmQoQ29tbW9uTWV0aG9kLmdldFN0cmluZyhmb3JtLCBcImNhcmRcIikpO1xuICAgICAgICBwLnNldEdlbmRlcihDb21tb25NZXRob2QuZ2V0U3RyaW5nKGZvcm0sIFwiZ2VuZGVyXCIpKTtcbiAgICAgICAgcC5zZXRCaXJ0aGRheShDb21tb25NZXRob2QuZ2V0U3RyaW5nKGZvcm0sIFwiYmlydGhkYXlcIikpO1xuICAgICAgICBwLnNldEVtYWlsKENvbW1vbk1ldGhvZC5nZXRTdHJpbmcoZm9ybSwgXCJlbWFpbFwiKSk7XG4gICAgICAgIHAuc2V0UGhvbmUoQ29tbW9uTWV0aG9kLmdldFN0cmluZyhmb3JtLCBcInBob25lXCIpKTtcbiAgICAgICAgcC5zZXRBZGRyZXNzKENvbW1vbk1ldGhvZC5nZXRTdHJpbmcoZm9ybSwgXCJhZGRyZXNzXCIpKTtcbiAgICAgICAgcGVyc29uUmVwb3NpdG9yeS5zYXZlKHApOyAgLy8g5L+u5pS55L+d5a2Y5Lq65ZGY5L+h5oGvXG4gICAgICAgIHMuc2V0Q2xhc3NOYW1lKENvbW1vbk1ldGhvZC5nZXRTdHJpbmcoZm9ybSwgXCJjbGFzc05hbWVcIikpO1xuICAgICAgICB0ZWFjaGVyUmVwb3NpdG9yeS5zYXZlKHMpOyAgLy/kv67mlLnkv53lrZjlrabnlJ/kv6Hmga9cbiAgICAgICAgc3lzdGVtU2VydmljZS5tb2RpZnlMb2cocyxpc05ldyk7XG4gICAgICAgIHJldHVybiBDb21tb25NZXRob2QuZ2V0UmV0dXJuRGF0YShzLmdldFBlcnNvbklkKCkpOyAgLy8g5bCGcGVyc29uSWTov5Tlm57liY3nq69cbiAgICB9XG4gICAgcHVibGljIFJlc3BvbnNlRW50aXR5PFN0cmVhbWluZ1Jlc3BvbnNlQm9keT4gZ2V0VGVhY2hlckxpc3RFeGNsKERhdGFSZXF1ZXN0IGRhdGFSZXF1ZXN0KSB7XG4gICAgICAgIFN0cmluZyBudW1OYW1lID0gZGF0YVJlcXVlc3QuZ2V0U3RyaW5nKFwibnVtTmFtZVwiKTtcbiAgICAgICAgTGlzdDxNYXA8U3RyaW5nLE9iamVjdD4+IGxpc3QgPSBnZXRUZWFjaGVyTWFwTGlzdChudW1OYW1lKTsgLy8g5YGH6K6+5bey5pS55Li66I635Y+W5pWZ5biI5pWw5o2u55qE5pa55rOVXG5cbiAgICAgICAgLy8g6LCD5pW05YiX5a696YWN572u77yI5qC55o2u5pWZ5biI5L+h5oGv54m554K56LCD5pW077yJXG4gICAgICAgIEludGVnZXJbXSB3aWR0aHMgPSB7OCwgMTUsIDEwLCAyMCwgMTUsIDEwLCA4LCAyNSwgMTUsIDMwfTtcbiAgICAgICAgU3RyaW5nW10gdGl0bGVzID0ge1wi5bqP5Y+3XCIsIFwi5bel5Y+3XCIsIFwi5aeT5ZCNXCIsIFwi5a2m6ZmiXCIsIFwi6IGM56ewXCIsIFwi5a2m5L2NXCIsIFwi5oCn5YirXCIsIFwi6YKu566xXCIsIFwi55S16K+dXCIsIFwi5Zyw5Z2AXCJ9O1xuICAgICAgICBTdHJpbmcgb3V0UHV0U2hlZXROYW1lID0gXCJ0ZWFjaGVyLnhsc3hcIjtcblxuICAgICAgICBYU1NGV29ya2Jvb2sgd2IgPSBuZXcgWFNTRldvcmtib29rKCk7XG4gICAgICAgIFhTU0ZTaGVldCBzaGVldCA9IHdiLmNyZWF0ZVNoZWV0KG91dFB1dFNoZWV0TmFtZSk7XG5cbiAgICAgICAgLy8g6K6+572u5YiX5a69XG4gICAgICAgIGZvcihpbnQgaiA9IDA7IGogPCB3aWR0aHMubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgICAgIHNoZWV0LnNldENvbHVtbldpZHRoKGosIHdpZHRoc1tqXSAqIDI1Nik7XG4gICAgICAgIH1cbi4uLlxuXG4gICAgICAgICAgICAgICAgLy8g5aGr5YWF5YW35L2T5pWw5o2u77yI5a2X5q615ZCN6ZyA6KaB5qC55o2u5a6e6ZmF5pWZ5biI5pWw5o2u57uT5p6E6LCD5pW077yJXG4gICAgICAgICAgICAgICAgY2VsbFswXS5zZXRDZWxsVmFsdWUoKGkgKyAxKSArIFwiXCIpOyAvLyDluo/lj7dcbiAgICAgICAgICAgICAgICBjZWxsWzFdLnNldENlbGxWYWx1ZShDb21tb25NZXRob2QuZ2V0U3RyaW5nKG0sIFwidGVhY2hlck51bVwiKSk7IC8vIOW3peWPt1xuICAgICAgICAgICAgICAgIGNlbGxbMl0uc2V0Q2VsbFZhbHVlKENvbW1vbk1ldGhvZC5nZXRTdHJpbmcobSwgXCJuYW1lXCIpKTsgLy8g5aeT5ZCNXG4gICAgICAgICAgICAgICAgY2VsbFszXS5zZXRDZWxsVmFsdWUoQ29tbW9uTWV0aG9kLmdldFN0cmluZyhtLCBcImRlcGFydFwiKSk7IC8vIOWtpumZolxuICAgICAgICAgICAgICAgIGNlbGxbNF0uc2V0Q2VsbFZhbHVlKENvbW1vbk1ldGhvZC5nZXRTdHJpbmcobSwgXCJ0aXRsZVwiKSk7IC8vIOiBjOensFxuICAgICAgICAgICAgICAgIGNlbGxbNV0uc2V0Q2VsbFZhbHVlKENvbW1vbk1ldGhvZC5nZXRTdHJpbmcobSwgXCJkZWdyZWVcIikpOyAvLyDlrabkvY1cbiAgICAgICAgICAgICAgICBjZWxsWzZdLnNldENlbGxWYWx1ZShDb21tb25NZXRob2QuZ2V0U3RyaW5nKG0sIFwiZ2VuZGVyXCIpKTsgLy8g5oCn5YirXG4gICAgICAgICAgICAgICAgY2VsbFs3XS5zZXRDZWxsVmFsdWUoQ29tbW9uTWV0aG9kLmdldFN0cmluZyhtLCBcImVtYWlsXCIpKTsgLy8g6YKu566xXG4gICAgICAgICAgICAgICAgY2VsbFs4XS5zZXRDZWxsVmFsdWUoQ29tbW9uTWV0aG9kLmdldFN0cmluZyhtLCBcInBob25lXCIpKTsgLy8g55S16K+dXG4gICAgICAgICAgICAgICAgY2VsbFs5XS5zZXRDZWxsVmFsdWUoQ29tbW9uTWV0aG9kLmdldFN0cmluZyhtLCBcImFkZHJlc3NcIikpOyAvLyDlnLDlnYBcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuLi4uXG4gICAgcHVibGljIERhdGFSZXNwb25zZSBnZXRUZWFjaGVyUGFnZURhdGEoRGF0YVJlcXVlc3QgZGF0YVJlcXVlc3QpIHtcbiAgICAgICAgU3RyaW5nIG51bU5hbWUgPSBkYXRhUmVxdWVzdC5nZXRTdHJpbmcoXCJudW1OYW1lXCIpO1xuICAgICAgICBJbnRlZ2VyIGNQYWdlID0gZGF0YVJlcXVlc3QuZ2V0Q3VycmVudFBhZ2UoKTtcbiAgICAgICAgaW50IGRhdGFUb3RhbCA9IDA7XG4gICAgICAgIGludCBzaXplID0gNDA7XG4gICAgICAgIExpc3Q8TWFwPFN0cmluZyxPYmplY3Q+PiBkYXRhTGlzdCA9IG5ldyBBcnJheUxpc3Q8PigpO1xuICAgICAgICBQYWdlPFRlYWNoZXI+IHBhZ2UgPSBudWxsO1xuICAgICAgICBQYWdlYWJsZSBwYWdlYWJsZSA9IFBhZ2VSZXF1ZXN0Lm9mKGNQYWdlLCBzaXplKTtcbiAgICAgICAgcGFnZSA9IHRlYWNoZXJSZXBvc2l0b3J5LmZpbmRUZWFjaGVyTGlzdEJ5TnVtTmFtZShudW1OYW1lLCBwYWdlYWJsZSk7XG4gICAgICAgIE1hcDxTdHJpbmcsT2JqZWN0PiBtO1xuICAgICAgICBpZiAocGFnZSAhPSBudWxsKSB7XG4gICAgICAgICAgICBkYXRhVG90YWwgPSAoaW50KSBwYWdlLmdldFRvdGFsRWxlbWVudHMoKTtcbiAgICAgICAgICAgIExpc3Q8VGVhY2hlcj4gbGlzdCA9IHBhZ2UuZ2V0Q29udGVudCgpO1xuICAgICAgICAgICAgaWYgKCFsaXN0LmlzRW1wdHkoKSkge1xuICAgICAgICAgICAgICAgIGZvciAoVGVhY2hlciB0ZWFjaGVyIDogbGlzdCkge1xuICAgICAgICAgICAgICAgICAgICBtID0gZ2V0TWFwRnJvbVRlYWNoZXIodGVhY2hlcik7XG4gICAgICAgICAgICAgICAgICAgIGRhdGFMaXN0LmFkZChtKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbi4uLlxuICAgIHB1YmxpYyBEYXRhUmVzcG9uc2UgZ2V0RmFtaWx5TWVtYmVyTGlzdChEYXRhUmVxdWVzdCBkYXRhUmVxdWVzdCkge1xuICAgICAgICBJbnRlZ2VyIHBlcnNvbklkID0gZGF0YVJlcXVlc3QuZ2V0SW50ZWdlcihcInBlcnNvbklkXCIpO1xuICAgICAgICBMaXN0PEZhbWlseU1lbWJlcj4gZkxpc3QgPSBmYW1pbHlNZW1iZXJSZXBvc2l0b3J5LmZpbmRCeVRlYWNoZXJQZXJzb25JZChwZXJzb25JZCk7XG4gICAgICAgIExpc3Q8TWFwPFN0cmluZyxPYmplY3Q+PiBkYXRhTGlzdCA9IG5ldyBBcnJheUxpc3Q8PigpO1xuICAgICAgICBNYXA8U3RyaW5nLE9iamVjdD4gbTtcbiAgICAgICAgaWYgKGZMaXN0ICE9IG51bGwpIHtcbiAgICAgICAgICAgIGZvciAoRmFtaWx5TWVtYmVyIGYgOiBmTGlzdCkge1xuICAgICAgICAgICAgICAgIG0gPSBuZXcgSGFzaE1hcDw+KCk7XG4gICAgICAgICAgICAgICAgbS5wdXQoXCJtZW1iZXJJZFwiLCBmLmdldE1lbWJlcklkKCkpO1xuICAgICAgICAgICAgICAgIG0ucHV0KFwicGVyc29uSWRcIiwgZi5nZXRUZWFjaGVyKCkuZ2V0UGVyc29uSWQoKSk7XG4gICAgICAgICAgICAgICAgbS5wdXQoXCJyZWxhdGlvblwiLCBmLmdldFJlbGF0aW9uKCkpO1xuICAgICAgICAgICAgICAgIG0ucHV0KFwibmFtZVwiLCBmLmdldE5hbWUoKSk7XG4gICAgICAgICAgICAgICAgbS5wdXQoXCJnZW5kZXJcIiwgZi5nZXRHZW5kZXIoKSk7XG4gICAgICAgICAgICAgICAgbS5wdXQoXCJhZ2VcIiwgZi5nZXRBZ2UoKStcIlwiKTtcbiAgICAgICAgICAgICAgICBtLnB1dChcInVuaXRcIiwgZi5nZXRVbml0KCkpO1xuICAgICAgICAgICAgICAgIGRhdGFMaXN0LmFkZChtKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gQ29tbW9uTWV0aG9kLmdldFJldHVybkRhdGEoZGF0YUxpc3QpO1xuICAgIH1cbiAgICBwdWJsaWMgRGF0YVJlc3BvbnNlIGZhbWlseU1lbWJlclNhdmUoRGF0YVJlcXVlc3QgZGF0YVJlcXVlc3QpIHtcbiAgICAgICAgTWFwPFN0cmluZyxPYmplY3Q+IGZvcm0gPSBkYXRhUmVxdWVzdC5nZXRNYXAoXCJmb3JtXCIpO1xuICAgICAgICBJbnRlZ2VyIHBlcnNvbklkID0gQ29tbW9uTWV0aG9kLmdldEludGVnZXIoZm9ybSxcInBlcnNvbklkXCIpO1xuICAgICAgICBJbnRlZ2VyIG1lbWJlcklkID0gQ29tbW9uTWV0aG9kLmdldEludGVnZXIoZm9ybSxcIm1lbWJlcklkXCIpO1xuICAgICAgICBPcHRpb25hbDxGYW1pbHlNZW1iZXI+IG9wO1xuICAgICAgICBGYW1pbHlNZW1iZXIgZiA9IG51bGw7XG4gICAgICAgIGlmKG1lbWJlcklkICE9IG51bGwpIHtcbiAgICAgICAgICAgIG9wID0gZmFtaWx5TWVtYmVyUmVwb3NpdG9yeS5maW5kQnlJZChtZW1iZXJJZCk7XG4gICAgICAgICAgICBpZihvcC5pc1ByZXNlbnQoKSkge1xuICAgICAgICAgICAgICAgIGYgPSBvcC5nZXQoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZihmPT0gbnVsbCkge1xuICAgICAgICAgICAgZiA9IG5ldyBGYW1pbHlNZW1iZXIoKTtcbiAgICAgICAgICAgIGFzc2VydCBwZXJzb25JZCAhPSBudWxsO1xuICAgICAgICAgICAgZi5zZXRTdHVkZW50KHRlYWNoZXJSZXBvc2l0b3J5LmZpbmRCeUlkKHBlcnNvbklkKS5nZXQoKSk7XG4gICAgICAgIH1cbi4uLlxuUGF0aDogamF2YS1zZXJ2ZXIvc3JjL21haW4vamF2YS9jbi9lZHUvc2R1L2phdmEvc2VydmVyL3NlcnZpY2VzL1RlYWNoZXJTZXJ2aWNlcy5qYXZhXG4uLi5cblxuaW1wb3J0IGNuLmVkdS5zZHUuamF2YS5zZXJ2ZXIubW9kZWxzLio7XG5pbXBvcnQgY24uZWR1LnNkdS5qYXZhLnNlcnZlci5tb2RlbHMuVGVhY2hlcjtcbmltcG9ydCBjbi5lZHUuc2R1LmphdmEuc2VydmVyLnBheWxvYWQucmVxdWVzdC5EYXRhUmVxdWVzdDtcbmltcG9ydCBjbi5lZHUuc2R1LmphdmEuc2VydmVyLnBheWxvYWQucmVzcG9uc2UuRGF0YVJlc3BvbnNlO1xuaW1wb3J0IGNuLmVkdS5zZHUuamF2YS5zZXJ2ZXIucmVwb3NpdG9yeXMuKjtcbmltcG9ydCBjbi5lZHUuc2R1LmphdmEuc2VydmVyLnV0aWwuQ29tRGF0YVV0aWw7XG5pbXBvcnQgY24uZWR1LnNkdS5qYXZhLnNlcnZlci51dGlsLkNvbW1vbk1ldGhvZDtcbmltcG9ydCBjbi5lZHUuc2R1LmphdmEuc2VydmVyLnV0aWwuRGF0ZVRpbWVUb29sO1xuaW1wb3J0IG9yZy5hcGFjaGUucG9pLnhzc2YudXNlcm1vZGVsLio7XG5pbXBvcnQgb3JnLnNsZjRqLkxvZ2dlcjtcbmltcG9ydCBvcmcuc2xmNGouTG9nZ2VyRmFjdG9yeTtcbmltcG9ydCBvcmcuc3ByaW5nZnJhbWV3b3JrLmRhdGEuZG9tYWluLlBhZ2U7XG5pbXBvcnQgb3JnLnNwcmluZ2ZyYW1ld29yay5kYXRhLmRvbWFpbi5QYWdlUmVxdWVzdDtcbmltcG9ydCBvcmcuc3ByaW5nZnJhbWV3b3JrLmRhdGEuZG9tYWluLlBhZ2VhYmxlO1xuaW1wb3J0IG9yZy5zcHJpbmdmcmFtZXdvcmsuaHR0cC5SZXNwb25zZUVudGl0eTtcbmltcG9ydCBvcmcuc3ByaW5nZnJhbWV3b3JrLnNlY3VyaXR5LmNyeXB0by5wYXNzd29yZC5QYXNzd29yZEVuY29kZXI7XG5pbXBvcnQgb3JnLnNwcmluZ2ZyYW1ld29yay5zdGVyZW90eXBlLlNlcnZpY2U7XG5pbXBvcnQgb3JnLnNwcmluZ2ZyYW1ld29yay53ZWIuc2VydmxldC5tdmMubWV0aG9kLmFubm90YXRpb24uU3RyZWFtaW5nUmVzcG9uc2VCb2R5O1xuXG5pbXBvcnQgamF2YS51dGlsLio7XG5cbkBTZXJ2aWNlXG5wdWJsaWMgY2xhc3MgVGVhY2hlclNlcnZpY2VzIHtcbiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBMb2dnZXIgbG9nID0gTG9nZ2VyRmFjdG9yeS5nZXRMb2dnZXIoVGVhY2hlclNlcnZpY2VzLmNsYXNzKTtcbiAgICBwcml2YXRlIGZpbmFsIFBlcnNvblJlcG9zaXRvcnkgcGVyc29uUmVwb3NpdG9yeTsgIC8v5Lq65ZGY5pWw5o2u5pON5L2c6Ieq5Yqo5rOo5YWlXG4gICAgcHJpdmF0ZSBmaW5hbCBUZWFjaGVyUmVwb3NpdG9yeSB0ZWFjaGVyUmVwb3NpdG9yeTsgIC8v5pWZ5biI5pWw5o2u5pON5L2c6Ieq5Yqo5rOo5YWlXG4gICAgcHJpdmF0ZSBmaW5hbCBVc2VyUmVwb3NpdG9yeSB1c2VyUmVwb3NpdG9yeTsgIC8v5pWw5o2u5pON5L2c6Ieq5Yqo5rOo5YWlXG4gICAgcHJpdmF0ZSBmaW5hbCBVc2VyVHlwZVJlcG9zaXRvcnkgdXNlclR5cGVSZXBvc2l0b3J5OyAvL+eUqOaIt+exu+Wei+aVsOaNruaTjeS9nOiHquWKqOazqOWFpVxuICAgIHByaXZhdGUgZmluYWwgUGFzc3dvcmRFbmNvZGVyIGVuY29kZXI7ICAvL+WvhueggeacjeWKoeiHquWKqOazqOWFpVxuICAgIC8v5raI6LS55pWw5o2u5pON5L2c6Ieq5Yqo5rOo5YWlXG4gICAgcHJpdmF0ZSBmaW5hbCBGYW1pbHlNZW1iZXJSZXBvc2l0b3J5IGZhbWlseU1lbWJlclJlcG9zaXRvcnk7XG4gICAgcHJpdmF0ZSBmaW5hbCBTeXN0ZW1TZXJ2aWNlIHN5c3RlbVNlcnZpY2U7XG4uLi5cblxuICAgIHB1YmxpYyBNYXA8U3RyaW5nLCBPYmplY3Q+IGdldE1hcEZyb21UZWFjaGVyKFRlYWNoZXIgcykge1xuICAgICAgICBNYXA8U3RyaW5nLCBPYmplY3Q+IG0gPSBuZXcgSGFzaE1hcDw+KCk7XG4gICAgICAgIFBlcnNvbiBwO1xuICAgICAgICBpZiAocyA9PSBudWxsKVxuICAgICAgICAgICAgcmV0dXJuIG07XG4gICAgICAgIG0ucHV0KFwidGl0bGVcIiwgcy5nZXRUaXRsZSgpKTtcbiAgICAgICAgbS5wdXQoXCJkZWdyZWVcIiwgcy5nZXREZWdyZWUoKSk7XG4gICAgICAgIG0ucHV0KFwiY2xhc3NOYW1lXCIsIHMuZ2V0Q2xhc3NOYW1lKCkpO1xuICAgICAgICBwID0gcy5nZXRQZXJzb24oKTtcbiAgICAgICAgaWYgKHAgPT0gbnVsbClcbiAgICAgICAgICAgIHJldHVybiBtO1xuICAgICAgICBtLnB1dChcInBlcnNvbklkXCIsIHMuZ2V0UGVyc29uSWQoKSk7XG4gICAgICAgIG0ucHV0KFwibnVtXCIsIHAuZ2V0TnVtKCkpO1xuICAgICAgICBtLnB1dChcIm5hbWVcIiwgcC5nZXROYW1lKCkpO1xuICAgICAgICBtLnB1dChcImRlcHRcIiwgcC5nZXREZXB0KCkpO1xuICAgICAgICBtLnB1dChcImNhcmRcIiwgcC5nZXRDYXJkKCkpO1xuICAgICAgICBTdHJpbmcgZ2VuZGVyID0gcC5nZXRHZW5kZXIoKTtcbiAgICAgICAgbS5wdXQoXCJnZW5kZXJcIiwgZ2VuZGVyKTtcbiAgICAgICAgbS5wdXQoXCJnZW5kZXJOYW1lXCIsIENvbURhdGFVdGlsLmdldEluc3RhbmNlKCkuZ2V0RGljdGlvbmFyeUxhYmVsQnlWYWx1ZShcIlhCTVwiLCBnZW5kZXIpKTsgLy/mgKfliKvnsbvlnovnmoTlgLzovazmjaLmiJDmlbDmja7nsbvlnovlkI1cbiAgICAgICAgbS5wdXQoXCJiaXJ0aGRheVwiLCBwLmdldEJpcnRoZGF5KCkpOyAgLy/ml7bpl7TmoLzlvI/ovazmjaLlrZfnrKbkuLJcbiAgICAgICAgbS5wdXQoXCJlbWFpbFwiLCBwLmdldEVtYWlsKCkpO1xuICAgICAgICBtLnB1dChcInBob25lXCIsIHAuZ2V0UGhvbmUoKSk7XG4gICAgICAgIG0ucHV0KFwiYWRkcmVzc1wiLCBwLmdldEFkZHJlc3MoKSk7XG4gICAgICAgIG0ucHV0KFwiaW50cm9kdWNlXCIsIHAuZ2V0SW50cm9kdWNlKCkpO1xuICAgICAgICByZXR1cm4gbTtcbiAgICB9XG5cbiAgICBwdWJsaWMgTGlzdDxNYXA8U3RyaW5nLCBPYmplY3Q+PiBnZXRUZWFjaGVyTWFwTGlzdChTdHJpbmcgbnVtTmFtZSkge1xuICAgICAgICBMaXN0PE1hcDxTdHJpbmcsIE9iamVjdD4+IGRhdGFMaXN0ID0gbmV3IEFycmF5TGlzdDw+KCk7XG4gICAgICAgIExpc3Q8VGVhY2hlcj4gc0xpc3QgPSB0ZWFjaGVyUmVwb3NpdG9yeS5maW5kVGVhY2hlckxpc3RCeU51bU5hbWUobnVtTmFtZSk7ICAvL+aVsOaNruW6k+afpeivouaTjeS9nFxuICAgICAgICBpZiAoc0xpc3QgPT0gbnVsbCB8fCBzTGlzdC5pc0VtcHR5KCkpXG4gICAgICAgICAgICByZXR1cm4gZGF0YUxpc3Q7XG4gICAgICAgIGZvciAoVGVhY2hlciB0ZWFjaGVyIDogc0xpc3QpIHtcbiAgICAgICAgICAgIGRhdGFMaXN0LmFkZChnZXRNYXBGcm9tVGVhY2hlcih0ZWFjaGVyKSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGRhdGFMaXN0O1xuICAgIH1cblxuICAgIHB1YmxpYyBEYXRhUmVzcG9uc2UgZ2V0VGVhY2hlckxpc3QoRGF0YVJlcXVlc3QgZGF0YVJlcXVlc3QpIHtcbiAgICAgICAgU3RyaW5nIG51bU5hbWUgPSBkYXRhUmVxdWVzdC5nZXRTdHJpbmcoXCJudW1OYW1lXCIpO1xuICAgICAgICBMaXN0PE1hcDxTdHJpbmcsIE9iamVjdD4+IGRhdGFMaXN0ID0gZ2V0VGVhY2hlck1hcExpc3QobnVtTmFtZSk7XG4gICAgICAgIHJldHVybiBDb21tb25NZXRob2QuZ2V0UmV0dXJuRGF0YShkYXRhTGlzdCk7ICAvL+aMieeFp+a1i+ivleahhuaetuinhOiMg+S8mumAgU1hcOeahGxpc3RcbiAgICB9XG5cbiAgICBwdWJsaWMgRGF0YVJlc3BvbnNlIHRlYWNoZXJEZWxldGUoRGF0YVJlcXVlc3QgZGF0YVJlcXVlc3QpIHtcbiAgICAgICAgSW50ZWdlciBwZXJzb25JZCA9IGRhdGFSZXF1ZXN0LmdldEludGVnZXIoXCJwZXJzb25JZFwiKTsgIC8v6I635Y+WdGVhY2hlcl9pZOWAvFxuICAgICAgICBUZWFjaGVyIHMgPSBudWxsO1xuICAgICAgICBPcHRpb25hbDxUZWFjaGVyPiBvcDtcbiAgICAgICAgaWYgKHBlcnNvbklkICE9IG51bGwgJiYgcGVyc29uSWQgPiAwKSB7XG4gICAgICAgICAgICBvcCA9IHRlYWNoZXJSZXBvc2l0b3J5LmZpbmRCeUlkKHBlcnNvbklkKTsgICAvL+afpeivouiOt+W+l+WunuS9k+WvueixoVxuICAgICAgICAgICAgaWYgKG9wLmlzUHJlc2VudCgpKSB7XG4gICAgICAgICAgICAgICAgcyA9IG9wLmdldCgpO1xuICAgICAgICAgICAgICAgIE9wdGlvbmFsPFVzZXI+IHVPcCA9IHVzZXJSZXBvc2l0b3J5LmZpbmRCeUlkKHBlcnNvbklkKTsgLy/mn6Xor6Llr7nlupTor6XmlZnluIjnmoTotKbmiLdcbiAgICAgICAgICAgICAgICAvL+WIoOmZpOWvueW6lOivpeaVmeW4iOeahOi0puaIt1xuICAgICAgICAgICAgICAgIHVPcC5pZlByZXNlbnQodXNlclJlcG9zaXRvcnk6OmRlbGV0ZSk7XG4gICAgICAgICAgICAgICAgUGVyc29uIHAgPSBzLmdldFBlcnNvbigpO1xuICAgICAgICAgICAgICAgIHRlYWNoZXJSZXBvc2l0b3J5LmRlbGV0ZShzKTsgICAgLy/pppblhYjmlbDmja7lupPmsLjkuYXliKDpmaTmlZnluIjkv6Hmga9cbiAgICAgICAgICAgICAgICBwZXJzb25SZXBvc2l0b3J5LmRlbGV0ZShwKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gQ29tbW9uTWV0aG9kLmdldFJldHVybk1lc3NhZ2VPSygpOyAgLy/pgJrnn6XliY3nq6/mk43kvZzmraPluLhcbiAgICB9XG5cbiAgICBwdWJsaWMgRGF0YVJlc3BvbnNlIGdldFRlYWNoZXJJbmZvKERhdGFSZXF1ZXN0IGRhdGFSZXF1ZXN0KSB7XG4gICAgICAgIEludGVnZXIgcGVyc29uSWQgPSBkYXRhUmVxdWVzdC5nZXRJbnRlZ2VyKFwicGVyc29uSWRcIik7XG4gICAgICAgIFRlYWNoZXIgcyA9IG51bGw7XG4gICAgICAgIE9wdGlvbmFsPFRlYWNoZXI+IG9wO1xuICAgICAgICBpZiAocGVyc29uSWQgIT0gbnVsbCkge1xuICAgICAgICAgICAgb3AgPSB0ZWFjaGVyUmVwb3NpdG9yeS5maW5kQnlJZChwZXJzb25JZCk7IC8v5qC55o2u5a2m55Sf5Li76ZSu5LuO5pWw5o2u5bqT5p+l6K+i5a2m55Sf55qE5L+h5oGvXG4gICAgICAgICAgICBpZiAob3AuaXNQcmVzZW50KCkpIHtcbiAgICAgICAgICAgICAgICBzID0gb3AuZ2V0KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIENvbW1vbk1ldGhvZC5nZXRSZXR1cm5EYXRhKGdldE1hcEZyb21UZWFjaGVyKHMpKTsgLy/ov5nph4zlm57kvKDljIXlkKvlrabnlJ/kv6Hmga/nmoRNYXDlr7nosaFcbiAgICB9XG5cbiAgICBwdWJsaWMgRGF0YVJlc3BvbnNlIHRlYWNoZXJFZGl0U2F2ZShEYXRhUmVxdWVzdCBkYXRhUmVxdWVzdCkge1xuICAgICAgICBJbnRlZ2VyIHBlcnNvbklkID0gZGF0YVJlcXVlc3QuZ2V0SW50ZWdlcihcInBlcnNvbklkXCIpO1xuICAgICAgICBNYXA8U3RyaW5nLCBPYmplY3Q+IGZvcm0gPSBkYXRhUmVxdWVzdC5nZXRNYXAoXCJmb3JtXCIpOyAvL+WPguaVsOiOt+WPlk1hcOWvueixoVxuICAgICAgICBTdHJpbmcgbnVtID0gQ29tbW9uTWV0aG9kLmdldFN0cmluZyhmb3JtLCBcIm51bVwiKTsgIC8vTWFwIOiOt+WPluWxnuaAp+eahOWAvFxuICAgICAgICBUZWFjaGVyIHMgPSBudWxsO1xuICAgICAgICBQZXJzb24gcDtcbiAgICAgICAgVXNlciB1O1xuICAgICAgICBPcHRpb25hbDxUZWFjaGVyPiBvcDtcbiAgICAgICAgYm9vbGVhbiBpc05ldyA9IGZhbHNlO1xuICAgICAgICBpZiAocGVyc29uSWQgIT0gbnVsbCkge1xuICAgICAgICAgICAgb3AgPSB0ZWFjaGVyUmVwb3NpdG9yeS5maW5kQnlJZChwZXJzb25JZCk7ICAvL+afpeivouWvueW6lOaVsOaNruW6k+S4reS4u+mUruS4umlk55qE5YC855qE5a6e5L2T5a+56LGhXG4gICAgICAgICAgICBpZiAob3AuaXNQcmVzZW50KCkpIHtcbiAgICAgICAgICAgICAgICBzID0gb3AuZ2V0KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgT3B0aW9uYWw8UGVyc29uPiBuT3AgPSBwZXJzb25SZXBvc2l0b3J5LmZpbmRCeU51bShudW0pOyAvL+afpeivouaYr+WQpuWtmOWcqG51beeahOS6uuWRmFxuICAgICAgICBpZiAobk9wLmlzUHJlc2VudCgpKSB7XG4gICAgICAgICAgICBpZiAocyA9PSBudWxsIHx8ICFzLmdldFBlcnNvbigpLmdldE51bSgpLmVxdWFscyhudW0pKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIENvbW1vbk1ldGhvZC5nZXRSZXR1cm5NZXNzYWdlRXJyb3IoXCLmlrDlt6Xlj7flt7Lnu4/lrZjlnKjvvIzkuI3og73mt7vliqDmiJbkv67mlLnvvIFcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHMgPT0gbnVsbCkge1xuICAgICAgICAgICAgcCA9IG5ldyBQZXJzb24oKTtcbiAgICAgICAgICAgIHAuc2V0TnVtKG51bSk7XG4gICAgICAgICAgICBwLnNldFR5cGUoXCIyXCIpOyAgLy8gMuihqOekuuaVmeW4iOexu+Wei1xuICAgICAgICAgICAgcGVyc29uUmVwb3NpdG9yeS5zYXZlQW5kRmx1c2gocCk7ICAvL+aPkuWFpeaWsOeahFBlcnNvbuiusOW9lVxuICAgICAgICAgICAgcGVyc29uSWQgPSBwLmdldFBlcnNvbklkKCk7XG4gICAgICAgICAgICBTdHJpbmcgcGFzc3dvcmQgPSBlbmNvZGVyLmVuY29kZShcIjEyMzQ1NlwiKTtcbiAgICAgICAgICAgIHUgPSBuZXcgVXNlcigpO1xuICAgICAgICAgICAgdS5zZXRQZXJzb25JZChwZXJzb25JZCk7XG4gICAgICAgICAgICB1LnNldFVzZXJOYW1lKG51bSk7XG4gICAgICAgICAgICB1LnNldFBhc3N3b3JkKHBhc3N3b3JkKTtcbiAgICAgICAgICAgIHUuc2V0VXNlclR5cGUodXNlclR5cGVSZXBvc2l0b3J5LmZpbmRCeU5hbWUoRVVzZXJUeXBlLlJPTEVfVEVBQ0hFUikpOyAgLy8g6K6+572u5Li65pWZ5biI6KeS6ImyXG4gICAgICAgICAgICB1LnNldENyZWF0ZVRpbWUoRGF0ZVRpbWVUb29sLnBhcnNlRGF0ZVRpbWUobmV3IERhdGUoKSkpO1xuICAgICAgICAgICAgdS5zZXRDcmVhdG9ySWQoQ29tbW9uTWV0aG9kLmdldFBlcnNvbklkKCkpO1xuICAgICAgICAgICAgdXNlclJlcG9zaXRvcnkuc2F2ZUFuZEZsdXNoKHUpOyAvL+aPkuWFpeaWsOeahFVzZXLorrDlvZVcbiAgICAgICAgICAgIHMgPSBuZXcgVGVhY2hlcigpOyAgIC8vIOWIm+W7uuWunuS9k+WvueixoVxuICAgICAgICAgICAgcy5zZXRQZXJzb25JZChwZXJzb25JZCk7XG4gICAgICAgICAgICB0ZWFjaGVyUmVwb3NpdG9yeS5zYXZlQW5kRmx1c2gocyk7ICAvL+aPkuWFpeaWsOeahFRlYWNoZXLorrDlvZVcbiAgICAgICAgICAgIGlzTmV3ID0gdHJ1ZTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHAgPSBzLmdldFBlcnNvbigpO1xuICAgICAgICB9XG4uLi5cbiAgICAgICAgcC5zZXROYW1lKENvbW1vbk1ldGhvZC5nZXRTdHJpbmcoZm9ybSwgXCJuYW1lXCIpKTtcbiAgICAgICAgcC5zZXREZXB0KENvbW1vbk1ldGhvZC5nZXRTdHJpbmcoZm9ybSwgXCJkZXB0XCIpKTtcbiAgICAgICAgcC5zZXRDYXJkKENvbW1vbk1ldGhvZC5nZXRTdHJpbmcoZm9ybSwgXCJjYXJkXCIpKTtcbiAgICAgICAgcC5zZXRHZW5kZXIoQ29tbW9uTWV0aG9kLmdldFN0cmluZyhmb3JtLCBcImdlbmRlclwiKSk7XG4gICAgICAgIHAuc2V0QmlydGhkYXkoQ29tbW9uTWV0aG9kLmdldFN0cmluZyhmb3JtLCBcImJpcnRoZGF5XCIpKTtcbiAgICAgICAgcC5zZXRFbWFpbChDb21tb25NZXRob2QuZ2V0U3RyaW5nKGZvcm0sIFwiZW1haWxcIikpO1xuICAgICAgICBwLnNldFBob25lKENvbW1vbk1ldGhvZC5nZXRTdHJpbmcoZm9ybSwgXCJwaG9uZVwiKSk7XG4gICAgICAgIHAuc2V0QWRkcmVzcyhDb21tb25NZXRob2QuZ2V0U3RyaW5nKGZvcm0sIFwiYWRkcmVzc1wiKSk7XG4gICAgICAgIHBlcnNvblJlcG9zaXRvcnkuc2F2ZShwKTsgIC8vIOS/ruaUueS/neWtmOS6uuWRmOS/oeaBr1xuICAgICAgICBzLnNldENsYXNzTmFtZShDb21tb25NZXRob2QuZ2V0U3RyaW5nKGZvcm0sIFwiY2xhc3NOYW1lXCIpKTtcbiAgICAgICAgdGVhY2hlclJlcG9zaXRvcnkuc2F2ZShzKTsgIC8v5L+u5pS55L+d5a2Y5a2m55Sf5L+h5oGvXG4gICAgICAgIHN5c3RlbVNlcnZpY2UubW9kaWZ5TG9nKHMsIGlzTmV3KTtcbiAgICAgICAgcmV0dXJuIENvbW1vbk1ldGhvZC5nZXRSZXR1cm5EYXRhKHMuZ2V0UGVyc29uSWQoKSk7ICAvLyDlsIZwZXJzb25JZOi/lOWbnuWJjeerr1xuICAgIH1cblxuICAgIHB1YmxpYyBSZXNwb25zZUVudGl0eTxTdHJlYW1pbmdSZXNwb25zZUJvZHk+IGdldFRlYWNoZXJMaXN0RXhjbChEYXRhUmVxdWVzdCBkYXRhUmVxdWVzdCkge1xuICAgICAgICBTdHJpbmcgbnVtTmFtZSA9IGRhdGFSZXF1ZXN0LmdldFN0cmluZyhcIm51bU5hbWVcIik7XG4gICAgICAgIExpc3Q8TWFwPFN0cmluZywgT2JqZWN0Pj4gbGlzdCA9IGdldFRlYWNoZXJNYXBMaXN0KG51bU5hbWUpO1xuXG4gICAgICAgIC8vIOiwg+aVtOWIl+WuvemFjee9rlxuICAgICAgICBJbnRlZ2VyW10gd2lkdGhzID0gezgsIDE1LCAxMCwgMjAsIDE1LCAxMCwgOCwgMjUsIDE1LCAzMH07XG4gICAgICAgIFN0cmluZ1tdIHRpdGxlcyA9IHtcIuW6j+WPt1wiLCBcIuW3peWPt1wiLCBcIuWnk+WQjVwiLCBcIuWtpumZolwiLCBcIuiBjOensFwiLCBcIuWtpuS9jVwiLCBcIuaAp+WIq1wiLCBcIumCrueusVwiLCBcIueUteivnVwiLCBcIuWcsOWdgFwifTtcbiAgICAgICAgU3RyaW5nIG91dFB1dFNoZWV0TmFtZSA9IFwidGVhY2hlci54bHN4XCI7XG5cbiAgICAgICAgWFNTRldvcmtib29rIHdiID0gbmV3IFhTU0ZXb3JrYm9vaygpO1xuICAgICAgICBYU1NGU2hlZXQgc2hlZXQgPSB3Yi5jcmVhdGVTaGVldChvdXRQdXRTaGVldE5hbWUpO1xuXG4gICAgICAgIC8vIOiuvue9ruWIl+WuvVxuICAgICAgICBmb3IgKGludCBqID0gMDsgaiA8IHdpZHRocy5sZW5ndGg7IGorKykge1xuICAgICAgICAgICAgc2hlZXQuc2V0Q29sdW1uV2lkdGgoaiwgd2lkdGhzW2pdICogMjU2KTtcbiAgICAgICAgfVxuLi4uXG5cbiAgICAgICAgICAgICAgICAvLyDloavlhYXlhbfkvZPmlbDmja5cbiAgICAgICAgICAgICAgICBjZWxsWzBdLnNldENlbGxWYWx1ZSgoaSArIDEpICsgXCJcIik7IC8vIOW6j+WPt1xuICAgICAgICAgICAgICAgIGNlbGxbMV0uc2V0Q2VsbFZhbHVlKENvbW1vbk1ldGhvZC5nZXRTdHJpbmcobSwgXCJudW1cIikpOyAvLyDlt6Xlj7dcbiAgICAgICAgICAgICAgICBjZWxsWzJdLnNldENlbGxWYWx1ZShDb21tb25NZXRob2QuZ2V0U3RyaW5nKG0sIFwibmFtZVwiKSk7IC8vIOWnk+WQjVxuICAgICAgICAgICAgICAgIGNlbGxbM10uc2V0Q2VsbFZhbHVlKENvbW1vbk1ldGhvZC5nZXRTdHJpbmcobSwgXCJkZXB0XCIpKTsgLy8g5a2m6ZmiXG4gICAgICAgICAgICAgICAgY2VsbFs0XS5zZXRDZWxsVmFsdWUoQ29tbW9uTWV0aG9kLmdldFN0cmluZyhtLCBcInRpdGxlXCIpKTsgLy8g6IGM56ewXG4gICAgICAgICAgICAgICAgY2VsbFs1XS5zZXRDZWxsVmFsdWUoQ29tbW9uTWV0aG9kLmdldFN0cmluZyhtLCBcImRlZ3JlZVwiKSk7IC8vIOWtpuS9jVxuICAgICAgICAgICAgICAgIGNlbGxbNl0uc2V0Q2VsbFZhbHVlKENvbW1vbk1ldGhvZC5nZXRTdHJpbmcobSwgXCJnZW5kZXJOYW1lXCIpKTsgLy8g5oCn5YirXG4gICAgICAgICAgICAgICAgY2VsbFs3XS5zZXRDZWxsVmFsdWUoQ29tbW9uTWV0aG9kLmdldFN0cmluZyhtLCBcImVtYWlsXCIpKTsgLy8g6YKu566xXG4gICAgICAgICAgICAgICAgY2VsbFs4XS5zZXRDZWxsVmFsdWUoQ29tbW9uTWV0aG9kLmdldFN0cmluZyhtLCBcInBob25lXCIpKTsgLy8g55S16K+dXG4gICAgICAgICAgICAgICAgY2VsbFs5XS5zZXRDZWxsVmFsdWUoQ29tbW9uTWV0aG9kLmdldFN0cmluZyhtLCBcImFkZHJlc3NcIikpOyAvLyDlnLDlnYBcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuLi4uXG5cbiAgICBwdWJsaWMgRGF0YVJlc3BvbnNlIGdldFRlYWNoZXJQYWdlRGF0YShEYXRhUmVxdWVzdCBkYXRhUmVxdWVzdCkge1xuICAgICAgICBTdHJpbmcgbnVtTmFtZSA9IGRhdGFSZXF1ZXN0LmdldFN0cmluZyhcIm51bU5hbWVcIik7XG4gICAgICAgIEludGVnZXIgY1BhZ2UgPSBkYXRhUmVxdWVzdC5nZXRDdXJyZW50UGFnZSgpO1xuICAgICAgICBpbnQgZGF0YVRvdGFsID0gMDtcbiAgICAgICAgaW50IHNpemUgPSA0MDtcbiAgICAgICAgTGlzdDxNYXA8U3RyaW5nLCBPYmplY3Q+PiBkYXRhTGlzdCA9IG5ldyBBcnJheUxpc3Q8PigpO1xuICAgICAgICBQYWdlPFRlYWNoZXI+IHBhZ2UgPSBudWxsO1xuICAgICAgICBQYWdlYWJsZSBwYWdlYWJsZSA9IFBhZ2VSZXF1ZXN0Lm9mKGNQYWdlLCBzaXplKTtcbiAgICAgICAgcGFnZSA9IHRlYWNoZXJSZXBvc2l0b3J5LmZpbmRUZWFjaGVyTGlzdEJ5TnVtTmFtZShudW1OYW1lLCBwYWdlYWJsZSk7XG4gICAgICAgIE1hcDxTdHJpbmcsIE9iamVjdD4gbTtcbiAgICAgICAgaWYgKHBhZ2UgIT0gbnVsbCkge1xuICAgICAgICAgICAgZGF0YVRvdGFsID0gKGludCkgcGFnZS5nZXRUb3RhbEVsZW1lbnRzKCk7XG4gICAgICAgICAgICBMaXN0PFRlYWNoZXI+IGxpc3QgPSBwYWdlLmdldENvbnRlbnQoKTtcbiAgICAgICAgICAgIGlmICghbGlzdC5pc0VtcHR5KCkpIHtcbiAgICAgICAgICAgICAgICBmb3IgKFRlYWNoZXIgdGVhY2hlciA6IGxpc3QpIHtcbiAgICAgICAgICAgICAgICAgICAgbSA9IGdldE1hcEZyb21UZWFjaGVyKHRlYWNoZXIpO1xuICAgICAgICAgICAgICAgICAgICBkYXRhTGlzdC5hZGQobSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4uLi5cbiIsImlzRXJyb3IiOmZhbHNlLCJyZXF1ZXN0SWQiOiIifX0sIjlmZWVmYTU5LWIxNDUtNDA4ZS1iNWIwLWI1ZjIwMTIxODA5MDt0b29sdV92cnR4XzAxVVhwWUd1UTI2Ym9RZlhEQTdoV1JhOCI6eyJyZXF1ZXN0SWQiOiI5ZmVlZmE1OS1iMTQ1LTQwOGUtYjViMC1iNWYyMDEyMTgwOTAiLCJ0b29sVXNlSWQiOiJ0b29sdV92cnR4XzAxVVhwWUd1UTI2Ym9RZlhEQTdoV1JhOCIsInBoYXNlIjo1LCJyZXN1bHQiOnsidGV4dCI6IlRoZSBmb2xsb3dpbmcgY29kZSBzZWN0aW9ucyB3ZXJlIHJldHJpZXZlZDpcblBhdGg6IHNyYy9tYWluL2phdmEvY24vZWR1L3NkdS9qYXZhL3NlcnZlci91dGlsL0NvbW1vbk1ldGhvZC5qYXZhXG4uLi5cblxuICAgIHB1YmxpYyBzdGF0aWMgU3RyaW5nIGdldE5leHROdW0yKFN0cmluZyBudW0pIHtcbiAgICAgICAgU3RyaW5nIHN0cjtcbiAgICAgICAgU3RyaW5nIHByZWZpeDtcbiAgICAgICAgaWYobnVtLmxlbmd0aCgpID09IDIpIHtcbiAgICAgICAgICAgIHN0ciA9IG51bTtcbiAgICAgICAgICAgIHByZWZpeD0gXCJcIjtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHN0ciA9IG51bS5zdWJzdHJpbmcobnVtLmxlbmd0aCgpIC0gMik7XG4gICAgICAgICAgICBwcmVmaXggPSBudW0uc3Vic3RyaW5nKDAsbnVtLmxlbmd0aCgpIC0gMik7XG4gICAgICAgIH1cbiAgICAgICAgaW50IGM7XG4gICAgICAgIGlmKHN0ci5jaGFyQXQoMCk9PScwJykge1xuICAgICAgICAgICAgYyA9IHN0ci5jaGFyQXQoMSktJzAnO1xuICAgICAgICB9ZWxzZSB7XG4gICAgICAgICAgICBjID0gKHN0ci5jaGFyQXQoMCktJzAnKSoxMCArIHN0ci5jaGFyQXQoMSktJzAnO1xuICAgICAgICB9XG4gICAgICAgIGMrKztcbiAgICAgICAgaWYoYyA8IDEwKSB7XG4gICAgICAgICAgICByZXR1cm4gcHJlZml4K1wiMFwiICsgYztcbiAgICAgICAgfWVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIHByZWZpeCsgYztcbiAgICAgICAgfVxuICAgIH1cbi4uLlxuICAgIHB1YmxpYyBzdGF0aWMgU3RyaW5nIGdldE5leHROdW00KCBTdHJpbmcgbnVtKSB7XG4gICAgICAgIFN0cmluZyBzdHI7XG4gICAgICAgIFN0cmluZyBwcmVmaXg7XG4gICAgICAgIGlmKG51bS5sZW5ndGgoKSA9PSA0KSB7XG4gICAgICAgICAgICBzdHIgPSBudW07XG4gICAgICAgICAgICBwcmVmaXg9IFwiXCI7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBzdHIgPSBudW0uc3Vic3RyaW5nKG51bS5sZW5ndGgoKSAtIDQpO1xuICAgICAgICAgICAgcHJlZml4ID0gbnVtLnN1YnN0cmluZygwLG51bS5sZW5ndGgoKSAtIDQpO1xuICAgICAgICB9XG4gICAgICAgIGludCBjO1xuICAgICAgICBpZihzdHIuY2hhckF0KDApPT0nMCcpIHtcbiAgICAgICAgICAgIGlmIChzdHIuY2hhckF0KDEpID09ICcwJykge1xuICAgICAgICAgICAgICAgIGlmIChzdHIuY2hhckF0KDIpID09ICcwJykge1xuICAgICAgICAgICAgICAgICAgICBjID0gc3RyLmNoYXJBdCgzKSAtICcwJztcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBjID0gKHN0ci5jaGFyQXQoMikgLSAnMCcpICogMTAgKyBzdHIuY2hhckF0KDMpIC0gJzAnO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgYyA9IChzdHIuY2hhckF0KDEpIC0gJzAnKSAqIDEwMCArIChzdHIuY2hhckF0KDIpIC0gJzAnKSAqIDEwICsgc3RyLmNoYXJBdCgzKSAtICcwJztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfWVsc2Uge1xuICAgICAgICAgICAgYyA9IChzdHIuY2hhckF0KDApIC0gJzAnKSAqIDEwMDAgKyAoc3RyLmNoYXJBdCgxKSAtICcwJykgKiAxMDAgKyAoc3RyLmNoYXJBdCgyKSAtICcwJykgKiAxMCArIHN0ci5jaGFyQXQoMykgLSAnMCc7XG4gICAgICAgIH1cbiAgICAgICAgYysrO1xuICAgICAgICBpZihjIDwgMTApIHtcbiAgICAgICAgICAgIHJldHVybiBwcmVmaXgrXCIwMDBcIiArIGM7XG4gICAgICAgIH1lbHNlIGlmKGMgPCAxMDApIHtcbiAgICAgICAgICAgIHJldHVybiBwcmVmaXgrXCIwMFwiICsgYztcbiAgICAgICAgfWVsc2UgaWYoYyA8IDEwMDApe1xuICAgICAgICAgICAgcmV0dXJuIHByZWZpeCArIFwiMFwiICsgYztcbiAgICAgICAgfWVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIHByZWZpeCsgYztcbiAgICAgICAgfVxuICAgIH1cbiAgICBwdWJsaWMgc3RhdGljIFN0cmluZ1tdIGdldFN0cmluZ3MoTWFwPFN0cmluZyxPYmplY3Q+IGRhdGEsU3RyaW5nIGtleSl7XG4gICAgICAgIE9iamVjdCBvYmogPSBkYXRhLmdldChrZXkpO1xuICAgICAgICBpZihvYmogPT0gbnVsbClcbiAgICAgICAgICAgIHJldHVybiBuZXcgU3RyaW5nW117fTtcbiAgICAgICAgaWYob2JqIGluc3RhbmNlb2YgU3RyaW5nW10pXG4gICAgICAgICAgICByZXR1cm4gKFN0cmluZ1tdKW9iajtcbiAgICAgICAgcmV0dXJuIG5ldyBTdHJpbmdbXXt9O1xuICAgIH1cblxuICAgIHB1YmxpYyBzdGF0aWMgU3RyaW5nIGdldFN0cmluZyhNYXA8U3RyaW5nLE9iamVjdD4gZGF0YSxTdHJpbmcga2V5KXtcbiAgICAgICAgT2JqZWN0IG9iaiA9IGRhdGEuZ2V0KGtleSk7XG4gICAgICAgIGlmKG9iaiA9PSBudWxsKVxuICAgICAgICAgICAgcmV0dXJuIFwiXCI7XG4gICAgICAgIGlmKG9iaiBpbnN0YW5jZW9mIFN0cmluZylcbiAgICAgICAgICAgIHJldHVybiAoU3RyaW5nKW9iajtcbiAgICAgICAgcmV0dXJuIG9iai50b1N0cmluZygpO1xuICAgIH1cbiAgICBwdWJsaWMgc3RhdGljIEJvb2xlYW4gZ2V0Qm9vbGVhbihNYXA8U3RyaW5nLE9iamVjdD4gZGF0YSxTdHJpbmcga2V5KXtcbiAgICAgICAgT2JqZWN0IG9iaiA9IGRhdGEuZ2V0KGtleSk7XG4gICAgICAgIGlmKG9iaiA9PSBudWxsKVxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICBpZihvYmogaW5zdGFuY2VvZiBCb29sZWFuKVxuICAgICAgICAgICAgcmV0dXJuIChCb29sZWFuKW9iajtcbiAgICAgICAgcmV0dXJuIFwidHJ1ZVwiLmVxdWFscyhvYmoudG9TdHJpbmcoKSk7XG4gICAgfVxuICAgIHB1YmxpYyBzdGF0aWMgTGlzdDw/PiBnZXRMaXN0KE1hcDxTdHJpbmcsT2JqZWN0PiBkYXRhLCBTdHJpbmcga2V5KXtcbiAgICAgICAgT2JqZWN0IG9iaiA9IGRhdGEuZ2V0KGtleSk7XG4gICAgICAgIGlmKG9iaiA9PSBudWxsKVxuICAgICAgICAgICAgcmV0dXJuIG5ldyBBcnJheUxpc3Q8PigpO1xuICAgICAgICBpZihvYmogaW5zdGFuY2VvZiBMaXN0KVxuICAgICAgICAgICAgcmV0dXJuIChMaXN0PD8+KW9iajtcbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgcmV0dXJuIG5ldyBBcnJheUxpc3Q8PigpO1xuICAgIH1cbiAgICBwdWJsaWMgc3RhdGljIE1hcDxTdHJpbmcsT2JqZWN0PiBnZXRNYXAoTWFwPFN0cmluZyxPYmplY3Q+IGRhdGEsU3RyaW5nIGtleSl7XG4gICAgICAgIE9iamVjdCBvYmogPSBkYXRhLmdldChrZXkpO1xuICAgICAgICBpZihvYmogPT0gbnVsbClcbiAgICAgICAgICAgIHJldHVybiBuZXcgSGFzaE1hcDw+KCk7XG4gICAgICAgIGlmKG9iaiBpbnN0YW5jZW9mIE1hcClcbiAgICAgICAgICAgIHJldHVybiAoTWFwPFN0cmluZywgT2JqZWN0Pikgb2JqO1xuICAgICAgICBlbHNlXG4gICAgICAgICAgICByZXR1cm4gbmV3IEhhc2hNYXA8PigpO1xuICAgIH1cblxuICAgIHB1YmxpYyBzdGF0aWMgSW50ZWdlciBnZXRJbnRlZ2VyKE1hcDxTdHJpbmcsT2JqZWN0PiBkYXRhLFN0cmluZyBrZXkpIHtcbiAgICAgICAgT2JqZWN0IG9iaiA9IGRhdGEuZ2V0KGtleSk7XG4gICAgICAgIGlmKG9iaiA9PSBudWxsKVxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIGlmKG9iaiBpbnN0YW5jZW9mIEludGVnZXIpXG4gICAgICAgICAgICByZXR1cm4gKEludGVnZXIpb2JqO1xuICAgICAgICBTdHJpbmcgc3RyID0gb2JqLnRvU3RyaW5nKCk7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICByZXR1cm4gKGludClEb3VibGUucGFyc2VEb3VibGUoc3RyKTtcbiAgICAgICAgfWNhdGNoKEV4Y2VwdGlvbiBlKSB7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgIH1cbiAgICBwdWJsaWMgc3RhdGljIEludGVnZXIgZ2V0SW50ZWdlcjAoTWFwPFN0cmluZyxPYmplY3Q+IGRhdGEsU3RyaW5nIGtleSkge1xuICAgICAgICBPYmplY3Qgb2JqID0gZGF0YS5nZXQoa2V5KTtcbiAgICAgICAgaWYob2JqID09IG51bGwpXG4gICAgICAgICAgICByZXR1cm4gMDtcbiAgICAgICAgaWYob2JqIGluc3RhbmNlb2YgSW50ZWdlcilcbiAgICAgICAgICAgIHJldHVybiAoSW50ZWdlcilvYmo7XG4gICAgICAgIFN0cmluZyBzdHIgPSBvYmoudG9TdHJpbmcoKTtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIHJldHVybiAoaW50KURvdWJsZS5wYXJzZURvdWJsZShzdHIpO1xuICAgICAgICB9Y2F0Y2goRXhjZXB0aW9uIGUpIHtcbiAgICAgICAgICAgIHJldHVybiAwO1xuICAgICAgICB9XG4gICAgfVxuICAgIHB1YmxpYyBzdGF0aWMgTG9uZyBnZXRMb25nKE1hcDxTdHJpbmcsT2JqZWN0PiBkYXRhLFN0cmluZyBrZXkpIHtcbiAgICAgICAgT2JqZWN0IG9iaiA9IGRhdGEuZ2V0KGtleSk7XG4gICAgICAgIGlmKG9iaiA9PSBudWxsKVxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIGlmKG9iaiBpbnN0YW5jZW9mIExvbmcpXG4gICAgICAgICAgICByZXR1cm4gKExvbmcpb2JqO1xuICAgICAgICBTdHJpbmcgc3RyID0gb2JqLnRvU3RyaW5nKCk7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICByZXR1cm4gTG9uZy5wYXJzZUxvbmcoc3RyKTtcbiAgICAgICAgfWNhdGNoKEV4Y2VwdGlvbiBlKSB7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHB1YmxpYyBzdGF0aWMgRG91YmxlIGdldERvdWJsZShNYXA8U3RyaW5nLE9iamVjdD4gZGF0YSxTdHJpbmcga2V5KSB7XG4gICAgICAgIE9iamVjdCBvYmogPSBkYXRhLmdldChrZXkpO1xuICAgICAgICBpZihvYmogPT0gbnVsbClcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICBpZihvYmogaW5zdGFuY2VvZiBEb3VibGUpXG4gICAgICAgICAgICByZXR1cm4gKERvdWJsZSlvYmo7XG4gICAgICAgIFN0cmluZyBzdHIgPSBvYmoudG9TdHJpbmcoKTtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIHJldHVybiBEb3VibGUucGFyc2VEb3VibGUoc3RyKTtcbiAgICAgICAgfWNhdGNoKEV4Y2VwdGlvbiBlKSB7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgIH1cbiAgICBwdWJsaWMgc3RhdGljIERvdWJsZSBnZXREb3VibGUwKE1hcDxTdHJpbmcsT2JqZWN0PiBkYXRhLFN0cmluZyBrZXkpIHtcbiAgICAgICAgRG91YmxlIGQwID0gMGQ7XG4gICAgICAgIE9iamVjdCBvYmogPSBkYXRhLmdldChrZXkpO1xuICAgICAgICBpZihvYmogPT0gbnVsbClcbiAgICAgICAgICAgIHJldHVybiBkMDtcbiAgICAgICAgaWYob2JqIGluc3RhbmNlb2YgRG91YmxlKVxuICAgICAgICAgICAgcmV0dXJuIChEb3VibGUpb2JqO1xuICAgICAgICBTdHJpbmcgc3RyID0gb2JqLnRvU3RyaW5nKCk7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICByZXR1cm4gRG91YmxlLnBhcnNlRG91YmxlKHN0cik7XG4gICAgICAgIH1jYXRjaChFeGNlcHRpb24gZSkge1xuICAgICAgICAgICAgcmV0dXJuIGQwO1xuICAgICAgICB9XG4gICAgfVxuICAgIHB1YmxpYyBzdGF0aWMgRGF0ZSBnZXREYXRlKE1hcDxTdHJpbmcsT2JqZWN0PiBkYXRhLCBTdHJpbmcga2V5KSB7XG4gICAgICAgIE9iamVjdCBvYmogPSBkYXRhLmdldChrZXkpO1xuICAgICAgICBpZihvYmogPT0gbnVsbClcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICBpZihvYmogaW5zdGFuY2VvZiBEYXRlKVxuICAgICAgICAgICAgcmV0dXJuIChEYXRlKW9iajtcbiAgICAgICAgU3RyaW5nIHN0ciA9IG9iai50b1N0cmluZygpO1xuICAgICAgICByZXR1cm4gRGF0ZVRpbWVUb29sLmZvcm1hdERhdGVUaW1lKHN0cixcInl5eXktTU0tZGRcIik7XG4gICAgfVxuICAgIHB1YmxpYyBzdGF0aWMgRGF0ZSBnZXRUaW1lKE1hcDxTdHJpbmcsT2JqZWN0PiBkYXRhLFN0cmluZyBrZXkpIHtcbiAgICAgICAgT2JqZWN0IG9iaiA9IGRhdGEuZ2V0KGtleSk7XG4gICAgICAgIGlmKG9iaiA9PSBudWxsKVxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIGlmKG9iaiBpbnN0YW5jZW9mIERhdGUpXG4gICAgICAgICAgICByZXR1cm4gKERhdGUpb2JqO1xuICAgICAgICBTdHJpbmcgc3RyID0gb2JqLnRvU3RyaW5nKCk7XG4gICAgICAgIHJldHVybiBEYXRlVGltZVRvb2wuZm9ybWF0RGF0ZVRpbWUoc3RyLFwieXl5eS1NTS1kZCBISDptbTpzc1wiKTtcbiAgICB9XG4uLi5cbiAgICBwdWJsaWMgc3RhdGljIERvdWJsZSBnZXREb3VibGUyKERvdWJsZSBmKSB7XG4gICAgICAgIGlmIChmID09IG51bGwpXG4gICAgICAgICAgICByZXR1cm4gMGQ7XG4gICAgICAgIEJpZ0RlY2ltYWwgYmcgPSBuZXcgQmlnRGVjaW1hbChmKTtcbiAgICAgICAgcmV0dXJuIGJnLnNldFNjYWxlKDIsIEJpZ0RlY2ltYWwuUk9VTkRfSEFMRl9VUCkuZG91YmxlVmFsdWUoKTtcbiAgICB9XG4gICAgcHVibGljIHN0YXRpYyBTdHJpbmcgT2JqZWN0VG9KU29uKE9iamVjdCBvKXtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIC8vcOaYr+aMh+Wumuimgei9rOaNoueahOWvueixoVxuICAgICAgICAgICAgU3RyaW5nIGpzb24gPSBtYXBwZXIud3JpdGVWYWx1ZUFzU3RyaW5nKG8pO1xuICAgICAgICAgICAgcmV0dXJuIGpzb247XG4gICAgICAgIH1jYXRjaChFeGNlcHRpb24gZSl7XG4gICAgICAgICAgICByZXR1cm4gXCJcIjtcbiAgICAgICAgfVxuICAgIH1cbi4uLlxuUGF0aDogc3JjL21haW4vamF2YS9jb20vdGVhY2gvamF2YWZ4L3V0aWwvQ29tbW9uTWV0aG9kLmphdmFcbi4uLlxuXG5wdWJsaWMgY2xhc3MgQ29tbW9uTWV0aG9kIHtcbiAgICBwdWJsaWMgc3RhdGljIFN0cmluZ1tdIGdldFN0cmluZ3MoTWFwPFN0cmluZyxPYmplY3Q+IGRhdGEsU3RyaW5nIGtleSl7XG4gICAgICAgIE9iamVjdCBvYmogPSBkYXRhLmdldChrZXkpO1xuICAgICAgICBpZihvYmogPT0gbnVsbClcbiAgICAgICAgICAgIHJldHVybiBuZXcgU3RyaW5nW117fTtcbiAgICAgICAgaWYob2JqIGluc3RhbmNlb2YgU3RyaW5nW10pXG4gICAgICAgICAgICByZXR1cm4gKFN0cmluZ1tdKW9iajtcbiAgICAgICAgcmV0dXJuIG5ldyBTdHJpbmdbXXt9O1xuICAgIH1cblxuICAgIHB1YmxpYyBzdGF0aWMgU3RyaW5nIGdldFN0cmluZyhNYXA8U3RyaW5nLE9iamVjdD4gZGF0YSxTdHJpbmcga2V5KXtcbiAgICAgICAgaWYoZGF0YSA9PSBudWxsKVxuICAgICAgICAgICAgcmV0dXJuIFwiXCI7XG4gICAgICAgIE9iamVjdCBvYmogPSBkYXRhLmdldChrZXkpO1xuICAgICAgICBpZihvYmogPT0gbnVsbClcbiAgICAgICAgICAgIHJldHVybiBcIlwiO1xuICAgICAgICBpZihvYmogaW5zdGFuY2VvZiBTdHJpbmcpXG4gICAgICAgICAgICByZXR1cm4gKFN0cmluZylvYmo7XG4gICAgICAgIHJldHVybiBvYmoudG9TdHJpbmcoKTtcbiAgICB9XG4gICAgcHVibGljIHN0YXRpYyBCb29sZWFuIGdldEJvb2xlYW4oTWFwPFN0cmluZyxPYmplY3Q+IGRhdGEsU3RyaW5nIGtleSl7XG4gICAgICAgIGlmKGRhdGEgPT0gbnVsbClcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICBPYmplY3Qgb2JqID0gZGF0YS5nZXQoa2V5KTtcbiAgICAgICAgaWYob2JqID09IG51bGwpXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIGlmKG9iaiBpbnN0YW5jZW9mIEJvb2xlYW4pXG4gICAgICAgICAgICByZXR1cm4gKEJvb2xlYW4pb2JqO1xuICAgICAgICBpZihcInRydWVcIi5lcXVhbHMob2JqLnRvU3RyaW5nKCkpKVxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4uLi5cbiAgICBwdWJsaWMgc3RhdGljIEludGVnZXIgZ2V0SW50ZWdlckZyb21PYmplY3QoT2JqZWN0IG9iaikge1xuICAgICAgICBpZihvYmogPT0gbnVsbClcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICBpZihvYmogaW5zdGFuY2VvZiBJbnRlZ2VyKVxuICAgICAgICAgICAgcmV0dXJuIChJbnRlZ2VyKW9iajtcbiAgICAgICAgU3RyaW5nIHN0ciA9IG9iai50b1N0cmluZygpO1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgcmV0dXJuIChpbnQpRG91YmxlLnBhcnNlRG91YmxlKHN0cik7XG4gICAgICAgIH1jYXRjaChFeGNlcHRpb24gZSkge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwdWJsaWMgc3RhdGljIEludGVnZXIgZ2V0SW50ZWdlcihNYXA8U3RyaW5nLE9iamVjdD4gZGF0YSxTdHJpbmcga2V5KSB7XG4gICAgICAgIGlmKGRhdGEgPT0gbnVsbClcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICBPYmplY3Qgb2JqID0gZGF0YS5nZXQoa2V5KTtcbiAgICAgICAgaWYob2JqID09IG51bGwpXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgaWYob2JqIGluc3RhbmNlb2YgSW50ZWdlcilcbiAgICAgICAgICAgIHJldHVybiAoSW50ZWdlcilvYmo7XG4gICAgICAgIFN0cmluZyBzdHIgPSBvYmoudG9TdHJpbmcoKTtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIHJldHVybiAoaW50KURvdWJsZS5wYXJzZURvdWJsZShzdHIpO1xuICAgICAgICB9Y2F0Y2goRXhjZXB0aW9uIGUpIHtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgfVxuICAgIHB1YmxpYyBzdGF0aWMgSW50ZWdlciBnZXRJbnRlZ2VyMChNYXA8U3RyaW5nLE9iamVjdD4gZGF0YSxTdHJpbmcga2V5KSB7XG4gICAgICAgIGlmKGRhdGEgPT0gbnVsbClcbiAgICAgICAgICAgIHJldHVybiAwO1xuICAgICAgICBPYmplY3Qgb2JqID0gZGF0YS5nZXQoa2V5KTtcbiAgICAgICAgaWYob2JqID09IG51bGwpXG4gICAgICAgICAgICByZXR1cm4gMDtcbiAgICAgICAgaWYob2JqIGluc3RhbmNlb2YgSW50ZWdlcilcbiAgICAgICAgICAgIHJldHVybiAoSW50ZWdlcilvYmo7XG4gICAgICAgIFN0cmluZyBzdHIgPSBvYmoudG9TdHJpbmcoKTtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIHJldHVybiAoaW50KURvdWJsZS5wYXJzZURvdWJsZShzdHIpO1xuICAgICAgICB9Y2F0Y2goRXhjZXB0aW9uIGUpIHtcbiAgICAgICAgICAgIHJldHVybiAwO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHVibGljIHN0YXRpYyBEb3VibGUgZ2V0RG91YmxlKE1hcDxTdHJpbmcsT2JqZWN0PiBkYXRhLFN0cmluZyBrZXkpIHtcbiAgICAgICAgaWYoZGF0YSA9PSBudWxsKVxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIE9iamVjdCBvYmogPSBkYXRhLmdldChrZXkpO1xuICAgICAgICBpZihvYmogPT0gbnVsbClcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICBpZihvYmogaW5zdGFuY2VvZiBEb3VibGUpXG4gICAgICAgICAgICByZXR1cm4gKERvdWJsZSlvYmo7XG4gICAgICAgIFN0cmluZyBzdHIgPSBvYmoudG9TdHJpbmcoKTtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIHJldHVybiAwZDtcbiAgICAgICAgfWNhdGNoKEV4Y2VwdGlvbiBlKSB7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgIH1cbiAgICBwdWJsaWMgc3RhdGljIERvdWJsZSBnZXREb3VibGUwKE1hcDxTdHJpbmcsT2JqZWN0PiBkYXRhLFN0cmluZyBrZXkpIHtcbiAgICAgICAgRG91YmxlIGQwID0gMGQ7XG4gICAgICAgIE9iamVjdCBvYmogPSBkYXRhLmdldChrZXkpO1xuICAgICAgICBpZihvYmogPT0gbnVsbClcbiAgICAgICAgICAgIHJldHVybiBkMDtcbiAgICAgICAgaWYob2JqIGluc3RhbmNlb2YgRG91YmxlKVxuICAgICAgICAgICAgcmV0dXJuIChEb3VibGUpb2JqO1xuICAgICAgICBTdHJpbmcgc3RyID0gb2JqLnRvU3RyaW5nKCk7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICByZXR1cm4gZDA7XG4gICAgICAgIH1jYXRjaChFeGNlcHRpb24gZSkge1xuICAgICAgICAgICAgcmV0dXJuIGQwO1xuICAgICAgICB9XG4gICAgfVxuICAgIHB1YmxpYyBzdGF0aWMgRGF0ZSBnZXREYXRlKE1hcDxTdHJpbmcsT2JqZWN0PiBkYXRhLCBTdHJpbmcga2V5KSB7XG4gICAgICAgIGlmKGRhdGEgPT0gbnVsbClcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICBPYmplY3Qgb2JqID0gZGF0YS5nZXQoa2V5KTtcbiAgICAgICAgaWYob2JqID09IG51bGwpXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgaWYob2JqIGluc3RhbmNlb2YgRGF0ZSlcbiAgICAgICAgICAgIHJldHVybiAoRGF0ZSlvYmo7XG4gICAgICAgIFN0cmluZyBzdHIgPSBvYmoudG9TdHJpbmcoKTtcbiAgICAgICAgcmV0dXJuIERhdGVUaW1lVG9vbC5mb3JtYXREYXRlVGltZShzdHIsXCJ5eXl5LU1NLWRkXCIpO1xuICAgIH1cbi4uLlxuUGF0aDogc3JjL21haW4vamF2YS9jbi9lZHUvc2R1L2phdmEvc2VydmVyL3BheWxvYWQvcmVxdWVzdC9EYXRhUmVxdWVzdC5qYXZhXG4uLi5cblxuICAgIHB1YmxpYyBMaXN0PD8+IGdldExpc3QoU3RyaW5nIGtleSl7XG4gICAgICAgIE9iamVjdCBvYmogPSBkYXRhLmdldChrZXkpO1xuICAgICAgICBpZihvYmogPT0gbnVsbClcbiAgICAgICAgICAgIHJldHVybiBuZXcgQXJyYXlMaXN0PD4oKTtcbiAgICAgICAgaWYob2JqIGluc3RhbmNlb2YgTGlzdClcbiAgICAgICAgICAgIHJldHVybiAoTGlzdDw/PilvYmo7XG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIHJldHVybiBuZXcgQXJyYXlMaXN0PD4oKTtcbiAgICB9XG4gICAgcHVibGljIE1hcDxTdHJpbmcsT2JqZWN0PiBnZXRNYXAoU3RyaW5nIGtleSl7XG4gICAgICAgIGlmKGRhdGEgPT0gbnVsbClcbiAgICAgICAgICAgIHJldHVybiBuZXcgSGFzaE1hcDw+KCk7XG4gICAgICAgIE9iamVjdCBvYmogPSBkYXRhLmdldChrZXkpO1xuICAgICAgICBpZihvYmogPT0gbnVsbClcbiAgICAgICAgICAgIHJldHVybiBuZXcgSGFzaE1hcDw+KCk7XG4gICAgICAgIGlmKG9iaiBpbnN0YW5jZW9mIE1hcClcbiAgICAgICAgICAgIHJldHVybiAoTWFwPFN0cmluZyxPYmplY3Q+KW9iajtcbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgcmV0dXJuIG5ldyBIYXNoTWFwPD4oKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgSW50ZWdlciBnZXRJbnRlZ2VyKFN0cmluZyBrZXkpIHtcbiAgICAgICAgaWYoZGF0YSA9PSBudWxsKVxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIE9iamVjdCBvYmogPSBkYXRhLmdldChrZXkpO1xuICAgICAgICBpZihvYmogPT0gbnVsbClcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICBpZihvYmogaW5zdGFuY2VvZiBJbnRlZ2VyKVxuICAgICAgICAgICAgcmV0dXJuIChJbnRlZ2VyKW9iajtcbiAgICAgICAgU3RyaW5nIHN0ciA9IG9iai50b1N0cmluZygpO1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgcmV0dXJuIChpbnQpRG91YmxlLnBhcnNlRG91YmxlKHN0cik7XG4gICAgICAgIH1jYXRjaChFeGNlcHRpb24gZSkge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICB9XG4uLi5cbiAgICBwdWJsaWMgRGF0ZSBnZXRUaW1lKFN0cmluZyBrZXkpIHtcbiAgICAgICAgT2JqZWN0IG9iaiA9IGRhdGEuZ2V0KGtleSk7XG4gICAgICAgIGlmKG9iaiA9PSBudWxsKVxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIGlmKG9iaiBpbnN0YW5jZW9mIERhdGUpXG4gICAgICAgICAgICByZXR1cm4gKERhdGUpb2JqO1xuICAgICAgICBTdHJpbmcgc3RyID0gb2JqLnRvU3RyaW5nKCk7XG4gICAgICAgIHJldHVybiBEYXRlVGltZVRvb2wuZm9ybWF0RGF0ZVRpbWUoc3RyLFwieXl5eS1NTS1kZCBISDptbTpzc1wiKTtcbiAgICB9XG4gICAgcHVibGljIEludGVnZXIgZ2V0Q3VycmVudFBhZ2UoKXtcbiAgICAgICAgSW50ZWdlciBjUGFnZSA9IHRoaXMuZ2V0SW50ZWdlcihcImN1cnJlbnRQYWdlXCIpO1xuICAgICAgICBpZihjUGFnZSAhPSBudWxsICYmIGNQYWdlID4wIClcbiAgICAgICAgICAgIGNQYWdlID0gY1BhZ2UgLTE7XG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIGNQYWdlID0gMDtcbiAgICAgICAgcmV0dXJuIGNQYWdlO1xuXG4gICAgfVxuXG59XG4uLi5cblBhdGg6IHNyYy9tYWluL2phdmEvY29tL3RlYWNoL2phdmFmeC9yZXF1ZXN0L0RhdGFSZXF1ZXN0LmphdmFcbi4uLlxuXG4gICAgcHVibGljIExpc3Q8Pz4gZ2V0TGlzdChTdHJpbmcga2V5KXtcbiAgICAgICAgT2JqZWN0IG9iaiA9IGRhdGEuZ2V0KGtleSk7XG4gICAgICAgIGlmKG9iaiA9PSBudWxsKVxuICAgICAgICAgICAgcmV0dXJuIG5ldyBBcnJheUxpc3Q8PigpO1xuICAgICAgICBpZihvYmogaW5zdGFuY2VvZiBMaXN0KVxuICAgICAgICAgICAgcmV0dXJuIChMaXN0PD8+KW9iajtcbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgcmV0dXJuIG5ldyBBcnJheUxpc3Q8PigpO1xuICAgIH1cbiAgICBwdWJsaWMgTWFwPFN0cmluZyxPYmplY3Q+IGdldE1hcChTdHJpbmcga2V5KXtcbiAgICAgICAgaWYoZGF0YSA9PSBudWxsKVxuICAgICAgICAgICAgcmV0dXJuIG5ldyBIYXNoTWFwPD4oKTtcbiAgICAgICAgT2JqZWN0IG9iaiA9IGRhdGEuZ2V0KGtleSk7XG4gICAgICAgIGlmKG9iaiA9PSBudWxsKVxuICAgICAgICAgICAgcmV0dXJuIG5ldyBIYXNoTWFwPD4oKTtcbiAgICAgICAgaWYob2JqIGluc3RhbmNlb2YgTWFwKVxuICAgICAgICAgICAgcmV0dXJuIChNYXA8U3RyaW5nLE9iamVjdD4pb2JqO1xuICAgICAgICBlbHNlXG4gICAgICAgICAgICByZXR1cm4gbmV3IEhhc2hNYXA8PigpO1xuICAgIH1cblxuICAgIHB1YmxpYyBJbnRlZ2VyIGdldEludGVnZXIoU3RyaW5nIGtleSkge1xuICAgICAgICBpZihkYXRhID09IG51bGwpXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgT2JqZWN0IG9iaiA9IGRhdGEuZ2V0KGtleSk7XG4gICAgICAgIGlmKG9iaiA9PSBudWxsKVxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIGlmKG9iaiBpbnN0YW5jZW9mIEludGVnZXIpXG4gICAgICAgICAgICByZXR1cm4gKEludGVnZXIpb2JqO1xuICAgICAgICBTdHJpbmcgc3RyID0gb2JqLnRvU3RyaW5nKCk7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICByZXR1cm4gKGludClEb3VibGUucGFyc2VEb3VibGUoc3RyKTtcbiAgICAgICAgfWNhdGNoKEV4Y2VwdGlvbiBlKSB7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgIH1cbi4uLlxuICAgIHB1YmxpYyBEYXRlIGdldFRpbWUoU3RyaW5nIGtleSkge1xuICAgICAgICBPYmplY3Qgb2JqID0gZGF0YS5nZXQoa2V5KTtcbiAgICAgICAgaWYob2JqID09IG51bGwpXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgaWYob2JqIGluc3RhbmNlb2YgRGF0ZSlcbiAgICAgICAgICAgIHJldHVybiAoRGF0ZSlvYmo7XG4gICAgICAgIFN0cmluZyBzdHIgPSBvYmoudG9TdHJpbmcoKTtcbiAgICAgICAgcmV0dXJuIERhdGVUaW1lVG9vbC5mb3JtYXREYXRlVGltZShzdHIsXCJ5eXl5LU1NLWRkIEhIOm1tOnNzXCIpO1xuICAgIH1cbiAgICBwdWJsaWMgSW50ZWdlciBnZXRDdXJyZW50UGFnZSgpe1xuICAgICAgICBJbnRlZ2VyIGNQYWdlID0gdGhpcy5nZXRJbnRlZ2VyKFwiY3VycmVudFBhZ2VcIik7XG4gICAgICAgIGlmKGNQYWdlICE9IG51bGwgJiYgY1BhZ2UgPjAgKVxuICAgICAgICAgICAgY1BhZ2UgPSBjUGFnZSAtMTtcbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgY1BhZ2UgPSAwO1xuICAgICAgICByZXR1cm4gY1BhZ2U7XG5cbiAgICB9XG5cbn1cbi4uLlxuUGF0aDogc3JjL21haW4vamF2YS9jbi9lZHUvc2R1L2phdmEvc2VydmVyL3NlcnZpY2VzL0Jhc2VTZXJ2aWNlLmphdmFcbi4uLlxuXG4gICAgcHVibGljIERhdGFSZXNwb25zZSBnZXRNZW51TGlzdChEYXRhUmVxdWVzdCBkYXRhUmVxdWVzdCkge1xuICAgICAgICBMaXN0PE1hcDxTdHJpbmcsIE9iamVjdD4+IGRhdGFMaXN0ID0gbmV3IEFycmF5TGlzdDw+KCk7XG4gICAgICAgIEludGVnZXIgdXNlclR5cGVJZCA9IGRhdGFSZXF1ZXN0LmdldEludGVnZXIoXCJ1c2VyVHlwZUlkXCIpO1xuICAgICAgICBpZiAodXNlclR5cGVJZCA9PSBudWxsKSB7XG4gICAgICAgICAgICBJbnRlZ2VyIHBlcnNvbklkID0gQ29tbW9uTWV0aG9kLmdldFBlcnNvbklkKCk7XG4gICAgICAgICAgICBpZiAocGVyc29uSWQgPT0gbnVsbClcbiAgICAgICAgICAgICAgICByZXR1cm4gQ29tbW9uTWV0aG9kLmdldFJldHVybkRhdGEoZGF0YUxpc3QpO1xuICAgICAgICAgICAgdXNlclR5cGVJZCA9IHVzZXJSZXBvc2l0b3J5LmZpbmRCeUlkKHBlcnNvbklkKS5nZXQoKS5nZXRVc2VyVHlwZSgpLmdldElkKCk7XG4gICAgICAgIH1cbiAgICAgICAgTGlzdDxNZW51SW5mbz4gbUxpc3QgPSBtZW51SW5mb1JlcG9zaXRvcnkuZmluZEJ5VXNlclR5cGVJZHModXNlclR5cGVJZCArIFwiXCIpO1xuICAgICAgICBNYXA8U3RyaW5nLCBPYmplY3Q+IG07XG4gICAgICAgIExpc3Q8TWFwPFN0cmluZywgT2JqZWN0Pj4gc0xpc3Q7XG4gICAgICAgIGZvciAoTWVudUluZm8gaW5mbyA6IG1MaXN0KSB7XG4gICAgICAgICAgICBtID0gbmV3IEhhc2hNYXA8PigpO1xuICAgICAgICAgICAgbS5wdXQoXCJpZFwiLCBpbmZvLmdldElkKCkpO1xuICAgICAgICAgICAgbS5wdXQoXCJuYW1lXCIsIGluZm8uZ2V0TmFtZSgpKTtcbiAgICAgICAgICAgIG0ucHV0KFwidGl0bGVcIiwgaW5mby5nZXRUaXRsZSgpKTtcbiAgICAgICAgICAgIHNMaXN0ID0gZ2V0TWVudUxpc3QodXNlclR5cGVJZCwgaW5mby5nZXRJZCgpKTtcbiAgICAgICAgICAgIG0ucHV0KFwic0xpc3RcIiwgc0xpc3QpO1xuICAgICAgICAgICAgZGF0YUxpc3QuYWRkKG0pO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBDb21tb25NZXRob2QuZ2V0UmV0dXJuRGF0YShkYXRhTGlzdCk7XG4gICAgfVxuXG5cbiAgICBwdWJsaWMgT3B0aW9uSXRlbUxpc3QgZ2V0Um9sZU9wdGlvbkl0ZW1MaXN0KEBWYWxpZCBAUmVxdWVzdEJvZHkgRGF0YVJlcXVlc3QgZGF0YVJlcXVlc3QpIHtcbiAgICAgICAgTGlzdDxVc2VyVHlwZT4gdUxpc3QgPSB1c2VyVHlwZVJlcG9zaXRvcnkuZmluZEFsbCgpO1xuICAgICAgICBMaXN0PE9wdGlvbkl0ZW0+IGl0ZW1MaXN0ID0gbmV3IEFycmF5TGlzdDw+KCk7XG4gICAgICAgIGZvciAoVXNlclR5cGUgdXQgOiB1TGlzdCkge1xuICAgICAgICAgICAgaXRlbUxpc3QuYWRkKG5ldyBPcHRpb25JdGVtKHV0LmdldElkKCksIG51bGwsIHV0LmdldE5hbWUoKS5uYW1lKCkpKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbmV3IE9wdGlvbkl0ZW1MaXN0KDAsIGl0ZW1MaXN0KTtcbiAgICB9XG5cblxuICAgIHB1YmxpYyBEYXRhUmVzcG9uc2UgbWVudURlbGV0ZShEYXRhUmVxdWVzdCBkYXRhUmVxdWVzdCkge1xuICAgICAgICBJbnRlZ2VyIGlkID0gZGF0YVJlcXVlc3QuZ2V0SW50ZWdlcihcImlkXCIpO1xuICAgICAgICBpbnQgY291bnQgID0gbWVudUluZm9SZXBvc2l0b3J5LmNvdW50TWVudUluZm9CeVBpZChpZCk7XG4gICAgICAgIGlmKGNvdW50ID4gMCkge1xuICAgICAgICAgICAgcmV0dXJuIENvbW1vbk1ldGhvZC5nZXRSZXR1cm5NZXNzYWdlRXJyb3IoXCLlrZjlnKjlrZDoj5zljZXvvIzkuI3og73liKDpmaTvvIFcIik7XG4gICAgICAgIH1cbiAgICAgICAgT3B0aW9uYWw8TWVudUluZm8+IG9wID0gbWVudUluZm9SZXBvc2l0b3J5LmZpbmRCeUlkKGlkKTtcbiAgICAgICAgb3AuaWZQcmVzZW50KG1lbnVJbmZvUmVwb3NpdG9yeTo6ZGVsZXRlKTtcbiAgICAgICAgcmV0dXJuIENvbW1vbk1ldGhvZC5nZXRSZXR1cm5NZXNzYWdlT0soKTtcbiAgICB9XG4uLi5cbiAgICAgICAgaWYgKG0gPT0gbnVsbClcbiAgICAgICAgICAgIG0gPSBuZXcgTWVudUluZm8oKTtcbiAgICAgICAgbS5zZXRJZChpZCk7XG4gICAgICAgIG0uc2V0VGl0bGUodGl0bGUpO1xuICAgICAgICBtLnNldE5hbWUobmFtZSk7XG4gICAgICAgIG0uc2V0UGlkKHBpZCk7XG4gICAgICAgIG0uc2V0VXNlclR5cGVJZHModXNlclR5cGVJZHMpO1xuICAgICAgICBtZW51SW5mb1JlcG9zaXRvcnkuc2F2ZShtKTtcbiAgICAgICAgcmV0dXJuIENvbW1vbk1ldGhvZC5nZXRSZXR1cm5NZXNzYWdlT0soKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgRGF0YVJlc3BvbnNlIGRlbGV0ZURpY3Rpb25hcnkoRGF0YVJlcXVlc3QgZGF0YVJlcXVlc3QpIHtcbiAgICAgICAgSW50ZWdlciBpZCA9IGRhdGFSZXF1ZXN0LmdldEludGVnZXIoXCJpZFwiKTtcbiAgICAgICAgaW50IGNvdW50ID0gZGljdGlvbmFyeUluZm9SZXBvc2l0b3J5LmNvdW50RGljdGlvbmFyeUluZm9CeVBpZChpZCk7XG4gICAgICAgIGlmKGNvdW50ID4gMCkge1xuICAgICAgICAgICAgcmV0dXJuIENvbW1vbk1ldGhvZC5nZXRSZXR1cm5NZXNzYWdlRXJyb3IoXCLlrZjlnKjmlbDmja7pobnvvIzkuI3og73liKDpmaTvvIFcIik7XG4gICAgICAgIH1cbiAgICAgICAgT3B0aW9uYWw8RGljdGlvbmFyeUluZm8+IG9wID0gZGljdGlvbmFyeUluZm9SZXBvc2l0b3J5LmZpbmRCeUlkKGlkKTtcbiAgICAgICAgb3AuaWZQcmVzZW50KGRpY3Rpb25hcnlJbmZvUmVwb3NpdG9yeTo6ZGVsZXRlKTtcbiAgICAgICAgcmV0dXJuIENvbW1vbk1ldGhvZC5nZXRSZXR1cm5NZXNzYWdlT0soKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgRGF0YVJlc3BvbnNlIGRpY3Rpb25hcnlTYXZlKERhdGFSZXF1ZXN0IGRhdGFSZXF1ZXN0KSB7XG4gICAgICAgIEludGVnZXIgaWQgPSBkYXRhUmVxdWVzdC5nZXRJbnRlZ2VyKFwiaWRcIik7XG4gICAgICAgIEludGVnZXIgcGlkID0gZGF0YVJlcXVlc3QuZ2V0SW50ZWdlcihcInBpZFwiKTtcbiAgICAgICAgU3RyaW5nIHZhbHVlID0gZGF0YVJlcXVlc3QuZ2V0U3RyaW5nKFwidmFsdWVcIik7XG4gICAgICAgIFN0cmluZyB0aXRsZSA9IGRhdGFSZXF1ZXN0LmdldFN0cmluZyhcInRpdGxlXCIpO1xuICAgICAgICBEaWN0aW9uYXJ5SW5mbyBtID0gbnVsbDtcbiAgICAgICAgaWYoaWQgIT0gbnVsbCkge1xuICAgICAgICAgICAgT3B0aW9uYWw8RGljdGlvbmFyeUluZm8+IG9wID0gZGljdGlvbmFyeUluZm9SZXBvc2l0b3J5LmZpbmRCeUlkKGlkKTtcbiAgICAgICAgICAgIGlmIChvcC5pc1ByZXNlbnQoKSkge1xuICAgICAgICAgICAgICAgIG0gPSBvcC5nZXQoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZihtID09IG51bGwpIHtcbiAgICAgICAgICAgIG0gPSBuZXcgRGljdGlvbmFyeUluZm8oKTtcbiAgICAgICAgICAgIG0uc2V0UGlkKHBpZCk7XG4gICAgICAgIH1cbiAgICAgICAgbS5zZXRMYWJlbCh0aXRsZSk7XG4gICAgICAgIG0uc2V0VmFsdWUodmFsdWUpO1xuICAgICAgICBkaWN0aW9uYXJ5SW5mb1JlcG9zaXRvcnkuc2F2ZShtKTtcbiAgICAgICAgcmV0dXJuIENvbW1vbk1ldGhvZC5nZXRSZXR1cm5NZXNzYWdlT0soKTtcbiAgICB9XG4uLi5cblBhdGg6IHNyYy9tYWluL2phdmEvY29tL3RlYWNoL2phdmFmeC9yZXF1ZXN0L09wdGlvbkl0ZW0uamF2YVxuLi4uXG5cbi8qKlxuICogT3B0aW9uSXRlbSDpgInpobnmlbDmja7nsbtcbiAqIEludGVnZXIgaWQgIOaVsOaNrumhuWlkXG4gKiBTdHJpbmcgdmFsdWUg5pWw5o2u6aG55YC8XG4gKiBTdHJpbmcgbGFiZWwg5pWw5o2u5YC85qCH6aKYXG4gKi9cbnB1YmxpYyBjbGFzcyBPcHRpb25JdGVtIHtcbiAgICBwcml2YXRlIEludGVnZXIgaWQ7XG4gICAgcHJpdmF0ZSBTdHJpbmcgdmFsdWU7XG4gICAgcHJpdmF0ZSBTdHJpbmcgdGl0bGU7XG5cbiAgICBwdWJsaWMgT3B0aW9uSXRlbSgpe1xuXG4gICAgfVxuICAgIHB1YmxpYyBPcHRpb25JdGVtKEludGVnZXIgaWQsIFN0cmluZyB2YWx1ZSwgU3RyaW5nIHRpdGxlKXtcbiAgICAgICAgdGhpcy5pZCA9IGlkO1xuICAgICAgICB0aGlzLnZhbHVlID0gdmFsdWU7XG4gICAgICAgIHRoaXMudGl0bGUgPSB0aXRsZTtcbiAgICB9XG4gICAgcHVibGljIE9wdGlvbkl0ZW0oTWFwPFN0cmluZyxPYmplY3Q+IG1hcCl7XG4gICAgICAgIHRoaXMuaWQgPSBDb21tb25NZXRob2QuZ2V0SW50ZWdlcihtYXAsXCJpZFwiKTtcbiAgICAgICAgdGhpcy52YWx1ZSA9IENvbW1vbk1ldGhvZC5nZXRTdHJpbmcobWFwLFwidmFsdWVcIik7XG4gICAgICAgIHRoaXMudGl0bGUgPSBDb21tb25NZXRob2QuZ2V0U3RyaW5nKG1hcCxcInRpdGxlXCIpO1xuICAgIH1cbiAgICBwdWJsaWMgSW50ZWdlciBnZXRJZCgpIHtcbiAgICAgICAgcmV0dXJuIGlkO1xuICAgIH1cblxuICAgIHB1YmxpYyB2b2lkIHNldElkKEludGVnZXIgaWQpIHtcbiAgICAgICAgdGhpcy5pZCA9IGlkO1xuICAgIH1cblxuICAgIHB1YmxpYyBTdHJpbmcgZ2V0VmFsdWUoKSB7XG4gICAgICAgIHJldHVybiB2YWx1ZTtcbiAgICB9XG5cbiAgICBwdWJsaWMgdm9pZCBzZXRWYWx1ZShTdHJpbmcgdmFsdWUpIHtcbiAgICAgICAgdGhpcy52YWx1ZSA9IHZhbHVlO1xuICAgIH1cblxuICAgIHB1YmxpYyBTdHJpbmcgZ2V0VGl0bGUoKSB7XG4gICAgICAgIHJldHVybiB0aXRsZTtcbiAgICB9XG4uLi5cblBhdGg6IHNyYy9tYWluL2phdmEvY24vZWR1L3NkdS9qYXZhL3NlcnZlci9zZXJ2aWNlcy9TdHVkZW50U2VydmljZS5qYXZhXG4uLi5cblxuXG4gICAgcHVibGljIERhdGFSZXNwb25zZSBnZXRTdHVkZW50SW5mbyhEYXRhUmVxdWVzdCBkYXRhUmVxdWVzdCkge1xuICAgICAgICBJbnRlZ2VyIHBlcnNvbklkID0gZGF0YVJlcXVlc3QuZ2V0SW50ZWdlcihcInBlcnNvbklkXCIpO1xuICAgICAgICBTdHVkZW50IHMgPSBudWxsO1xuICAgICAgICBPcHRpb25hbDxTdHVkZW50PiBvcDtcbiAgICAgICAgaWYgKHBlcnNvbklkICE9IG51bGwpIHtcbiAgICAgICAgICAgIG9wID0gc3R1ZGVudFJlcG9zaXRvcnkuZmluZEJ5SWQocGVyc29uSWQpOyAvL+agueaNruWtpueUn+S4u+mUruS7juaVsOaNruW6k+afpeivouWtpueUn+eahOS/oeaBr1xuICAgICAgICAgICAgaWYgKG9wLmlzUHJlc2VudCgpKSB7XG4gICAgICAgICAgICAgICAgcyA9IG9wLmdldCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBDb21tb25NZXRob2QuZ2V0UmV0dXJuRGF0YShnZXRNYXBGcm9tU3R1ZGVudChzKSk7IC8v6L+Z6YeM5Zue5Lyg5YyF5ZCr5a2m55Sf5L+h5oGv55qETWFw5a+56LGhXG4gICAgfVxuLi4uXG5QYXRoOiBqYXZhLXNlcnZlci9zcmMvbWFpbi9qYXZhL2NuL2VkdS9zZHUvamF2YS9zZXJ2ZXIvc2VydmljZXMvVGVhY2hlclNlcnZpY2VzLmphdmFcbi4uLlxuXG4gICAgcHVibGljIERhdGFSZXNwb25zZSBnZXRUZWFjaGVySW5mbyhEYXRhUmVxdWVzdCBkYXRhUmVxdWVzdCkge1xuICAgICAgICBJbnRlZ2VyIHBlcnNvbklkID0gZGF0YVJlcXVlc3QuZ2V0SW50ZWdlcihcInBlcnNvbklkXCIpO1xuICAgICAgICBUZWFjaGVyIHMgPSBudWxsO1xuICAgICAgICBPcHRpb25hbDxUZWFjaGVyPiBvcDtcbiAgICAgICAgaWYgKHBlcnNvbklkICE9IG51bGwpIHtcbiAgICAgICAgICAgIG9wID0gdGVhY2hlclJlcG9zaXRvcnkuZmluZEJ5SWQocGVyc29uSWQpOyAvL+agueaNruWtpueUn+S4u+mUruS7juaVsOaNruW6k+afpeivouWtpueUn+eahOS/oeaBr1xuICAgICAgICAgICAgaWYgKG9wLmlzUHJlc2VudCgpKSB7XG4gICAgICAgICAgICAgICAgcyA9IG9wLmdldCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBDb21tb25NZXRob2QuZ2V0UmV0dXJuRGF0YShnZXRNYXBGcm9tVGVhY2hlcihzKSk7IC8v6L+Z6YeM5Zue5Lyg5YyF5ZCr5a2m55Sf5L+h5oGv55qETWFw5a+56LGhXG4gICAgfVxuLi4uXG5QYXRoOiBzcmMvbWFpbi9qYXZhL2NuL2VkdS9zZHUvamF2YS9zZXJ2ZXIvc2VydmljZXMvVGVhY2hlclNlcnZpY2VzLmphdmFcbi4uLlxuICAgIHB1YmxpYyBEYXRhUmVzcG9uc2UgZ2V0VGVhY2hlckluZm8oRGF0YVJlcXVlc3QgZGF0YVJlcXVlc3QpIHtcbiAgICAgICAgSW50ZWdlciBwZXJzb25JZCA9IGRhdGFSZXF1ZXN0LmdldEludGVnZXIoXCJwZXJzb25JZFwiKTtcbiAgICAgICAgVGVhY2hlciBzID0gbnVsbDtcbiAgICAgICAgT3B0aW9uYWw8VGVhY2hlcj4gb3A7XG4gICAgICAgIGlmIChwZXJzb25JZCAhPSBudWxsKSB7XG4gICAgICAgICAgICBvcCA9IHRlYWNoZXJSZXBvc2l0b3J5LmZpbmRCeUlkKHBlcnNvbklkKTsgLy/moLnmja7lrabnlJ/kuLvplK7ku47mlbDmja7lupPmn6Xor6LlrabnlJ/nmoTkv6Hmga9cbiAgICAgICAgICAgIGlmIChvcC5pc1ByZXNlbnQoKSkge1xuICAgICAgICAgICAgICAgIHMgPSBvcC5nZXQoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gQ29tbW9uTWV0aG9kLmdldFJldHVybkRhdGEoZ2V0TWFwRnJvbVRlYWNoZXIocykpOyAvL+i/memHjOWbnuS8oOWMheWQq+WtpueUn+S/oeaBr+eahE1hcOWvueixoVxuICAgIH1cbi4uLlxuUGF0aDogc3JjL21haW4vamF2YS9jb20vdGVhY2gvamF2YWZ4L3JlcXVlc3QvTXlUcmVlTm9kZS5qYXZhXG4uLi5cblxuICAgIHB1YmxpYyBNeVRyZWVOb2RlKE1hcDxTdHJpbmcsT2JqZWN0PiBtYXApe1xuICAgICAgICB0aGlzLmlkICA9IENvbW1vbk1ldGhvZC5nZXRJbnRlZ2VyKG1hcCxcImlkXCIpO1xuICAgICAgICB0aGlzLnZhbHVlID0gQ29tbW9uTWV0aG9kLmdldFN0cmluZyhtYXAsXCJ2YWx1ZVwiKTtcbiAgICAgICAgdGhpcy5sYWJlbCA9IENvbW1vbk1ldGhvZC5nZXRTdHJpbmcobWFwLFwibGFiZWxcIik7XG4gICAgICAgIHRoaXMudGl0bGUgPSBDb21tb25NZXRob2QuZ2V0U3RyaW5nKG1hcCxcInRpdGxlXCIpO1xuICAgICAgICB0aGlzLmlzTGVhZiA9IENvbW1vbk1ldGhvZC5nZXRJbnRlZ2VyKG1hcCxcImlzTGVhZlwiKTtcbiAgICAgICAgdGhpcy5waWQgPSBDb21tb25NZXRob2QuZ2V0SW50ZWdlcihtYXAsXCJwaWRcIik7XG4gICAgICAgIHRoaXMudXNlclR5cGVJZHMgPSBDb21tb25NZXRob2QuZ2V0U3RyaW5nKG1hcCxcInVzZXJUeXBlSWRzXCIpO1xuICAgICAgICB0aGlzLnBhcmVudFRpdGxlID0gQ29tbW9uTWV0aG9kLmdldFN0cmluZyhtYXAsXCJwYXJlbnRUaXRsZVwiKTtcbiAgICAgICAgdGhpcy5jaGlsZHJlbj0gbmV3IEFycmF5TGlzdDxNeVRyZWVOb2RlPigpO1xuICAgICAgICBMaXN0PD8+IGNoaWxkcmVuID0gQ29tbW9uTWV0aG9kLmdldExpc3QobWFwLFwiY2hpbGRyZW5cIik7XG4gLi4uIiwiaXNFcnJvciI6ZmFsc2UsInJlcXVlc3RJZCI6IiJ9fSwiYjc5MmIzZWEtMTk2Yy00MDYyLTk0ZWUtZmQ4MzY5ZDcwOTQ4O3Rvb2x1X3ZydHhfMDFDQ3ZHWk1aQ1JKU1k2MjVwNXlBbnpnIjp7InJlcXVlc3RJZCI6ImI3OTJiM2VhLTE5NmMtNDA2Mi05NGVlLWZkODM2OWQ3MDk0OCIsInRvb2xVc2VJZCI6InRvb2x1X3ZydHhfMDFDQ3ZHWk1aQ1JKU1k2MjVwNXlBbnpnIiwicGhhc2UiOjUsInJlc3VsdCI6eyJ0ZXh0IjoiVGhlIGZvbGxvd2luZyBjb2RlIHNlY3Rpb25zIHdlcmUgcmV0cmlldmVkOlxuUGF0aDogc3JjL21haW4vamF2YS9jbi9lZHUvc2R1L2phdmEvc2VydmVyL21vZGVscy9GYW1pbHlNZW1iZXIuamF2YVxucGFja2FnZSBjbi5lZHUuc2R1LmphdmEuc2VydmVyLm1vZGVscztcblxuaW1wb3J0IGpha2FydGEucGVyc2lzdGVuY2UuKjtcbmltcG9ydCBqYWthcnRhLnZhbGlkYXRpb24uY29uc3RyYWludHMuU2l6ZTtcbmltcG9ydCBsb21ib2suR2V0dGVyO1xuaW1wb3J0IGxvbWJvay5TZXR0ZXI7XG5AR2V0dGVyXG5AU2V0dGVyXG5ARW50aXR5XG5AVGFibGUoXHRuYW1lID0gXCJmYW1pbHlfbWVtYmVyXCIsXG4gICAgICAgIHVuaXF1ZUNvbnN0cmFpbnRzID0ge1xuICAgICAgICB9KVxucHVibGljIGNsYXNzIEZhbWlseU1lbWJlciB7XG4gICAgQElkXG4gICAgQEdlbmVyYXRlZFZhbHVlKHN0cmF0ZWd5ID0gR2VuZXJhdGlvblR5cGUuSURFTlRJVFkpXG4gICAgcHJpdmF0ZSBJbnRlZ2VyIG1lbWJlcklkO1xuXG4gICAgQE1hbnlUb09uZVxuICAgIEBKb2luQ29sdW1uKG5hbWU9XCJwZXJzb25JZFwiKVxuICAgIHByaXZhdGUgU3R1ZGVudCBzdHVkZW50O1xuICAgIEBTaXplKG1heD0xMClcbiAgICBwcml2YXRlIFN0cmluZyByZWxhdGlvbjtcbiAgICBAU2l6ZShtYXg9MzApXG4gICAgcHJpdmF0ZSBTdHJpbmcgbmFtZTtcbiAgICBAU2l6ZShtYXg9MTApXG4gICAgcHJpdmF0ZSBTdHJpbmcgZ2VuZGVyO1xuICAgIHByaXZhdGUgSW50ZWdlciBhZ2U7XG4gICAgQFNpemUobWF4PTUwKVxuICAgIHByaXZhdGUgU3RyaW5nIHVuaXQ7XG5cbn1cbi4uLlxuUGF0aDogamF2YS1zZXJ2ZXIvc3JjL21haW4vamF2YS9jbi9lZHUvc2R1L2phdmEvc2VydmVyL21vZGVscy9GYW1pbHlNZW1iZXIuamF2YVxucGFja2FnZSBjbi5lZHUuc2R1LmphdmEuc2VydmVyLm1vZGVscztcblxuaW1wb3J0IGpha2FydGEucGVyc2lzdGVuY2UuKjtcbmltcG9ydCBqYWthcnRhLnZhbGlkYXRpb24uY29uc3RyYWludHMuU2l6ZTtcbmltcG9ydCBsb21ib2suR2V0dGVyO1xuaW1wb3J0IGxvbWJvay5TZXR0ZXI7XG5AR2V0dGVyXG5AU2V0dGVyXG5ARW50aXR5XG5AVGFibGUoXHRuYW1lID0gXCJmYW1pbHlfbWVtYmVyXCIsXG4gICAgICAgIHVuaXF1ZUNvbnN0cmFpbnRzID0ge1xuICAgICAgICB9KVxucHVibGljIGNsYXNzIEZhbWlseU1lbWJlciB7XG4gICAgQElkXG4gICAgQEdlbmVyYXRlZFZhbHVlKHN0cmF0ZWd5ID0gR2VuZXJhdGlvblR5cGUuSURFTlRJVFkpXG4gICAgcHJpdmF0ZSBJbnRlZ2VyIG1lbWJlcklkO1xuXG4gICAgQE1hbnlUb09uZVxuICAgIEBKb2luQ29sdW1uKG5hbWU9XCJwZXJzb25JZFwiKVxuICAgIHByaXZhdGUgU3R1ZGVudCBzdHVkZW50O1xuICAgIEBTaXplKG1heD0xMClcbiAgICBwcml2YXRlIFN0cmluZyByZWxhdGlvbjtcbiAgICBAU2l6ZShtYXg9MzApXG4gICAgcHJpdmF0ZSBTdHJpbmcgbmFtZTtcbiAgICBAU2l6ZShtYXg9MTApXG4gICAgcHJpdmF0ZSBTdHJpbmcgZ2VuZGVyO1xuICAgIHByaXZhdGUgSW50ZWdlciBhZ2U7XG4gICAgQFNpemUobWF4PTUwKVxuICAgIHByaXZhdGUgU3RyaW5nIHVuaXQ7XG5cbiAgICBwdWJsaWMgdm9pZCBzZXRUZWFjaGVyKE9iamVjdCBvKSB7XG4gICAgfVxufVxuLi4uXG5QYXRoOiBzcmMvbWFpbi9qYXZhL2NuL2VkdS9zZHUvamF2YS9zZXJ2ZXIvcmVwb3NpdG9yeXMvRmFtaWx5TWVtYmVyUmVwb3NpdG9yeS5qYXZhXG5wYWNrYWdlIGNuLmVkdS5zZHUuamF2YS5zZXJ2ZXIucmVwb3NpdG9yeXM7XG5cbmltcG9ydCBjbi5lZHUuc2R1LmphdmEuc2VydmVyLm1vZGVscy5GYW1pbHlNZW1iZXI7XG5pbXBvcnQgb3JnLnNwcmluZ2ZyYW1ld29yay5kYXRhLmpwYS5yZXBvc2l0b3J5LkpwYVJlcG9zaXRvcnk7XG5cbmltcG9ydCBqYXZhLnV0aWwuTGlzdDtcblxucHVibGljIGludGVyZmFjZSBGYW1pbHlNZW1iZXJSZXBvc2l0b3J5IGV4dGVuZHMgSnBhUmVwb3NpdG9yeTxGYW1pbHlNZW1iZXIsSW50ZWdlcj4ge1xuICAgIExpc3Q8RmFtaWx5TWVtYmVyPiBmaW5kQnlTdHVkZW50UGVyc29uSWQoSW50ZWdlciBwZXJzb25JZCk7XG59XG4uLi5cblBhdGg6IHNyYy9tYWluL2phdmEvY24vZWR1L3NkdS9qYXZhL3NlcnZlci9tb2RlbHMvUGVyc29uLmphdmFcbnBhY2thZ2UgY24uZWR1LnNkdS5qYXZhLnNlcnZlci5tb2RlbHM7XG5cblxuXG5pbXBvcnQgamFrYXJ0YS5wZXJzaXN0ZW5jZS4qO1xuaW1wb3J0IGpha2FydGEudmFsaWRhdGlvbi5jb25zdHJhaW50cy5FbWFpbDtcbmltcG9ydCBqYWthcnRhLnZhbGlkYXRpb24uY29uc3RyYWludHMuTm90Qmxhbms7XG5pbXBvcnQgamFrYXJ0YS52YWxpZGF0aW9uLmNvbnN0cmFpbnRzLlNpemU7XG5cblxuLypcbiAqIFBlcnNvbuS6uuWRmOihqOWunuS9k+exuyDkv53lrZjkurrlkZjnmoTln7rmnKzkv6Hmga/kv6Hmga/vvIwg6LSm5oi344CB5a2m55Sf5ZKM5pWZ5biI6YO95YWz6IGU5Lq65ZGY77yMXG4gKiBJbnRlZ2VyIHBlcnNvbklkIOS6uuWRmOihqCBwZXJzb24g5Li76ZSuIHBlcnNvbl9pZFxuICogU3RyaW5nIG51bSDkurrlkZjnvJblj7dcbiAqIFN0cmluZyBuYW1lIOS6uuWRmOWQjeensFxuICogU3RyaW5nIHR5cGUg5Lq65ZGY57G75Z6LICAw566h55CG5ZGYIDHlrabnlJ8gMuaVmeW4iFxuICogU3RyaW5nIGRlcHQg5a2m6ZmiXG4gKiBTdHJpbmcgY2FyZCDouqvku73or4Hlj7dcbiAqIFN0cmluZyBnZW5kZXIg5oCn5YirICAxIOeUtyAyIOWls1xuICogU3RyaW5nIGJpcnRoZGF5IOWHuueUn+aXpeacn1xuICogU3RyaW5nIGVtYWlsIOmCrueusVxuICogU3RyaW5nIHBob25lIOeUteivnVxuICogU3RyaW5nIGFkZHJlc3Mg5Zyw5Z2AXG4gKiBTdHJpbmcgaW50cm9kdWNlIOS4quS6uueugOS7i1xuICovXG5pbXBvcnQgbG9tYm9rLkdldHRlcjtcbmltcG9ydCBsb21ib2suU2V0dGVyO1xuQEdldHRlclxuQFNldHRlclxuQEVudGl0eVxuQFRhYmxlKFx0bmFtZSA9IFwicGVyc29uXCIsXG4gICAgICAgIHVuaXF1ZUNvbnN0cmFpbnRzID0ge1xuICAgICAgICAgICAgICAgIEBVbmlxdWVDb25zdHJhaW50KGNvbHVtbk5hbWVzID0gXCJudW1cIiksICAgLy/kurrlkZjooajkuK3nmoTnvJblj7cg5ZSv5LiAXG4gICAgICAgIH0pXG5wdWJsaWMgY2xhc3MgUGVyc29uIHtcbiAgICBASWRcbiAgICBAR2VuZXJhdGVkVmFsdWUoc3RyYXRlZ3kgPSBHZW5lcmF0aW9uVHlwZS5JREVOVElUWSlcbiAgICBwcml2YXRlIEludGVnZXIgcGVyc29uSWQ7XG5cbiAgICBATm90QmxhbmsgICAgLy8g5a2X5q616Z2e56m6XG4gICAgQFNpemUobWF4ID0gMjApICAgLy/lrZfmrrXplb/luqbmnIDplb/kuLoyMFxuICAgIHByaXZhdGUgU3RyaW5nIG51bTtcblxuICAgIEBTaXplKG1heCA9IDUwKVxuICAgIHByaXZhdGUgU3RyaW5nIG5hbWU7XG5cbiAgICBAU2l6ZShtYXggPSAyKVxuICAgIHByaXZhdGUgU3RyaW5nIHR5cGU7XG4uLi5cblBhdGg6IHNyYy9tYWluL2phdmEvY24vZWR1L3NkdS9qYXZhL3NlcnZlci9tb2RlbHMvVGVhY2hlci5qYXZhXG5wYWNrYWdlIGNuLmVkdS5zZHUuamF2YS5zZXJ2ZXIubW9kZWxzO1xuXG5pbXBvcnQgY29tLmZhc3RlcnhtbC5qYWNrc29uLmFubm90YXRpb24uSnNvbklnbm9yZTtcbmltcG9ydCBqYWthcnRhLnBlcnNpc3RlbmNlLio7XG5pbXBvcnQgamFrYXJ0YS52YWxpZGF0aW9uLmNvbnN0cmFpbnRzLlNpemU7XG5pbXBvcnQgbG9tYm9rLkdldHRlcjtcbmltcG9ydCBsb21ib2suU2V0dGVyO1xuXG5pbXBvcnQgamF2YS51dGlsLkRhdGU7XG5cbkBHZXR0ZXJcbiAgICBAU2V0dGVyXG4gICAgQEVudGl0eVxuICAgIEBUYWJsZShcdG5hbWUgPSBcInRlYWNoZXJcIixcbiAgICAgICAgICAgIHVuaXF1ZUNvbnN0cmFpbnRzID0ge1xuICAgICAgICAgICAgfSlcbiAgICBwdWJsaWMgY2xhc3MgVGVhY2hlciB7XG4gICAgICAgIEBJZFxuICAgICAgICBwcml2YXRlIEludGVnZXIgcGVyc29uSWQ7XG5cbiAgICAgICAgQE9uZVRvT25lXG4gICAgICAgIEBKb2luQ29sdW1uKG5hbWU9XCJwZXJzb25JZFwiKVxuICAgICAgICBASnNvbklnbm9yZVxuICAgICAgICBwcml2YXRlIFBlcnNvbiBwZXJzb247XG4gICAgICAgIEBTaXplKG1heD01MClcbiAgICAgICAgcHJpdmF0ZSBTdHJpbmcgdGl0bGU7XG4gICAgICAgIEBTaXplKG1heD0zMClcbiAgICAgICAgcHJpdmF0ZSBTdHJpbmcgZGVncmVlO1xuICAgICAgICBwcml2YXRlIERhdGUgZW50ZXJUaW1lO1xuICAgICAgICBwcml2YXRlIEludGVnZXIgc3R1ZGVudE51bTtcbiAgICAgICAgQFNpemUobWF4ID0gNTApXG4gICAgICAgIHByaXZhdGUgU3RyaW5nIGNsYXNzTmFtZTtcblxuXG59XG5cblxuXG5cblxuLi4uXG5QYXRoOiBqYXZhLXNlcnZlci9zcmMvbWFpbi9qYXZhL2NuL2VkdS9zZHUvamF2YS9zZXJ2ZXIvbW9kZWxzL1RlYWNoZXIuamF2YVxucGFja2FnZSBjbi5lZHUuc2R1LmphdmEuc2VydmVyLm1vZGVscztcblxuaW1wb3J0IGNvbS5mYXN0ZXJ4bWwuamFja3Nvbi5hbm5vdGF0aW9uLkpzb25JZ25vcmU7XG5pbXBvcnQgamFrYXJ0YS5wZXJzaXN0ZW5jZS4qO1xuaW1wb3J0IGpha2FydGEudmFsaWRhdGlvbi5jb25zdHJhaW50cy5TaXplO1xuaW1wb3J0IGxvbWJvay5HZXR0ZXI7XG5pbXBvcnQgbG9tYm9rLlNldHRlcjtcblxuaW1wb3J0IGphdmEudXRpbC5EYXRlO1xuXG4vKipcbiAqIFRlYWNoZXLmlZnluIjooajlrp7kvZPnsbsg5L+d5a2Y5q+P5Liq5pWZ5biI55qE5L+h5oGv77yMXG4gKiBJbnRlZ2VyIHBlcnNvbklkIOaVmeW4iOihqCB0ZWFjaGVyIOS4u+mUriBwZXJzb25faWQg5LiOUGVyc29u6KGo5Li76ZSu55u45ZCMXG4gKiBQZXJzb24gcGVyc29uIOWFs+iBlOWIsOivpeeUqOaIt+aJgOeUqOeahFBlcnNvbuWvueixoe+8jOi0puaIt+aJgOWvueW6lOeahOS6uuWRmOS/oeaBryBwZXJzb25faWQg5YWz6IGUIHBlcnNvbiDooajkuLvplK4gcGVyc29uX2lkXG4gKiBTdHJpbmcgdGl0bGUg6IGM56ewXG4gKiBTdHJpbmcgZGVncmVlIOWtpuS9jVxuICogRGF0ZSBlbnRlclRpbWUg5YWl6IGM5pe26Ze0XG4gKiBJbnRlZ2VyIHN0dWRlbnROdW0g5a2m55Sf5pWw6YePXG4gKiBTdHJpbmcgY2xhc3NOYW1lIOePree6p+WQjeensFxuICovXG5AR2V0dGVyXG5AU2V0dGVyXG5ARW50aXR5XG5AVGFibGUobmFtZSA9IFwidGVhY2hlclwiLFxuICAgICAgICB1bmlxdWVDb25zdHJhaW50cyA9IHtcbiAgICAgICAgfSlcbnB1YmxpYyBjbGFzcyBUZWFjaGVyIHtcbiAgICAvKipcbiAgICAgKiDmlZnluIhJRO+8jOS4jlBlcnNvbuihqOeahHBlcnNvbklk55u45ZCMXG4gICAgICovXG4gICAgQElkXG4gICAgcHJpdmF0ZSBJbnRlZ2VyIHBlcnNvbklkO1xuXG4gICAgLyoqXG4gICAgICog5YWz6IGU55qEUGVyc29u5a+56LGh77yM5YyF5ZCr5Z+65pys5Lq65ZGY5L+h5oGvXG4gICAgICovXG4gICAgQE9uZVRvT25lXG4gICAgQEpvaW5Db2x1bW4obmFtZT1cInBlcnNvbklkXCIpXG4gICAgQEpzb25JZ25vcmVcbiAgICBwcml2YXRlIFBlcnNvbiBwZXJzb247XG5cbiAgICAvKipcbiAgICAgKiDogYznp7DvvIzlpoLmlZnmjojjgIHlia/mlZnmjojjgIHorrLluIjnrYlcbiAgICAgKi9cbiAgICBAU2l6ZShtYXg9NTApXG4gICAgcHJpdmF0ZSBTdHJpbmcgdGl0bGU7XG5cbiAgICAvKipcbiAgICAgKiDlrabkvY3vvIzlpoLlrablo6vjgIHnoZXlo6vjgIHljZrlo6vnrYlcbiAgICAgKi9cbiAgICBAU2l6ZShtYXg9MzApXG4gICAgcHJpdmF0ZSBTdHJpbmcgZGVncmVlO1xuXG4gICAgLyoqXG4gICAgICog5YWl6IGM5pe26Ze0XG4gICAgICovXG4gICAgcHJpdmF0ZSBEYXRlIGVudGVyVGltZTtcblxuICAgIC8qKlxuICAgICAqIOaMh+WvvOeahOWtpueUn+aVsOmHj1xuICAgICAqL1xuICAgIHByaXZhdGUgSW50ZWdlciBzdHVkZW50TnVtO1xuLi4uXG5QYXRoOiBzcmMvbWFpbi9qYXZhL2NuL2VkdS9zZHUvamF2YS9zZXJ2ZXIvbW9kZWxzL1VzZXJUeXBlLmphdmFcbnBhY2thZ2UgY24uZWR1LnNkdS5qYXZhLnNlcnZlci5tb2RlbHM7XG5cblxuaW1wb3J0IGpha2FydGEucGVyc2lzdGVuY2UuKjtcblxuLypcbiAqIFVzZXJUeXBl55So5oi357G75Z6L6KGo5a6e5L2T57G7IOS4ieenjeexu+WeiyDnrqHnkIblkZjvvIzlrabnlJ/lkozmlZnluIgg5a+55bqUIOaemuS4vuexu+Wei0VVc2VyVHlwZVxuICogSW50ZWdlciBpZCB1c2VyX3R5cGUg6KGoIOS4u+mUriBpZFxuICogRVVzZXJUeXBlIG5hbSDop5LoibLlkI3np7AgUk9MRV9BRE1JTiwgUk9MRV9TVFVERU5ULFJPTEVfVEVBQ0hFUlxuICovXG5pbXBvcnQgbG9tYm9rLkdldHRlcjtcbmltcG9ydCBsb21ib2suU2V0dGVyO1xuQEdldHRlclxuQFNldHRlclxuQEVudGl0eVxuQFRhYmxlKG5hbWUgPSBcInVzZXJfdHlwZVwiKVxucHVibGljIGNsYXNzIFVzZXJUeXBlIHtcbiAgICBASWRcbiAgICBAR2VuZXJhdGVkVmFsdWUoc3RyYXRlZ3kgPSBHZW5lcmF0aW9uVHlwZS5JREVOVElUWSlcbiAgICBwcml2YXRlIEludGVnZXIgaWQ7XG5cbiAgICBARW51bWVyYXRlZChFbnVtVHlwZS5TVFJJTkcpXG4gICAgQENvbHVtbihsZW5ndGggPSAyMClcbiAgICBwcml2YXRlIEVVc2VyVHlwZSBuYW1lO1xufS4uLlxuUGF0aDogc3JjL21haW4vamF2YS9jbi9lZHUvc2R1L2phdmEvc2VydmVyL3NlcnZpY2VzL1N0dWRlbnRTZXJ2aWNlLmphdmFcbi4uLlxuXG5AU2VydmljZVxucHVibGljIGNsYXNzIFN0dWRlbnRTZXJ2aWNlIHtcbiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBMb2dnZXIgbG9nID0gTG9nZ2VyRmFjdG9yeS5nZXRMb2dnZXIoU3R1ZGVudFNlcnZpY2UuY2xhc3MpO1xuICAgIHByaXZhdGUgZmluYWwgUGVyc29uUmVwb3NpdG9yeSBwZXJzb25SZXBvc2l0b3J5OyAgLy/kurrlkZjmlbDmja7mk43kvZzoh6rliqjms6jlhaVcbiAgICBwcml2YXRlIGZpbmFsIFN0dWRlbnRSZXBvc2l0b3J5IHN0dWRlbnRSZXBvc2l0b3J5OyAgLy/lrabnlJ/mlbDmja7mk43kvZzoh6rliqjms6jlhaVcbiAgICBwcml2YXRlIGZpbmFsIFVzZXJSZXBvc2l0b3J5IHVzZXJSZXBvc2l0b3J5OyAgLy/lrabnlJ/mlbDmja7mk43kvZzoh6rliqjms6jlhaVcbiAgICBwcml2YXRlIGZpbmFsIFVzZXJUeXBlUmVwb3NpdG9yeSB1c2VyVHlwZVJlcG9zaXRvcnk7IC8v55So5oi357G75Z6L5pWw5o2u5pON5L2c6Ieq5Yqo5rOo5YWlXG4gICAgcHJpdmF0ZSBmaW5hbCBQYXNzd29yZEVuY29kZXIgZW5jb2RlcjsgIC8v5a+G56CB5pyN5Yqh6Ieq5Yqo5rOo5YWlXG4gICAgcHJpdmF0ZSBmaW5hbCBGZWVSZXBvc2l0b3J5IGZlZVJlcG9zaXRvcnk7ICAvL+a2iOi0ueaVsOaNruaTjeS9nOiHquWKqOazqOWFpVxuICAgIHByaXZhdGUgZmluYWwgRmFtaWx5TWVtYmVyUmVwb3NpdG9yeSBmYW1pbHlNZW1iZXJSZXBvc2l0b3J5O1xuICAgIHByaXZhdGUgZmluYWwgU3lzdGVtU2VydmljZSBzeXN0ZW1TZXJ2aWNlO1xuLi4uXG5cblxuXG4gICAgLypcbiAgICAgICAgRmFtaWx5TWVtYmVyXG4gICAgICovXG4gICAgcHVibGljIERhdGFSZXNwb25zZSBnZXRGYW1pbHlNZW1iZXJMaXN0KERhdGFSZXF1ZXN0IGRhdGFSZXF1ZXN0KSB7XG4gICAgICAgIEludGVnZXIgcGVyc29uSWQgPSBkYXRhUmVxdWVzdC5nZXRJbnRlZ2VyKFwicGVyc29uSWRcIik7XG4gICAgICAgIExpc3Q8RmFtaWx5TWVtYmVyPiBmTGlzdCA9IGZhbWlseU1lbWJlclJlcG9zaXRvcnkuZmluZEJ5U3R1ZGVudFBlcnNvbklkKHBlcnNvbklkKTtcbiAgICAgICAgTGlzdDxNYXA8U3RyaW5nLE9iamVjdD4+IGRhdGFMaXN0ID0gbmV3IEFycmF5TGlzdDw+KCk7XG4gICAgICAgIE1hcDxTdHJpbmcsT2JqZWN0PiBtO1xuICAgICAgICBpZiAoZkxpc3QgIT0gbnVsbCkge1xuICAgICAgICAgICAgZm9yIChGYW1pbHlNZW1iZXIgZiA6IGZMaXN0KSB7XG4gICAgICAgICAgICAgICAgbSA9IG5ldyBIYXNoTWFwPD4oKTtcbiAgICAgICAgICAgICAgICBtLnB1dChcIm1lbWJlcklkXCIsIGYuZ2V0TWVtYmVySWQoKSk7XG4gICAgICAgICAgICAgICAgbS5wdXQoXCJwZXJzb25JZFwiLCBmLmdldFN0dWRlbnQoKS5nZXRQZXJzb25JZCgpKTtcbiAgICAgICAgICAgICAgICBtLnB1dChcInJlbGF0aW9uXCIsIGYuZ2V0UmVsYXRpb24oKSk7XG4gICAgICAgICAgICAgICAgbS5wdXQoXCJuYW1lXCIsIGYuZ2V0TmFtZSgpKTtcbiAgICAgICAgICAgICAgICBtLnB1dChcImdlbmRlclwiLCBmLmdldEdlbmRlcigpKTtcbiAgICAgICAgICAgICAgICBtLnB1dChcImFnZVwiLCBmLmdldEFnZSgpK1wiXCIpO1xuICAgICAgICAgICAgICAgIG0ucHV0KFwidW5pdFwiLCBmLmdldFVuaXQoKSk7XG4gICAgICAgICAgICAgICAgZGF0YUxpc3QuYWRkKG0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBDb21tb25NZXRob2QuZ2V0UmV0dXJuRGF0YShkYXRhTGlzdCk7XG4gICAgfVxuXG4gICAgcHVibGljIERhdGFSZXNwb25zZSBmYW1pbHlNZW1iZXJTYXZlKERhdGFSZXF1ZXN0IGRhdGFSZXF1ZXN0KSB7XG4gICAgICAgIE1hcDxTdHJpbmcsT2JqZWN0PiBmb3JtID0gZGF0YVJlcXVlc3QuZ2V0TWFwKFwiZm9ybVwiKTtcbiAgICAgICAgSW50ZWdlciBwZXJzb25JZCA9IENvbW1vbk1ldGhvZC5nZXRJbnRlZ2VyKGZvcm0sXCJwZXJzb25JZFwiKTtcbiAgICAgICAgSW50ZWdlciBtZW1iZXJJZCA9IENvbW1vbk1ldGhvZC5nZXRJbnRlZ2VyKGZvcm0sXCJtZW1iZXJJZFwiKTtcbiAgICAgICAgT3B0aW9uYWw8RmFtaWx5TWVtYmVyPiBvcDtcbiAgICAgICAgRmFtaWx5TWVtYmVyIGYgPSBudWxsO1xuICAgICAgICBpZihtZW1iZXJJZCAhPSBudWxsKSB7XG4gICAgICAgICAgICBvcCA9IGZhbWlseU1lbWJlclJlcG9zaXRvcnkuZmluZEJ5SWQobWVtYmVySWQpO1xuICAgICAgICAgICAgaWYob3AuaXNQcmVzZW50KCkpIHtcbiAgICAgICAgICAgICAgICBmID0gb3AuZ2V0KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYoZj09IG51bGwpIHtcbiAgICAgICAgICAgIGYgPSBuZXcgRmFtaWx5TWVtYmVyKCk7XG4gICAgICAgICAgICBhc3NlcnQgcGVyc29uSWQgIT0gbnVsbDtcbiAgICAgICAgICAgIGYuc2V0U3R1ZGVudChzdHVkZW50UmVwb3NpdG9yeS5maW5kQnlJZChwZXJzb25JZCkuZ2V0KCkpO1xuICAgICAgICB9XG4gICAgICAgIGYuc2V0UmVsYXRpb24oQ29tbW9uTWV0aG9kLmdldFN0cmluZyhmb3JtLFwicmVsYXRpb25cIikpO1xuICAgICAgICBmLnNldE5hbWUoQ29tbW9uTWV0aG9kLmdldFN0cmluZyhmb3JtLFwibmFtZVwiKSk7XG4gICAgICAgIGYuc2V0R2VuZGVyKENvbW1vbk1ldGhvZC5nZXRTdHJpbmcoZm9ybSxcImdlbmRlclwiKSk7XG4gICAgICAgIGYuc2V0QWdlKENvbW1vbk1ldGhvZC5nZXRJbnRlZ2VyKGZvcm0sXCJhZ2VcIikpO1xuICAgICAgICBmLnNldFVuaXQoQ29tbW9uTWV0aG9kLmdldFN0cmluZyhmb3JtLFwidW5pdFwiKSk7XG4gICAgICAgIGZhbWlseU1lbWJlclJlcG9zaXRvcnkuc2F2ZShmKTtcbiAgICAgICAgcmV0dXJuIENvbW1vbk1ldGhvZC5nZXRSZXR1cm5NZXNzYWdlT0soKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgRGF0YVJlc3BvbnNlIGZhbWlseU1lbWJlckRlbGV0ZShEYXRhUmVxdWVzdCBkYXRhUmVxdWVzdCkge1xuICAgICAgICBJbnRlZ2VyIG1lbWJlcklkID0gZGF0YVJlcXVlc3QuZ2V0SW50ZWdlcihcIm1lbWJlcklkXCIpO1xuICAgICAgICBPcHRpb25hbDxGYW1pbHlNZW1iZXI+IG9wO1xuICAgICAgICBvcCA9IGZhbWlseU1lbWJlclJlcG9zaXRvcnkuZmluZEJ5SWQobWVtYmVySWQpO1xuICAgICAgICBvcC5pZlByZXNlbnQoZmFtaWx5TWVtYmVyUmVwb3NpdG9yeTo6ZGVsZXRlKTtcbiAgICAgICAgcmV0dXJuIENvbW1vbk1ldGhvZC5nZXRSZXR1cm5NZXNzYWdlT0soKTtcbiAgICB9XG4uLi5cblBhdGg6IHNyYy9tYWluL2phdmEvY24vZWR1L3NkdS9qYXZhL3NlcnZlci9zZXJ2aWNlcy9UZWFjaGVyU2VydmljZXMuamF2YVxuLi4uXG5cbkBTZXJ2aWNlXG5wdWJsaWMgY2xhc3MgVGVhY2hlclNlcnZpY2Uge1xuICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIExvZ2dlciBsb2cgPSBMb2dnZXJGYWN0b3J5LmdldExvZ2dlcihjbi5lZHUuc2R1LmphdmEuc2VydmVyLnNlcnZpY2VzLlRlYWNoZXJTZXJ2aWNlLmNsYXNzKTtcbiAgICBwcml2YXRlIGZpbmFsIFBlcnNvblJlcG9zaXRvcnkgcGVyc29uUmVwb3NpdG9yeTsgIC8v5Lq65ZGY5pWw5o2u5pON5L2c6Ieq5Yqo5rOo5YWlXG4gICAgcHJpdmF0ZSBmaW5hbCBUZWFjaGVyUmVwb3NpdG9yeSB0ZWFjaGVyUmVwb3NpdG9yeTsgIC8v5pWZ5biI5pWw5o2u5pON5L2c6Ieq5Yqo5rOo5YWlXG4gICAgcHJpdmF0ZSBmaW5hbCBVc2VyUmVwb3NpdG9yeSB1c2VyUmVwb3NpdG9yeTsgIC8v5pWw5o2u5pON5L2c6Ieq5Yqo5rOo5YWlXG4gICAgcHJpdmF0ZSBmaW5hbCBVc2VyVHlwZVJlcG9zaXRvcnkgdXNlclR5cGVSZXBvc2l0b3J5OyAvL+eUqOaIt+exu+Wei+aVsOaNruaTjeS9nOiHquWKqOazqOWFpVxuICAgIHByaXZhdGUgZmluYWwgUGFzc3dvcmRFbmNvZGVyIGVuY29kZXI7ICAvL+WvhueggeacjeWKoeiHquWKqOazqOWFpVxuICAgIHByaXZhdGUgZmluYWwgRmVlUmVwb3NpdG9yeSBmZWVSZXBvc2l0b3J5OyAgLy/mtojotLnmlbDmja7mk43kvZzoh6rliqjms6jlhaVcbiAgICBwcml2YXRlIGZpbmFsIEZhbWlseU1lbWJlclJlcG9zaXRvcnkgZmFtaWx5TWVtYmVyUmVwb3NpdG9yeTtcbiAgICBwcml2YXRlIGZpbmFsIFN5c3RlbVNlcnZpY2Ugc3lzdGVtU2VydmljZTtcbi4uLlxuICAgIHB1YmxpYyBEYXRhUmVzcG9uc2UgZ2V0RmFtaWx5TWVtYmVyTGlzdChEYXRhUmVxdWVzdCBkYXRhUmVxdWVzdCkge1xuICAgICAgICBJbnRlZ2VyIHBlcnNvbklkID0gZGF0YVJlcXVlc3QuZ2V0SW50ZWdlcihcInBlcnNvbklkXCIpO1xuICAgICAgICBMaXN0PEZhbWlseU1lbWJlcj4gZkxpc3QgPSBmYW1pbHlNZW1iZXJSZXBvc2l0b3J5LmZpbmRCeVRlYWNoZXJQZXJzb25JZChwZXJzb25JZCk7XG4gICAgICAgIExpc3Q8TWFwPFN0cmluZyxPYmplY3Q+PiBkYXRhTGlzdCA9IG5ldyBBcnJheUxpc3Q8PigpO1xuICAgICAgICBNYXA8U3RyaW5nLE9iamVjdD4gbTtcbiAgICAgICAgaWYgKGZMaXN0ICE9IG51bGwpIHtcbiAgICAgICAgICAgIGZvciAoRmFtaWx5TWVtYmVyIGYgOiBmTGlzdCkge1xuICAgICAgICAgICAgICAgIG0gPSBuZXcgSGFzaE1hcDw+KCk7XG4gICAgICAgICAgICAgICAgbS5wdXQoXCJtZW1iZXJJZFwiLCBmLmdldE1lbWJlcklkKCkpO1xuICAgICAgICAgICAgICAgIG0ucHV0KFwicGVyc29uSWRcIiwgZi5nZXRUZWFjaGVyKCkuZ2V0UGVyc29uSWQoKSk7XG4gICAgICAgICAgICAgICAgbS5wdXQoXCJyZWxhdGlvblwiLCBmLmdldFJlbGF0aW9uKCkpO1xuICAgICAgICAgICAgICAgIG0ucHV0KFwibmFtZVwiLCBmLmdldE5hbWUoKSk7XG4gICAgICAgICAgICAgICAgbS5wdXQoXCJnZW5kZXJcIiwgZi5nZXRHZW5kZXIoKSk7XG4gICAgICAgICAgICAgICAgbS5wdXQoXCJhZ2VcIiwgZi5nZXRBZ2UoKStcIlwiKTtcbiAgICAgICAgICAgICAgICBtLnB1dChcInVuaXRcIiwgZi5nZXRVbml0KCkpO1xuICAgICAgICAgICAgICAgIGRhdGFMaXN0LmFkZChtKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gQ29tbW9uTWV0aG9kLmdldFJldHVybkRhdGEoZGF0YUxpc3QpO1xuICAgIH1cbiAgICBwdWJsaWMgRGF0YVJlc3BvbnNlIGZhbWlseU1lbWJlclNhdmUoRGF0YVJlcXVlc3QgZGF0YVJlcXVlc3QpIHtcbiAgICAgICAgTWFwPFN0cmluZyxPYmplY3Q+IGZvcm0gPSBkYXRhUmVxdWVzdC5nZXRNYXAoXCJmb3JtXCIpO1xuICAgICAgICBJbnRlZ2VyIHBlcnNvbklkID0gQ29tbW9uTWV0aG9kLmdldEludGVnZXIoZm9ybSxcInBlcnNvbklkXCIpO1xuICAgICAgICBJbnRlZ2VyIG1lbWJlcklkID0gQ29tbW9uTWV0aG9kLmdldEludGVnZXIoZm9ybSxcIm1lbWJlcklkXCIpO1xuICAgICAgICBPcHRpb25hbDxGYW1pbHlNZW1iZXI+IG9wO1xuICAgICAgICBGYW1pbHlNZW1iZXIgZiA9IG51bGw7XG4gICAgICAgIGlmKG1lbWJlcklkICE9IG51bGwpIHtcbiAgICAgICAgICAgIG9wID0gZmFtaWx5TWVtYmVyUmVwb3NpdG9yeS5maW5kQnlJZChtZW1iZXJJZCk7XG4gICAgICAgICAgICBpZihvcC5pc1ByZXNlbnQoKSkge1xuICAgICAgICAgICAgICAgIGYgPSBvcC5nZXQoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZihmPT0gbnVsbCkge1xuICAgICAgICAgICAgZiA9IG5ldyBGYW1pbHlNZW1iZXIoKTtcbiAgICAgICAgICAgIGFzc2VydCBwZXJzb25JZCAhPSBudWxsO1xuICAgICAgICAgICAgZi5zZXRTdHVkZW50KHRlYWNoZXJSZXBvc2l0b3J5LmZpbmRCeUlkKHBlcnNvbklkKS5nZXQoKSk7XG4gICAgICAgIH1cbi4uLlxuUGF0aDogc3JjL21haW4vamF2YS9jbi9lZHUvc2R1L2phdmEvc2VydmVyL21vZGVscy9TdHVkZW50LmphdmFcbnBhY2thZ2UgY24uZWR1LnNkdS5qYXZhLnNlcnZlci5tb2RlbHM7XG5cbmltcG9ydCBjb20uZmFzdGVyeG1sLmphY2tzb24uYW5ub3RhdGlvbi5Kc29uSWdub3JlO1xuXG5pbXBvcnQgamFrYXJ0YS5wZXJzaXN0ZW5jZS4qO1xuaW1wb3J0IGpha2FydGEudmFsaWRhdGlvbi5jb25zdHJhaW50cy5TaXplO1xuXG5cbi8qKlxuICogU3R1ZGVudOWtpueUn+ihqOWunuS9k+exuyDkv53lrZjmr4/kuKrlrabnlJ/nmoTkv6Hmga/vvIxcbiAqIEludGVnZXIgcGVyc29uSWQg5a2m55Sf6KGoIHN0dWRlbnQg5Li76ZSuIHBlcnNvbl9pZCDkuI5QZXJzb27ooajkuLvplK7nm7jlkIxcbiAqIFBlcnNvbiBwZXJzb24g5YWz6IGU5Yiw6K+l55So5oi35omA55So55qEUGVyc29u5a+56LGh77yM6LSm5oi35omA5a+55bqU55qE5Lq65ZGY5L+h5oGvIHBlcnNvbl9pZCDlhbPogZQgcGVyc29uIOihqOS4u+mUriBwZXJzb25faWRcbiAqIFN0cmluZyBtYWpvciDkuJPkuJpcbiAqIFN0cmluZyBjbGFzc05hbWUg54+t57qnXG4gKlxuICovXG5pbXBvcnQgbG9tYm9rLkdldHRlcjtcbmltcG9ydCBsb21ib2suU2V0dGVyO1xuQEdldHRlclxuQFNldHRlclxuQEVudGl0eVxuQFRhYmxlKFx0bmFtZSA9IFwic3R1ZGVudFwiLFxuICAgICAgICB1bmlxdWVDb25zdHJhaW50cyA9IHtcbiAgICAgICAgfSlcbnB1YmxpYyBjbGFzcyBTdHVkZW50IHtcbiAgICBASWRcbiAgICBwcml2YXRlIEludGVnZXIgcGVyc29uSWQ7XG5cbiAgICBAT25lVG9PbmVcbiAgICBASm9pbkNvbHVtbihuYW1lPVwicGVyc29uSWRcIilcbiAgICBASnNvbklnbm9yZVxuICAgIHByaXZhdGUgUGVyc29uIHBlcnNvbjtcblxuICAgIEBTaXplKG1heCA9IDIwKVxuICAgIHByaXZhdGUgU3RyaW5nIG1ham9yO1xuXG4gICAgQFNpemUobWF4ID0gNTApXG4gICAgcHJpdmF0ZSBTdHJpbmcgY2xhc3NOYW1lO1xuXG59XG4uLi5cblBhdGg6IHNyYy9tYWluL2phdmEvY24vZWR1L3NkdS9qYXZhL3NlcnZlci9tb2RlbHMvRmVlLmphdmFcbnBhY2thZ2UgY24uZWR1LnNkdS5qYXZhLnNlcnZlci5tb2RlbHM7XG5cbmltcG9ydCBqYWthcnRhLnBlcnNpc3RlbmNlLio7XG5pbXBvcnQgamFrYXJ0YS52YWxpZGF0aW9uLmNvbnN0cmFpbnRzLlNpemU7XG5cbi8qXG4gKiBGZWUg5raI6LS55rWB5rC05a6e5L2T57G7ICDkv53lrZjlrabnlJ/mtojotLnmtYHmsLTnmoTln7rmnKzkv6Hmga/kv6Hmga/vvIxcbiAqIEludGVnZXIgZmVlSWQg5raI6LS56KGoIGZlZSDkuLvplK4gZmVlX2lkXG4gKiBJbnRlZ2VyIHBlcnNvbklkICAg5a+55bqUc3R1ZGVudCDooajph4zpnaLnmoQgcGVyc29uX2lkXG4gKiBTdHJpbmcgZGF5IOaXpeacn1xuICogRG91YmxlIG1vbmV5IOmHkeminVxuICovXG5pbXBvcnQgbG9tYm9rLkdldHRlcjtcbmltcG9ydCBsb21ib2suU2V0dGVyO1xuQEdldHRlclxuQFNldHRlclxuQEVudGl0eVxuQFRhYmxlKFx0bmFtZSA9IFwiZmVlXCJcbilcbnB1YmxpYyBjbGFzcyBGZWUge1xuICAgIEBJZFxuICAgIEBHZW5lcmF0ZWRWYWx1ZShzdHJhdGVneSA9IEdlbmVyYXRpb25UeXBlLklERU5USVRZKVxuICAgIHByaXZhdGUgSW50ZWdlciBmZWVJZDtcbiAgICBATWFueVRvT25lXG4gICAgQEpvaW5Db2x1bW4obmFtZSA9IFwicGVyc29uSWRcIilcbiAgICBwcml2YXRlIFN0dWRlbnQgc3R1ZGVudDtcbiAgICBAU2l6ZShtYXggPSAyMClcbiAgICBwcml2YXRlIFN0cmluZyBkYXk7XG4gICAgcHJpdmF0ZSBEb3VibGUgbW9uZXk7XG5cbn1cbi4uLlxuUGF0aDogc3JjL21haW4vamF2YS9jbi9lZHUvc2R1L2phdmEvc2VydmVyL2NvbnRyb2xsZXJzL1N0dWRlbnRDb250cm9sbGVyLmphdmFcbi4uLlxuXG4gICAgLypcbiAgICAgICAgRmFtaWx5TWVtYmVyXG4gICAgICovXG4gICAgQFBvc3RNYXBwaW5nKFwiL2dldEZhbWlseU1lbWJlckxpc3RcIilcbiAgICBAUHJlQXV0aG9yaXplKFwiIGhhc1JvbGUoJ0FETUlOJykgb3IgIGhhc1JvbGUoJ1NUVURFTlQnKVwiKVxuICAgIHB1YmxpYyBEYXRhUmVzcG9uc2UgZ2V0RmFtaWx5TWVtYmVyTGlzdChAVmFsaWQgQFJlcXVlc3RCb2R5IERhdGFSZXF1ZXN0IGRhdGFSZXF1ZXN0KSB7XG4gICAgICAgIHJldHVybiBzdHVkZW50U2VydmljZS5nZXRGYW1pbHlNZW1iZXJMaXN0KGRhdGFSZXF1ZXN0KTtcbiAgICB9XG5cbiAgICBAUG9zdE1hcHBpbmcoXCIvZmFtaWx5TWVtYmVyU2F2ZVwiKVxuICAgIEBQcmVBdXRob3JpemUoXCIgaGFzUm9sZSgnQURNSU4nKSBvciAgaGFzUm9sZSgnU1RVREVOVCcpXCIpXG4gICAgcHVibGljIERhdGFSZXNwb25zZSBmYW1pbHlNZW1iZXJTYXZlKEBWYWxpZCBAUmVxdWVzdEJvZHkgRGF0YVJlcXVlc3QgZGF0YVJlcXVlc3QpIHtcbiAgICAgICAgcmV0dXJuIHN0dWRlbnRTZXJ2aWNlLmZhbWlseU1lbWJlclNhdmUoZGF0YVJlcXVlc3QpO1xuICAgIH1cblxuICAgIEBQb3N0TWFwcGluZyhcIi9mYW1pbHlNZW1iZXJEZWxldGVcIilcbiAgICBAUHJlQXV0aG9yaXplKFwiIGhhc1JvbGUoJ0FETUlOJykgb3IgIGhhc1JvbGUoJ1NUVURFTlQnKVwiKVxuICAgIHB1YmxpYyBEYXRhUmVzcG9uc2UgZmFtaWx5TWVtYmVyRGVsZXRlKEBWYWxpZCBAUmVxdWVzdEJvZHkgRGF0YVJlcXVlc3QgZGF0YVJlcXVlc3QpIHtcbiAgICAgICAgcmV0dXJuIHN0dWRlbnRTZXJ2aWNlLmZhbWlseU1lbWJlckRlbGV0ZShkYXRhUmVxdWVzdCk7XG4gICAgfVxuLi4uXG5QYXRoOiBqYXZhLXNlcnZlci9zcmMvbWFpbi9qYXZhL2NuL2VkdS9zZHUvamF2YS9zZXJ2ZXIvY29udHJvbGxlcnMvU3R1ZGVudENvbnRyb2xsZXIuamF2YVxuLi4uXG5cbiAgICAvKlxuICAgICAgICBGYW1pbHlNZW1iZXJcbiAgICAgKi9cbiAgICBAUG9zdE1hcHBpbmcoXCIvZ2V0RmFtaWx5TWVtYmVyTGlzdFwiKVxuICAgIEBQcmVBdXRob3JpemUoXCIgaGFzUm9sZSgnQURNSU4nKSBvciAgaGFzUm9sZSgnU1RVREVOVCcpXCIpXG4gICAgcHVibGljIERhdGFSZXNwb25zZSBnZXRGYW1pbHlNZW1iZXJMaXN0KEBWYWxpZCBAUmVxdWVzdEJvZHkgRGF0YVJlcXVlc3QgZGF0YVJlcXVlc3QpIHtcbiAgICAgICAgcmV0dXJuIHN0dWRlbnRTZXJ2aWNlLmdldEZhbWlseU1lbWJlckxpc3QoZGF0YVJlcXVlc3QpO1xuICAgIH1cblxuICAgIEBQb3N0TWFwcGluZyhcIi9mYW1pbHlNZW1iZXJTYXZlXCIpXG4gICAgQFByZUF1dGhvcml6ZShcIiBoYXNSb2xlKCdBRE1JTicpIG9yICBoYXNSb2xlKCdTVFVERU5UJylcIilcbiAgICBwdWJsaWMgRGF0YVJlc3BvbnNlIGZhbWlseU1lbWJlclNhdmUoQFZhbGlkIEBSZXF1ZXN0Qm9keSBEYXRhUmVxdWVzdCBkYXRhUmVxdWVzdCkge1xuICAgICAgICByZXR1cm4gc3R1ZGVudFNlcnZpY2UuZmFtaWx5TWVtYmVyU2F2ZShkYXRhUmVxdWVzdCk7XG4gICAgfVxuXG4gICAgQFBvc3RNYXBwaW5nKFwiL2ZhbWlseU1lbWJlckRlbGV0ZVwiKVxuICAgIEBQcmVBdXRob3JpemUoXCIgaGFzUm9sZSgnQURNSU4nKSBvciAgaGFzUm9sZSgnU1RVREVOVCcpXCIpXG4gICAgcHVibGljIERhdGFSZXNwb25zZSBmYW1pbHlNZW1iZXJEZWxldGUoQFZhbGlkIEBSZXF1ZXN0Qm9keSBEYXRhUmVxdWVzdCBkYXRhUmVxdWVzdCkge1xuICAgICAgICByZXR1cm4gc3R1ZGVudFNlcnZpY2UuZmFtaWx5TWVtYmVyRGVsZXRlKGRhdGFSZXF1ZXN0KTtcbiAgICB9XG4uLi5cblBhdGg6IHNyYy9tYWluL2phdmEvY29tL3RlYWNoL2phdmFmeC9jb250cm9sbGVyL1N0dWRlbnRDb250cm9sbGVyLmphdmFcbi4uLlxuXG4gICAgQEZYTUxcbiAgICBwcm90ZWN0ZWQgdm9pZCBvbkZhbWlseUJ1dHRvbkNsaWNrKCkge1xuICAgICAgICBEYXRhUmVxdWVzdCByZXEgPSBuZXcgRGF0YVJlcXVlc3QoKTtcbiAgICAgICAgcmVxLmFkZChcInBlcnNvbklkXCIsIHBlcnNvbklkKTtcbiAgICAgICAgRGF0YVJlc3BvbnNlIHJlcyA9IEh0dHBSZXF1ZXN0VXRpbC5yZXF1ZXN0KFwiL2FwaS9zdHVkZW50L2dldEZhbWlseU1lbWJlckxpc3RcIiwgcmVxKTtcbiAgICAgICAgaWYgKHJlcy5nZXRDb2RlKCkgIT0gMCkge1xuICAgICAgICAgICAgTWVzc2FnZURpYWxvZy5zaG93RGlhbG9nKHJlcy5nZXRNc2coKSk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbi4uLlxuUGF0aDogdGFyZ2V0L21hdmVuLXN0YXR1cy9tYXZlbi1jb21waWxlci1wbHVnaW4vY29tcGlsZS9kZWZhdWx0LWNvbXBpbGUvY3JlYXRlZEZpbGVzLmxzdFxuLi4uXG5jblxcZWR1XFxzZHVcXGphdmFcXHNlcnZlclxccmVwb3NpdG9yeXNcXFN0YXRpc3RpY3NEYXlSZXBvc2l0b3J5LmNsYXNzXG5jblxcZWR1XFxzZHVcXGphdmFcXHNlcnZlclxcc2VydmljZXNcXFN0YXRpc3RpY3NTZXJ2aWNlLmNsYXNzXG5jblxcZWR1XFxzZHVcXGphdmFcXHNlcnZlclxccmVwb3NpdG9yeXNcXEZhbWlseU1lbWJlclJlcG9zaXRvcnkuY2xhc3NcbmNuXFxlZHVcXHNkdVxcamF2YVxcc2VydmVyXFxyZXBvc2l0b3J5c1xcTWVudUluZm9SZXBvc2l0b3J5LmNsYXNzXG5jblxcZWR1XFxzZHVcXGphdmFcXHNlcnZlclxccmVwb3NpdG9yeXNcXFN5c3RlbUluZm9SZXBvc2l0b3J5LmNsYXNzXG5jblxcZWR1XFxzZHVcXGphdmFcXHNlcnZlclxcbW9kZWxzXFxSZXF1ZXN0TG9nLmNsYXNzXG5jblxcZWR1XFxzZHVcXGphdmFcXHNlcnZlclxccGF5bG9hZFxccmVxdWVzdFxcRGF0YVJlcXVlc3QuY2xhc3NcbmNuXFxlZHVcXHNkdVxcamF2YVxcc2VydmVyXFx1dGlsXFxMb2dpbkNvbnRyb2xVdGlsLmNsYXNzXG5jblxcZWR1XFxzZHVcXGphdmFcXHNlcnZlclxcc2VydmljZXNcXENvdXJzZVNlcnZpY2UuY2xhc3NcbmNuXFxlZHVcXHNkdVxcamF2YVxcc2VydmVyXFxwYXlsb2FkXFxyZXNwb25zZVxcT3B0aW9uSXRlbUxpc3QuY2xhc3NcbmNuXFxlZHVcXHNkdVxcamF2YVxcc2VydmVyXFxyZXBvc2l0b3J5c1xcU3R1ZGVudFN0YXRpc3RpY3NSZXBvc2l0b3J5LmNsYXNzXG5jblxcZWR1XFxzZHVcXGphdmFcXHNlcnZlclxcY29uZmlnc1xcU2VjdXJpdHlDb25maWd1cmF0aW9uLmNsYXNzXG5jblxcZWR1XFxzZHVcXGphdmFcXHNlcnZlclxcY29uZmlnc1xcSnd0QXV0aGVudGljYXRpb25GaWx0ZXIuY2xhc3NcbmNuXFxlZHVcXHNkdVxcamF2YVxcc2VydmVyXFxyZXBvc2l0b3J5c1xcU2NvcmVSZXBvc2l0b3J5LmNsYXNzXG5jblxcZWR1XFxzZHVcXGphdmFcXHNlcnZlclxcc2VydmljZXNcXEF1dGhlbnRpY2F0aW9uU2VydmljZS5jbGFzc1xuY25cXGVkdVxcc2R1XFxqYXZhXFxzZXJ2ZXJcXHNlcnZpY2VzXFxBdXRoU2VydmljZS5jbGFzc1xuY25cXGVkdVxcc2R1XFxqYXZhXFxzZXJ2ZXJcXEphdmFTZXJ2ZXJBcHBsaWNhdGlvbi5jbGFzc1xuY25cXGVkdVxcc2R1XFxqYXZhXFxzZXJ2ZXJcXG1vZGVsc1xcU3R1ZGVudC5jbGFzc1xuY25cXGVkdVxcc2R1XFxqYXZhXFxzZXJ2ZXJcXG1vZGVsc1xcVXNlci5jbGFzc1xuY25cXGVkdVxcc2R1XFxqYXZhXFxzZXJ2ZXJcXHNlcnZpY2VzXFxCYXNlU2VydmljZS5jbGFzc1xuY25cXGVkdVxcc2R1XFxqYXZhXFxzZXJ2ZXJcXG1vZGVsc1xcRVVzZXJUeXBlLmNsYXNzXG5jblxcZWR1XFxzZHVcXGphdmFcXHNlcnZlclxcbW9kZWxzXFxGYW1pbHlNZW1iZXIuY2xhc3NcbmNuXFxlZHVcXHNkdVxcamF2YVxcc2VydmVyXFxwYXlsb2FkXFxyZXNwb25zZVxcRGF0YVJlc3BvbnNlLmNsYXNzXG5jblxcZWR1XFxzZHVcXGphdmFcXHNlcnZlclxcU3lzdGVtQXBwbGljYXRpb25MaXN0ZW5lci5jbGFzc1xuY25cXGVkdVxcc2R1XFxqYXZhXFxzZXJ2ZXJcXHJlcG9zaXRvcnlzXFxVc2VyVHlwZVJlcG9zaXRvcnkuY2xhc3NcbmNuXFxlZHVcXHNkdVxcamF2YVxcc2VydmVyXFxjb250cm9sbGVyc1xcQmFzZUNvbnRyb2xsZXIuY2xhc3NcbmNuXFxlZHVcXHNkdVxcamF2YVxcc2VydmVyXFxjb250cm9sbGVyc1xcU3R1ZGVudENvbnRyb2xsZXIuY2xhc3Ncbi4uLlxuUGF0aDogdGFyZ2V0L21hdmVuLXN0YXR1cy9tYXZlbi1jb21waWxlci1wbHVnaW4vY29tcGlsZS9kZWZhdWx0LWNvbXBpbGUvaW5wdXRGaWxlcy5sc3Rcbi4uLlxuQzpcXFVzZXJzXFxwcmluY2lwXFxEZXNrdG9wXFxqYXZhLWtlc2hlXFxqYXZhLXNlcnZlclxcc3JjXFxtYWluXFxqYXZhXFxjblxcZWR1XFxzZHVcXGphdmFcXHNlcnZlclxcbW9kZWxzXFxFVXNlclR5cGUuamF2YVxuQzpcXFVzZXJzXFxwcmluY2lwXFxEZXNrdG9wXFxqYXZhLWtlc2hlXFxqYXZhLXNlcnZlclxcc3JjXFxtYWluXFxqYXZhXFxjblxcZWR1XFxzZHVcXGphdmFcXHNlcnZlclxcbW9kZWxzXFxGYW1pbHlNZW1iZXIuamF2YVxuQzpcXFVzZXJzXFxwcmluY2lwXFxEZXNrdG9wXFxqYXZhLWtlc2hlXFxqYXZhLXNlcnZlclxcc3JjXFxtYWluXFxqYXZhXFxjblxcZWR1XFxzZHVcXGphdmFcXHNlcnZlclxcbW9kZWxzXFxGZWUuamF2YVxuQzpcXFVzZXJzXFxwcmluY2lwXFxEZXNrdG9wXFxqYXZhLWtlc2hlXFxqYXZhLXNlcnZlclxcc3JjXFxtYWluXFxqYXZhXFxjblxcZWR1XFxzZHVcXGphdmFcXHNlcnZlclxcbW9kZWxzXFxNZW51SW5mby5qYXZhXG5DOlxcVXNlcnNcXHByaW5jaXBcXERlc2t0b3BcXGphdmEta2VzaGVcXGphdmEtc2VydmVyXFxzcmNcXG1haW5cXGphdmFcXGNuXFxlZHVcXHNkdVxcamF2YVxcc2VydmVyXFxtb2RlbHNcXE1vZGlmeUxvZy5qYXZhXG5DOlxcVXNlcnNcXHByaW5jaXBcXERlc2t0b3BcXGphdmEta2VzaGVcXGphdmEtc2VydmVyXFxzcmNcXG1haW5cXGphdmFcXGNuXFxlZHVcXHNkdVxcamF2YVxcc2VydmVyXFxtb2RlbHNcXFBlcnNvbi5qYXZhXG5DOlxcVXNlcnNcXHByaW5jaXBcXERlc2t0b3BcXGphdmEta2VzaGVcXGphdmEtc2VydmVyXFxzcmNcXG1haW5cXGphdmFcXGNuXFxlZHVcXHNkdVxcamF2YVxcc2VydmVyXFxtb2RlbHNcXFJlcXVlc3RMb2cuamF2YVxuLi4uXG5QYXRoOiBqYXZhLXNlcnZlci9zcmMvbWFpbi9qYXZhL2NuL2VkdS9zZHUvamF2YS9zZXJ2ZXIvc2VydmljZXMvVGVhY2hlclNlcnZpY2VzLmphdmFcbi4uLlxuaW1wb3J0IG9yZy5zcHJpbmdmcmFtZXdvcmsuc3RlcmVvdHlwZS5TZXJ2aWNlO1xuaW1wb3J0IG9yZy5zcHJpbmdmcmFtZXdvcmsud2ViLnNlcnZsZXQubXZjLm1ldGhvZC5hbm5vdGF0aW9uLlN0cmVhbWluZ1Jlc3BvbnNlQm9keTtcblxuaW1wb3J0IGphdmEudXRpbC4qO1xuXG5AU2VydmljZVxucHVibGljIGNsYXNzIFRlYWNoZXJTZXJ2aWNlcyB7XG4gICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgTG9nZ2VyIGxvZyA9IExvZ2dlckZhY3RvcnkuZ2V0TG9nZ2VyKFRlYWNoZXJTZXJ2aWNlcy5jbGFzcyk7XG4gICAgcHJpdmF0ZSBmaW5hbCBQZXJzb25SZXBvc2l0b3J5IHBlcnNvblJlcG9zaXRvcnk7ICAvL+S6uuWRmOaVsOaNruaTjeS9nOiHquWKqOazqOWFpVxuICAgIHByaXZhdGUgZmluYWwgVGVhY2hlclJlcG9zaXRvcnkgdGVhY2hlclJlcG9zaXRvcnk7ICAvL+aVmeW4iOaVsOaNruaTjeS9nOiHquWKqOazqOWFpVxuICAgIHByaXZhdGUgZmluYWwgVXNlclJlcG9zaXRvcnkgdXNlclJlcG9zaXRvcnk7ICAvL+aVsOaNruaTjeS9nOiHquWKqOazqOWFpVxuICAgIHByaXZhdGUgZmluYWwgVXNlclR5cGVSZXBvc2l0b3J5IHVzZXJUeXBlUmVwb3NpdG9yeTsgLy/nlKjmiLfnsbvlnovmlbDmja7mk43kvZzoh6rliqjms6jlhaVcbiAgICBwcml2YXRlIGZpbmFsIFBhc3N3b3JkRW5jb2RlciBlbmNvZGVyOyAgLy/lr4bnoIHmnI3liqHoh6rliqjms6jlhaVcbiAgICAvL+a2iOi0ueaVsOaNruaTjeS9nOiHquWKqOazqOWFpVxuICAgIHByaXZhdGUgZmluYWwgRmFtaWx5TWVtYmVyUmVwb3NpdG9yeSBmYW1pbHlNZW1iZXJSZXBvc2l0b3J5O1xuICAgIHByaXZhdGUgZmluYWwgU3lzdGVtU2VydmljZSBzeXN0ZW1TZXJ2aWNlO1xuLi4uXG5QYXRoOiBsb2dzL2phdmEtc2VydmVyLTIwMjUtMDItMTkuMC5sb2dcbi4uLlxuMjAyNS0wMi0xOSAxNzowMDo1Miw0NTkgW21haW5dIElORk8gIG8ucy5kLnIuYy5SZXBvc2l0b3J5Q29uZmlndXJhdGlvbkV4dGVuc2lvblN1cHBvcnQgIC0gU3ByaW5nIERhdGEgUmVkaXMgLSBDb3VsZCBub3Qgc2FmZWx5IGlkZW50aWZ5IHN0b3JlIGFzc2lnbm1lbnQgZm9yIHJlcG9zaXRvcnkgY2FuZGlkYXRlIGludGVyZmFjZSBjbi5lZHUuc2R1LmphdmEuc2VydmVyLnJlcG9zaXRvcnlzLkZhbWlseU1lbWJlclJlcG9zaXRvcnk7IElmIHlvdSB3YW50IHRoaXMgcmVwb3NpdG9yeSB0byBiZSBhIFJlZGlzIHJlcG9zaXRvcnksIGNvbnNpZGVyIGFubm90YXRpbmcgeW91ciBlbnRpdGllcyB3aXRoIG9uZSBvZiB0aGVzZSBhbm5vdGF0aW9uczogb3JnLnNwcmluZ2ZyYW1ld29yay5kYXRhLnJlZGlzLmNvcmUuUmVkaXNIYXNoIChwcmVmZXJyZWQpLCBvciBjb25zaWRlciBleHRlbmRpbmcgb25lIG9mIHRoZSBmb2xsb3dpbmcgdHlwZXMgd2l0aCB5b3VyIHJlcG9zaXRvcnk6IG9yZy5zcHJpbmdmcmFtZXdvcmsuZGF0YS5rZXl2YWx1ZS5yZXBvc2l0b3J5LktleVZhbHVlUmVwb3NpdG9yeVxuLi4uXG4yMDI1LTAyLTE5IDE3OjEwOjE0LDc4MyBbbWFpbl0gSU5GTyAgby5zLmQuci5jLlJlcG9zaXRvcnlDb25maWd1cmF0aW9uRXh0ZW5zaW9uU3VwcG9ydCAgLSBTcHJpbmcgRGF0YSBSZWRpcyAtIENvdWxkIG5vdCBzYWZlbHkgaWRlbnRpZnkgc3RvcmUgYXNzaWdubWVudCBmb3IgcmVwb3NpdG9yeSBjYW5kaWRhdGUgaW50ZXJmYWNlIGNuLmVkdS5zZHUuamF2YS5zZXJ2ZXIucmVwb3NpdG9yeXMuRmFtaWx5TWVtYmVyUmVwb3NpdG9yeTsgSWYgeW91IHdhbnQgdGhpcyByZXBvc2l0b3J5IHRvIGJlIGEgUmVkaXMgcmVwb3NpdG9yeSwgY29uc2lkZXIgYW5ub3RhdGluZyB5b3VyIGVudGl0aWVzIHdpdGggb25lIG9mIHRoZXNlIGFubm90YXRpb25zOiBvcmcuc3ByaW5nZnJhbWV3b3JrLmRhdGEucmVkaXMuY29yZS5SZWRpc0hhc2ggKHByZWZlcnJlZCksIG9yIGNvbnNpZGVyIGV4dGVuZGluZyBvbmUgb2YgdGhlIGZvbGxvd2luZyB0eXBlcyB3aXRoIHlvdXIgcmVwb3NpdG9yeTogb3JnLnNwcmluZ2ZyYW1ld29yay5kYXRhLmtleXZhbHVlLnJlcG9zaXRvcnkuS2V5VmFsdWVSZXBvc2l0b3J5XG4uLi5cbjIwMjUtMDItMTkgMTc6NDI6MDcsMjgxIFttYWluXSBJTkZPICBvLnMuZC5yLmMuUmVwb3NpdG9yeUNvbmZpZ3VyYXRpb25FeHRlbnNpb25TdXBwb3J0ICAtIFNwcmluZyBEYXRhIFJlZGlzIC0gQ291bGQgbm90IHNhZmVseSBpZGVudGlmeSBzdG9yZSBhc3NpZ25tZW50IGZvciByZXBvc2l0b3J5IGNhbmRpZGF0ZSBpbnRlcmZhY2UgY24uZWR1LnNkdS5qYXZhLnNlcnZlci5yZXBvc2l0b3J5cy5GYW1pbHlNZW1iZXJSZXBvc2l0b3J5OyBJZiB5b3Ugd2FudCB0aGlzIHJlcG9zaXRvcnkgdG8gYmUgYSBSZWRpcyByZXBvc2l0b3J5LCBjb25zaWRlciBhbm5vdGF0aW5nIHlvdXIgZW50aXRpZXMgd2l0aCBvbmUgb2YgdGhlc2UgYW5ub3RhdGlvbnM6IG9yZy5zcHJpbmdmcmFtZXdvcmsuZGF0YS5yZWRpcy5jb3JlLlJlZGlzSGFzaCAocHJlZmVycmVkKSwgb3IgY29uc2lkZXIgZXh0ZW5kaW5nIG9uZSBvZiB0aGUgZm9sbG93aW5nIHR5cGVzIHdpdGggeW91ciByZXBvc2l0b3J5OiBvcmcuc3ByaW5nZnJhbWV3b3JrLmRhdGEua2V5dmFsdWUucmVwb3NpdG9yeS5LZXlWYWx1ZVJlcG9zaXRvcnlcbi4uLlxuUGF0aDogbG9ncy9qYXZhLXNlcnZlci0yMDI1LTAyLTI1LjAubG9nXG4uLi5cbjIwMjUtMDItMjUgMTg6NTg6MDAsNjM5IFttYWluXSBJTkZPICBvLnMuZC5yLmMuUmVwb3NpdG9yeUMuLi4iLCJpc0Vycm9yIjpmYWxzZSwicmVxdWVzdElkIjoiIn19LCI5YWIwYzU3Mi0yN2NjLTQzN2EtYWNhNS02MmE3NGZjMWI5NGE7dG9vbHVfdnJ0eF8wMTFTb21uQkU1VFFiTFBaaWVBSGhKRzkiOnsicmVxdWVzdElkIjoiOWFiMGM1NzItMjdjYy00MzdhLWFjYTUtNjJhNzRmYzFiOTRhIiwidG9vbFVzZUlkIjoidG9vbHVfdnJ0eF8wMTFTb21uQkU1VFFiTFBaaWVBSGhKRzkiLCJwaGFzZSI6NSwicmVzdWx0Ijp7InRleHQiOiJUaGUgZm9sbG93aW5nIGNvZGUgc2VjdGlvbnMgd2VyZSByZXRyaWV2ZWQ6XG5QYXRoOiBzcmMvbWFpbi9qYXZhL2NuL2VkdS9zZHUvamF2YS9zZXJ2ZXIvc2VydmljZXMvVGVhY2hlclNlcnZpY2VzLmphdmFcbi4uLlxuXG5AU2VydmljZVxucHVibGljIGNsYXNzIFRlYWNoZXJTZXJ2aWNlIHtcbiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBMb2dnZXIgbG9nID0gTG9nZ2VyRmFjdG9yeS5nZXRMb2dnZXIoY24uZWR1LnNkdS5qYXZhLnNlcnZlci5zZXJ2aWNlcy5UZWFjaGVyU2VydmljZS5jbGFzcyk7XG4gICAgcHJpdmF0ZSBmaW5hbCBQZXJzb25SZXBvc2l0b3J5IHBlcnNvblJlcG9zaXRvcnk7ICAvL+S6uuWRmOaVsOaNruaTjeS9nOiHquWKqOazqOWFpVxuICAgIHByaXZhdGUgZmluYWwgVGVhY2hlclJlcG9zaXRvcnkgdGVhY2hlclJlcG9zaXRvcnk7ICAvL+aVmeW4iOaVsOaNruaTjeS9nOiHquWKqOazqOWFpVxuICAgIHByaXZhdGUgZmluYWwgVXNlclJlcG9zaXRvcnkgdXNlclJlcG9zaXRvcnk7ICAvL+aVsOaNruaTjeS9nOiHquWKqOazqOWFpVxuICAgIHByaXZhdGUgZmluYWwgVXNlclR5cGVSZXBvc2l0b3J5IHVzZXJUeXBlUmVwb3NpdG9yeTsgLy/nlKjmiLfnsbvlnovmlbDmja7mk43kvZzoh6rliqjms6jlhaVcbiAgICBwcml2YXRlIGZpbmFsIFBhc3N3b3JkRW5jb2RlciBlbmNvZGVyOyAgLy/lr4bnoIHmnI3liqHoh6rliqjms6jlhaVcbiAgICBwcml2YXRlIGZpbmFsIEZlZVJlcG9zaXRvcnkgZmVlUmVwb3NpdG9yeTsgIC8v5raI6LS55pWw5o2u5pON5L2c6Ieq5Yqo5rOo5YWlXG4gICAgcHJpdmF0ZSBmaW5hbCBGYW1pbHlNZW1iZXJSZXBvc2l0b3J5IGZhbWlseU1lbWJlclJlcG9zaXRvcnk7XG4gICAgcHJpdmF0ZSBmaW5hbCBTeXN0ZW1TZXJ2aWNlIHN5c3RlbVNlcnZpY2U7XG4uLi5cbiAgICBwdWJsaWMgTWFwPFN0cmluZyxPYmplY3Q+IGdldE1hcEZyb21UZWFjaGVyKFRlYWNoZXIgcykge1xuICAgICAgICBNYXA8U3RyaW5nLE9iamVjdD4gbSA9IG5ldyBIYXNoTWFwPD4oKTtcbiAgICAgICAgUGVyc29uIHA7XG4gICAgICAgIGlmKHMgPT0gbnVsbClcbiAgICAgICAgICAgIHJldHVybiBtO1xuICAgICAgICBtLnB1dChcInRpdGxlXCIscy5nZXRUaXRsZSgpKTtcbiAgICAgICAgbS5wdXQoXCJkZWdyZWVcIixzLmdldERlZ3JlZSgpKTtcbiAgICAgICAgbS5wdXQoXCJjbGFzc05hbWVcIixzLmdldENsYXNzTmFtZSgpKTtcbiAgICAgICAgcCA9IHMuZ2V0UGVyc29uKCk7XG4gICAgICAgIGlmKHAgPT0gbnVsbClcbiAgICAgICAgICAgIHJldHVybiBtO1xuICAgICAgICBtLnB1dChcInBlcnNvbklkXCIsIHMuZ2V0UGVyc29uSWQoKSk7XG4gICAgICAgIG0ucHV0KFwibnVtXCIscC5nZXROdW0oKSk7XG4gICAgICAgIG0ucHV0KFwibmFtZVwiLHAuZ2V0TmFtZSgpKTtcbiAgICAgICAgbS5wdXQoXCJkZXB0XCIscC5nZXREZXB0KCkpO1xuICAgICAgICBtLnB1dChcImNhcmRcIixwLmdldENhcmQoKSk7XG4gICAgICAgIFN0cmluZyBnZW5kZXIgPSBwLmdldEdlbmRlcigpO1xuICAgICAgICBtLnB1dChcImdlbmRlclwiLGdlbmRlcik7XG4gICAgICAgIG0ucHV0KFwiZ2VuZGVyTmFtZVwiLCBDb21EYXRhVXRpbC5nZXRJbnN0YW5jZSgpLmdldERpY3Rpb25hcnlMYWJlbEJ5VmFsdWUoXCJYQk1cIiwgZ2VuZGVyKSk7IC8v5oCn5Yir57G75Z6L55qE5YC86L2s5o2i5oiQ5pWw5o2u57G75Z6L5ZCNXG4gICAgICAgIG0ucHV0KFwiYmlydGhkYXlcIiwgcC5nZXRCaXJ0aGRheSgpKTsgIC8v5pe26Ze05qC85byP6L2s5o2i5a2X56ym5LiyXG4gICAgICAgIG0ucHV0KFwiZW1haWxcIixwLmdldEVtYWlsKCkpO1xuICAgICAgICBtLnB1dChcInBob25lXCIscC5nZXRQaG9uZSgpKTtcbiAgICAgICAgbS5wdXQoXCJhZGRyZXNzXCIscC5nZXRBZGRyZXNzKCkpO1xuICAgICAgICBtLnB1dChcImludHJvZHVjZVwiLHAuZ2V0SW50cm9kdWNlKCkpO1xuICAgICAgICByZXR1cm4gbTtcbiAgICB9XG4gICAgcHVibGljIExpc3Q8TWFwPFN0cmluZyxPYmplY3Q+PiBnZXRUZWFjaGVyTWFwTGlzdChTdHJpbmcgbnVtTmFtZSkge1xuICAgICAgICBMaXN0PE1hcDxTdHJpbmcsT2JqZWN0Pj4gZGF0YUxpc3QgPSBuZXcgQXJyYXlMaXN0PD4oKTtcbiAgICAgICAgTGlzdDxUZWFjaGVyPiBzTGlzdCA9IHRlYWNoZXJSZXBvc2l0b3J5LmZpbmRUZWFjaGVyTGlzdEJ5TnVtTmFtZShudW1OYW1lKTsgIC8v5pWw5o2u5bqT5p+l6K+i5pON5L2cXG4gICAgICAgIGlmIChzTGlzdCA9PSBudWxsIHx8IHNMaXN0LmlzRW1wdHkoKSlcbiAgICAgICAgICAgIHJldHVybiBkYXRhTGlzdDtcbiAgICAgICAgZm9yIChUZWFjaGVyIHRlYWNoZXIgOiBzTGlzdCkge1xuICAgICAgICAgICAgZGF0YUxpc3QuYWRkKGdldE1hcEZyb21UZWFjaGVyKHRlYWNoZXIpKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZGF0YUxpc3Q7XG4gICAgfVxuICAgIHB1YmxpYyBEYXRhUmVzcG9uc2UgZ2V0VGVhY2hlckxpc3QoRGF0YVJlcXVlc3QgZGF0YVJlcXVlc3QpIHtcbiAgICAgICAgU3RyaW5nIG51bU5hbWUgPSBkYXRhUmVxdWVzdC5nZXRTdHJpbmcoXCJudW1OYW1lXCIpO1xuICAgICAgICBMaXN0PE1hcDxTdHJpbmcsT2JqZWN0Pj4gZGF0YUxpc3QgPSAgZ2V0VGVhY2hlckxpc3QobnVtTmFtZSk7XG4gICAgICAgIHJldHVybiBDb21tb25NZXRob2QuZ2V0UmV0dXJuRGF0YShkYXRhTGlzdCk7ICAvL+aMieeFp+a1i+ivleahhuaetuinhOiMg+S8mumAgU1hcOeahGxpc3RcbiAgICB9XG4gICAgcHVibGljIERhdGFSZXNwb25zZSB0ZWFjaGVyRGVsZXRlKERhdGFSZXF1ZXN0IGRhdGFSZXF1ZXN0KSB7XG4gICAgICAgIEludGVnZXIgcGVyc29uSWQgPSBkYXRhUmVxdWVzdC5nZXRJbnRlZ2VyKFwicGVyc29uSWRcIik7ICAvL+iOt+WPlnRlYWNoZXJfaWTlgLxcbiAgICAgICAgVGVhY2hlciBzID0gbnVsbDtcbiAgICAgICAgT3B0aW9uYWw8VGVhY2hlcj4gb3A7XG4gICAgICAgIGlmIChwZXJzb25JZCAhPSBudWxsICYmIHBlcnNvbklkID4gMCkge1xuICAgICAgICAgICAgb3AgPSB0ZWFjaGVyUmVwb3NpdG9yeS5maW5kQnlJZChwZXJzb25JZCk7ICAgLy/mn6Xor6Lojrflvpflrp7kvZPlr7nosaFcbiAgICAgICAgICAgIGlmKG9wLmlzUHJlc2VudCgpKSB7XG4gICAgICAgICAgICAgICAgcyA9IG9wLmdldCgpO1xuICAgICAgICAgICAgICAgIE9wdGlvbmFsPFVzZXI+IHVPcCA9IHVzZXJSZXBvc2l0b3J5LmZpbmRCeUlkKHBlcnNvbklkKTsgLy/mn6Xor6Llr7nlupTor6XmlZnluIjnmoTotKbmiLdcbiAgICAgICAgICAgICAgICAvL+WIoOmZpOWvueW6lOivpeaVmeW4iOeahOi0puaIt1xuICAgICAgICAgICAgICAgIHVPcC5pZlByZXNlbnQodXNlclJlcG9zaXRvcnk6OmRlbGV0ZSk7XG4gICAgICAgICAgICAgICAgUGVyc29uIHAgPSBzLmdldFBlcnNvbigpO1xuICAgICAgICAgICAgICAgIHRlYWNoZXJSZXBvc2l0b3J5LmRlbGV0ZShzKTsgICAgLy/pppblhYjmlbDmja7lupPmsLjkuYXliKDpmaTmlZnluIjkv6Hmga9cbiAgICAgICAgICAgICAgICBwZXJzb25SZXBvc2l0b3J5LmRlbGV0ZShwKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gQ29tbW9uTWV0aG9kLmdldFJldHVybk1lc3NhZ2VPSygpOyAgLy/pgJrnn6XliY3nq6/mk43kvZzmraPluLhcbiAgICB9XG4gICAgcHVibGljIERhdGFSZXNwb25zZSBnZXRUZWFjaGVySW5mbyhEYXRhUmVxdWVzdCBkYXRhUmVxdWVzdCkge1xuICAgICAgICBJbnRlZ2VyIHBlcnNvbklkID0gZGF0YVJlcXVlc3QuZ2V0SW50ZWdlcihcInBlcnNvbklkXCIpO1xuICAgICAgICBUZWFjaGVyIHMgPSBudWxsO1xuICAgICAgICBPcHRpb25hbDxUZWFjaGVyPiBvcDtcbiAgICAgICAgaWYgKHBlcnNvbklkICE9IG51bGwpIHtcbiAgICAgICAgICAgIG9wID0gdGVhY2hlclJlcG9zaXRvcnkuZmluZEJ5SWQocGVyc29uSWQpOyAvL+agueaNruWtpueUn+S4u+mUruS7juaVsOaNruW6k+afpeivouWtpueUn+eahOS/oeaBr1xuICAgICAgICAgICAgaWYgKG9wLmlzUHJlc2VudCgpKSB7XG4gICAgICAgICAgICAgICAgcyA9IG9wLmdldCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBDb21tb25NZXRob2QuZ2V0UmV0dXJuRGF0YShnZXRNYXBGcm9tVGVhY2hlcihzKSk7IC8v6L+Z6YeM5Zue5Lyg5YyF5ZCr5a2m55Sf5L+h5oGv55qETWFw5a+56LGhXG4gICAgfVxuXG4gICAgcHVibGljIERhdGFSZXNwb25zZSB0ZWFjaGVyRWRpdFNhdmUoRGF0YVJlcXVlc3QgZGF0YVJlcXVlc3QpIHtcbiAgICAgICAgSW50ZWdlciBwZXJzb25JZCA9IGRhdGFSZXF1ZXN0LmdldEludGVnZXIoXCJwZXJzb25JZFwiKTtcbiAgICAgICAgTWFwPFN0cmluZyxPYmplY3Q+IGZvcm0gPSBkYXRhUmVxdWVzdC5nZXRNYXAoXCJmb3JtXCIpOyAvL+WPguaVsOiOt+WPlk1hcOWvueixoVxuICAgICAgICBTdHJpbmcgbnVtID0gQ29tbW9uTWV0aG9kLmdldFN0cmluZyhmb3JtLCBcIm51bVwiKTsgIC8vTWFwIOiOt+WPluWxnuaAp+eahOWAvFxuICAgICAgICBUZWFjaGVyIHMgPSBudWxsO1xuICAgICAgICBQZXJzb24gcDtcbiAgICAgICAgVXNlciB1O1xuICAgICAgICBPcHRpb25hbDxUZWFjaGVyPiBvcDtcbiAgICAgICAgYm9vbGVhbiBpc05ldyA9IGZhbHNlO1xuICAgICAgICBpZiAocGVyc29uSWQgIT0gbnVsbCkge1xuICAgICAgICAgICAgb3AgPSB0ZWFjaGVyUmVwb3NpdG9yeS5maW5kQnlJZChwZXJzb25JZCk7ICAvL+afpeivouWvueW6lOaVsOaNruW6k+S4reS4u+mUruS4umlk55qE5YC855qE5a6e5L2T5a+56LGhXG4gICAgICAgICAgICBpZiAob3AuaXNQcmVzZW50KCkpIHtcbiAgICAgICAgICAgICAgICBzID0gb3AuZ2V0KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgT3B0aW9uYWw8UGVyc29uPiBuT3AgPSBwZXJzb25SZXBvc2l0b3J5LmZpbmRCeU51bShudW0pOyAvL+afpeivouaYr+WQpuWtmOWcqG51beeahOS6uuWRmFxuICAgICAgICBpZiAobk9wLmlzUHJlc2VudCgpKSB7XG4gICAgICAgICAgICBpZiAocyA9PSBudWxsIHx8ICFzLmdldFBlcnNvbigpLmdldE51bSgpLmVxdWFscyhudW0pKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIENvbW1vbk1ldGhvZC5nZXRSZXR1cm5NZXNzYWdlRXJyb3IoXCLmlrDlrablj7flt7Lnu4/lrZjlnKjvvIzkuI3og73mt7vliqDmiJbkv67mlLnvvIFcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHMgPT0gbnVsbCkge1xuICAgICAgICAgICAgcCA9IG5ldyBQZXJzb24oKTtcbiAgICAgICAgICAgIHAuc2V0TnVtKG51bSk7XG4gICAgICAgICAgICBwLnNldFR5cGUoXCIxXCIpO1xuICAgICAgICAgICAgcGVyc29uUmVwb3NpdG9yeS5zYXZlQW5kRmx1c2gocCk7ICAvL+aPkuWFpeaWsOeahFBlcnNvbuiusOW9lVxuICAgICAgICAgICAgcGVyc29uSWQgPSBwLmdldFBlcnNvbklkKCk7XG4gICAgICAgICAgICBTdHJpbmcgcGFzc3dvcmQgPSBlbmNvZGVyLmVuY29kZShcIjEyMzQ1NlwiKTtcbiAgICAgICAgICAgIHUgPSBuZXcgVXNlcigpO1xuICAgICAgICAgICAgdS5zZXRQZXJzb25JZChwZXJzb25JZCk7XG4gICAgICAgICAgICB1LnNldFVzZXJOYW1lKG51bSk7XG4gICAgICAgICAgICB1LnNldFBhc3N3b3JkKHBhc3N3b3JkKTtcbiAgICAgICAgICAgIHUuc2V0VXNlclR5cGUodXNlclR5cGVSZXBvc2l0b3J5LmZpbmRCeU5hbWUoRVVzZXJUeXBlLlJPTEVfU1RVREVOVCkpO1xuICAgICAgICAgICAgdS5zZXRDcmVhdGVUaW1lKERhdGVUaW1lVG9vbC5wYXJzZURhdGVUaW1lKG5ldyBEYXRlKCkpKTtcbiAgICAgICAgICAgIHUuc2V0Q3JlYXRvcklkKENvbW1vbk1ldGhvZC5nZXRQZXJzb25JZCgpKTtcbiAgICAgICAgICAgIHVzZXJSZXBvc2l0b3J5LnNhdmVBbmRGbHVzaCh1KTsgLy/mj5LlhaXmlrDnmoRVc2Vy6K6w5b2VXG4gICAgICAgICAgICBzID0gbmV3IFRlYWNoZXIoKTsgICAvLyDliJvlu7rlrp7kvZPlr7nosaFcbiAgICAgICAgICAgIHMuc2V0UGVyc29uSWQocGVyc29uSWQpO1xuICAgICAgICAgICAgdGVhY2hlclJlcG9zaXRvcnkuc2F2ZUFuZEZsdXNoKHMpOyAgLy/mj5LlhaXmlrDnmoRTdHVkZW506K6w5b2VXG4gICAgICAgICAgICBpc05ldyA9IHRydWU7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBwID0gcy5nZXRQZXJzb24oKTtcbiAgICAgICAgfVxuLi4uXG4gICAgcHVibGljIFJlc3BvbnNlRW50aXR5PFN0cmVhbWluZ1Jlc3BvbnNlQm9keT4gZ2V0VGVhY2hlckxpc3RFeGNsKERhdGFSZXF1ZXN0IGRhdGFSZXF1ZXN0KSB7XG4gICAgICAgIFN0cmluZyBudW1OYW1lID0gZGF0YVJlcXVlc3QuZ2V0U3RyaW5nKFwibnVtTmFtZVwiKTtcbiAgICAgICAgTGlzdDxNYXA8U3RyaW5nLE9iamVjdD4+IGxpc3QgPSBnZXRUZWFjaGVyTWFwTGlzdChudW1OYW1lKTsgLy8g5YGH6K6+5bey5pS55Li66I635Y+W5pWZ5biI5pWw5o2u55qE5pa55rOVXG5cbiAgICAgICAgLy8g6LCD5pW05YiX5a696YWN572u77yI5qC55o2u5pWZ5biI5L+h5oGv54m554K56LCD5pW077yJXG4gICAgICAgIEludGVnZXJbXSB3aWR0aHMgPSB7OCwgMTUsIDEwLCAyMCwgMTUsIDEwLCA4LCAyNSwgMTUsIDMwfTtcbiAgICAgICAgU3RyaW5nW10gdGl0bGVzID0ge1wi5bqP5Y+3XCIsIFwi5bel5Y+3XCIsIFwi5aeT5ZCNXCIsIFwi5a2m6ZmiXCIsIFwi6IGM56ewXCIsIFwi5a2m5L2NXCIsIFwi5oCn5YirXCIsIFwi6YKu566xXCIsIFwi55S16K+dXCIsIFwi5Zyw5Z2AXCJ9O1xuICAgICAgICBTdHJpbmcgb3V0UHV0U2hlZXROYW1lID0gXCJ0ZWFjaGVyLnhsc3hcIjtcblxuICAgICAgICBYU1NGV29ya2Jvb2sgd2IgPSBuZXcgWFNTRldvcmtib29rKCk7XG4gICAgICAgIFhTU0ZTaGVldCBzaGVldCA9IHdiLmNyZWF0ZVNoZWV0KG91dFB1dFNoZWV0TmFtZSk7XG5cbiAgICAgICAgLy8g6K6+572u5YiX5a69XG4gICAgICAgIGZvcihpbnQgaiA9IDA7IGogPCB3aWR0aHMubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgICAgIHNoZWV0LnNldENvbHVtbldpZHRoKGosIHdpZHRoc1tqXSAqIDI1Nik7XG4gICAgICAgIH1cbi4uLlxuICAgIHB1YmxpYyBEYXRhUmVzcG9uc2UgZ2V0VGVhY2hlclBhZ2VEYXRhKERhdGFSZXF1ZXN0IGRhdGFSZXF1ZXN0KSB7XG4gICAgICAgIFN0cmluZyBudW1OYW1lID0gZGF0YVJlcXVlc3QuZ2V0U3RyaW5nKFwibnVtTmFtZVwiKTtcbiAgICAgICAgSW50ZWdlciBjUGFnZSA9IGRhdGFSZXF1ZXN0LmdldEN1cnJlbnRQYWdlKCk7XG4gICAgICAgIGludCBkYXRhVG90YWwgPSAwO1xuICAgICAgICBpbnQgc2l6ZSA9IDQwO1xuICAgICAgICBMaXN0PE1hcDxTdHJpbmcsT2JqZWN0Pj4gZGF0YUxpc3QgPSBuZXcgQXJyYXlMaXN0PD4oKTtcbiAgICAgICAgUGFnZTxUZWFjaGVyPiBwYWdlID0gbnVsbDtcbiAgICAgICAgUGFnZWFibGUgcGFnZWFibGUgPSBQYWdlUmVxdWVzdC5vZihjUGFnZSwgc2l6ZSk7XG4gICAgICAgIHBhZ2UgPSB0ZWFjaGVyUmVwb3NpdG9yeS5maW5kVGVhY2hlckxpc3RCeU51bU5hbWUobnVtTmFtZSwgcGFnZWFibGUpO1xuICAgICAgICBNYXA8U3RyaW5nLE9iamVjdD4gbTtcbiAgICAgICAgaWYgKHBhZ2UgIT0gbnVsbCkge1xuICAgICAgICAgICAgZGF0YVRvdGFsID0gKGludCkgcGFnZS5nZXRUb3RhbEVsZW1lbnRzKCk7XG4gICAgICAgICAgICBMaXN0PFRlYWNoZXI+IGxpc3QgPSBwYWdlLmdldENvbnRlbnQoKTtcbiAgICAgICAgICAgIGlmICghbGlzdC5pc0VtcHR5KCkpIHtcbiAgICAgICAgICAgICAgICBmb3IgKFRlYWNoZXIgdGVhY2hlciA6IGxpc3QpIHtcbiAgICAgICAgICAgICAgICAgICAgbSA9IGdldE1hcEZyb21UZWFjaGVyKHRlYWNoZXIpO1xuICAgICAgICAgICAgICAgICAgICBkYXRhTGlzdC5hZGQobSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4uLi5cbiAgICBwdWJsaWMgRGF0YVJlc3BvbnNlIGdldEZhbWlseU1lbWJlckxpc3QoRGF0YVJlcXVlc3QgZGF0YVJlcXVlc3QpIHtcbiAgICAgICAgSW50ZWdlciBwZXJzb25JZCA9IGRhdGFSZXF1ZXN0LmdldEludGVnZXIoXCJwZXJzb25JZFwiKTtcbiAgICAgICAgTGlzdDxGYW1pbHlNZW1iZXI+IGZMaXN0ID0gZmFtaWx5TWVtYmVyUmVwb3NpdG9yeS5maW5kQnlUZWFjaGVyUGVyc29uSWQocGVyc29uSWQpO1xuICAgICAgICBMaXN0PE1hcDxTdHJpbmcsT2JqZWN0Pj4gZGF0YUxpc3QgPSBuZXcgQXJyYXlMaXN0PD4oKTtcbiAgICAgICAgTWFwPFN0cmluZyxPYmplY3Q+IG07XG4gICAgICAgIGlmIChmTGlzdCAhPSBudWxsKSB7XG4gICAgICAgICAgICBmb3IgKEZhbWlseU1lbWJlciBmIDogZkxpc3QpIHtcbiAgICAgICAgICAgICAgICBtID0gbmV3IEhhc2hNYXA8PigpO1xuICAgICAgICAgICAgICAgIG0ucHV0KFwibWVtYmVySWRcIiwgZi5nZXRNZW1iZXJJZCgpKTtcbiAgICAgICAgICAgICAgICBtLnB1dChcInBlcnNvbklkXCIsIGYuZ2V0VGVhY2hlcigpLmdldFBlcnNvbklkKCkpO1xuICAgICAgICAgICAgICAgIG0ucHV0KFwicmVsYXRpb25cIiwgZi5nZXRSZWxhdGlvbigpKTtcbiAgICAgICAgICAgICAgICBtLnB1dChcIm5hbWVcIiwgZi5nZXROYW1lKCkpO1xuICAgICAgICAgICAgICAgIG0ucHV0KFwiZ2VuZGVyXCIsIGYuZ2V0R2VuZGVyKCkpO1xuICAgICAgICAgICAgICAgIG0ucHV0KFwiYWdlXCIsIGYuZ2V0QWdlKCkrXCJcIik7XG4gICAgICAgICAgICAgICAgbS5wdXQoXCJ1bml0XCIsIGYuZ2V0VW5pdCgpKTtcbiAgICAgICAgICAgICAgICBkYXRhTGlzdC5hZGQobSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIENvbW1vbk1ldGhvZC5nZXRSZXR1cm5EYXRhKGRhdGFMaXN0KTtcbiAgICB9XG4gICAgcHVibGljIERhdGFSZXNwb25zZSBmYW1pbHlNZW1iZXJTYXZlKERhdGFSZXF1ZXN0IGRhdGFSZXF1ZXN0KSB7XG4gICAgICAgIE1hcDxTdHJpbmcsT2JqZWN0PiBmb3JtID0gZGF0YVJlcXVlc3QuZ2V0TWFwKFwiZm9ybVwiKTtcbiAgICAgICAgSW50ZWdlciBwZXJzb25JZCA9IENvbW1vbk1ldGhvZC5nZXRJbnRlZ2VyKGZvcm0sXCJwZXJzb25JZFwiKTtcbiAgICAgICAgSW50ZWdlciBtZW1iZXJJZCA9IENvbW1vbk1ldGhvZC5nZXRJbnRlZ2VyKGZvcm0sXCJtZW1iZXJJZFwiKTtcbiAgICAgICAgT3B0aW9uYWw8RmFtaWx5TWVtYmVyPiBvcDtcbiAgICAgICAgRmFtaWx5TWVtYmVyIGYgPSBudWxsO1xuICAgICAgICBpZihtZW1iZXJJZCAhPSBudWxsKSB7XG4gICAgICAgICAgICBvcCA9IGZhbWlseU1lbWJlclJlcG9zaXRvcnkuZmluZEJ5SWQobWVtYmVySWQpO1xuICAgICAgICAgICAgaWYob3AuaXNQcmVzZW50KCkpIHtcbiAgICAgICAgICAgICAgICBmID0gb3AuZ2V0KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYoZj09IG51bGwpIHtcbiAgICAgICAgICAgIGYgPSBuZXcgRmFtaWx5TWVtYmVyKCk7XG4gICAgICAgICAgICBhc3NlcnQgcGVyc29uSWQgIT0gbnVsbDtcbiAgICAgICAgICAgIGYuc2V0U3R1ZGVudCh0ZWFjaGVyUmVwb3NpdG9yeS5maW5kQnlJZChwZXJzb25JZCkuZ2V0KCkpO1xuICAgICAgICB9XG4gICAgICAgIGYuc2V0UmVsYXRpb24oQ29tbW9uTWV0aG9kLmdldFN0cmluZyhmb3JtLFwicmVsYXRpb25cIikpO1xuICAgICAgICBmLnNldE5hbWUoQ29tbW9uTWV0aG9kLmdldFN0cmluZyhmb3JtLFwibmFtZVwiKSk7XG4gICAgICAgIGYuc2V0R2VuZGVyKENvbW1vbk1ldGhvZC5nZXRTdHJpbmcoZm9ybSxcImdlbmRlclwiKSk7XG4gICAgICAgIGYuc2V0QWdlKENvbW1vbk1ldGhvZC5nZXRJbnRlZ2VyKGZvcm0sXCJhZ2VcIikpO1xuICAgICAgICBmLnNldFVuaXQoQ29tbW9uTWV0aG9kLmdldFN0cmluZyhmb3JtLFwidW5pdFwiKSk7XG4gICAgICAgIGZhbWlseU1lbWJlclJlcG9zaXRvcnkuc2F2ZShmKTtcbiAgICAgICAgcmV0dXJuIENvbW1vbk1ldGhvZC5nZXRSZXR1cm5NZXNzYWdlT0soKTtcbiAgICB9XG59XG5cbi4uLlxuUGF0aDogc3JjL21haW4vamF2YS9jbi9lZHUvc2R1L2phdmEvc2VydmVyL3NlcnZpY2VzL1N0dWRlbnRTZXJ2aWNlLmphdmFcbi4uLlxuXG5cblxuICAgIC8qXG4gICAgICAgIEZhbWlseU1lbWJlclxuICAgICAqL1xuICAgIHB1YmxpYyBEYXRhUmVzcG9uc2UgZ2V0RmFtaWx5TWVtYmVyTGlzdChEYXRhUmVxdWVzdCBkYXRhUmVxdWVzdCkge1xuICAgICAgICBJbnRlZ2VyIHBlcnNvbklkID0gZGF0YVJlcXVlc3QuZ2V0SW50ZWdlcihcInBlcnNvbklkXCIpO1xuICAgICAgICBMaXN0PEZhbWlseU1lbWJlcj4gZkxpc3QgPSBmYW1pbHlNZW1iZXJSZXBvc2l0b3J5LmZpbmRCeVN0dWRlbnRQZXJzb25JZChwZXJzb25JZCk7XG4gICAgICAgIExpc3Q8TWFwPFN0cmluZyxPYmplY3Q+PiBkYXRhTGlzdCA9IG5ldyBBcnJheUxpc3Q8PigpO1xuICAgICAgICBNYXA8U3RyaW5nLE9iamVjdD4gbTtcbiAgICAgICAgaWYgKGZMaXN0ICE9IG51bGwpIHtcbiAgICAgICAgICAgIGZvciAoRmFtaWx5TWVtYmVyIGYgOiBmTGlzdCkge1xuICAgICAgICAgICAgICAgIG0gPSBuZXcgSGFzaE1hcDw+KCk7XG4gICAgICAgICAgICAgICAgbS5wdXQoXCJtZW1iZXJJZFwiLCBmLmdldE1lbWJlcklkKCkpO1xuICAgICAgICAgICAgICAgIG0ucHV0KFwicGVyc29uSWRcIiwgZi5nZXRTdHVkZW50KCkuZ2V0UGVyc29uSWQoKSk7XG4gICAgICAgICAgICAgICAgbS5wdXQoXCJyZWxhdGlvblwiLCBmLmdldFJlbGF0aW9uKCkpO1xuICAgICAgICAgICAgICAgIG0ucHV0KFwibmFtZVwiLCBmLmdldE5hbWUoKSk7XG4gICAgICAgICAgICAgICAgbS5wdXQoXCJnZW5kZXJcIiwgZi5nZXRHZW5kZXIoKSk7XG4gICAgICAgICAgICAgICAgbS5wdXQoXCJhZ2VcIiwgZi5nZXRBZ2UoKStcIlwiKTtcbiAgICAgICAgICAgICAgICBtLnB1dChcInVuaXRcIiwgZi5nZXRVbml0KCkpO1xuICAgICAgICAgICAgICAgIGRhdGFMaXN0LmFkZChtKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gQ29tbW9uTWV0aG9kLmdldFJldHVybkRhdGEoZGF0YUxpc3QpO1xuICAgIH1cblxuICAgIHB1YmxpYyBEYXRhUmVzcG9uc2UgZmFtaWx5TWVtYmVyU2F2ZShEYXRhUmVxdWVzdCBkYXRhUmVxdWVzdCkge1xuICAgICAgICBNYXA8U3RyaW5nLE9iamVjdD4gZm9ybSA9IGRhdGFSZXF1ZXN0LmdldE1hcChcImZvcm1cIik7XG4gICAgICAgIEludGVnZXIgcGVyc29uSWQgPSBDb21tb25NZXRob2QuZ2V0SW50ZWdlcihmb3JtLFwicGVyc29uSWRcIik7XG4gICAgICAgIEludGVnZXIgbWVtYmVySWQgPSBDb21tb25NZXRob2QuZ2V0SW50ZWdlcihmb3JtLFwibWVtYmVySWRcIik7XG4gICAgICAgIE9wdGlvbmFsPEZhbWlseU1lbWJlcj4gb3A7XG4gICAgICAgIEZhbWlseU1lbWJlciBmID0gbnVsbDtcbiAgICAgICAgaWYobWVtYmVySWQgIT0gbnVsbCkge1xuICAgICAgICAgICAgb3AgPSBmYW1pbHlNZW1iZXJSZXBvc2l0b3J5LmZpbmRCeUlkKG1lbWJlcklkKTtcbiAgICAgICAgICAgIGlmKG9wLmlzUHJlc2VudCgpKSB7XG4gICAgICAgICAgICAgICAgZiA9IG9wLmdldCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmKGY9PSBudWxsKSB7XG4gICAgICAgICAgICBmID0gbmV3IEZhbWlseU1lbWJlcigpO1xuICAgICAgICAgICAgYXNzZXJ0IHBlcnNvbklkICE9IG51bGw7XG4gICAgICAgICAgICBmLnNldFN0dWRlbnQoc3R1ZGVudFJlcG9zaXRvcnkuZmluZEJ5SWQocGVyc29uSWQpLmdldCgpKTtcbiAgICAgICAgfVxuICAgICAgICBmLnNldFJlbGF0aW9uKENvbW1vbk1ldGhvZC5nZXRTdHJpbmcoZm9ybSxcInJlbGF0aW9uXCIpKTtcbiAgICAgICAgZi5zZXROYW1lKENvbW1vbk1ldGhvZC5nZXRTdHJpbmcoZm9ybSxcIm5hbWVcIikpO1xuICAgICAgICBmLnNldEdlbmRlcihDb21tb25NZXRob2QuZ2V0U3RyaW5nKGZvcm0sXCJnZW5kZXJcIikpO1xuICAgICAgICBmLnNldEFnZShDb21tb25NZXRob2QuZ2V0SW50ZWdlcihmb3JtLFwiYWdlXCIpKTtcbiAgICAgICAgZi5zZXRVbml0KENvbW1vbk1ldGhvZC5nZXRTdHJpbmcoZm9ybSxcInVuaXRcIikpO1xuICAgICAgICBmYW1pbHlNZW1iZXJSZXBvc2l0b3J5LnNhdmUoZik7XG4gICAgICAgIHJldHVybiBDb21tb25NZXRob2QuZ2V0UmV0dXJuTWVzc2FnZU9LKCk7XG4gICAgfVxuXG4gICAgcHVibGljIERhdGFSZXNwb25zZSBmYW1pbHlNZW1iZXJEZWxldGUoRGF0YVJlcXVlc3QgZGF0YVJlcXVlc3QpIHtcbiAgICAgICAgSW50ZWdlciBtZW1iZXJJZCA9IGRhdGFSZXF1ZXN0LmdldEludGVnZXIoXCJtZW1iZXJJZFwiKTtcbiAgICAgICAgT3B0aW9uYWw8RmFtaWx5TWVtYmVyPiBvcDtcbiAgICAgICAgb3AgPSBmYW1pbHlNZW1iZXJSZXBvc2l0b3J5LmZpbmRCeUlkKG1lbWJlcklkKTtcbiAgICAgICAgb3AuaWZQcmVzZW50KGZhbWlseU1lbWJlclJlcG9zaXRvcnk6OmRlbGV0ZSk7XG4gICAgICAgIHJldHVybiBDb21tb25NZXRob2QuZ2V0UmV0dXJuTWVzc2FnZU9LKCk7XG4gICAgfVxuLi4uXG5QYXRoOiBqYXZhLXNlcnZlci9zcmMvbWFpbi9qYXZhL2NuL2VkdS9zZHUvamF2YS9zZXJ2ZXIvc2VydmljZXMvVGVhY2hlclNlcnZpY2VzLmphdmFcbi4uLlxuaW1wb3J0IG9yZy5zcHJpbmdmcmFtZXdvcmsuc3RlcmVvdHlwZS5TZXJ2aWNlO1xuaW1wb3J0IG9yZy5zcHJpbmdmcmFtZXdvcmsud2ViLnNlcnZsZXQubXZjLm1ldGhvZC5hbm5vdGF0aW9uLlN0cmVhbWluZ1Jlc3BvbnNlQm9keTtcblxuaW1wb3J0IGphdmEudXRpbC4qO1xuXG5AU2VydmljZVxucHVibGljIGNsYXNzIFRlYWNoZXJTZXJ2aWNlcyB7XG4gICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgTG9nZ2VyIGxvZyA9IExvZ2dlckZhY3RvcnkuZ2V0TG9nZ2VyKFRlYWNoZXJTZXJ2aWNlcy5jbGFzcyk7XG4gICAgcHJpdmF0ZSBmaW5hbCBQZXJzb25SZXBvc2l0b3J5IHBlcnNvblJlcG9zaXRvcnk7ICAvL+S6uuWRmOaVsOaNruaTjeS9nOiHquWKqOazqOWFpVxuICAgIHByaXZhdGUgZmluYWwgVGVhY2hlclJlcG9zaXRvcnkgdGVhY2hlclJlcG9zaXRvcnk7ICAvL+aVmeW4iOaVsOaNruaTjeS9nOiHquWKqOazqOWFpVxuICAgIHByaXZhdGUgZmluYWwgVXNlclJlcG9zaXRvcnkgdXNlclJlcG9zaXRvcnk7ICAvL+aVsOaNruaTjeS9nOiHquWKqOazqOWFpVxuICAgIHByaXZhdGUgZmluYWwgVXNlclR5cGVSZXBvc2l0b3J5IHVzZXJUeXBlUmVwb3NpdG9yeTsgLy/nlKjmiLfnsbvlnovmlbDmja7mk43kvZzoh6rliqjms6jlhaVcbiAgICBwcml2YXRlIGZpbmFsIFBhc3N3b3JkRW5jb2RlciBlbmNvZGVyOyAgLy/lr4bnoIHmnI3liqHoh6rliqjms6jlhaVcbiAgICAvL+a2iOi0ueaVsOaNruaTjeS9nOiHquWKqOazqOWFpVxuICAgIHByaXZhdGUgZmluYWwgRmFtaWx5TWVtYmVyUmVwb3NpdG9yeSBmYW1pbHlNZW1iZXJSZXBvc2l0b3J5O1xuICAgIHByaXZhdGUgZmluYWwgU3lzdGVtU2VydmljZSBzeXN0ZW1TZXJ2aWNlO1xuLi4uXG5cbiAgICBwdWJsaWMgTWFwPFN0cmluZywgT2JqZWN0PiBnZXRNYXBGcm9tVGVhY2hlcihUZWFjaGVyIHMpIHtcbiAgICAgICAgTWFwPFN0cmluZywgT2JqZWN0PiBtID0gbmV3IEhhc2hNYXA8PigpO1xuICAgICAgICBQZXJzb24gcDtcbiAgICAgICAgaWYgKHMgPT0gbnVsbClcbiAgICAgICAgICAgIHJldHVybiBtO1xuICAgICAgICBtLnB1dChcInRpdGxlXCIsIHMuZ2V0VGl0bGUoKSk7XG4gICAgICAgIG0ucHV0KFwiZGVncmVlXCIsIHMuZ2V0RGVncmVlKCkpO1xuICAgICAgICBtLnB1dChcImNsYXNzTmFtZVwiLCBzLmdldENsYXNzTmFtZSgpKTtcbiAgICAgICAgcCA9IHMuZ2V0UGVyc29uKCk7XG4gICAgICAgIGlmIChwID09IG51bGwpXG4gICAgICAgICAgICByZXR1cm4gbTtcbiAgICAgICAgbS5wdXQoXCJwZXJzb25JZFwiLCBzLmdldFBlcnNvbklkKCkpO1xuICAgICAgICBtLnB1dChcIm51bVwiLCBwLmdldE51bSgpKTtcbiAgICAgICAgbS5wdXQoXCJuYW1lXCIsIHAuZ2V0TmFtZSgpKTtcbiAgICAgICAgbS5wdXQoXCJkZXB0XCIsIHAuZ2V0RGVwdCgpKTtcbiAgICAgICAgbS5wdXQoXCJjYXJkXCIsIHAuZ2V0Q2FyZCgpKTtcbiAgICAgICAgU3RyaW5nIGdlbmRlciA9IHAuZ2V0R2VuZGVyKCk7XG4gICAgICAgIG0ucHV0KFwiZ2VuZGVyXCIsIGdlbmRlcik7XG4gICAgICAgIG0ucHV0KFwiZ2VuZGVyTmFtZVwiLCBDb21EYXRhVXRpbC5nZXRJbnN0YW5jZSgpLmdldERpY3Rpb25hcnlMYWJlbEJ5VmFsdWUoXCJYQk1cIiwgZ2VuZGVyKSk7IC8v5oCn5Yir57G75Z6L55qE5YC86L2s5o2i5oiQ5pWw5o2u57G75Z6L5ZCNXG4gICAgICAgIG0ucHV0KFwiYmlydGhkYXlcIiwgcC5nZXRCaXJ0aGRheSgpKTsgIC8v5pe26Ze05qC85byP6L2s5o2i5a2X56ym5LiyXG4gICAgICAgIG0ucHV0KFwiZW1haWxcIiwgcC5nZXRFbWFpbCgpKTtcbiAgICAgICAgbS5wdXQoXCJwaG9uZVwiLCBwLmdldFBob25lKCkpO1xuICAgICAgICBtLnB1dChcImFkZHJlc3NcIiwgcC5nZXRBZGRyZXNzKCkpO1xuICAgICAgICBtLnB1dChcImludHJvZHVjZVwiLCBwLmdldEludHJvZHVjZSgpKTtcbiAgICAgICAgcmV0dXJuIG07XG4gICAgfVxuXG4gICAgcHVibGljIExpc3Q8TWFwPFN0cmluZywgT2JqZWN0Pj4gZ2V0VGVhY2hlck1hcExpc3QoU3RyaW5nIG51bU5hbWUpIHtcbiAgICAgICAgTGlzdDxNYXA8U3RyaW5nLCBPYmplY3Q+PiBkYXRhTGlzdCA9IG5ldyBBcnJheUxpc3Q8PigpO1xuICAgICAgICBMaXN0PFRlYWNoZXI+IHNMaXN0ID0gdGVhY2hlclJlcG9zaXRvcnkuZmluZFRlYWNoZXJMaXN0QnlOdW1OYW1lKG51bU5hbWUpOyAgLy/mlbDmja7lupPmn6Xor6Lmk43kvZxcbiAgICAgICAgaWYgKHNMaXN0ID09IG51bGwgfHwgc0xpc3QuaXNFbXB0eSgpKVxuICAgICAgICAgICAgcmV0dXJuIGRhdGFMaXN0O1xuICAgICAgICBmb3IgKFRlYWNoZXIgdGVhY2hlciA6IHNMaXN0KSB7XG4gICAgICAgICAgICBkYXRhTGlzdC5hZGQoZ2V0TWFwRnJvbVRlYWNoZXIodGVhY2hlcikpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBkYXRhTGlzdDtcbiAgICB9XG5cbiAgICBwdWJsaWMgRGF0YVJlc3BvbnNlIGdldFRlYWNoZXJMaXN0KERhdGFSZXF1ZXN0IGRhdGFSZXF1ZXN0KSB7XG4gICAgICAgIFN0cmluZyBudW1OYW1lID0gZGF0YVJlcXVlc3QuZ2V0U3RyaW5nKFwibnVtTmFtZVwiKTtcbiAgICAgICAgTGlzdDxNYXA8U3RyaW5nLCBPYmplY3Q+PiBkYXRhTGlzdCA9IGdldFRlYWNoZXJNYXBMaXN0KG51bU5hbWUpO1xuICAgICAgICByZXR1cm4gQ29tbW9uTWV0aG9kLmdldFJldHVybkRhdGEoZGF0YUxpc3QpOyAgLy/mjInnhafmtYvor5XmoYbmnrbop4TojIPkvJrpgIFNYXDnmoRsaXN0XG4gICAgfVxuXG4gICAgcHVibGljIERhdGFSZXNwb25zZSB0ZWFjaGVyRGVsZXRlKERhdGFSZXF1ZXN0IGRhdGFSZXF1ZXN0KSB7XG4gICAgICAgIEludGVnZXIgcGVyc29uSWQgPSBkYXRhUmVxdWVzdC5nZXRJbnRlZ2VyKFwicGVyc29uSWRcIik7ICAvL+iOt+WPlnRlYWNoZXJfaWTlgLxcbiAgICAgICAgVGVhY2hlciBzID0gbnVsbDtcbiAgICAgICAgT3B0aW9uYWw8VGVhY2hlcj4gb3A7XG4gICAgICAgIGlmIChwZXJzb25JZCAhPSBudWxsICYmIHBlcnNvbklkID4gMCkge1xuICAgICAgICAgICAgb3AgPSB0ZWFjaGVyUmVwb3NpdG9yeS5maW5kQnlJZChwZXJzb25JZCk7ICAgLy/mn6Xor6Lojrflvpflrp7kvZPlr7nosaFcbiAgICAgICAgICAgIGlmIChvcC5pc1ByZXNlbnQoKSkge1xuICAgICAgICAgICAgICAgIHMgPSBvcC5nZXQoKTtcbiAgICAgICAgICAgICAgICBPcHRpb25hbDxVc2VyPiB1T3AgPSB1c2VyUmVwb3NpdG9yeS5maW5kQnlJZChwZXJzb25JZCk7IC8v5p+l6K+i5a+55bqU6K+l5pWZ5biI55qE6LSm5oi3XG4gICAgICAgICAgICAgICAgLy/liKDpmaTlr7nlupTor6XmlZnluIjnmoTotKbmiLdcbiAgICAgICAgICAgICAgICB1T3AuaWZQcmVzZW50KHVzZXJSZXBvc2l0b3J5OjpkZWxldGUpO1xuICAgICAgICAgICAgICAgIFBlcnNvbiBwID0gcy5nZXRQZXJzb24oKTtcbiAgICAgICAgICAgICAgICB0ZWFjaGVyUmVwb3NpdG9yeS5kZWxldGUocyk7ICAgIC8v6aaW5YWI5pWw5o2u5bqT5rC45LmF5Yig6Zmk5pWZ5biI5L+h5oGvXG4gICAgICAgICAgICAgICAgcGVyc29uUmVwb3NpdG9yeS5kZWxldGUocCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIENvbW1vbk1ldGhvZC5nZXRSZXR1cm5NZXNzYWdlT0soKTsgIC8v6YCa55+l5YmN56uv5pON5L2c5q2j5bi4XG4gICAgfVxuXG4gICAgcHVibGljIERhdGFSZXNwb25zZSBnZXRUZWFjaGVySW5mbyhEYXRhUmVxdWVzdCBkYXRhUmVxdWVzdCkge1xuICAgICAgICBJbnRlZ2VyIHBlcnNvbklkID0gZGF0YVJlcXVlc3QuZ2V0SW50ZWdlcihcInBlcnNvbklkXCIpO1xuICAgICAgICBUZWFjaGVyIHMgPSBudWxsO1xuICAgICAgICBPcHRpb25hbDxUZWFjaGVyPiBvcDtcbiAgICAgICAgaWYgKHBlcnNvbklkICE9IG51bGwpIHtcbiAgICAgICAgICAgIG9wID0gdGVhY2hlclJlcG9zaXRvcnkuZmluZEJ5SWQocGVyc29uSWQpOyAvL+agueaNruWtpueUn+S4u+mUruS7juaVsOaNruW6k+afpeivouWtpueUn+eahOS/oeaBr1xuICAgICAgICAgICAgaWYgKG9wLmlzUHJlc2VudCgpKSB7XG4gICAgICAgICAgICAgICAgcyA9IG9wLmdldCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBDb21tb25NZXRob2QuZ2V0UmV0dXJuRGF0YShnZXRNYXBGcm9tVGVhY2hlcihzKSk7IC8v6L+Z6YeM5Zue5Lyg5YyF5ZCr5a2m55Sf5L+h5oGv55qETWFw5a+56LGhXG4gICAgfVxuXG4gICAgcHVibGljIERhdGFSZXNwb25zZSB0ZWFjaGVyRWRpdFNhdmUoRGF0YVJlcXVlc3QgZGF0YVJlcXVlc3QpIHtcbiAgICAgICAgSW50ZWdlciBwZXJzb25JZCA9IGRhdGFSZXF1ZXN0LmdldEludGVnZXIoXCJwZXJzb25JZFwiKTtcbiAgICAgICAgTWFwPFN0cmluZywgT2JqZWN0PiBmb3JtID0gZGF0YVJlcXVlc3QuZ2V0TWFwKFwiZm9ybVwiKTsgLy/lj4LmlbDojrflj5ZNYXDlr7nosaFcbiAgICAgICAgU3RyaW5nIG51bSA9IENvbW1vbk1ldGhvZC5nZXRTdHJpbmcoZm9ybSwgXCJudW1cIik7ICAvL01hcCDojrflj5blsZ7mgKfnmoTlgLxcbiAgICAgICAgVGVhY2hlciBzID0gbnVsbDtcbiAgICAgICAgUGVyc29uIHA7XG4gICAgICAgIFVzZXIgdTtcbiAgICAgICAgT3B0aW9uYWw8VGVhY2hlcj4gb3A7XG4gICAgICAgIGJvb2xlYW4gaXNOZXcgPSBmYWxzZTtcbiAgICAgICAgaWYgKHBlcnNvbklkICE9IG51bGwpIHtcbiAgICAgICAgICAgIG9wID0gdGVhY2hlclJlcG9zaXRvcnkuZmluZEJ5SWQocGVyc29uSWQpOyAgLy/mn6Xor6Llr7nlupTmlbDmja7lupPkuK3kuLvplK7kuLppZOeahOWAvOeahOWunuS9k+WvueixoVxuICAgICAgICAgICAgaWYgKG9wLmlzUHJlc2VudCgpKSB7XG4gICAgICAgICAgICAgICAgcyA9IG9wLmdldCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIE9wdGlvbmFsPFBlcnNvbj4gbk9wID0gcGVyc29uUmVwb3NpdG9yeS5maW5kQnlOdW0obnVtKTsgLy/mn6Xor6LmmK/lkKblrZjlnKhudW3nmoTkurrlkZhcbiAgICAgICAgaWYgKG5PcC5pc1ByZXNlbnQoKSkge1xuICAgICAgICAgICAgaWYgKHMgPT0gbnVsbCB8fCAhcy5nZXRQZXJzb24oKS5nZXROdW0oKS5lcXVhbHMobnVtKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBDb21tb25NZXRob2QuZ2V0UmV0dXJuTWVzc2FnZUVycm9yKFwi5paw5bel5Y+35bey57uP5a2Y5Zyo77yM5LiN6IO95re75Yqg5oiW5L+u5pS577yBXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmIChzID09IG51bGwpIHtcbiAgICAgICAgICAgIHAgPSBuZXcgUGVyc29uKCk7XG4gICAgICAgICAgICBwLnNldE51bShudW0pO1xuICAgICAgICAgICAgcC5zZXRUeXBlKFwiMlwiKTsgIC8vIDLooajnpLrmlZnluIjnsbvlnotcbiAgICAgICAgICAgIHBlcnNvblJlcG9zaXRvcnkuc2F2ZUFuZEZsdXNoKHApOyAgLy/mj5LlhaXmlrDnmoRQZXJzb27orrDlvZVcbiAgICAgICAgICAgIHBlcnNvbklkID0gcC5nZXRQZXJzb25JZCgpO1xuICAgICAgICAgICAgU3RyaW5nIHBhc3N3b3JkID0gZW5jb2Rlci5lbmNvZGUoXCIxMjM0NTZcIik7XG4gICAgICAgICAgICB1ID0gbmV3IFVzZXIoKTtcbiAgICAgICAgICAgIHUuc2V0UGVyc29uSWQocGVyc29uSWQpO1xuICAgICAgICAgICAgdS5zZXRVc2VyTmFtZShudW0pO1xuICAgICAgICAgICAgdS5zZXRQYXNzd29yZChwYXNzd29yZCk7XG4gICAgICAgICAgICB1LnNldFVzZXJUeXBlKHVzZXJUeXBlUmVwb3NpdG9yeS5maW5kQnlOYW1lKEVVc2VyVHlwZS5ST0xFX1RFQUNIRVIpKTsgIC8vIOiuvue9ruS4uuaVmeW4iOinkuiJslxuICAgICAgICAgICAgdS5zZXRDcmVhdGVUaW1lKERhdGVUaW1lVG9vbC5wYXJzZURhdGVUaW1lKG5ldyBEYXRlKCkpKTtcbiAgICAgICAgICAgIHUuc2V0Q3JlYXRvcklkKENvbW1vbk1ldGhvZC5nZXRQZXJzb25JZCgpKTtcbiAgICAgICAgICAgIHVzZXJSZXBvc2l0b3J5LnNhdmVBbmRGbHVzaCh1KTsgLy/mj5LlhaXmlrDnmoRVc2Vy6K6w5b2VXG4gICAgICAgICAgICBzID0gbmV3IFRlYWNoZXIoKTsgICAvLyDliJvlu7rlrp7kvZPlr7nosaFcbiAgICAgICAgICAgIHMuc2V0UGVyc29uSWQocGVyc29uSWQpO1xuICAgICAgICAgICAgdGVhY2hlclJlcG9zaXRvcnkuc2F2ZUFuZEZsdXNoKHMpOyAgLy/mj5LlhaXmlrDnmoRUZWFjaGVy6K6w5b2VXG4gICAgICAgICAgICBpc05ldyA9IHRydWU7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBwID0gcy5nZXRQZXJzb24oKTtcbiAgICAgICAgfVxuLi4uXG5cbiAgICBwdWJsaWMgUmVzcG9uc2VFbnRpdHk8U3RyZWFtaW5nUmVzcG9uc2VCb2R5PiBnZXRUZWFjaGVyTGlzdEV4Y2woRGF0YVJlcXVlc3QgZGF0YVJlcXVlc3QpIHtcbiAgICAgICAgU3RyaW5nIG51bU5hbWUgPSBkYXRhUmVxdWVzdC5nZXRTdHJpbmcoXCJudW1OYW1lXCIpO1xuICAgICAgICBMaXN0PE1hcDxTdHJpbmcsIE9iamVjdD4+IGxpc3QgPSBnZXRUZWFjaGVyTWFwTGlzdChudW1OYW1lKTtcblxuICAgICAgICAvLyDosIPmlbTliJflrr3phY3nva5cbiAgICAgICAgSW50ZWdlcltdIHdpZHRocyA9IHs4LCAxNSwgMTAsIDIwLCAxNSwgMTAsIDgsIDI1LCAxNSwgMzB9O1xuICAgICAgICBTdHJpbmdbXSB0aXRsZXMgPSB7XCLluo/lj7dcIiwgXCLlt6Xlj7dcIiwgXCLlp5PlkI1cIiwgXCLlrabpmaJcIiwgXCLogYznp7BcIiwgXCLlrabkvY1cIiwgXCLmgKfliKtcIiwgXCLpgq7nrrFcIiwgXCLnlLXor51cIiwgXCLlnLDlnYBcIn07XG4gICAgICAgIFN0cmluZyBvdXRQdXRTaGVldE5hbWUgPSBcInRlYWNoZXIueGxzeFwiO1xuXG4gICAgICAgIFhTU0ZXb3JrYm9vayB3YiA9IG5ldyBYU1NGV29ya2Jvb2soKTtcbiAgICAgICAgWFNTRlNoZWV0IHNoZWV0ID0gd2IuY3JlYXRlU2hlZXQob3V0UHV0U2hlZXROYW1lKTtcblxuICAgICAgICAvLyDorr7nva7liJflrr1cbiAgICAgICAgZm9yIChpbnQgaiA9IDA7IGogPCB3aWR0aHMubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgICAgIHNoZWV0LnNldENvbHVtbldpZHRoKGosIHdpZHRoc1tqXSAqIDI1Nik7XG4gICAgICAgIH1cbi4uLlxuXG4gICAgcHVibGljIERhdGFSZXNwb25zZSBnZXRUZWFjaGVyUGFnZURhdGEoRGF0YVJlcXVlc3QgZGF0YVJlcXVlc3QpIHtcbiAgICAgICAgU3RyaW5nIG51bU5hbWUgPSBkYXRhUmVxdWVzdC5nZXRTdHJpbmcoXCJudW1OYW1lXCIpO1xuICAgICAgICBJbnRlZ2VyIGNQYWdlID0gZGF0YVJlcXVlc3QuZ2V0Q3VycmVudFBhZ2UoKTtcbiAgICAgICAgaW50IGRhdGFUb3RhbCA9IDA7XG4gICAgICAgIGludCBzaXplID0gNDA7XG4gICAgICAgIExpc3Q8TWFwPFN0cmluZywgT2JqZWN0Pj4gZGF0YUxpc3QgPSBuZXcgQXJyYXlMaXN0PD4oKTtcbiAgICAgICAgUGFnZTxUZWFjaGVyPiBwYWdlID0gbnVsbDtcbiAgICAgICAgUGFnZWFibGUgcGFnZWFibGUgPSBQYWdlUmVxdWVzdC5vZihjUGFnZSwgc2l6ZSk7XG4gICAgICAgIHBhZ2UgPSB0ZWFjaGVyUmVwb3NpdG9yeS5maW5kVGVhY2hlckxpc3RCeU51bU5hbWUobnVtTmFtZSwgcGFnZWFibGUpO1xuICAgICAgICBNYXA8U3RyaW5nLCBPYmplY3Q+IG07XG4gICAgICAgIGlmIChwYWdlICE9IG51bGwpIHtcbiAgICAgICAgICAgIGRhdGFUb3RhbCA9IChpbnQpIHBhZ2UuZ2V0VG90YWxFbGVtZW50cygpO1xuICAgICAgICAgICAgTGlzdDxUZWFjaGVyPiBsaXN0ID0gcGFnZS5nZXRDb250ZW50KCk7XG4gICAgICAgICAgICBpZiAoIWxpc3QuaXNFbXB0eSgpKSB7XG4gICAgICAgICAgICAgICAgZm9yIChUZWFjaGVyIHRlYWNoZXIgOiBsaXN0KSB7XG4gICAgICAgICAgICAgICAgICAgIG0gPSBnZXRNYXBGcm9tVGVhY2hlcih0ZWFjaGVyKTtcbiAgICAgICAgICAgICAgICAgICAgZGF0YUxpc3QuYWRkKG0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuLi4uXG5QYXRoOiBqYXZhLXNlcnZlci9zcmMvbWFpbi9qYXZhL2NuL2VkdS9zZHUvamF2YS9zZXJ2ZXIvY29udHJvbGxlcnMvU3R1ZGVudENvbnRyb2xsZXIuamF2YVxuLi4uXG5cbiAgICAvKlxuICAgICAgICBGYW1pbHlNZW1iZXJcbiAgICAgKi9cbiAgICBAUG9zdE1hcHBpbmcoXCIvZ2V0RmFtaWx5TWVtYmVyTGlzdFwiKVxuICAgIEBQcmVBdXRob3JpemUoXCIgaGFzUm9sZSgnQURNSU4nKSBvciAgaGFzUm9sZSgnU1RVREVOVCcpXCIpXG4gICAgcHVibGljIERhdGFSZXNwb25zZSBnZXRGYW1pbHlNZW1iZXJMaXN0KEBWYWxpZCBAUmVxdWVzdEJvZHkgRGF0YVJlcXVlc3QgZGF0YVJlcXVlc3QpIHtcbiAgICAgICAgcmV0dXJuIHN0dWRlbnRTZXJ2aWNlLmdldEZhbWlseU1lbWJlckxpc3QoZGF0YVJlcXVlc3QpO1xuICAgIH1cblxuICAgIEBQb3N0TWFwcGluZyhcIi9mYW1pbHlNZW1iZXJTYXZlXCIpXG4gICAgQFByZUF1dGhvcml6ZShcIiBoYXNSb2xlKCdBRE1JTicpIG9yICBoYXNSb2xlKCdTVFVERU5UJylcIilcbiAgICBwdWJsaWMgRGF0YVJlc3BvbnNlIGZhbWlseU1lbWJlclNhdmUoQFZhbGlkIEBSZXF1ZXN0Qm9keSBEYXRhUmVxdWVzdCBkYXRhUmVxdWVzdCkge1xuICAgICAgICByZXR1cm4gc3R1ZGVudFNlcnZpY2UuZmFtaWx5TWVtYmVyU2F2ZShkYXRhUmVxdWVzdCk7XG4gICAgfVxuXG4gICAgQFBvc3RNYXBwaW5nKFwiL2ZhbWlseU1lbWJlckRlbGV0ZVwiKVxuICAgIEBQcmVBdXRob3JpemUoXCIgaGFzUm9sZSgnQURNSU4nKSBvciAgaGFzUm9sZSgnU1RVREVOVCcpXCIpXG4gICAgcHVibGljIERhdGFSZXNwb25zZSBmYW1pbHlNZW1iZXJEZWxldGUoQFZhbGlkIEBSZXF1ZXN0Qm9keSBEYXRhUmVxdWVzdCBkYXRhUmVxdWVzdCkge1xuICAgICAgICByZXR1cm4gc3R1ZGVudFNlcnZpY2UuZmFtaWx5TWVtYmVyRGVsZXRlKGRhdGFSZXF1ZXN0KTtcbiAgICB9XG4uLi5cblBhdGg6IGphdmEtc2VydmVyL3NyYy9tYWluL2phdmEvY24vZWR1L3NkdS9qYXZhL3NlcnZlci9tb2RlbHMvRmFtaWx5TWVtYmVyLmphdmFcbnBhY2thZ2UgY24uZWR1LnNkdS5qYXZhLnNlcnZlci5tb2RlbHM7XG5cbmltcG9ydCBqYWthcnRhLnBlcnNpc3RlbmNlLio7XG5pbXBvcnQgamFrYXJ0YS52YWxpZGF0aW9uLmNvbnN0cmFpbnRzLlNpemU7XG5pbXBvcnQgbG9tYm9rLkdldHRlcjtcbmltcG9ydCBsb21ib2suU2V0dGVyO1xuQEdldHRlclxuQFNldHRlclxuQEVudGl0eVxuQFRhYmxlKFx0bmFtZSA9IFwiZmFtaWx5X21lbWJlclwiLFxuICAgICAgICB1bmlxdWVDb25zdHJhaW50cyA9IHtcbiAgICAgICAgfSlcbnB1YmxpYyBjbGFzcyBGYW1pbHlNZW1iZXIge1xuICAgIEBJZFxuICAgIEBHZW5lcmF0ZWRWYWx1ZShzdHJhdGVneSA9IEdlbmVyYXRpb25UeXBlLklERU5USVRZKVxuICAgIHByaXZhdGUgSW50ZWdlciBtZW1iZXJJZDtcblxuICAgIEBNYW55VG9PbmVcbiAgICBALi4uIiwiaXNFcnJvciI6ZmFsc2UsInJlcXVlc3RJZCI6IiJ9fSwiOWQ1YjdmMDUtYzFlNS00YjE4LWIwY2QtMDU2NjVlMmMwZmNhO3Rvb2x1X3ZydHhfMDFQYTRZYWduY3lHdWR5TUZhNWlFRjJVIjp7InJlcXVlc3RJZCI6IjlkNWI3ZjA1LWMxZTUtNGIxOC1iMGNkLTA1NjY1ZTJjMGZjYSIsInRvb2xVc2VJZCI6InRvb2x1X3ZydHhfMDFQYTRZYWduY3lHdWR5TUZhNWlFRjJVIiwicGhhc2UiOjUsInJlc3VsdCI6eyJ0ZXh0IjoiVGhlIGZvbGxvd2luZyBjb2RlIHNlY3Rpb25zIHdlcmUgcmV0cmlldmVkOlxuUGF0aDogc3JjL21haW4vamF2YS9jbi9lZHUvc2R1L2phdmEvc2VydmVyL3NlcnZpY2VzL1RlYWNoZXJTZXJ2aWNlcy5qYXZhXG4uLi5cbiAgICBwdWJsaWMgRGF0YVJlc3BvbnNlIHRlYWNoZXJEZWxldGUoRGF0YVJlcXVlc3QgZGF0YVJlcXVlc3QpIHtcbiAgICAgICAgSW50ZWdlciBwZXJzb25JZCA9IGRhdGFSZXF1ZXN0LmdldEludGVnZXIoXCJwZXJzb25JZFwiKTsgIC8v6I635Y+WdGVhY2hlcl9pZOWAvFxuICAgICAgICBUZWFjaGVyIHMgPSBudWxsO1xuICAgICAgICBPcHRpb25hbDxUZWFjaGVyPiBvcDtcbiAgICAgICAgaWYgKHBlcnNvbklkICE9IG51bGwgJiYgcGVyc29uSWQgPiAwKSB7XG4gICAgICAgICAgICBvcCA9IHRlYWNoZXJSZXBvc2l0b3J5LmZpbmRCeUlkKHBlcnNvbklkKTsgICAvL+afpeivouiOt+W+l+WunuS9k+WvueixoVxuICAgICAgICAgICAgaWYob3AuaXNQcmVzZW50KCkpIHtcbiAgICAgICAgICAgICAgICBzID0gb3AuZ2V0KCk7XG4gICAgICAgICAgICAgICAgT3B0aW9uYWw8VXNlcj4gdU9wID0gdXNlclJlcG9zaXRvcnkuZmluZEJ5SWQocGVyc29uSWQpOyAvL+afpeivouWvueW6lOivpeaVmeW4iOeahOi0puaIt1xuICAgICAgICAgICAgICAgIC8v5Yig6Zmk5a+55bqU6K+l5pWZ5biI55qE6LSm5oi3XG4gICAgICAgICAgICAgICAgdU9wLmlmUHJlc2VudCh1c2VyUmVwb3NpdG9yeTo6ZGVsZXRlKTtcbiAgICAgICAgICAgICAgICBQZXJzb24gcCA9IHMuZ2V0UGVyc29uKCk7XG4gICAgICAgICAgICAgICAgdGVhY2hlclJlcG9zaXRvcnkuZGVsZXRlKHMpOyAgICAvL+mmluWFiOaVsOaNruW6k+awuOS5heWIoOmZpOaVmeW4iOS/oeaBr1xuICAgICAgICAgICAgICAgIHBlcnNvblJlcG9zaXRvcnkuZGVsZXRlKHApO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBDb21tb25NZXRob2QuZ2V0UmV0dXJuTWVzc2FnZU9LKCk7ICAvL+mAmuefpeWJjeerr+aTjeS9nOato+W4uFxuICAgIH1cbiAgICBwdWJsaWMgRGF0YVJlc3BvbnNlIGdldFRlYWNoZXJJbmZvKERhdGFSZXF1ZXN0IGRhdGFSZXF1ZXN0KSB7XG4gICAgICAgIEludGVnZXIgcGVyc29uSWQgPSBkYXRhUmVxdWVzdC5nZXRJbnRlZ2VyKFwicGVyc29uSWRcIik7XG4gICAgICAgIFRlYWNoZXIgcyA9IG51bGw7XG4gICAgICAgIE9wdGlvbmFsPFRlYWNoZXI+IG9wO1xuICAgICAgICBpZiAocGVyc29uSWQgIT0gbnVsbCkge1xuICAgICAgICAgICAgb3AgPSB0ZWFjaGVyUmVwb3NpdG9yeS5maW5kQnlJZChwZXJzb25JZCk7IC8v5qC55o2u5a2m55Sf5Li76ZSu5LuO5pWw5o2u5bqT5p+l6K+i5a2m55Sf55qE5L+h5oGvXG4gICAgICAgICAgICBpZiAob3AuaXNQcmVzZW50KCkpIHtcbiAgICAgICAgICAgICAgICBzID0gb3AuZ2V0KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIENvbW1vbk1ldGhvZC5nZXRSZXR1cm5EYXRhKGdldE1hcEZyb21UZWFjaGVyKHMpKTsgLy/ov5nph4zlm57kvKDljIXlkKvlrabnlJ/kv6Hmga/nmoRNYXDlr7nosaFcbiAgICB9XG5cbiAgICBwdWJsaWMgRGF0YVJlc3BvbnNlIHRlYWNoZXJFZGl0U2F2ZShEYXRhUmVxdWVzdCBkYXRhUmVxdWVzdCkge1xuICAgICAgICBJbnRlZ2VyIHBlcnNvbklkID0gZGF0YVJlcXVlc3QuZ2V0SW50ZWdlcihcInBlcnNvbklkXCIpO1xuICAgICAgICBNYXA8U3RyaW5nLE9iamVjdD4gZm9ybSA9IGRhdGFSZXF1ZXN0LmdldE1hcChcImZvcm1cIik7IC8v5Y+C5pWw6I635Y+WTWFw5a+56LGhXG4gICAgICAgIFN0cmluZyBudW0gPSBDb21tb25NZXRob2QuZ2V0U3RyaW5nKGZvcm0sIFwibnVtXCIpOyAgLy9NYXAg6I635Y+W5bGe5oCn55qE5YC8XG4gICAgICAgIFRlYWNoZXIgcyA9IG51bGw7XG4gICAgICAgIFBlcnNvbiBwO1xuICAgICAgICBVc2VyIHU7XG4gICAgICAgIE9wdGlvbmFsPFRlYWNoZXI+IG9wO1xuICAgICAgICBib29sZWFuIGlzTmV3ID0gZmFsc2U7XG4gICAgICAgIGlmIChwZXJzb25JZCAhPSBudWxsKSB7XG4gICAgICAgICAgICBvcCA9IHRlYWNoZXJSZXBvc2l0b3J5LmZpbmRCeUlkKHBlcnNvbklkKTsgIC8v5p+l6K+i5a+55bqU5pWw5o2u5bqT5Lit5Li76ZSu5Li6aWTnmoTlgLznmoTlrp7kvZPlr7nosaFcbiAgICAgICAgICAgIGlmIChvcC5pc1ByZXNlbnQoKSkge1xuICAgICAgICAgICAgICAgIHMgPSBvcC5nZXQoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBPcHRpb25hbDxQZXJzb24+IG5PcCA9IHBlcnNvblJlcG9zaXRvcnkuZmluZEJ5TnVtKG51bSk7IC8v5p+l6K+i5piv5ZCm5a2Y5ZyobnVt55qE5Lq65ZGYXG4gICAgICAgIGlmIChuT3AuaXNQcmVzZW50KCkpIHtcbiAgICAgICAgICAgIGlmIChzID09IG51bGwgfHwgIXMuZ2V0UGVyc29uKCkuZ2V0TnVtKCkuZXF1YWxzKG51bSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gQ29tbW9uTWV0aG9kLmdldFJldHVybk1lc3NhZ2VFcnJvcihcIuaWsOWtpuWPt+W3sue7j+WtmOWcqO+8jOS4jeiDvea3u+WKoOaIluS/ruaUue+8gVwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAocyA9PSBudWxsKSB7XG4gICAgICAgICAgICBwID0gbmV3IFBlcnNvbigpO1xuICAgICAgICAgICAgcC5zZXROdW0obnVtKTtcbiAgICAgICAgICAgIHAuc2V0VHlwZShcIjFcIik7XG4gICAgICAgICAgICBwZXJzb25SZXBvc2l0b3J5LnNhdmVBbmRGbHVzaChwKTsgIC8v5o+S5YWl5paw55qEUGVyc29u6K6w5b2VXG4gICAgICAgICAgICBwZXJzb25JZCA9IHAuZ2V0UGVyc29uSWQoKTtcbiAgICAgICAgICAgIFN0cmluZyBwYXNzd29yZCA9IGVuY29kZXIuZW5jb2RlKFwiMTIzNDU2XCIpO1xuICAgICAgICAgICAgdSA9IG5ldyBVc2VyKCk7XG4gICAgICAgICAgICB1LnNldFBlcnNvbklkKHBlcnNvbklkKTtcbiAgICAgICAgICAgIHUuc2V0VXNlck5hbWUobnVtKTtcbiAgICAgICAgICAgIHUuc2V0UGFzc3dvcmQocGFzc3dvcmQpO1xuICAgICAgICAgICAgdS5zZXRVc2VyVHlwZSh1c2VyVHlwZVJlcG9zaXRvcnkuZmluZEJ5TmFtZShFVXNlclR5cGUuUk9MRV9TVFVERU5UKSk7XG4gICAgICAgICAgICB1LnNldENyZWF0ZVRpbWUoRGF0ZVRpbWVUb29sLnBhcnNlRGF0ZVRpbWUobmV3IERhdGUoKSkpO1xuICAgICAgICAgICAgdS5zZXRDcmVhdG9ySWQoQ29tbW9uTWV0aG9kLmdldFBlcnNvbklkKCkpO1xuICAgICAgICAgICAgdXNlclJlcG9zaXRvcnkuc2F2ZUFuZEZsdXNoKHUpOyAvL+aPkuWFpeaWsOeahFVzZXLorrDlvZVcbiAgICAgICAgICAgIHMgPSBuZXcgVGVhY2hlcigpOyAgIC8vIOWIm+W7uuWunuS9k+WvueixoVxuICAgICAgICAgICAgcy5zZXRQZXJzb25JZChwZXJzb25JZCk7XG4gICAgICAgICAgICB0ZWFjaGVyUmVwb3NpdG9yeS5zYXZlQW5kRmx1c2gocyk7ICAvL+aPkuWFpeaWsOeahFN0dWRlbnTorrDlvZVcbiAgICAgICAgICAgIGlzTmV3ID0gdHJ1ZTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHAgPSBzLmdldFBlcnNvbigpO1xuICAgICAgICB9XG4uLi5cbiAgICAgICAgcC5zZXROYW1lKENvbW1vbk1ldGhvZC5nZXRTdHJpbmcoZm9ybSwgXCJuYW1lXCIpKTtcbiAgICAgICAgcC5zZXREZXB0KENvbW1vbk1ldGhvZC5nZXRTdHJpbmcoZm9ybSwgXCJkZXB0XCIpKTtcbiAgICAgICAgcC5zZXRDYXJkKENvbW1vbk1ldGhvZC5nZXRTdHJpbmcoZm9ybSwgXCJjYXJkXCIpKTtcbiAgICAgICAgcC5zZXRHZW5kZXIoQ29tbW9uTWV0aG9kLmdldFN0cmluZyhmb3JtLCBcImdlbmRlclwiKSk7XG4gICAgICAgIHAuc2V0QmlydGhkYXkoQ29tbW9uTWV0aG9kLmdldFN0cmluZyhmb3JtLCBcImJpcnRoZGF5XCIpKTtcbiAgICAgICAgcC5zZXRFbWFpbChDb21tb25NZXRob2QuZ2V0U3RyaW5nKGZvcm0sIFwiZW1haWxcIikpO1xuICAgICAgICBwLnNldFBob25lKENvbW1vbk1ldGhvZC5nZXRTdHJpbmcoZm9ybSwgXCJwaG9uZVwiKSk7XG4gICAgICAgIHAuc2V0QWRkcmVzcyhDb21tb25NZXRob2QuZ2V0U3RyaW5nKGZvcm0sIFwiYWRkcmVzc1wiKSk7XG4gICAgICAgIHBlcnNvblJlcG9zaXRvcnkuc2F2ZShwKTsgIC8vIOS/ruaUueS/neWtmOS6uuWRmOS/oeaBr1xuICAgICAgICBzLnNldENsYXNzTmFtZShDb21tb25NZXRob2QuZ2V0U3RyaW5nKGZvcm0sIFwiY2xhc3NOYW1lXCIpKTtcbiAgICAgICAgdGVhY2hlclJlcG9zaXRvcnkuc2F2ZShzKTsgIC8v5L+u5pS55L+d5a2Y5a2m55Sf5L+h5oGvXG4gICAgICAgIHN5c3RlbVNlcnZpY2UubW9kaWZ5TG9nKHMsaXNOZXcpO1xuICAgICAgICByZXR1cm4gQ29tbW9uTWV0aG9kLmdldFJldHVybkRhdGEocy5nZXRQZXJzb25JZCgpKTsgIC8vIOWwhnBlcnNvbklk6L+U5Zue5YmN56uvXG4gICAgfVxuLi4uXG4gICAgcHVibGljIERhdGFSZXNwb25zZSBnZXRGYW1pbHlNZW1iZXJMaXN0KERhdGFSZXF1ZXN0IGRhdGFSZXF1ZXN0KSB7XG4gICAgICAgIEludGVnZXIgcGVyc29uSWQgPSBkYXRhUmVxdWVzdC5nZXRJbnRlZ2VyKFwicGVyc29uSWRcIik7XG4gICAgICAgIExpc3Q8RmFtaWx5TWVtYmVyPiBmTGlzdCA9IGZhbWlseU1lbWJlclJlcG9zaXRvcnkuZmluZEJ5VGVhY2hlclBlcnNvbklkKHBlcnNvbklkKTtcbiAgICAgICAgTGlzdDxNYXA8U3RyaW5nLE9iamVjdD4+IGRhdGFMaXN0ID0gbmV3IEFycmF5TGlzdDw+KCk7XG4gICAgICAgIE1hcDxTdHJpbmcsT2JqZWN0PiBtO1xuICAgICAgICBpZiAoZkxpc3QgIT0gbnVsbCkge1xuICAgICAgICAgICAgZm9yIChGYW1pbHlNZW1iZXIgZiA6IGZMaXN0KSB7XG4gICAgICAgICAgICAgICAgbSA9IG5ldyBIYXNoTWFwPD4oKTtcbiAgICAgICAgICAgICAgICBtLnB1dChcIm1lbWJlcklkXCIsIGYuZ2V0TWVtYmVySWQoKSk7XG4gICAgICAgICAgICAgICAgbS5wdXQoXCJwZXJzb25JZFwiLCBmLmdldFRlYWNoZXIoKS5nZXRQZXJzb25JZCgpKTtcbiAgICAgICAgICAgICAgICBtLnB1dChcInJlbGF0aW9uXCIsIGYuZ2V0UmVsYXRpb24oKSk7XG4gICAgICAgICAgICAgICAgbS5wdXQoXCJuYW1lXCIsIGYuZ2V0TmFtZSgpKTtcbiAgICAgICAgICAgICAgICBtLnB1dChcImdlbmRlclwiLCBmLmdldEdlbmRlcigpKTtcbiAgICAgICAgICAgICAgICBtLnB1dChcImFnZVwiLCBmLmdldEFnZSgpK1wiXCIpO1xuICAgICAgICAgICAgICAgIG0ucHV0KFwidW5pdFwiLCBmLmdldFVuaXQoKSk7XG4gICAgICAgICAgICAgICAgZGF0YUxpc3QuYWRkKG0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBDb21tb25NZXRob2QuZ2V0UmV0dXJuRGF0YShkYXRhTGlzdCk7XG4gICAgfVxuICAgIHB1YmxpYyBEYXRhUmVzcG9uc2UgZmFtaWx5TWVtYmVyU2F2ZShEYXRhUmVxdWVzdCBkYXRhUmVxdWVzdCkge1xuICAgICAgICBNYXA8U3RyaW5nLE9iamVjdD4gZm9ybSA9IGRhdGFSZXF1ZXN0LmdldE1hcChcImZvcm1cIik7XG4gICAgICAgIEludGVnZXIgcGVyc29uSWQgPSBDb21tb25NZXRob2QuZ2V0SW50ZWdlcihmb3JtLFwicGVyc29uSWRcIik7XG4gICAgICAgIEludGVnZXIgbWVtYmVySWQgPSBDb21tb25NZXRob2QuZ2V0SW50ZWdlcihmb3JtLFwibWVtYmVySWRcIik7XG4gICAgICAgIE9wdGlvbmFsPEZhbWlseU1lbWJlcj4gb3A7XG4gICAgICAgIEZhbWlseU1lbWJlciBmID0gbnVsbDtcbiAgICAgICAgaWYobWVtYmVySWQgIT0gbnVsbCkge1xuICAgICAgICAgICAgb3AgPSBmYW1pbHlNZW1iZXJSZXBvc2l0b3J5LmZpbmRCeUlkKG1lbWJlcklkKTtcbiAgICAgICAgICAgIGlmKG9wLmlzUHJlc2VudCgpKSB7XG4gICAgICAgICAgICAgICAgZiA9IG9wLmdldCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmKGY9PSBudWxsKSB7XG4gICAgICAgICAgICBmID0gbmV3IEZhbWlseU1lbWJlcigpO1xuICAgICAgICAgICAgYXNzZXJ0IHBlcnNvbklkICE9IG51bGw7XG4gICAgICAgICAgICBmLnNldFN0dWRlbnQodGVhY2hlclJlcG9zaXRvcnkuZmluZEJ5SWQocGVyc29uSWQpLmdldCgpKTtcbiAgICAgICAgfVxuICAgICAgICBmLnNldFJlbGF0aW9uKENvbW1vbk1ldGhvZC5nZXRTdHJpbmcoZm9ybSxcInJlbGF0aW9uXCIpKTtcbiAgICAgICAgZi5zZXROYW1lKENvbW1vbk1ldGhvZC5nZXRTdHJpbmcoZm9ybSxcIm5hbWVcIikpO1xuICAgICAgICBmLnNldEdlbmRlcihDb21tb25NZXRob2QuZ2V0U3RyaW5nKGZvcm0sXCJnZW5kZXJcIikpO1xuICAgICAgICBmLnNldEFnZShDb21tb25NZXRob2QuZ2V0SW50ZWdlcihmb3JtLFwiYWdlXCIpKTtcbiAgICAgICAgZi5zZXRVbml0KENvbW1vbk1ldGhvZC5nZXRTdHJpbmcoZm9ybSxcInVuaXRcIikpO1xuICAgICAgICBmYW1pbHlNZW1iZXJSZXBvc2l0b3J5LnNhdmUoZik7XG4gICAgICAgIHJldHVybiBDb21tb25NZXRob2QuZ2V0UmV0dXJuTWVzc2FnZU9LKCk7XG4gICAgfVxufVxuXG4uLi5cblBhdGg6IHNyYy9tYWluL2phdmEvY24vZWR1L3NkdS9qYXZhL3NlcnZlci9zZXJ2aWNlcy9TdHVkZW50U2VydmljZS5qYXZhXG4uLi5cblxuICAgIHB1YmxpYyBEYXRhUmVzcG9uc2UgZmFtaWx5TWVtYmVyU2F2ZShEYXRhUmVxdWVzdCBkYXRhUmVxdWVzdCkge1xuICAgICAgICBNYXA8U3RyaW5nLE9iamVjdD4gZm9ybSA9IGRhdGFSZXF1ZXN0LmdldE1hcChcImZvcm1cIik7XG4gICAgICAgIEludGVnZXIgcGVyc29uSWQgPSBDb21tb25NZXRob2QuZ2V0SW50ZWdlcihmb3JtLFwicGVyc29uSWRcIik7XG4gICAgICAgIEludGVnZXIgbWVtYmVySWQgPSBDb21tb25NZXRob2QuZ2V0SW50ZWdlcihmb3JtLFwibWVtYmVySWRcIik7XG4gICAgICAgIE9wdGlvbmFsPEZhbWlseU1lbWJlcj4gb3A7XG4gICAgICAgIEZhbWlseU1lbWJlciBmID0gbnVsbDtcbiAgICAgICAgaWYobWVtYmVySWQgIT0gbnVsbCkge1xuICAgICAgICAgICAgb3AgPSBmYW1pbHlNZW1iZXJSZXBvc2l0b3J5LmZpbmRCeUlkKG1lbWJlcklkKTtcbiAgICAgICAgICAgIGlmKG9wLmlzUHJlc2VudCgpKSB7XG4gICAgICAgICAgICAgICAgZiA9IG9wLmdldCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmKGY9PSBudWxsKSB7XG4gICAgICAgICAgICBmID0gbmV3IEZhbWlseU1lbWJlcigpO1xuICAgICAgICAgICAgYXNzZXJ0IHBlcnNvbklkICE9IG51bGw7XG4gICAgICAgICAgICBmLnNldFN0dWRlbnQoc3R1ZGVudFJlcG9zaXRvcnkuZmluZEJ5SWQocGVyc29uSWQpLmdldCgpKTtcbiAgICAgICAgfVxuICAgICAgICBmLnNldFJlbGF0aW9uKENvbW1vbk1ldGhvZC5nZXRTdHJpbmcoZm9ybSxcInJlbGF0aW9uXCIpKTtcbiAgICAgICAgZi5zZXROYW1lKENvbW1vbk1ldGhvZC5nZXRTdHJpbmcoZm9ybSxcIm5hbWVcIikpO1xuICAgICAgICBmLnNldEdlbmRlcihDb21tb25NZXRob2QuZ2V0U3RyaW5nKGZvcm0sXCJnZW5kZXJcIikpO1xuICAgICAgICBmLnNldEFnZShDb21tb25NZXRob2QuZ2V0SW50ZWdlcihmb3JtLFwiYWdlXCIpKTtcbiAgICAgICAgZi5zZXRVbml0KENvbW1vbk1ldGhvZC5nZXRTdHJpbmcoZm9ybSxcInVuaXRcIikpO1xuICAgICAgICBmYW1pbHlNZW1iZXJSZXBvc2l0b3J5LnNhdmUoZik7XG4gICAgICAgIHJldHVybiBDb21tb25NZXRob2QuZ2V0UmV0dXJuTWVzc2FnZU9LKCk7XG4gICAgfVxuXG4gICAgcHVibGljIERhdGFSZXNwb25zZSBmYW1pbHlNZW1iZXJEZWxldGUoRGF0YVJlcXVlc3QgZGF0YVJlcXVlc3QpIHtcbiAgICAgICAgSW50ZWdlciBtZW1iZXJJZCA9IGRhdGFSZXF1ZXN0LmdldEludGVnZXIoXCJtZW1iZXJJZFwiKTtcbiAgICAgICAgT3B0aW9uYWw8RmFtaWx5TWVtYmVyPiBvcDtcbiAgICAgICAgb3AgPSBmYW1pbHlNZW1iZXJSZXBvc2l0b3J5LmZpbmRCeUlkKG1lbWJlcklkKTtcbiAgICAgICAgb3AuaWZQcmVzZW50KGZhbWlseU1lbWJlclJlcG9zaXRvcnk6OmRlbGV0ZSk7XG4gICAgICAgIHJldHVybiBDb21tb25NZXRob2QuZ2V0UmV0dXJuTWVzc2FnZU9LKCk7XG4gICAgfVxuLi4uXG5QYXRoOiBqYXZhLXNlcnZlci9zcmMvbWFpbi9qYXZhL2NuL2VkdS9zZHUvamF2YS9zZXJ2ZXIvc2VydmljZXMvVGVhY2hlclNlcnZpY2VzLmphdmFcbnBhY2thZ2UgY24uZWR1LnNkdS5qYXZhLnNlcnZlci5zZXJ2aWNlcztcblxuaW1wb3J0IGNuLmVkdS5zZHUuamF2YS5zZXJ2ZXIubW9kZWxzLio7XG5pbXBvcnQgY24uZWR1LnNkdS5qYXZhLnNlcnZlci5tb2RlbHMuVGVhY2hlcjtcbmltcG9ydCBjbi5lZHUuc2R1LmphdmEuc2VydmVyLnBheWxvYWQucmVxdWVzdC5EYXRhUmVxdWVzdDtcbmltcG9ydCBjbi5lZHUuc2R1LmphdmEuc2VydmVyLnBheWxvYWQucmVzcG9uc2UuRGF0YVJlc3BvbnNlO1xuaW1wb3J0IGNuLmVkdS5zZHUuamF2YS5zZXJ2ZXIucmVwb3NpdG9yeXMuKjtcbmltcG9ydCBjbi5lZHUuc2R1LmphdmEuc2VydmVyLnV0aWwuQ29tRGF0YVV0aWw7XG5pbXBvcnQgY24uZWR1LnNkdS5qYXZhLnNlcnZlci51dGlsLkNvbW1vbk1ldGhvZDtcbmltcG9ydCBjbi5lZHUuc2R1LmphdmEuc2VydmVyLnV0aWwuRGF0ZVRpbWVUb29sO1xuaW1wb3J0IG9yZy5hcGFjaGUucG9pLnhzc2YudXNlcm1vZGVsLio7XG5pbXBvcnQgb3JnLnNsZjRqLkxvZ2dlcjtcbmltcG9ydCBvcmcuc2xmNGouTG9nZ2VyRmFjdG9yeTtcbmltcG9ydCBvcmcuc3ByaW5nZnJhbWV3b3JrLmRhdGEuZG9tYWluLlBhZ2U7XG5pbXBvcnQgb3JnLnNwcmluZ2ZyYW1ld29yay5kYXRhLmRvbWFpbi5QYWdlUmVxdWVzdDtcbmltcG9ydCBvcmcuc3ByaW5nZnJhbWV3b3JrLmRhdGEuZG9tYWluLlBhZ2VhYmxlO1xuaW1wb3J0IG9yZy5zcHJpbmdmcmFtZXdvcmsuaHR0cC5SZXNwb25zZUVudGl0eTtcbmltcG9ydCBvcmcuc3ByaW5nZnJhbWV3b3JrLnNlY3VyaXR5LmNyeXB0by5wYXNzd29yZC5QYXNzd29yZEVuY29kZXI7XG5pbXBvcnQgb3JnLnNwcmluZ2ZyYW1ld29yay5zdGVyZW90eXBlLlNlcnZpY2U7XG5pbXBvcnQgb3JnLnNwcmluZ2ZyYW1ld29yay53ZWIuc2VydmxldC5tdmMubWV0aG9kLmFubm90YXRpb24uU3RyZWFtaW5nUmVzcG9uc2VCb2R5O1xuXG5pbXBvcnQgamF2YS51dGlsLio7XG5cbkBTZXJ2aWNlXG5wdWJsaWMgY2xhc3MgVGVhY2hlclNlcnZpY2VzIHtcbiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBMb2dnZXIgbG9nID0gTG9nZ2VyRmFjdG9yeS5nZXRMb2dnZXIoVGVhY2hlclNlcnZpY2VzLmNsYXNzKTtcbiAgICBwcml2YXRlIGZpbmFsIFBlcnNvblJlcG9zaXRvcnkgcGVyc29uUmVwb3NpdG9yeTsgIC8v5Lq65ZGY5pWw5o2u5pON5L2c6Ieq5Yqo5rOo5YWlXG4gICAgcHJpdmF0ZSBmaW5hbCBUZWFjaGVyUmVwb3NpdG9yeSB0ZWFjaGVyUmVwb3NpdG9yeTsgIC8v5pWZ5biI5pWw5o2u5pON5L2c6Ieq5Yqo5rOo5YWlXG4gICAgcHJpdmF0ZSBmaW5hbCBVc2VyUmVwb3NpdG9yeSB1c2VyUmVwb3NpdG9yeTsgIC8v5pWw5o2u5pON5L2c6Ieq5Yqo5rOo5YWlXG4gICAgcHJpdmF0ZSBmaW5hbCBVc2VyVHlwZVJlcG9zaXRvcnkgdXNlclR5cGVSZXBvc2l0b3J5OyAvL+eUqOaIt+exu+Wei+aVsOaNruaTjeS9nOiHquWKqOazqOWFpVxuICAgIHByaXZhdGUgZmluYWwgUGFzc3dvcmRFbmNvZGVyIGVuY29kZXI7ICAvL+WvhueggeacjeWKoeiHquWKqOazqOWFpVxuICAgIC8v5raI6LS55pWw5o2u5pON5L2c6Ieq5Yqo5rOo5YWlXG4gICAgcHJpdmF0ZSBmaW5hbCBGYW1pbHlNZW1iZXJSZXBvc2l0b3J5IGZhbWlseU1lbWJlclJlcG9zaXRvcnk7XG4gICAgcHJpdmF0ZSBmaW5hbCBTeXN0ZW1TZXJ2aWNlIHN5c3RlbVNlcnZpY2U7XG5cbiAgICBwdWJsaWMgVGVhY2hlclNlcnZpY2VzKFBlcnNvblJlcG9zaXRvcnkgcGVyc29uUmVwb3NpdG9yeSwgVGVhY2hlclJlcG9zaXRvcnkgdGVhY2hlclJlcG9zaXRvcnksIFVzZXJSZXBvc2l0b3J5IHVzZXJSZXBvc2l0b3J5LCBVc2VyVHlwZVJlcG9zaXRvcnkgdXNlclR5cGVSZXBvc2l0b3J5LCBQYXNzd29yZEVuY29kZXIgZW5jb2RlciwgRmVlUmVwb3NpdG9yeSBmZWVSZXBvc2l0b3J5LCBGYW1pbHlNZW1iZXJSZXBvc2l0b3J5IGZhbWlseU1lbWJlclJlcG9zaXRvcnksIFN5c3RlbVNlcnZpY2Ugc3lzdGVtU2VydmljZSkge1xuICAgICAgICB0aGlzLnBlcnNvblJlcG9zaXRvcnkgPSBwZXJzb25SZXBvc2l0b3J5O1xuICAgICAgICB0aGlzLnRlYWNoZXJSZXBvc2l0b3J5ID0gdGVhY2hlclJlcG9zaXRvcnk7XG4gICAgICAgIHRoaXMudXNlclJlcG9zaXRvcnkgPSB1c2VyUmVwb3NpdG9yeTtcbiAgICAgICAgdGhpcy51c2VyVHlwZVJlcG9zaXRvcnkgPSB1c2VyVHlwZVJlcG9zaXRvcnk7XG4gICAgICAgIHRoaXMuZW5jb2RlciA9IGVuY29kZXI7XG4gICAgICAgIHRoaXMuZmFtaWx5TWVtYmVyUmVwb3NpdG9yeSA9IGZhbWlseU1lbWJlclJlcG9zaXRvcnk7XG4gICAgICAgIHRoaXMuc3lzdGVtU2VydmljZSA9IHN5c3RlbVNlcnZpY2U7XG4gICAgfVxuXG4gICAgcHVibGljIE1hcDxTdHJpbmcsIE9iamVjdD4gZ2V0TWFwRnJvbVRlYWNoZXIoVGVhY2hlciBzKSB7XG4gICAgICAgIE1hcDxTdHJpbmcsIE9iamVjdD4gbSA9IG5ldyBIYXNoTWFwPD4oKTtcbiAgICAgICAgUGVyc29uIHA7XG4gICAgICAgIGlmIChzID09IG51bGwpXG4gICAgICAgICAgICByZXR1cm4gbTtcbiAgICAgICAgbS5wdXQoXCJ0aXRsZVwiLCBzLmdldFRpdGxlKCkpO1xuICAgICAgICBtLnB1dChcImRlZ3JlZVwiLCBzLmdldERlZ3JlZSgpKTtcbiAgICAgICAgbS5wdXQoXCJjbGFzc05hbWVcIiwgcy5nZXRDbGFzc05hbWUoKSk7XG4gICAgICAgIHAgPSBzLmdldFBlcnNvbigpO1xuICAgICAgICBpZiAocCA9PSBudWxsKVxuICAgICAgICAgICAgcmV0dXJuIG07XG4gICAgICAgIG0ucHV0KFwicGVyc29uSWRcIiwgcy5nZXRQZXJzb25JZCgpKTtcbiAgICAgICAgbS5wdXQoXCJudW1cIiwgcC5nZXROdW0oKSk7XG4gICAgICAgIG0ucHV0KFwibmFtZVwiLCBwLmdldE5hbWUoKSk7XG4gICAgICAgIG0ucHV0KFwiZGVwdFwiLCBwLmdldERlcHQoKSk7XG4gICAgICAgIG0ucHV0KFwiY2FyZFwiLCBwLmdldENhcmQoKSk7XG4gICAgICAgIFN0cmluZyBnZW5kZXIgPSBwLmdldEdlbmRlcigpO1xuICAgICAgICBtLnB1dChcImdlbmRlclwiLCBnZW5kZXIpO1xuICAgICAgICBtLnB1dChcImdlbmRlck5hbWVcIiwgQ29tRGF0YVV0aWwuZ2V0SW5zdGFuY2UoKS5nZXREaWN0aW9uYXJ5TGFiZWxCeVZhbHVlKFwiWEJNXCIsIGdlbmRlcikpOyAvL+aAp+WIq+exu+Wei+eahOWAvOi9rOaNouaIkOaVsOaNruexu+Wei+WQjVxuICAgICAgICBtLnB1dChcImJpcnRoZGF5XCIsIHAuZ2V0QmlydGhkYXkoKSk7ICAvL+aXtumXtOagvOW8j+i9rOaNouWtl+espuS4slxuICAgICAgICBtLnB1dChcImVtYWlsXCIsIHAuZ2V0RW1haWwoKSk7XG4gICAgICAgIG0ucHV0KFwicGhvbmVcIiwgcC5nZXRQaG9uZSgpKTtcbiAgICAgICAgbS5wdXQoXCJhZGRyZXNzXCIsIHAuZ2V0QWRkcmVzcygpKTtcbiAgICAgICAgbS5wdXQoXCJpbnRyb2R1Y2VcIiwgcC5nZXRJbnRyb2R1Y2UoKSk7XG4gICAgICAgIHJldHVybiBtO1xuICAgIH1cblxuICAgIHB1YmxpYyBMaXN0PE1hcDxTdHJpbmcsIE9iamVjdD4+IGdldFRlYWNoZXJNYXBMaXN0KFN0cmluZyBudW1OYW1lKSB7XG4gICAgICAgIExpc3Q8TWFwPFN0cmluZywgT2JqZWN0Pj4gZGF0YUxpc3QgPSBuZXcgQXJyYXlMaXN0PD4oKTtcbiAgICAgICAgTGlzdDxUZWFjaGVyPiBzTGlzdCA9IHRlYWNoZXJSZXBvc2l0b3J5LmZpbmRUZWFjaGVyTGlzdEJ5TnVtTmFtZShudW1OYW1lKTsgIC8v5pWw5o2u5bqT5p+l6K+i5pON5L2cXG4gICAgICAgIGlmIChzTGlzdCA9PSBudWxsIHx8IHNMaXN0LmlzRW1wdHkoKSlcbiAgICAgICAgICAgIHJldHVybiBkYXRhTGlzdDtcbiAgICAgICAgZm9yIChUZWFjaGVyIHRlYWNoZXIgOiBzTGlzdCkge1xuICAgICAgICAgICAgZGF0YUxpc3QuYWRkKGdldE1hcEZyb21UZWFjaGVyKHRlYWNoZXIpKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZGF0YUxpc3Q7XG4gICAgfVxuXG4gICAgcHVibGljIERhdGFSZXNwb25zZSBnZXRUZWFjaGVyTGlzdChEYXRhUmVxdWVzdCBkYXRhUmVxdWVzdCkge1xuICAgICAgICBTdHJpbmcgbnVtTmFtZSA9IGRhdGFSZXF1ZXN0LmdldFN0cmluZyhcIm51bU5hbWVcIik7XG4gICAgICAgIExpc3Q8TWFwPFN0cmluZywgT2JqZWN0Pj4gZGF0YUxpc3QgPSBnZXRUZWFjaGVyTWFwTGlzdChudW1OYW1lKTtcbiAgICAgICAgcmV0dXJuIENvbW1vbk1ldGhvZC5nZXRSZXR1cm5EYXRhKGRhdGFMaXN0KTsgIC8v5oyJ54Wn5rWL6K+V5qGG5p626KeE6IyD5Lya6YCBTWFw55qEbGlzdFxuICAgIH1cblxuICAgIHB1YmxpYyBEYXRhUmVzcG9uc2UgdGVhY2hlckRlbGV0ZShEYXRhUmVxdWVzdCBkYXRhUmVxdWVzdCkge1xuICAgICAgICBJbnRlZ2VyIHBlcnNvbklkID0gZGF0YVJlcXVlc3QuZ2V0SW50ZWdlcihcInBlcnNvbklkXCIpOyAgLy/ojrflj5Z0ZWFjaGVyX2lk5YC8XG4gICAgICAgIFRlYWNoZXIgcyA9IG51bGw7XG4gICAgICAgIE9wdGlvbmFsPFRlYWNoZXI+IG9wO1xuICAgICAgICBpZiAocGVyc29uSWQgIT0gbnVsbCAmJiBwZXJzb25JZCA+IDApIHtcbiAgICAgICAgICAgIG9wID0gdGVhY2hlclJlcG9zaXRvcnkuZmluZEJ5SWQocGVyc29uSWQpOyAgIC8v5p+l6K+i6I635b6X5a6e5L2T5a+56LGhXG4gICAgICAgICAgICBpZiAob3AuaXNQcmVzZW50KCkpIHtcbiAgICAgICAgICAgICAgICBzID0gb3AuZ2V0KCk7XG4gICAgICAgICAgICAgICAgT3B0aW9uYWw8VXNlcj4gdU9wID0gdXNlclJlcG9zaXRvcnkuZmluZEJ5SWQocGVyc29uSWQpOyAvL+afpeivouWvueW6lOivpeaVmeW4iOeahOi0puaIt1xuICAgICAgICAgICAgICAgIC8v5Yig6Zmk5a+55bqU6K+l5pWZ5biI55qE6LSm5oi3XG4gICAgICAgICAgICAgICAgdU9wLmlmUHJlc2VudCh1c2VyUmVwb3NpdG9yeTo6ZGVsZXRlKTtcbiAgICAgICAgICAgICAgICBQZXJzb24gcCA9IHMuZ2V0UGVyc29uKCk7XG4gICAgICAgICAgICAgICAgdGVhY2hlclJlcG9zaXRvcnkuZGVsZXRlKHMpOyAgICAvL+mmluWFiOaVsOaNruW6k+awuOS5heWIoOmZpOaVmeW4iOS/oeaBr1xuICAgICAgICAgICAgICAgIHBlcnNvblJlcG9zaXRvcnkuZGVsZXRlKHApO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBDb21tb25NZXRob2QuZ2V0UmV0dXJuTWVzc2FnZU9LKCk7ICAvL+mAmuefpeWJjeerr+aTjeS9nOato+W4uFxuICAgIH1cblxuICAgIHB1YmxpYyBEYXRhUmVzcG9uc2UgZ2V0VGVhY2hlckluZm8oRGF0YVJlcXVlc3QgZGF0YVJlcXVlc3QpIHtcbiAgICAgICAgSW50ZWdlciBwZXJzb25JZCA9IGRhdGFSZXF1ZXN0LmdldEludGVnZXIoXCJwZXJzb25JZFwiKTtcbiAgICAgICAgVGVhY2hlciBzID0gbnVsbDtcbiAgICAgICAgT3B0aW9uYWw8VGVhY2hlcj4gb3A7XG4gICAgICAgIGlmIChwZXJzb25JZCAhPSBudWxsKSB7XG4gICAgICAgICAgICBvcCA9IHRlYWNoZXJSZXBvc2l0b3J5LmZpbmRCeUlkKHBlcnNvbklkKTsgLy/moLnmja7lrabnlJ/kuLvplK7ku47mlbDmja7lupPmn6Xor6LlrabnlJ/nmoTkv6Hmga9cbiAgICAgICAgICAgIGlmIChvcC5pc1ByZXNlbnQoKSkge1xuICAgICAgICAgICAgICAgIHMgPSBvcC5nZXQoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gQ29tbW9uTWV0aG9kLmdldFJldHVybkRhdGEoZ2V0TWFwRnJvbVRlYWNoZXIocykpOyAvL+i/memHjOWbnuS8oOWMheWQq+WtpueUn+S/oeaBr+eahE1hcOWvueixoVxuICAgIH1cblxuICAgIHB1YmxpYyBEYXRhUmVzcG9uc2UgdGVhY2hlckVkaXRTYXZlKERhdGFSZXF1ZXN0IGRhdGFSZXF1ZXN0KSB7XG4gICAgICAgIEludGVnZXIgcGVyc29uSWQgPSBkYXRhUmVxdWVzdC5nZXRJbnRlZ2VyKFwicGVyc29uSWRcIik7XG4gICAgICAgIE1hcDxTdHJpbmcsIE9iamVjdD4gZm9ybSA9IGRhdGFSZXF1ZXN0LmdldE1hcChcImZvcm1cIik7IC8v5Y+C5pWw6I635Y+WTWFw5a+56LGhXG4gICAgICAgIFN0cmluZyBudW0gPSBDb21tb25NZXRob2QuZ2V0U3RyaW5nKGZvcm0sIFwibnVtXCIpOyAgLy9NYXAg6I635Y+W5bGe5oCn55qE5YC8XG4gICAgICAgIFRlYWNoZXIgcyA9IG51bGw7XG4gICAgICAgIFBlcnNvbiBwO1xuICAgICAgICBVc2VyIHU7XG4gICAgICAgIE9wdGlvbmFsPFRlYWNoZXI+IG9wO1xuICAgICAgICBib29sZWFuIGlzTmV3ID0gZmFsc2U7XG4gICAgICAgIGlmIChwZXJzb25JZCAhPSBudWxsKSB7XG4gICAgICAgICAgICBvcCA9IHRlYWNoZXJSZXBvc2l0b3J5LmZpbmRCeUlkKHBlcnNvbklkKTsgIC8v5p+l6K+i5a+55bqU5pWw5o2u5bqT5Lit5Li76ZSu5Li6aWTnmoTlgLznmoTlrp7kvZPlr7nosaFcbiAgICAgICAgICAgIGlmIChvcC5pc1ByZXNlbnQoKSkge1xuICAgICAgICAgICAgICAgIHMgPSBvcC5nZXQoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBPcHRpb25hbDxQZXJzb24+IG5PcCA9IHBlcnNvblJlcG9zaXRvcnkuZmluZEJ5TnVtKG51bSk7IC8v5p+l6K+i5piv5ZCm5a2Y5ZyobnVt55qE5Lq65ZGYXG4gICAgICAgIGlmIChuT3AuaXNQcmVzZW50KCkpIHtcbiAgICAgICAgICAgIGlmIChzID09IG51bGwgfHwgIXMuZ2V0UGVyc29uKCkuZ2V0TnVtKCkuZXF1YWxzKG51bSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gQ29tbW9uTWV0aG9kLmdldFJldHVybk1lc3NhZ2VFcnJvcihcIuaWsOW3peWPt+W3sue7j+WtmOWcqO+8jOS4jeiDvea3u+WKoOaIluS/ruaUue+8gVwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAocyA9PSBudWxsKSB7XG4gICAgICAgICAgICBwID0gbmV3IFBlcnNvbigpO1xuICAgICAgICAgICAgcC5zZXROdW0obnVtKTtcbiAgICAgICAgICAgIHAuc2V0VHlwZShcIjJcIik7ICAvLyAy6KGo56S65pWZ5biI57G75Z6LXG4gICAgICAgICAgICBwZXJzb25SZXBvc2l0b3J5LnNhdmVBbmRGbHVzaChwKTsgIC8v5o+S5YWl5paw55qEUGVyc29u6K6w5b2VXG4gICAgICAgICAgICBwZXJzb25JZCA9IHAuZ2V0UGVyc29uSWQoKTtcbiAgICAgICAgICAgIFN0cmluZyBwYXNzd29yZCA9IGVuY29kZXIuZW5jb2RlKFwiMTIzNDU2XCIpO1xuICAgICAgICAgICAgdSA9IG5ldyBVc2VyKCk7XG4gICAgICAgICAgICB1LnNldFBlcnNvbklkKHBlcnNvbklkKTtcbiAgICAgICAgICAgIHUuc2V0VXNlck5hbWUobnVtKTtcbiAgICAgICAgICAgIHUuc2V0UGFzc3dvcmQocGFzc3dvcmQpO1xuICAgICAgICAgICAgdS5zZXRVc2VyVHlwZSh1c2VyVHlwZVJlcG9zaXRvcnkuZmluZEJ5TmFtZShFVXNlclR5cGUuUk9MRV9URUFDSEVSKSk7ICAvLyDorr7nva7kuLrmlZnluIjop5LoibJcbiAgICAgICAgICAgIHUuc2V0Q3JlYXRlVGltZShEYXRlVGltZVRvb2wucGFyc2VEYXRlVGltZShuZXcgRGF0ZSgpKSk7XG4gICAgICAgICAgICB1LnNldENyZWF0b3JJZChDb21tb25NZXRob2QuZ2V0UGVyc29uSWQoKSk7XG4gICAgICAgICAgICB1c2VyUmVwb3NpdG9yeS5zYXZlQW5kRmx1c2godSk7IC8v5o+S5YWl5paw55qEVXNlcuiusOW9lVxuICAgICAgICAgICAgcyA9IG5ldyBUZWFjaGVyKCk7ICAgLy8g5Yib5bu65a6e5L2T5a+56LGhXG4gICAgICAgICAgICBzLnNldFBlcnNvbklkKHBlcnNvbklkKTtcbiAgICAgICAgICAgIHRlYWNoZXJSZXBvc2l0b3J5LnNhdmVBbmRGbHVzaChzKTsgIC8v5o+S5YWl5paw55qEVGVhY2hlcuiusOW9lVxuICAgICAgICAgICAgaXNOZXcgPSB0cnVlO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcCA9IHMuZ2V0UGVyc29uKCk7XG4gICAgICAgIH1cbiAgICAgICAgcGVyc29uSWQgPSBwLmdldFBlcnNvbklkKCk7XG4gICAgICAgIGlmICghbnVtLmVxdWFscyhwLmdldE51bSgpKSkgeyAgIC8v5aaC5p6c5Lq65ZGY57yW5Y+35Y+Y5YyW77yM5L+u5pS55Lq65ZGY57yW5Y+35ZKM55m75b2V6LSm5Y+3XG4gICAgICAgICAgICBPcHRpb25hbDxVc2VyPiB1T3AgPSB1c2VyUmVwb3NpdG9yeS5maW5kQnlQZXJzb25QZXJzb25JZChwZXJzb25JZCk7XG4gICAgICAgICAgICBpZiAodU9wLmlzUHJlc2VudCgpKSB7XG4gICAgICAgICAgICAgICAgdSA9IHVPcC5nZXQoKTtcbiAgICAgICAgICAgICAgICB1LnNldFVzZXJOYW1lKG51bSk7XG4gICAgICAgICAgICAgICAgdXNlclJlcG9zaXRvcnkuc2F2ZUFuZEZsdXNoKHUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcC5zZXROdW0obnVtKTsgIC8v6K6+572u5bGe5oCnXG4gICAgICAgIH1cbiAgICAgICAgcC5zZXROYW1lKENvbW1vbk1ldGhvZC5nZXRTdHJpbmcoZm9ybSwgXCJuYW1lXCIpKTtcbiAgICAgICAgcC5zZXREZXB0KENvbW1vbk1ldGhvZC5nZXRTdHJpbmcoZm9ybSwgXCJkZXB0XCIpKTtcbiAgICAgICAgcC5zZXRDYXJkKENvbW1vbk1ldGhvZC5nZXRTdHJpbmcoZm9ybSwgXCJjYXJkXCIpKTtcbiAgICAgICAgcC5zZXRHZW5kZXIoQ29tbW9uTWV0aG9kLmdldFN0cmluZyhmb3JtLCBcImdlbmRlclwiKSk7XG4gICAgICAgIHAuc2V0QmlydGhkYXkoQ29tbW9uTWV0aG9kLmdldFN0cmluZyhmb3JtLCBcImJpcnRoZGF5XCIpKTtcbiAgICAgICAgcC5zZXRFbWFpbChDb21tb25NZXRob2QuZ2V0U3RyaW5nKGZvcm0sIFwiZW1haWxcIikpO1xuICAgICAgICBwLnNldFBob25lKENvbW1vbk1ldGhvZC5nZXRTdHJpbmcoZm9ybSwgXCJwaG9uZVwiKSk7XG4gICAgICAgIHAuc2V0QWRkcmVzcyhDb21tb25NZXRob2QuZ2V0U3RyaW5nKGZvcm0sIFwiYWRkcmVzc1wiKSk7XG4gICAgICAgIHBlcnNvblJlcG9zaXRvcnkuc2F2ZShwKTsgIC8vIOS/ruaUueS/neWtmOS6uuWRmOS/oeaBr1xuICAgICAgICBzLnNldENsYXNzTmFtZShDb21tb25NZXRob2QuZ2V0U3RyaW5nKGZvcm0sIFwiY2xhc3NOYW1lXCIpKTtcbiAgICAgICAgdGVhY2hlclJlcG9zaXRvcnkuc2F2ZShzKTsgIC8v5L+u5pS55L+d5a2Y5a2m55Sf5L+h5oGvXG4gICAgICAgIHN5c3RlbVNlcnZpY2UubW9kaWZ5TG9nKHMsIGlzTmV3KTtcbiAgICAgICAgcmV0dXJuIENvbW1vbk1ldGhvZC5nZXRSZXR1cm5EYXRhKHMuZ2V0UGVyc29uSWQoKSk7ICAvLyDlsIZwZXJzb25JZOi/lOWbnuWJjeerr1xuICAgIH1cblxuICAgIHB1YmxpYyBSZXNwb25zZUVudGl0eTxTdHJlYW1pbmdSZXNwb25zZUJvZHk+IGdldFRlYWNoZXJMaXN0RXhjbChEYXRhUmVxdWVzdCBkYXRhUmVxdWVzdCkge1xuICAgICAgICBTdHJpbmcgbnVtTmFtZSA9IGRhdGFSZXF1ZXN0LmdldFN0cmluZyhcIm51bU5hbWVcIik7XG4gICAgICAgIExpc3Q8TWFwPFN0cmluZywgT2JqZWN0Pj4gbGlzdCA9IGdldFRlYWNoZXJNYXBMaXN0KG51bU5hbWUpO1xuXG4gICAgICAgIC8vIOiwg+aVtOWIl+WuvemFjee9rlxuICAgICAgICBJbnRlZ2VyW10gd2lkdGhzID0gezgsIDE1LCAxMCwgMjAsIDE1LCAxMCwgOCwgMjUsIDE1LCAzMH07XG4gICAgICAgIFN0cmluZ1tdIHRpdGxlcyA9IHtcIuW6j+WPt1wiLCBcIuW3peWPt1wiLCBcIuWnk+WQjVwiLCBcIuWtpumZolwiLCBcIuiBjOensFwiLCBcIuWtpuS9jVwiLCBcIuaAp+WIq1wiLCBcIumCrueusVwiLCBcIueUteivnVwiLCBcIuWcsOWdgFwifTtcbiAgICAgICAgU3RyaW5nIG91dFB1dFNoZWV0TmFtZSA9IFwidGVhY2hlci54bHN4XCI7XG5cbiAgICAgICAgWFNTRldvcmtib29rIHdiID0gbmV3IFhTU0ZXb3JrYm9vaygpO1xuICAgICAgICBYU1NGU2hlZXQgc2hlZXQgPSB3Yi5jcmVhdGVTaGVldChvdXRQdXRTaGVldE5hbWUpO1xuXG4gICAgICAgIC8vIOiuvue9ruWIl+WuvVxuICAgICAgICBmb3IgKGludCBqID0gMDsgaiA8IHdpZHRocy5sZW5ndGg7IGorKykge1xuICAgICAgICAgICAgc2hlZXQuc2V0Q29sdW1uV2lkdGgoaiwgd2lkdGhzW2pdICogMjU2KTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIOWIm+W7uuagh+mimOihjOagt+W8j1xuICAgICAgICBYU1NGQ2VsbFN0eWxlIHN0eWxlID0gQ29tbW9uTWV0aG9kLmNyZWF0ZUNlbGxTdHlsZSh3YiwgMTEpO1xuICAgICAgICBYU1NGUm93IHJvdyA9IHNoZWV0LmNyZWF0ZVJvdygwKTtcbiAgICAgICAgWFNTRkNlbGxbXSBjZWxsID0gbmV3IFhTU0ZDZWxsW3dpZHRocy5sZW5ndGhdO1xuXG4gICAgICAgIC8vIOWhq+WFheagh+mimOihjFxuICAgICAgICBmb3IgKGludCBqID0gMDsgaiA8IHdpZHRocy5sZW5ndGg7IGorKykge1xuICAgICAgICAgICAgY2VsbFtqXSA9IHJvdy5jcmVhdGVDZWxsKGopO1xuICAgICAgICAgICAgY2VsbFtqXS5zZXRDZWxsU3R5bGUoc3R5bGUpO1xuICAgICAgICAgICAgY2VsbFtqXS5zZXRDZWxsVmFsdWUodGl0bGVzW2pdKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIOWhq+WFheaVsOaNruihjFxuICAgICAgICBpZiAobGlzdCAhPSBudWxsICYmICFsaXN0LmlzRW1wdHkoKSkge1xuICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBsaXN0LnNpemUoKTsgaSsrKSB7XG4gICAgICAgICAgICAgICAgcm93ID0gc2hlZXQuY3JlYXRlUm93KGkgKyAxKTtcbiAgICAgICAgICAgICAgICBNYXA8U3RyaW5nLCBPYmplY3Q+IG0gPSBsaXN0LmdldChpKTtcblxuICAgICAgICAgICAgICAgIC8vIOWIm+W7uuWNleWFg+agvOW5tuiuvue9ruagt+W8j1xuICAgICAgICAgICAgICAgIGZvciAoaW50IGogPSAwOyBqIDwgd2lkdGhzLmxlbmd0aDsgaisrKSB7XG4gICAgICAgICAgICAgICAgICAgIGNlbGxbal0gPSByb3cuY3JlYXRlQ2VsbChqKTtcbiAgICAgICAgICAgICAgICAgICAgY2VsbFtqXS5zZXRDZWxsU3R5bGUoc3R5bGUpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIC8vIOWhq+WFheWFt+S9k+aVsOaNrlxuICAgICAgICAgICAgICAgIGNlbGxbMF0uc2V0Q2VsbFZhbHVlKChpICsgMSkgKyBcIlwiKTsgLy8g5bqP5Y+3XG4gICAgICAgICAgICAgICAgY2VsbFsxXS5zZXRDZWxsVmFsdWUoQ29tbW9uTWV0aG9kLmdldFN0cmluZyhtLCBcIm51bVwiKSk7IC8vIOW3peWPt1xuICAgICAgICAgICAgICAgIGNlbGxbMl0uc2V0Q2VsbFZhbHVlKENvbW1vbk1ldGhvZC5nZXRTdHJpbmcobSwgXCJuYW1lXCIpKTsgLy8g5aeT5ZCNXG4gICAgICAgICAgICAgICAgY2VsbFszXS5zZXRDZWxsVmFsdWUoQ29tbW9uTWV0aG9kLmdldFN0cmluZyhtLCBcImRlcHRcIikpOyAvLyDlrabpmaJcbiAgICAgICAgICAgICAgICBjZWxsWzRdLnNldENlbGxWYWx1ZShDb21tb25NZXRob2QuZ2V0U3RyaW5nKG0sIFwidGl0bGVcIikpOyAvLyDogYznp7BcbiAgICAgICAgICAgICAgICBjZWxsWzVdLnNldENlbGxWYWx1ZShDb21tb25NZXRob2QuZ2V0U3RyaW5nKG0sIFwiZGVncmVlXCIpKTsgLy8g5a2m5L2NXG4gICAgICAgICAgICAgICAgY2VsbFs2XS5zZXRDZWxsVmFsdWUoQ29tbW9uTWV0aG9kLmdldFN0cmluZyhtLCBcImdlbmRlck5hbWVcIikpOyAvLyDmgKfliKtcbiAgICAgICAgICAgICAgICBjZWxsWzddLnNldENlbGxWYWx1ZShDb21tb25NZXRob2QuZ2V0U3RyaW5nKG0sIFwiZW1haWxcIikpOyAvLyDpgq7nrrFcbiAgICAgICAgICAgICAgICBjZWxsWzhdLnNldENlbGxWYWx1ZShDb21tb25NZXRob2QuZ2V0U3RyaW5nKG0sIFwicGhvbmVcIikpOyAvLyDnlLXor51cbiAgICAgICAgICAgICAgICBjZWxsWzldLnNldENlbGxWYWx1ZShDb21tb25NZXRob2QuZ2V0U3RyaW5nKG0sIFwiYWRkcmVzc1wiKSk7IC8vIOWcsOWdgFxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIFN0cmVhbWluZ1Jlc3BvbnNlQm9keSBzdHJlYW0gPSB3Yjo6d3JpdGU7XG4gICAgICAgICAgICByZXR1cm4gUmVzcG9uc2VFbnRpdHkub2soKVxuICAgICAgICAgICAgICAgICAgICAuY29udGVudFR5cGUoQ29tbW9uTWV0aG9kLmV4ZWxUeXBlKVxuICAgICAgICAgICAgICAgICAgICAuYm9keShzdHJlYW0pO1xuICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkge1xuICAgICAgICAgICAgcmV0dXJuIFJlc3BvbnNlRW50aXR5LmludGVybmFsU2VydmVyRXJyb3IoKS5idWlsZCgpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHVibGljIERhdGFSZXNwb25zZSBnZXRUZWFjaGVyUGFnZURhdGEoRGF0YVJlcXVlc3QgZGF0YVJlcXVlc3QpIHtcbiAgICAgICAgU3RyaW5nIG51bU5hbWUgPSBkYXRhUmVxdWVzdC5nZXRTdHJpbmcoXCJudW1OYW1lXCIpO1xuICAgICAgICBJbnRlZ2VyIGNQYWdlID0gZGF0YVJlcXVlc3QuZ2V0Q3VycmVudFBhZ2UoKTtcbiAgICAgICAgaW50IGRhdGFUb3RhbCA9IDA7XG4gICAgICAgIGludCBzaXplID0gNDA7XG4gICAgICAgIExpc3Q8TWFwPFN0cmluZywgT2JqZWN0Pj4gZGF0YUxpc3QgPSBuZXcgQXJyYXlMaXN0PD4oKTtcbiAgICAgICAgUGFnZTxUZWFjaGVyPiBwYWdlID0gbnVsbDtcbiAgICAgICAgUGFnZWFibGUgcGFnZWFibGUgPSBQYWdlUmVxdWVzdC5vZihjUGFnZSwgc2l6ZSk7XG4gICAgICAgIHBhZ2UgPSB0ZWFjaGVyUmVwb3NpdG9yeS5maW5kVGVhY2hlckxpc3RCeU51bU5hbWUobnVtTmFtZSwgcGFnZWFibGUpO1xuICAgICAgICBNYXA8U3RyaW5nLCBPYmplY3Q+IG07XG4gICAgICAgIGlmIChwYWdlICE9IG51bGwpIHtcbiAgICAgICAgICAgIGRhdGFUb3RhbCA9IChpbnQpIHBhZ2UuZ2V0VG90YWxFbGVtZW50cygpO1xuICAgICAgICAgICAgTGlzdDxUZWFjaGVyPiBsaXN0ID0gcGFnZS5nZXRDb250ZW50KCk7XG4gICAgICAgICAgICBpZiAoIWxpc3QuaXNFbXB0eSgpKSB7XG4gICAgICAgICAgICAgICAgZm9yIChUZWFjaGVyIHRlYWNoZXIgOiBsaXN0KSB7XG4gICAgICAgICAgICAgICAgICAgIG0gPSBnZXRNYXBGcm9tVGVhY2hlcih0ZWFjaGVyKTtcbiAgICAgICAgICAgICAgICAgICAgZGF0YUxpc3QuYWRkKG0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBNYXA8U3RyaW5nLCBPYmplY3Q+IGRhdGEgPSBuZXcgSGFzaE1hcDw+KCk7XG4gICAgICAgIGRhdGEucHV0KFwiZGF0YVRvdGFsXCIsIGRhdGFUb3RhbCk7XG4gICAgICAgIGRhdGEucHV0KFwicGFnZVNpemVcIiwgc2l6ZSk7XG4gICAgICAgIGRhdGEucHV0KFwiZGF0YUxpc3RcIiwgZGF0YUxpc3QpO1xuICAgICAgICByZXR1cm4gQ29tbW9uTWV0aG9kLmdldFJldHVybkRhdGEoZGF0YSk7XG4gICAgfVxufVxuXG4uLi5cblBhdGg6IGphdmEtc2VydmVyL3NyYy9tYWluL2phdmEvY24vZWR1L3NkdS9qYXZhL3NlcnZlci9tb2RlbHMvRmFtaWx5TWVtYmVyLmphdmFcbnBhY2thZ2UgY24uZWR1LnNkdS5qYXZhLnNlcnZlci5tb2RlbHM7XG5cbmltcG9ydCBqYWthcnRhLnBlcnNpc3RlbmNlLio7XG5pbXBvcnQgamFrYXJ0YS52YWxpZGF0aW9uLmNvbnN0cmFpbnRzLlNpemU7XG5pbXBvcnQgbG9tYm9rLkdldHRlcjtcbmltcG9ydCBsb21ib2suU2V0dGVyO1xuQEdldHRlclxuQFNldHRlclxuQEVudGl0eVxuQFRhYmxlKFx0bmFtZSA9IFwiZmFtaWx5X21lbWJlclwiLFxuICAgICAgICB1bmlxdWVDb25zdHJhaW50cyA9IHtcbiAgICAgICAgfSlcbnB1YmxpYyBjbGFzcyBGYW1pbHlNZW1iZXIge1xuICAgIEBJZFxuICAgIEBHZW5lcmF0ZWRWYWx1ZShzdHJhdGVneSA9IEdlbmVyYXRpb25UeXBlLklERU5USVRZKVxuICAgIHByaXZhdGUgSW50ZWdlciBtZW1iZXJJZDtcblxuICAgIEBNYW55VG9PbmVcbiAgICBASm9pbkNvbHVtbihuYW1lPVwicGVyc29uSWRcIilcbiAgICBwcml2YXRlIFN0dWRlbnQgc3R1ZGVudDtcbiAgICBAU2l6ZShtYXg9MTApXG4gICAgcHJpdmF0ZSBTdHJpbmcgcmVsYXRpb247XG4gICAgQFNpemUobWF4PTMwKVxuICAgIHByaXZhdGUgU3RyaW5nIG5hbWU7XG4gICAgQFNpemUobWF4PTEwKVxuICAgIHByaXZhdGUgU3RyaW5nIGdlbmRlcjtcbiAgICBwcml2YXRlIEludGVnZXIgYWdlO1xuLi4uIiwiaXNFcnJvciI6ZmFsc2UsInJlcXVlc3RJZCI6IiJ9fSwiNGYwNTY1NTMtMGM4ZS00ODIxLTlmMWItMjYwNWQ5MGYyMTM4O3Rvb2x1X3ZydHhfMDFFdEhwWkVrUjlqaUMxcU41RkNWYXNYIjp7InJlcXVlc3RJZCI6IjRmMDU2NTUzLTBjOGUtNDgyMS05ZjFiLTI2MDVkOTBmMjEzOCIsInRvb2xVc2VJZCI6InRvb2x1X3ZydHhfMDFFdEhwWkVrUjlqaUMxcU41RkNWYXNYIiwicGhhc2UiOjUsInJlc3VsdCI6eyJ0ZXh0IjoiVGhlIGZvbGxvd2luZyBjb2RlIHNlY3Rpb25zIHdlcmUgcmV0cmlldmVkOlxuUGF0aDogamF2YS1zZXJ2ZXIvc3JjL21haW4vamF2YS9jbi9lZHUvc2R1L2phdmEvc2VydmVyL21vZGVscy9GYW1pbHlNZW1iZXIuamF2YVxucGFja2FnZSBjbi5lZHUuc2R1LmphdmEuc2VydmVyLm1vZGVscztcblxuaW1wb3J0IGpha2FydGEucGVyc2lzdGVuY2UuKjtcbmltcG9ydCBqYWthcnRhLnZhbGlkYXRpb24uY29uc3RyYWludHMuU2l6ZTtcbmltcG9ydCBsb21ib2suR2V0dGVyO1xuaW1wb3J0IGxvbWJvay5TZXR0ZXI7XG5AR2V0dGVyXG5AU2V0dGVyXG5ARW50aXR5XG5AVGFibGUoXHRuYW1lID0gXCJmYW1pbHlfbWVtYmVyXCIsXG4gICAgICAgIHVuaXF1ZUNvbnN0cmFpbnRzID0ge1xuICAgICAgICB9KVxucHVibGljIGNsYXNzIEZhbWlseU1lbWJlciB7XG4gICAgQElkXG4gICAgQEdlbmVyYXRlZFZhbHVlKHN0cmF0ZWd5ID0gR2VuZXJhdGlvblR5cGUuSURFTlRJVFkpXG4gICAgcHJpdmF0ZSBJbnRlZ2VyIG1lbWJlcklkO1xuXG4gICAgQE1hbnlUb09uZVxuICAgIEBKb2luQ29sdW1uKG5hbWU9XCJwZXJzb25JZFwiKVxuICAgIHByaXZhdGUgU3R1ZGVudCBzdHVkZW50O1xuICAgIEBTaXplKG1heD0xMClcbiAgICBwcml2YXRlIFN0cmluZyByZWxhdGlvbjtcbiAgICBAU2l6ZShtYXg9MzApXG4gICAgcHJpdmF0ZSBTdHJpbmcgbmFtZTtcbiAgICBAU2l6ZShtYXg9MTApXG4gICAgcHJpdmF0ZSBTdHJpbmcgZ2VuZGVyO1xuICAgIHByaXZhdGUgSW50ZWdlciBhZ2U7XG4gICAgQFNpemUobWF4PTUwKVxuICAgIHByaXZhdGUgU3RyaW5nIHVuaXQ7XG5cbiAgICBwdWJsaWMgdm9pZCBzZXRUZWFjaGVyKE9iamVjdCBvKSB7XG4gICAgfVxufVxuLi4uXG5QYXRoOiBzcmMvbWFpbi9qYXZhL2NuL2VkdS9zZHUvamF2YS9zZXJ2ZXIvbW9kZWxzL0ZhbWlseU1lbWJlci5qYXZhXG5wYWNrYWdlIGNuLmVkdS5zZHUuamF2YS5zZXJ2ZXIubW9kZWxzO1xuXG5pbXBvcnQgamFrYXJ0YS5wZXJzaXN0ZW5jZS4qO1xuaW1wb3J0IGpha2FydGEudmFsaWRhdGlvbi5jb25zdHJhaW50cy5TaXplO1xuaW1wb3J0IGxvbWJvay5HZXR0ZXI7XG5pbXBvcnQgbG9tYm9rLlNldHRlcjtcbkBHZXR0ZXJcbkBTZXR0ZXJcbkBFbnRpdHlcbkBUYWJsZShcdG5hbWUgPSBcImZhbWlseV9tZW1iZXJcIixcbiAgICAgICAgdW5pcXVlQ29uc3RyYWludHMgPSB7XG4gICAgICAgIH0pXG5wdWJsaWMgY2xhc3MgRmFtaWx5TWVtYmVyIHtcbiAgICBASWRcbiAgICBAR2VuZXJhdGVkVmFsdWUoc3RyYXRlZ3kgPSBHZW5lcmF0aW9uVHlwZS5JREVOVElUWSlcbiAgICBwcml2YXRlIEludGVnZXIgbWVtYmVySWQ7XG5cbiAgICBATWFueVRvT25lXG4gICAgQEpvaW5Db2x1bW4obmFtZT1cInBlcnNvbklkXCIpXG4gICAgcHJpdmF0ZSBTdHVkZW50IHN0dWRlbnQ7XG4gICAgQFNpemUobWF4PTEwKVxuICAgIHByaXZhdGUgU3RyaW5nIHJlbGF0aW9uO1xuICAgIEBTaXplKG1heD0zMClcbiAgICBwcml2YXRlIFN0cmluZyBuYW1lO1xuICAgIEBTaXplKG1heD0xMClcbiAgICBwcml2YXRlIFN0cmluZyBnZW5kZXI7XG4gICAgcHJpdmF0ZSBJbnRlZ2VyIGFnZTtcbiAgICBAU2l6ZShtYXg9NTApXG4gICAgcHJpdmF0ZSBTdHJpbmcgdW5pdDtcblxufVxuLi4uXG5QYXRoOiBzcmMvbWFpbi9qYXZhL2NuL2VkdS9zZHUvamF2YS9zZXJ2ZXIvc2VydmljZXMvVGVhY2hlclNlcnZpY2VzLmphdmFcbi4uLlxuICAgIHB1YmxpYyBMaXN0PE1hcDxTdHJpbmcsT2JqZWN0Pj4gZ2V0VGVhY2hlck1hcExpc3QoU3RyaW5nIG51bU5hbWUpIHtcbiAgICAgICAgTGlzdDxNYXA8U3RyaW5nLE9iamVjdD4+IGRhdGFMaXN0ID0gbmV3IEFycmF5TGlzdDw+KCk7XG4gICAgICAgIExpc3Q8VGVhY2hlcj4gc0xpc3QgPSB0ZWFjaGVyUmVwb3NpdG9yeS5maW5kVGVhY2hlckxpc3RCeU51bU5hbWUobnVtTmFtZSk7ICAvL+aVsOaNruW6k+afpeivouaTjeS9nFxuICAgICAgICBpZiAoc0xpc3QgPT0gbnVsbCB8fCBzTGlzdC5pc0VtcHR5KCkpXG4gICAgICAgICAgICByZXR1cm4gZGF0YUxpc3Q7XG4gICAgICAgIGZvciAoVGVhY2hlciB0ZWFjaGVyIDogc0xpc3QpIHtcbiAgICAgICAgICAgIGRhdGFMaXN0LmFkZChnZXRNYXBGcm9tVGVhY2hlcih0ZWFjaGVyKSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGRhdGFMaXN0O1xuICAgIH1cbiAgICBwdWJsaWMgRGF0YVJlc3BvbnNlIGdldFRlYWNoZXJMaXN0KERhdGFSZXF1ZXN0IGRhdGFSZXF1ZXN0KSB7XG4gICAgICAgIFN0cmluZyBudW1OYW1lID0gZGF0YVJlcXVlc3QuZ2V0U3RyaW5nKFwibnVtTmFtZVwiKTtcbiAgICAgICAgTGlzdDxNYXA8U3RyaW5nLE9iamVjdD4+IGRhdGFMaXN0ID0gIGdldFRlYWNoZXJMaXN0KG51bU5hbWUpO1xuICAgICAgICByZXR1cm4gQ29tbW9uTWV0aG9kLmdldFJldHVybkRhdGEoZGF0YUxpc3QpOyAgLy/mjInnhafmtYvor5XmoYbmnrbop4TojIPkvJrpgIFNYXDnmoRsaXN0XG4gICAgfVxuICAgIHB1YmxpYyBEYXRhUmVzcG9uc2UgdGVhY2hlckRlbGV0ZShEYXRhUmVxdWVzdCBkYXRhUmVxdWVzdCkge1xuICAgICAgICBJbnRlZ2VyIHBlcnNvbklkID0gZGF0YVJlcXVlc3QuZ2V0SW50ZWdlcihcInBlcnNvbklkXCIpOyAgLy/ojrflj5Z0ZWFjaGVyX2lk5YC8XG4gICAgICAgIFRlYWNoZXIgcyA9IG51bGw7XG4gICAgICAgIE9wdGlvbmFsPFRlYWNoZXI+IG9wO1xuICAgICAgICBpZiAocGVyc29uSWQgIT0gbnVsbCAmJiBwZXJzb25JZCA+IDApIHtcbiAgICAgICAgICAgIG9wID0gdGVhY2hlclJlcG9zaXRvcnkuZmluZEJ5SWQocGVyc29uSWQpOyAgIC8v5p+l6K+i6I635b6X5a6e5L2T5a+56LGhXG4gICAgICAgICAgICBpZihvcC5pc1ByZXNlbnQoKSkge1xuICAgICAgICAgICAgICAgIHMgPSBvcC5nZXQoKTtcbiAgICAgICAgICAgICAgICBPcHRpb25hbDxVc2VyPiB1T3AgPSB1c2VyUmVwb3NpdG9yeS5maW5kQnlJZChwZXJzb25JZCk7IC8v5p+l6K+i5a+55bqU6K+l5pWZ5biI55qE6LSm5oi3XG4gICAgICAgICAgICAgICAgLy/liKDpmaTlr7nlupTor6XmlZnluIjnmoTotKbmiLdcbiAgICAgICAgICAgICAgICB1T3AuaWZQcmVzZW50KHVzZXJSZXBvc2l0b3J5OjpkZWxldGUpO1xuICAgICAgICAgICAgICAgIFBlcnNvbiBwID0gcy5nZXRQZXJzb24oKTtcbiAgICAgICAgICAgICAgICB0ZWFjaGVyUmVwb3NpdG9yeS5kZWxldGUocyk7ICAgIC8v6aaW5YWI5pWw5o2u5bqT5rC45LmF5Yig6Zmk5pWZ5biI5L+h5oGvXG4gICAgICAgICAgICAgICAgcGVyc29uUmVwb3NpdG9yeS5kZWxldGUocCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIENvbW1vbk1ldGhvZC5nZXRSZXR1cm5NZXNzYWdlT0soKTsgIC8v6YCa55+l5YmN56uv5pON5L2c5q2j5bi4XG4gICAgfVxuICAgIHB1YmxpYyBEYXRhUmVzcG9uc2UgZ2V0VGVhY2hlckluZm8oRGF0YVJlcXVlc3QgZGF0YVJlcXVlc3QpIHtcbiAgICAgICAgSW50ZWdlciBwZXJzb25JZCA9IGRhdGFSZXF1ZXN0LmdldEludGVnZXIoXCJwZXJzb25JZFwiKTtcbiAgICAgICAgVGVhY2hlciBzID0gbnVsbDtcbiAgICAgICAgT3B0aW9uYWw8VGVhY2hlcj4gb3A7XG4gICAgICAgIGlmIChwZXJzb25JZCAhPSBudWxsKSB7XG4gICAgICAgICAgICBvcCA9IHRlYWNoZXJSZXBvc2l0b3J5LmZpbmRCeUlkKHBlcnNvbklkKTsgLy/moLnmja7lrabnlJ/kuLvplK7ku47mlbDmja7lupPmn6Xor6LlrabnlJ/nmoTkv6Hmga9cbiAgICAgICAgICAgIGlmIChvcC5pc1ByZXNlbnQoKSkge1xuICAgICAgICAgICAgICAgIHMgPSBvcC5nZXQoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gQ29tbW9uTWV0aG9kLmdldFJldHVybkRhdGEoZ2V0TWFwRnJvbVRlYWNoZXIocykpOyAvL+i/memHjOWbnuS8oOWMheWQq+WtpueUn+S/oeaBr+eahE1hcOWvueixoVxuICAgIH1cblxuICAgIHB1YmxpYyBEYXRhUmVzcG9uc2UgdGVhY2hlckVkaXRTYXZlKERhdGFSZXF1ZXN0IGRhdGFSZXF1ZXN0KSB7XG4gICAgICAgIEludGVnZXIgcGVyc29uSWQgPSBkYXRhUmVxdWVzdC5nZXRJbnRlZ2VyKFwicGVyc29uSWRcIik7XG4gICAgICAgIE1hcDxTdHJpbmcsT2JqZWN0PiBmb3JtID0gZGF0YVJlcXVlc3QuZ2V0TWFwKFwiZm9ybVwiKTsgLy/lj4LmlbDojrflj5ZNYXDlr7nosaFcbiAgICAgICAgU3RyaW5nIG51bSA9IENvbW1vbk1ldGhvZC5nZXRTdHJpbmcoZm9ybSwgXCJudW1cIik7ICAvL01hcCDojrflj5blsZ7mgKfnmoTlgLxcbiAgICAgICAgVGVhY2hlciBzID0gbnVsbDtcbiAgICAgICAgUGVyc29uIHA7XG4gICAgICAgIFVzZXIgdTtcbiAgICAgICAgT3B0aW9uYWw8VGVhY2hlcj4gb3A7XG4gICAgICAgIGJvb2xlYW4gaXNOZXcgPSBmYWxzZTtcbiAgICAgICAgaWYgKHBlcnNvbklkICE9IG51bGwpIHtcbiAgICAgICAgICAgIG9wID0gdGVhY2hlclJlcG9zaXRvcnkuZmluZEJ5SWQocGVyc29uSWQpOyAgLy/mn6Xor6Llr7nlupTmlbDmja7lupPkuK3kuLvplK7kuLppZOeahOWAvOeahOWunuS9k+WvueixoVxuICAgICAgICAgICAgaWYgKG9wLmlzUHJlc2VudCgpKSB7XG4gICAgICAgICAgICAgICAgcyA9IG9wLmdldCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIE9wdGlvbmFsPFBlcnNvbj4gbk9wID0gcGVyc29uUmVwb3NpdG9yeS5maW5kQnlOdW0obnVtKTsgLy/mn6Xor6LmmK/lkKblrZjlnKhudW3nmoTkurrlkZhcbiAgICAgICAgaWYgKG5PcC5pc1ByZXNlbnQoKSkge1xuICAgICAgICAgICAgaWYgKHMgPT0gbnVsbCB8fCAhcy5nZXRQZXJzb24oKS5nZXROdW0oKS5lcXVhbHMobnVtKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBDb21tb25NZXRob2QuZ2V0UmV0dXJuTWVzc2FnZUVycm9yKFwi5paw5a2m5Y+35bey57uP5a2Y5Zyo77yM5LiN6IO95re75Yqg5oiW5L+u5pS577yBXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4uLi5cbiAgICBwdWJsaWMgUmVzcG9uc2VFbnRpdHk8U3RyZWFtaW5nUmVzcG9uc2VCb2R5PiBnZXRUZWFjaGVyTGlzdEV4Y2woRGF0YVJlcXVlc3QgZGF0YVJlcXVlc3QpIHtcbiAgICAgICAgU3RyaW5nIG51bU5hbWUgPSBkYXRhUmVxdWVzdC5nZXRTdHJpbmcoXCJudW1OYW1lXCIpO1xuICAgICAgICBMaXN0PE1hcDxTdHJpbmcsT2JqZWN0Pj4gbGlzdCA9IGdldFRlYWNoZXJNYXBMaXN0KG51bU5hbWUpOyAvLyDlgYforr7lt7LmlLnkuLrojrflj5bmlZnluIjmlbDmja7nmoTmlrnms5VcblxuICAgICAgICAvLyDosIPmlbTliJflrr3phY3nva7vvIjmoLnmja7mlZnluIjkv6Hmga/nibnngrnosIPmlbTvvIlcbiAgICAgICAgSW50ZWdlcltdIHdpZHRocyA9IHs4LCAxNSwgMTAsIDIwLCAxNSwgMTAsIDgsIDI1LCAxNSwgMzB9O1xuICAgICAgICBTdHJpbmdbXSB0aXRsZXMgPSB7XCLluo/lj7dcIiwgXCLlt6Xlj7dcIiwgXCLlp5PlkI1cIiwgXCLlrabpmaJcIiwgXCLogYznp7BcIiwgXCLlrabkvY1cIiwgXCLmgKfliKtcIiwgXCLpgq7nrrFcIiwgXCLnlLXor51cIiwgXCLlnLDlnYBcIn07XG4gICAgICAgIFN0cmluZyBvdXRQdXRTaGVldE5hbWUgPSBcInRlYWNoZXIueGxzeFwiO1xuXG4gICAgICAgIFhTU0ZXb3JrYm9vayB3YiA9IG5ldyBYU1NGV29ya2Jvb2soKTtcbiAgICAgICAgWFNTRlNoZWV0IHNoZWV0ID0gd2IuY3JlYXRlU2hlZXQob3V0UHV0U2hlZXROYW1lKTtcblxuICAgICAgICAvLyDorr7nva7liJflrr1cbiAgICAgICAgZm9yKGludCBqID0gMDsgaiA8IHdpZHRocy5sZW5ndGg7IGorKykge1xuICAgICAgICAgICAgc2hlZXQuc2V0Q29sdW1uV2lkdGgoaiwgd2lkdGhzW2pdICogMjU2KTtcbiAgICAgICAgfVxuLi4uXG4gICAgcHVibGljIERhdGFSZXNwb25zZSBnZXRUZWFjaGVyUGFnZURhdGEoRGF0YVJlcXVlc3QgZGF0YVJlcXVlc3QpIHtcbiAgICAgICAgU3RyaW5nIG51bU5hbWUgPSBkYXRhUmVxdWVzdC5nZXRTdHJpbmcoXCJudW1OYW1lXCIpO1xuICAgICAgICBJbnRlZ2VyIGNQYWdlID0gZGF0YVJlcXVlc3QuZ2V0Q3VycmVudFBhZ2UoKTtcbiAgICAgICAgaW50IGRhdGFUb3RhbCA9IDA7XG4gICAgICAgIGludCBzaXplID0gNDA7XG4gICAgICAgIExpc3Q8TWFwPFN0cmluZyxPYmplY3Q+PiBkYXRhTGlzdCA9IG5ldyBBcnJheUxpc3Q8PigpO1xuICAgICAgICBQYWdlPFRlYWNoZXI+IHBhZ2UgPSBudWxsO1xuICAgICAgICBQYWdlYWJsZSBwYWdlYWJsZSA9IFBhZ2VSZXF1ZXN0Lm9mKGNQYWdlLCBzaXplKTtcbiAgICAgICAgcGFnZSA9IHRlYWNoZXJSZXBvc2l0b3J5LmZpbmRUZWFjaGVyTGlzdEJ5TnVtTmFtZShudW1OYW1lLCBwYWdlYWJsZSk7XG4gICAgICAgIE1hcDxTdHJpbmcsT2JqZWN0PiBtO1xuICAgICAgICBpZiAocGFnZSAhPSBudWxsKSB7XG4gICAgICAgICAgICBkYXRhVG90YWwgPSAoaW50KSBwYWdlLmdldFRvdGFsRWxlbWVudHMoKTtcbiAgICAgICAgICAgIExpc3Q8VGVhY2hlcj4gbGlzdCA9IHBhZ2UuZ2V0Q29udGVudCgpO1xuICAgICAgICAgICAgaWYgKCFsaXN0LmlzRW1wdHkoKSkge1xuICAgICAgICAgICAgICAgIGZvciAoVGVhY2hlciB0ZWFjaGVyIDogbGlzdCkge1xuICAgICAgICAgICAgICAgICAgICBtID0gZ2V0TWFwRnJvbVRlYWNoZXIodGVhY2hlcik7XG4gICAgICAgICAgICAgICAgICAgIGRhdGFMaXN0LmFkZChtKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbi4uLlxuICAgIHB1YmxpYyBEYXRhUmVzcG9uc2UgZ2V0RmFtaWx5TWVtYmVyTGlzdChEYXRhUmVxdWVzdCBkYXRhUmVxdWVzdCkge1xuICAgICAgICBJbnRlZ2VyIHBlcnNvbklkID0gZGF0YVJlcXVlc3QuZ2V0SW50ZWdlcihcInBlcnNvbklkXCIpO1xuICAgICAgICBMaXN0PEZhbWlseU1lbWJlcj4gZkxpc3QgPSBmYW1pbHlNZW1iZXJSZXBvc2l0b3J5LmZpbmRCeVRlYWNoZXJQZXJzb25JZChwZXJzb25JZCk7XG4gICAgICAgIExpc3Q8TWFwPFN0cmluZyxPYmplY3Q+PiBkYXRhTGlzdCA9IG5ldyBBcnJheUxpc3Q8PigpO1xuICAgICAgICBNYXA8U3RyaW5nLE9iamVjdD4gbTtcbiAgICAgICAgaWYgKGZMaXN0ICE9IG51bGwpIHtcbiAgICAgICAgICAgIGZvciAoRmFtaWx5TWVtYmVyIGYgOiBmTGlzdCkge1xuICAgICAgICAgICAgICAgIG0gPSBuZXcgSGFzaE1hcDw+KCk7XG4gICAgICAgICAgICAgICAgbS5wdXQoXCJtZW1iZXJJZFwiLCBmLmdldE1lbWJlcklkKCkpO1xuICAgICAgICAgICAgICAgIG0ucHV0KFwicGVyc29uSWRcIiwgZi5nZXRUZWFjaGVyKCkuZ2V0UGVyc29uSWQoKSk7XG4gICAgICAgICAgICAgICAgbS5wdXQoXCJyZWxhdGlvblwiLCBmLmdldFJlbGF0aW9uKCkpO1xuICAgICAgICAgICAgICAgIG0ucHV0KFwibmFtZVwiLCBmLmdldE5hbWUoKSk7XG4gICAgICAgICAgICAgICAgbS5wdXQoXCJnZW5kZXJcIiwgZi5nZXRHZW5kZXIoKSk7XG4gICAgICAgICAgICAgICAgbS5wdXQoXCJhZ2VcIiwgZi5nZXRBZ2UoKStcIlwiKTtcbiAgICAgICAgICAgICAgICBtLnB1dChcInVuaXRcIiwgZi5nZXRVbml0KCkpO1xuICAgICAgICAgICAgICAgIGRhdGFMaXN0LmFkZChtKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gQ29tbW9uTWV0aG9kLmdldFJldHVybkRhdGEoZGF0YUxpc3QpO1xuICAgIH1cbiAgICBwdWJsaWMgRGF0YVJlc3BvbnNlIGZhbWlseU1lbWJlclNhdmUoRGF0YVJlcXVlc3QgZGF0YVJlcXVlc3QpIHtcbiAgICAgICAgTWFwPFN0cmluZyxPYmplY3Q+IGZvcm0gPSBkYXRhUmVxdWVzdC5nZXRNYXAoXCJmb3JtXCIpO1xuICAgICAgICBJbnRlZ2VyIHBlcnNvbklkID0gQ29tbW9uTWV0aG9kLmdldEludGVnZXIoZm9ybSxcInBlcnNvbklkXCIpO1xuICAgICAgICBJbnRlZ2VyIG1lbWJlcklkID0gQ29tbW9uTWV0aG9kLmdldEludGVnZXIoZm9ybSxcIm1lbWJlcklkXCIpO1xuICAgICAgICBPcHRpb25hbDxGYW1pbHlNZW1iZXI+IG9wO1xuICAgICAgICBGYW1pbHlNZW1iZXIgZiA9IG51bGw7XG4gICAgICAgIGlmKG1lbWJlcklkICE9IG51bGwpIHtcbiAgICAgICAgICAgIG9wID0gZmFtaWx5TWVtYmVyUmVwb3NpdG9yeS5maW5kQnlJZChtZW1iZXJJZCk7XG4gICAgICAgICAgICBpZihvcC5pc1ByZXNlbnQoKSkge1xuICAgICAgICAgICAgICAgIGYgPSBvcC5nZXQoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZihmPT0gbnVsbCkge1xuICAgICAgICAgICAgZiA9IG5ldyBGYW1pbHlNZW1iZXIoKTtcbiAgICAgICAgICAgIGFzc2VydCBwZXJzb25JZCAhPSBudWxsO1xuICAgICAgICAgICAgZi5zZXRTdHVkZW50KHRlYWNoZXJSZXBvc2l0b3J5LmZpbmRCeUlkKHBlcnNvbklkKS5nZXQoKSk7XG4gICAgICAgIH1cbiAgICAgICAgZi5zZXRSZWxhdGlvbihDb21tb25NZXRob2QuZ2V0U3RyaW5nKGZvcm0sXCJyZWxhdGlvblwiKSk7XG4gICAgICAgIGYuc2V0TmFtZShDb21tb25NZXRob2QuZ2V0U3RyaW5nKGZvcm0sXCJuYW1lXCIpKTtcbiAgICAgICAgZi5zZXRHZW5kZXIoQ29tbW9uTWV0aG9kLmdldFN0cmluZyhmb3JtLFwiZ2VuZGVyXCIpKTtcbiAgICAgICAgZi5zZXRBZ2UoQ29tbW9uTWV0aG9kLmdldEludGVnZXIoZm9ybSxcImFnZVwiKSk7XG4gICAgICAgIGYuc2V0VW5pdChDb21tb25NZXRob2QuZ2V0U3RyaW5nKGZvcm0sXCJ1bml0XCIpKTtcbiAgICAgICAgZmFtaWx5TWVtYmVyUmVwb3NpdG9yeS5zYXZlKGYpO1xuICAgICAgICByZXR1cm4gQ29tbW9uTWV0aG9kLmdldFJldHVybk1lc3NhZ2VPSygpO1xuICAgIH1cbn1cblxuLi4uXG5QYXRoOiBzcmMvbWFpbi9qYXZhL2NuL2VkdS9zZHUvamF2YS9zZXJ2ZXIvbW9kZWxzL1RlYWNoZXIuamF2YVxucGFja2FnZSBjbi5lZHUuc2R1LmphdmEuc2VydmVyLm1vZGVscztcblxuaW1wb3J0IGNvbS5mYXN0ZXJ4bWwuamFja3Nvbi5hbm5vdGF0aW9uLkpzb25JZ25vcmU7XG5pbXBvcnQgamFrYXJ0YS5wZXJzaXN0ZW5jZS4qO1xuaW1wb3J0IGpha2FydGEudmFsaWRhdGlvbi5jb25zdHJhaW50cy5TaXplO1xuaW1wb3J0IGxvbWJvay5HZXR0ZXI7XG5pbXBvcnQgbG9tYm9rLlNldHRlcjtcblxuaW1wb3J0IGphdmEudXRpbC5EYXRlO1xuXG5AR2V0dGVyXG4gICAgQFNldHRlclxuICAgIEBFbnRpdHlcbiAgICBAVGFibGUoXHRuYW1lID0gXCJ0ZWFjaGVyXCIsXG4gICAgICAgICAgICB1bmlxdWVDb25zdHJhaW50cyA9IHtcbiAgICAgICAgICAgIH0pXG4gICAgcHVibGljIGNsYXNzIFRlYWNoZXIge1xuICAgICAgICBASWRcbiAgICAgICAgcHJpdmF0ZSBJbnRlZ2VyIHBlcnNvbklkO1xuXG4gICAgICAgIEBPbmVUb09uZVxuICAgICAgICBASm9pbkNvbHVtbihuYW1lPVwicGVyc29uSWRcIilcbiAgICAgICAgQEpzb25JZ25vcmVcbiAgICAgICAgcHJpdmF0ZSBQZXJzb24gcGVyc29uO1xuICAgICAgICBAU2l6ZShtYXg9NTApXG4gICAgICAgIHByaXZhdGUgU3RyaW5nIHRpdGxlO1xuICAgICAgICBAU2l6ZShtYXg9MzApXG4gICAgICAgIHByaXZhdGUgU3RyaW5nIGRlZ3JlZTtcbiAgICAgICAgcHJpdmF0ZSBEYXRlIGVudGVyVGltZTtcbiAgICAgICAgcHJpdmF0ZSBJbnRlZ2VyIHN0dWRlbnROdW07XG4gICAgICAgIEBTaXplKG1heCA9IDUwKVxuICAgICAgICBwcml2YXRlIFN0cmluZyBjbGFzc05hbWU7XG5cblxufVxuXG5cblxuXG5cbi4uLlxuUGF0aDogamF2YS1zZXJ2ZXIvc3JjL21haW4vamF2YS9jbi9lZHUvc2R1L2phdmEvc2VydmVyL21vZGVscy9UZWFjaGVyLmphdmFcbnBhY2thZ2UgY24uZWR1LnNkdS5qYXZhLnNlcnZlci5tb2RlbHM7XG5cbmltcG9ydCBjb20uZmFzdGVyeG1sLmphY2tzb24uYW5ub3RhdGlvbi5Kc29uSWdub3JlO1xuaW1wb3J0IGpha2FydGEucGVyc2lzdGVuY2UuKjtcbmltcG9ydCBqYWthcnRhLnZhbGlkYXRpb24uY29uc3RyYWludHMuU2l6ZTtcbmltcG9ydCBsb21ib2suR2V0dGVyO1xuaW1wb3J0IGxvbWJvay5TZXR0ZXI7XG5cbmltcG9ydCBqYXZhLnV0aWwuRGF0ZTtcblxuLyoqXG4gKiBUZWFjaGVy5pWZ5biI6KGo5a6e5L2T57G7IOS/neWtmOavj+S4quaVmeW4iOeahOS/oeaBr++8jFxuICogSW50ZWdlciBwZXJzb25JZCDmlZnluIjooaggdGVhY2hlciDkuLvplK4gcGVyc29uX2lkIOS4jlBlcnNvbuihqOS4u+mUruebuOWQjFxuICogUGVyc29uIHBlcnNvbiDlhbPogZTliLDor6XnlKjmiLfmiYDnlKjnmoRQZXJzb27lr7nosaHvvIzotKbmiLfmiYDlr7nlupTnmoTkurrlkZjkv6Hmga8gcGVyc29uX2lkIOWFs+iBlCBwZXJzb24g6KGo5Li76ZSuIHBlcnNvbl9pZFxuICogU3RyaW5nIHRpdGxlIOiBjOensFxuICogU3RyaW5nIGRlZ3JlZSDlrabkvY1cbiAqIERhdGUgZW50ZXJUaW1lIOWFpeiBjOaXtumXtFxuICogSW50ZWdlciBzdHVkZW50TnVtIOWtpueUn+aVsOmHj1xuICogU3RyaW5nIGNsYXNzTmFtZSDnj63nuqflkI3np7BcbiAqL1xuQEdldHRlclxuQFNldHRlclxuQEVudGl0eVxuQFRhYmxlKG5hbWUgPSBcInRlYWNoZXJcIixcbiAgICAgICAgdW5pcXVlQ29uc3RyYWludHMgPSB7XG4gICAgICAgIH0pXG5wdWJsaWMgY2xhc3MgVGVhY2hlciB7XG4gICAgLyoqXG4gICAgICog5pWZ5biISUTvvIzkuI5QZXJzb27ooajnmoRwZXJzb25JZOebuOWQjFxuICAgICAqL1xuICAgIEBJZFxuICAgIHByaXZhdGUgSW50ZWdlciBwZXJzb25JZDtcblxuICAgIC8qKlxuICAgICAqIOWFs+iBlOeahFBlcnNvbuWvueixoe+8jOWMheWQq+WfuuacrOS6uuWRmOS/oeaBr1xuICAgICAqL1xuICAgIEBPbmVUb09uZVxuICAgIEBKb2luQ29sdW1uKG5hbWU9XCJwZXJzb25JZFwiKVxuICAgIEBKc29uSWdub3JlXG4gICAgcHJpdmF0ZSBQZXJzb24gcGVyc29uO1xuXG4gICAgLyoqXG4gICAgICog6IGM56ew77yM5aaC5pWZ5o6I44CB5Ymv5pWZ5o6I44CB6K6y5biI562JXG4gICAgICovXG4gICAgQFNpemUobWF4PTUwKVxuICAgIHByaXZhdGUgU3RyaW5nIHRpdGxlO1xuXG4gICAgLyoqXG4gICAgICog5a2m5L2N77yM5aaC5a2m5aOr44CB56GV5aOr44CB5Y2a5aOr562JXG4gICAgICovXG4gICAgQFNpemUobWF4PTMwKVxuICAgIHByaXZhdGUgU3RyaW5nIGRlZ3JlZTtcblxuICAgIC8qKlxuICAgICAqIOWFpeiBjOaXtumXtFxuICAgICAqL1xuICAgIHByaXZhdGUgRGF0ZSBlbnRlclRpbWU7XG5cbiAgICAvKipcbiAgICAgKiDmjIflr7znmoTlrabnlJ/mlbDph49cbiAgICAgKi9cbiAgICBwcml2YXRlIEludGVnZXIgc3R1ZGVudE51bTtcblxuICAgIC8qKlxuICAgICAqIOaJgOaVmeePree6p+WQjeensFxuICAgICAqL1xuICAgIEBTaXplKG1heCA9IDUwKVxuICAgIHByaXZhdGUgU3RyaW5nIGNsYXNzTmFtZTtcblxuICAgIC8qKlxuICAgICAqIOiOt+WPluaVmeW4iOeahOWnk+WQje+8iOS7juWFs+iBlOeahFBlcnNvbuWvueixoeS4reiOt+WPlu+8iVxuICAgICAqIEByZXR1cm4g5pWZ5biI5aeT5ZCNXG4gICAgICovXG4gICAgQFRyYW5zaWVudFxuICAgIHB1YmxpYyBTdHJpbmcgZ2V0TmFtZSgpIHtcbiAgICAgICAgcmV0dXJuIHBlcnNvbiAhPSBudWxsID8gcGVyc29uLmdldE5hbWUoKSA6IG51bGw7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICog6I635Y+W5pWZ5biI55qE5bel5Y+377yI5LuO5YWz6IGU55qEUGVyc29u5a+56LGh5Lit6I635Y+W77yJXG4gICAgICogQHJldHVybiDmlZnluIjlt6Xlj7dcbiAgICAgKi9cbiAgICBAVHJhbnNpZW50XG4gICAgcHVibGljIFN0cmluZyBnZXROdW0oKSB7XG4gICAgICAgIHJldHVybiBwZXJzb24gIT0gbnVsbCA/IHBlcnNvbi5nZXROdW0oKSA6IG51bGw7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICog6I635Y+W5pWZ5biI5omA5bGe5a2m6Zmi77yI5LuO5YWz6IGU55qEUGVyc29u5a+56LGh5Lit6I635Y+W77yJXG4gICAgICogQHJldHVybiDmiYDlsZ7lrabpmaJcbiAgICAgKi9cbiAgICBAVHJhbnNpZW50XG4gICAgcHVibGljIFN0cmluZyBnZXREZXB0KCkge1xuICAgICAgICByZXR1cm4gcGVyc29uICE9IG51bGwgPyBwZXJzb24uZ2V0RGVwdCgpIDogbnVsbDtcbiAgICB9XG59XG5cblxuXG5cblxuLi4uXG5QYXRoOiBzcmMvbWFpbi9qYXZhL2NuL2VkdS9zZHUvamF2YS9zZXJ2ZXIvc2VydmljZXMvU3R1ZGVudFNlcnZpY2UuamF2YVxuLi4uXG5cblxuXG4gICAgLypcbiAgICAgICAgRmFtaWx5TWVtYmVyXG4gICAgICovXG4gICAgcHVibGljIERhdGFSZXNwb25zZSBnZXRGYW1pbHlNZW1iZXJMaXN0KERhdGFSZXF1ZXN0IGRhdGFSZXF1ZXN0KSB7XG4gICAgICAgIEludGVnZXIgcGVyc29uSWQgPSBkYXRhUmVxdWVzdC5nZXRJbnRlZ2VyKFwicGVyc29uSWRcIik7XG4gICAgICAgIExpc3Q8RmFtaWx5TWVtYmVyPiBmTGlzdCA9IGZhbWlseU1lbWJlclJlcG9zaXRvcnkuZmluZEJ5U3R1ZGVudFBlcnNvbklkKHBlcnNvbklkKTtcbiAgICAgICAgTGlzdDxNYXA8U3RyaW5nLE9iamVjdD4+IGRhdGFMaXN0ID0gbmV3IEFycmF5TGlzdDw+KCk7XG4gICAgICAgIE1hcDxTdHJpbmcsT2JqZWN0PiBtO1xuICAgICAgICBpZiAoZkxpc3QgIT0gbnVsbCkge1xuICAgICAgICAgICAgZm9yIChGYW1pbHlNZW1iZXIgZiA6IGZMaXN0KSB7XG4gICAgICAgICAgICAgICAgbSA9IG5ldyBIYXNoTWFwPD4oKTtcbiAgICAgICAgICAgICAgICBtLnB1dChcIm1lbWJlcklkXCIsIGYuZ2V0TWVtYmVySWQoKSk7XG4gICAgICAgICAgICAgICAgbS5wdXQoXCJwZXJzb25JZFwiLCBmLmdldFN0dWRlbnQoKS5nZXRQZXJzb25JZCgpKTtcbiAgICAgICAgICAgICAgICBtLnB1dChcInJlbGF0aW9uXCIsIGYuZ2V0UmVsYXRpb24oKSk7XG4gICAgICAgICAgICAgICAgbS5wdXQoXCJuYW1lXCIsIGYuZ2V0TmFtZSgpKTtcbiAgICAgICAgICAgICAgICBtLnB1dChcImdlbmRlclwiLCBmLmdldEdlbmRlcigpKTtcbiAgICAgICAgICAgICAgICBtLnB1dChcImFnZVwiLCBmLmdldEFnZSgpK1wiXCIpO1xuICAgICAgICAgICAgICAgIG0ucHV0KFwidW5pdFwiLCBmLmdldFVuaXQoKSk7XG4gICAgICAgICAgICAgICAgZGF0YUxpc3QuYWRkKG0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBDb21tb25NZXRob2QuZ2V0UmV0dXJuRGF0YShkYXRhTGlzdCk7XG4gICAgfVxuXG4gICAgcHVibGljIERhdGFSZXNwb25zZSBmYW1pbHlNZW1iZXJTYXZlKERhdGFSZXF1ZXN0IGRhdGFSZXF1ZXN0KSB7XG4gICAgICAgIE1hcDxTdHJpbmcsT2JqZWN0PiBmb3JtID0gZGF0YVJlcXVlc3QuZ2V0TWFwKFwiZm9ybVwiKTtcbiAgICAgICAgSW50ZWdlciBwZXJzb25JZCA9IENvbW1vbk1ldGhvZC5nZXRJbnRlZ2VyKGZvcm0sXCJwZXJzb25JZFwiKTtcbiAgICAgICAgSW50ZWdlciBtZW1iZXJJZCA9IENvbW1vbk1ldGhvZC5nZXRJbnRlZ2VyKGZvcm0sXCJtZW1iZXJJZFwiKTtcbiAgICAgICAgT3B0aW9uYWw8RmFtaWx5TWVtYmVyPiBvcDtcbiAgICAgICAgRmFtaWx5TWVtYmVyIGYgPSBudWxsO1xuICAgICAgICBpZihtZW1iZXJJZCAhPSBudWxsKSB7XG4gICAgICAgICAgICBvcCA9IGZhbWlseU1lbWJlclJlcG9zaXRvcnkuZmluZEJ5SWQobWVtYmVySWQpO1xuICAgICAgICAgICAgaWYob3AuaXNQcmVzZW50KCkpIHtcbiAgICAgICAgICAgICAgICBmID0gb3AuZ2V0KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYoZj09IG51bGwpIHtcbiAgICAgICAgICAgIGYgPSBuZXcgRmFtaWx5TWVtYmVyKCk7XG4gICAgICAgICAgICBhc3NlcnQgcGVyc29uSWQgIT0gbnVsbDtcbiAgICAgICAgICAgIGYuc2V0U3R1ZGVudChzdHVkZW50UmVwb3NpdG9yeS5maW5kQnlJZChwZXJzb25JZCkuZ2V0KCkpO1xuICAgICAgICB9XG4gICAgICAgIGYuc2V0UmVsYXRpb24oQ29tbW9uTWV0aG9kLmdldFN0cmluZyhmb3JtLFwicmVsYXRpb25cIikpO1xuICAgICAgICBmLnNldE5hbWUoQ29tbW9uTWV0aG9kLmdldFN0cmluZyhmb3JtLFwibmFtZVwiKSk7XG4gICAgICAgIGYuc2V0R2VuZGVyKENvbW1vbk1ldGhvZC5nZXRTdHJpbmcoZm9ybSxcImdlbmRlclwiKSk7XG4gICAgICAgIGYuc2V0QWdlKENvbW1vbk1ldGhvZC5nZXRJbnRlZ2VyKGZvcm0sXCJhZ2VcIikpO1xuICAgICAgICBmLnNldFVuaXQoQ29tbW9uTWV0aG9kLmdldFN0cmluZyhmb3JtLFwidW5pdFwiKSk7XG4gICAgICAgIGZhbWlseU1lbWJlclJlcG9zaXRvcnkuc2F2ZShmKTtcbiAgICAgICAgcmV0dXJuIENvbW1vbk1ldGhvZC5nZXRSZXR1cm5NZXNzYWdlT0soKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgRGF0YVJlc3BvbnNlIGZhbWlseU1lbWJlckRlbGV0ZShEYXRhUmVxdWVzdCBkYXRhUmVxdWVzdCkge1xuICAgICAgICBJbnRlZ2VyIG1lbWJlcklkID0gZGF0YVJlcXVlc3QuZ2V0SW50ZWdlcihcIm1lbWJlcklkXCIpO1xuICAgICAgICBPcHRpb25hbDxGYW1pbHlNZW1iZXI+IG9wO1xuICAgICAgICBvcCA9IGZhbWlseU1lbWJlclJlcG9zaXRvcnkuZmluZEJ5SWQobWVtYmVySWQpO1xuICAgICAgICBvcC5pZlByZXNlbnQoZmFtaWx5TWVtYmVyUmVwb3NpdG9yeTo6ZGVsZXRlKTtcbiAgICAgICAgcmV0dXJuIENvbW1vbk1ldGhvZC5nZXRSZXR1cm5NZXNzYWdlT0soKTtcbiAgICB9XG4uLi5cblBhdGg6IHNyYy9tYWluL2phdmEvY24vZWR1L3NkdS9qYXZhL3NlcnZlci9yZXBvc2l0b3J5cy9GYW1pbHlNZW1iZXJSZXBvc2l0b3J5LmphdmFcbnBhY2thZ2UgY24uZWR1LnNkdS5qYXZhLnNlcnZlci5yZXBvc2l0b3J5cztcblxuaW1wb3J0IGNuLmVkdS5zZHUuamF2YS5zZXJ2ZXIubW9kZWxzLkZhbWlseU1lbWJlcjtcbmltcG9ydCBvcmcuc3ByaW5nZnJhbWV3b3JrLmRhdGEuanBhLnJlcG9zaXRvcnkuSnBhUmVwb3NpdG9yeTtcblxuaW1wb3J0IGphdmEudXRpbC5MaXN0O1xuXG5wdWJsaWMgaW50ZXJmYWNlIEZhbWlseU1lbWJlclJlcG9zaXRvcnkgZXh0ZW5kcyBKcGFSZXBvc2l0b3J5PEZhbWlseU1lbWJlcixJbnRlZ2VyPiB7XG4gICAgTGlzdDxGYW1pbHlNZW1iZXI+IGZpbmRCeVN0dWRlbnRQZXJzb25JZChJbnRlZ2VyIHBlcnNvbklkKTtcbn1cbi4uLlxuUGF0aDogamF2YS1zZXJ2ZXIvc3JjL21haW4vamF2YS9jbi9lZHUvc2R1L2phdmEvc2VydmVyL3NlcnZpY2VzL1RlYWNoZXJTZXJ2aWNlcy5qYXZhXG4uLi5cbiAgICAgICAgcmV0dXJuIG07XG4gICAgfVxuXG4gICAgcHVibGljIExpc3Q8TWFwPFN0cmluZywgT2JqZWN0Pj4gZ2V0VGVhY2hlck1hcExpc3QoU3RyaW5nIG51bU5hbWUpIHtcbiAgICAgICAgTGlzdDxNYXA8U3RyaW5nLCBPYmplY3Q+PiBkYXRhTGlzdCA9IG5ldyBBcnJheUxpc3Q8PigpO1xuICAgICAgICBMaXN0PFRlYWNoZXI+IHNMaXN0ID0gdGVhY2hlclJlcG9zaXRvcnkuZmluZFRlYWNoZXJMaXN0QnlOdW1OYW1lKG51bU5hbWUpOyAgLy/mlbDmja7lupPmn6Xor6Lmk43kvZxcbiAgICAgICAgaWYgKHNMaXN0ID09IG51bGwgfHwgc0xpc3QuaXNFbXB0eSgpKVxuICAgICAgICAgICAgcmV0dXJuIGRhdGFMaXN0O1xuICAgICAgICBmb3IgKFRlYWNoZXIgdGVhY2hlciA6IHNMaXN0KSB7XG4gICAgICAgICAgICBkYXRhTGlzdC5hZGQoZ2V0TWFwRnJvbVRlYWNoZXIodGVhY2hlcikpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBkYXRhTGlzdDtcbiAgICB9XG5cbiAgICBwdWJsaWMgRGF0YVJlc3BvbnNlIGdldFRlYWNoZXJMaXN0KERhdGFSZXF1ZXN0IGRhdGFSZXF1ZXN0KSB7XG4gICAgICAgIFN0cmluZyBudW1OYW1lID0gZGF0YVJlcXVlc3QuZ2V0U3RyaW5nKFwibnVtTmFtZVwiKTtcbiAgICAgICAgTGlzdDxNYXA8U3RyaW5nLCBPYmplY3Q+PiBkYXRhTGlzdCA9IGdldFRlYWNoZXJNYXBMaXN0KG51bU5hbWUpO1xuICAgICAgICByZXR1cm4gQ29tbW9uTWV0aG9kLmdldFJldHVybkRhdGEoZGF0YUxpc3QpOyAgLy/mjInnhafmtYvor5XmoYbmnrbop4TojIPkvJrpgIFNYXDnmoRsaXN0XG4gICAgfVxuXG4gICAgcHVibGljIERhdGFSZXNwb25zZSB0ZWFjaGVyRGVsZXRlKERhdGFSZXF1ZXN0IGRhdGFSZXF1ZXN0KSB7XG4gICAgICAgIEludGVnZXIgcGVyc29uSWQgPSBkYXRhUmVxdWVzdC5nZXRJbnRlZ2VyKFwicGVyc29uSWRcIik7ICAvL+iOt+WPlnRlYWNoZXJfaWTlgLxcbiAgICAgICAgVGVhY2hlciBzID0gbnVsbDtcbiAgICAgICAgT3B0aW9uYWw8VGVhY2hlcj4gb3A7XG4gICAgICAgIGlmIChwZXJzb25JZCAhPSBudWxsICYmIHBlcnNvbklkID4gMCkge1xuICAgICAgICAgICAgb3AgPSB0ZWFjaGVyUmVwb3NpdG9yeS5maW5kQnlJZChwZXJzb25JZCk7ICAgLy/mn6Xor6Lojrflvpflrp7kvZPlr7nosaFcbiAgICAgICAgICAgIGlmIChvcC5pc1ByZXNlbnQoKSkge1xuICAgICAgICAgICAgICAgIHMgPSBvcC5nZXQoKTtcbiAgICAgICAgICAgICAgICBPcHRpb25hbDxVc2VyPiB1T3AgPSB1c2VyUmVwb3NpdG9yeS5maW5kQnlJZChwZXJzb25JZCk7IC8v5p+l6K+i5a+55bqU6K+l5pWZ5biI55qE6LSm5oi3XG4gICAgICAgICAgICAgICAgLy/liKDpmaTlr7nlupTor6XmlZnluIjnmoTotKbmiLdcbiAgICAgICAgICAgICAgICB1T3AuaWZQcmVzZW50KHVzZXJSZXBvc2l0b3J5OjpkZWxldGUpO1xuICAgICAgICAgICAgICAgIFBlcnNvbiBwID0gcy5nZXRQZXJzb24oKTtcbiAgICAgICAgICAgICAgICB0ZWFjaGVyUmVwb3NpdG9yeS5kZWxldGUocyk7ICAgIC8v6aaW5YWI5pWw5o2u5bqT5rC45LmF5Yig6Zmk5pWZ5biI5L+h5oGvXG4gICAgICAgICAgICAgICAgcGVyc29uUmVwb3NpdG9yeS5kZWxldGUocCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIENvbW1vbk1ldGhvZC5nZXRSZXR1cm5NZXNzYWdlT0soKTsgIC8v6YCa55+l5YmN56uv5pON5L2c5q2j5bi4XG4gICAgfVxuXG4gICAgcHVibGljIERhdGFSZXNwb25zZSBnZXRUZWFjaGVySW5mbyhEYXRhUmVxdWVzdCBkYXRhUmVxdWVzdCkge1xuICAgICAgICBJbnRlZ2VyIHBlcnNvbklkID0gZGF0YVJlcXVlc3QuZ2V0SW50ZWdlcihcInBlcnNvbklkXCIpO1xuICAgICAgICBUZWFjaGVyIHMgPSBudWxsO1xuICAgICAgICBPcHRpb25hbDxUZWFjaGVyPiBvcDtcbiAgICAgICAgaWYgKHBlcnNvbklkICE9IG51bGwpIHtcbiAgICAgICAgICAgIG9wID0gdGVhY2hlclJlcG9zaXRvcnkuZmluZEJ5SWQocGVyc29uSWQpOyAvL+agueaNruWtpueUn+S4u+mUruS7juaVsOaNruW6k+afpeivouWtpueUn+eahOS/oeaBr1xuICAgICAgICAgICAgaWYgKG9wLmlzUHJlc2VudCgpKSB7XG4gICAgICAgICAgICAgICAgcyA9IG9wLmdldCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBDb21tb25NZXRob2QuZ2V0UmV0dXJuRGF0YShnZXRNYXBGcm9tVGVhY2hlcihzKSk7IC8v6L+Z6YeM5Zue5Lyg5YyF5ZCr5a2m55Sf5L+h5oGv55qETWFw5a+56LGhXG4gICAgfVxuLi4uXG5cbiAgICBwdWJsaWMgUmVzcG9uc2VFbnRpdHk8U3RyZWFtaW5nUmVzcG9uc2VCb2R5PiBnZXRUZWFjaGVyTGlzdEV4Y2woRGF0YVJlcXVlc3QgZGF0YVJlcXVlc3QpIHtcbiAgICAgICAgU3RyaW5nIG51bU5hbWUgPSBkYXRhUmVxdWVzdC5nZXRTdHJpbmcoXCJudW1OYW1lXCIpO1xuICAgICAgICBMaXN0PE1hcDxTdHJpbmcsIE9iamVjdD4+IGxpc3QgPSBnZXRUZWFjaGVyTWFwTGlzdChudW1OYW1lKTtcblxuICAgICAgICAvLyDosIPmlbTliJflrr3phY3nva5cbiAgICAgICAgSW50ZWdlcltdIHdpZHRocyA9IHs4LCAxNSwgMTAsIDIwLCAxNSwgMTAsIDgsIDI1LCAxNSwgMzB9O1xuICAgICAgICBTdHJpbmdbXSB0aXRsZXMgPSB7XCLluo/lj7dcIiwgXCLlt6Xlj7dcIiwgXCLlp5PlkI1cIiwgXCLlrabpmaJcIiwgXCLogYznp7BcIiwgXCLlrabkvY1cIiwgXCLmgKfliKtcIiwgXCLpgq7nrrFcIiwgXCLnlLXor51cIiwgXCLlnLDlnYBcIn07XG4gICAgICAgIFN0cmluZyBvdXRQdXRTaGVldE5hbWUgPSBcInRlYWNoZXIueGxzeFwiO1xuXG4gICAgICAgIFhTU0ZXb3JrYm9vayB3YiA9IG5ldyBYU1NGV29ya2Jvb2soKTtcbiAgICAgICAgWFNTRlNoZWV0IHNoZWV0ID0gd2IuY3JlYXRlU2hlZXQob3V0UHV0U2hlZXROYW1lKTtcblxuICAgICAgICAvLyDorr7nva7liJflrr1cbiAgICAgICAgZm9yIChpbnQgaiA9IDA7IGogPCB3aWR0aHMubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgICAgIHNoZWV0LnNldENvbHVtbldpZHRoKGosIHdpZHRoc1tqXSAqIDI1Nik7XG4gICAgICAgIH1cbi4uLlxuXG4gICAgcHVibGljIERhdGFSZXNwb25zZSBnZXRUZWFjaGVyUGFnZURhdGEoRGF0YVJlcXVlc3QgZGF0YVJlcXVlc3QpIHtcbiAgICAgICAgU3RyaW5nIG51bU5hbWUgPSBkYXRhUmVxdWVzdC5nZXRTdHJpbmcoXCJudW1OYW1lXCIpO1xuICAgICAgICBJbnRlZ2VyIGNQYWdlID0gZGF0YVJlcXVlc3QuZ2V0Q3VycmVudFBhZ2UoKTtcbiAgICAgICAgaW50IGRhdGFUb3RhbCA9IDA7XG4gICAgICAgIGludCBzaXplID0gNDA7XG4gICAgICAgIExpc3Q8TWFwPFN0cmluZywgT2JqZWN0Pj4gZGF0YUxpc3QgPSBuZXcgQXJyYXlMaXN0PD4oKTtcbiAgICAgICAgUGFnZTxUZWFjaGVyPiBwYWdlID0gbnVsbDtcbiAgICAgICAgUGFnZWFibGUgcGFnZWFibGUgPSBQYWdlUmVxdWVzdC5vZihjUGFnZSwgc2l6ZSk7XG4gICAgICAgIHBhZ2UgPSB0ZWFjaGVyUmVwb3NpdG9yeS5maW5kVGVhY2hlckxpc3RCeU51bU5hbWUobnVtTmFtZSwgcGFnZWFibGUpO1xuICAgICAgICBNYXA8U3RyaW5nLCBPYmplY3Q+IG07XG4gICAgICAgIGlmIChwYWdlICE9IG51bGwpIHtcbiAgICAgICAgICAgIGRhdGFUb3RhbCA9IChpbnQpIHBhZ2UuZ2V0VG90YWxFbGVtZW50cygpO1xuICAgICAgICAgICAgTGlzdDxUZWFjaGVyPiBsaXN0ID0gcGFnZS5nZXRDb250ZW50KCk7XG4gICAgICAgICAgICBpZiAoIWxpc3QuaXNFbXB0eSgpKSB7XG4gICAgICAgICAgICAgICAgZm9yIChUZWFjaGVyIHRlYWNoZXIgOiBsaXN0KSB7XG4gICAgICAgICAgICAgICAgICAgIG0gPSBnZXRNYXBGcm9tVGVhY2hlcih0ZWFjaGVyKTtcbiAgICAgICAgICAgICAgICAgICAgZGF0YUxpc3QuYWRkKG0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuLi4uXG5QYXRoOiBqYXZhLXNlcnZlci9zcmMvbWFpbi9qYXZhL2NuL2VkdS9zZHUvamF2YS9zZXJ2ZXIvcmVwb3NpdG9yeXMvVGVhY2hlclJlcG9zaXRvcnkuamF2YVxuLi4uXG5cbkBSZXBvc2l0b3J5XG5wdWJsaWMgaW50ZXJmYWNlIFRlYWNoZXJSZXBvc2l0b3J5IGV4dGVuZHMgSnBhUmVwb3NpdG9yeTxUZWFjaGVyLCBJbnRlZ2VyPiB7XG5cbiAgICAvLyDmoLnmja7lt6Xlj7fmiJblp5PlkI3mqKHns4rmn6Xor6LmlZnluIjliJfooajvvIjliIbpobXvvIlcbiAgICBAUXVlcnkoXCJTRUxFQ1QgdCBGUk9NIFRlYWNoZXIgdCBKT0lOIHQucGVyc29uIHAgXCIgK1xuICAgICAgICAgICAgXCJXSEVSRSAoOm51bU5hbWUgSVMgTlVMTCBPUiA6bnVtTmFtZSA9ICcnIE9SIFwiICtcbiAgICAgICAgICAgIFwicC5udW0gTElLRSAlOm51bU5hbWUlIE9SIHAubmFtZSBMSUtFICU6bnVtTmFtZSUpXCIpXG4gICAgUGFnZTxUZWFjaGVyPiBmaW5kVGVhY2hlckxpc3RCeU51bU5hbWUoQFBhcmFtKFwibnVtTmFtZVwiKSBTdHJpbmcgbnVtTmFtZSwgUGFnZWFibGUgcGFnZWFibGUpO1xuXG4gICAgLy8g5qC55o2u5bel5Y+35oiW5aeT5ZCN5qih57OK5p+l6K+i5pWZ5biI5YiX6KGo77yI5LiN5YiG6aG177yJXG4gICAgQFF1ZXJ5KFwiU0VMRUNUIHQgRlJPTSBUZWFjaGVyIHQgSk9JTiB0LnBlcnNvbiBwIFwiICtcbiAgICAgICAgICAgIFwiV0hFUkUgKDpudW1OYW1lIElTIE5VTEwgT1IgOm51bU5hbWUgPSAnJyBPUiBcIiArXG4gICAgICAgICAgICBcInAubnVtIExJS0UgJTpudW1OYW1lJSBPUiBwLm5hbWUgTElLRSAlOm51bU5hbWUlKVwiKVxuICAgIExpc3Q8VGVhY2hlcj4gZmluZFRlYWNoZXJMaXN0QnlOdW1OYW1lKEBQYXJhbShcIm51bU5hbWVcIikgU3RyaW5nIG51bU5hbWUpO1xuXG4gICAgLy8g5qC55o2ucGVyc29uSWTmn6Xor6LmlZnluIjkv6Hmga9cbiAgICBPcHRpb25hbDxUZWFjaGVyPiBmaW5kQnlQZXJzb25JZChJbnRlZ2VyIHBlcnNvbklkKTtcblxuICAgIC8vIOagueaNruS6uuWRmOe8luWPt+afpeivouaVmeW4iOS/oeaBr1xuICAgIEBRdWVyeShcIlNFTEVDVCB0IEZST00gVGVhY2hlciB0IEpPSU4gdC5wZXJzb24gcCBXSEVSRSBwLm51bSA9IDpudW1cIilcbiAgICBPcHRpb25hbDxUZWFjaGVyPiBmaW5kQnlQZXJzb25OdW0oQFBhcmFtKFwibnVtXCIpIFN0cmluZyBudW0pO1xuXG4gICAgLy8g57uf6K6h5pWZ5biI5pWw6YePXG4gICAgQFF1ZXJ5KFwiU0VMRUNUIENPVU5UKHQpIEZST00gVGVhY2hlciB0XCIpXG4gICAgbG9uZyBjb3VudEFsbFRlYWNoZXJzKCk7XG5cbiAgICAvLyDmjInlrabpmaLnu5/orqHmlZnluIjmlbDph49cbiAgICBAUXVlcnkoXCJTRUxFQ1QgQ09VTlQodCkgRlJPTSBUZWFjaGVyIHQgSk9JTiB0LnBlcnNvbiBwIFdIRVJFIHAuZGVwdCA9IDpkZXB0XCIpXG4gICAgbG9uZyBjb3VudEJ5RGVwYXJ0bWVudChAUGFyYW0oXCJkZXB0XCIpIFN0cmluZyBkZXB0KTtcblxuICAgIC8vIOiOt+WPluafkOS4quWtpumZoueahOaJgOacieaVmeW4iFxuICAgIEBRdWVyeShcIlNFTEVDVCB0IEZST00gVGVhY2hlciB0IEpPSU4gdC5wZXJzb24gcCBXSEVSRSBwLmRlcHQgPSA6ZGVwdFwiKVxuICAgIExpc3Q8VGVhY2hlcj4gZmluZEJ5RGVwYXJ0bWVudChAUGFyYW0oXCJkZXB0XCIpIFN0cmluZyBkZXB0KTtcbn0uLi5cblBhdGg6IHNyYy9tYWluL2phdmEvY24vZWR1L3NkdS9qYXZhL3NlcnZlci9tb2RlbHMvU3R1ZGVudC5qYXZhXG5wYWNrYWdlIGNuLmVkdS5zZHUuamF2YS5zZXJ2ZXIubW9kZWxzO1xuXG5pbXBvcnQgY29tLmZhc3RlcnhtbC5qYWNrc29uLmFubm90YXRpb24uSnNvbklnbm9yZTtcblxuaW1wb3J0IGpha2FydGEucGVyc2lzdGVuY2UuKjtcbmltcG9ydCBqYWthcnRhLnZhbGlkYXRpb24uY29uc3RyYWludHMuU2l6ZTtcblxuXG4vKipcbiAqIFN0dWRlbnTlrabnlJ/ooajlrp7kvZPnsbsg5L+d5a2Y5q+P5Liq5a2m55Sf55qE5L+h5oGv77yMXG4gKiBJbnRlZ2VyIHBlcnNvbklkIOWtpueUn+ihqCBzdHVkZW50IOS4u+mUriBwZXJzb25faWQg5LiOUGVyc29u6KGo5Li76ZSu55u45ZCMXG4gKiBQZXJzb24gcGVyc29uIOWFs+iBlOWIsOivpeeUqOaIt+aJgOeUqOeahFBlcnNvbuWvueixoe+8jOi0puaIt+aJgOWvueW6lOeahOS6uuWRmOS/oeaBryBwZXJzb25faWQg5YWz6IGUIHBlcnNvbiDooajkuLvplK4gcGVyc29uX2lkXG4gKiBTdHJpbmcgbWFqb3Ig5LiT5LiaXG4gKiBTdHJpbmcgY2xhc3NOYW1lIOePree6p1xuICpcbiAqL1xuaW1wb3J0IGxvbWJvay5HZXR0ZXI7XG5pbXBvcnQgbG9tYm9rLlNldHRlcjtcbkBHZXR0ZXJcbkBTZXR0ZXJcbkBFbnRpdHlcbkBUYWJsZShcdG5hbWUgPSBcInN0dWRlbnRcIixcbiAgICAgICAgdW5pcXVlQ29uc3RyYWludHMgPSB7XG4gICAgICAgIH0pXG5wdWJsaWMgY2xhc3MgU3R1ZGVudCB7XG4gICAgQElkXG4gICAgcHJpdmF0ZSBJbnRlZ2VyIHBlcnNvbklkO1xuXG4gICAgQE9uZVRvT25lXG4gICAgQEpvaW5Db2x1bW4obmFtZT1cInBlcnNvbklkXCIpXG4gICAgQEpzb25JZ25vcmVcbiAgICBwcml2YXRlIFBlcnNvbiBwZXJzb247XG5cbiAgICBAU2l6ZShtYXggPSAyMClcbiAgICBwcml2YXRlIFN0cmluZyBtYWpvcjtcblxuICAgIEBTaXplKG1heCA9IDUwKVxuICAgIHByaXZhdGUgU3RyaW5nIGNsYXNzTmFtZTtcblxufVxuLi4uXG5QYXRoOiBzcmMvbWFpbi9qYXZhL2NuL2VkdS9zZHUvamF2YS9zZXJ2ZXIvcmVwb3NpdG9yeXMvTWVudUluZm9SZXBvc2l0b3J5LmphdmFcbi4uLlxuXG5pbXBvcnQgamF2YS51dGlsLkxpc3Q7XG4vKlxuICogTWVudUluZm8g5pWw5o2u5pON5L2c5o6l5Y+j77yM5Li76KaB5a6e546wTWVudUluZm/mlbDmja7nmoTmn6Xor6Lmk43kvZxcbiAqIEludGVnZXIgZ2V0TWF4SWQoKSAgbWVudSDooajkuK3nmoTmnIDlpKfnmoRtZW51X2lkOyAgICBKUFFMIOazqOino1xuICogT3B0aW9uYWw8UGVyc29uPiBmaW5kQnlOdW0oU3RyaW5nIG51bSk7ICDmoLnmja5udW3mn6Xor6LojrflvpdPcHRpb248UGVyc29uPuWvueixoSwgIOWRveWQjeinhOiMg1xuICogTGlzdDxNZW51SW5mbz4gZmluZEJ5VXNlclR5cGVJZChJbnRlZ2VyIHVzZXJUeXBlSWQpOyDmoLnmja51c2VyVHlwZUlk5p+l6K+i6I635b6XcGlk5Li656m655qEIOiPnOWNlUxpc3Q8TWVudUluZm8+6ZuG5ZCIIOafpeivouebuOW6lOinkuiJsueahOaJgOaciei3n+iPnOWNlSBKUFFMIOazqOino1xuICogTGlzdDxNZW51SW5mbz4gZmluZEJ5VXNlclR5cGVJZEFuZFBpZChJbnRlZ2VyIHVzZXJUeXBlSWQsIEludGVnZXIgcGlkKTvmoLnmja51c2VyVHlwZUlk5ZKMcGlk5p+l6K+i6I635b6XcGlk55qE5omA5pyJ5a2Q6I+c5Y2VTGlzdDxNZW51SW5mbz7pm4blkIgg5ZG95ZCN6KeE6IyDXG4gKi4uLiIsImlzRXJyb3IiOmZhbHNlLCJyZXF1ZXN0SWQiOiIifX0sImZiZmU0NmM1LWY5ZmUtNDgwMC04YzkyLTY2OWZhYzcxNjg4ZTt0b29sdV92cnR4XzAxQmZ6cUY2eThFR0prMUhIMjNLVHROdCI6eyJyZXF1ZXN0SWQiOiJmYmZlNDZjNS1mOWZlLTQ4MDAtOGM5Mi02NjlmYWM3MTY4OGUiLCJ0b29sVXNlSWQiOiJ0b29sdV92cnR4XzAxQmZ6cUY2eThFR0prMUhIMjNLVHROdCIsInBoYXNlIjo2LCJyZXN1bHQiOnsidGV4dCI6IlJhbiBpbnRvIFVua25vd24gZXJyb3Igd2hpbGUgdHJ5aW5nIHRvIHJlYWQgamF2YS1zZXJ2ZXIvc3JjL21haW4vamF2YS9jbi9lZHUvc2R1L2phdmEvc2VydmVyL3NlcnZpY2VzL1RlYWNoZXJTZXJ2aWNlcy5qYXZhIiwiaXNFcnJvciI6dHJ1ZSwicmVxdWVzdElkIjoiIn19LCIzZmVkYTliOS02MDhiLTQ5NDUtYjEwMy1jNTUxMjE5ZjZmOWI7dG9vbHVfdnJ0eF8wMVFxdTVvYlBlWW1VVXFmRjVhQ1M3R3YiOnsicmVxdWVzdElkIjoiM2ZlZGE5YjktNjA4Yi00OTQ1LWIxMDMtYzU1MTIxOWY2ZjliIiwidG9vbFVzZUlkIjoidG9vbHVfdnJ0eF8wMVFxdTVvYlBlWW1VVXFmRjVhQ1M3R3YiLCJwaGFzZSI6NSwicmVzdWx0Ijp7InRleHQiOiJUaGUgZm9sbG93aW5nIGNvZGUgc2VjdGlvbnMgd2VyZSByZXRyaWV2ZWQ6XG5QYXRoOiBqYXZhLXNlcnZlci9zcmMvbWFpbi9qYXZhL2NuL2VkdS9zZHUvamF2YS9zZXJ2ZXIvc2VydmljZXMvVGVhY2hlclNlcnZpY2VzLmphdmFcbnBhY2thZ2UgY24uZWR1LnNkdS5qYXZhLnNlcnZlci5zZXJ2aWNlcztcblxuaW1wb3J0IGNuLmVkdS5zZHUuamF2YS5zZXJ2ZXIubW9kZWxzLio7XG5pbXBvcnQgY24uZWR1LnNkdS5qYXZhLnNlcnZlci5tb2RlbHMuVGVhY2hlcjtcbmltcG9ydCBjbi5lZHUuc2R1LmphdmEuc2VydmVyLnBheWxvYWQucmVxdWVzdC5EYXRhUmVxdWVzdDtcbmltcG9ydCBjbi5lZHUuc2R1LmphdmEuc2VydmVyLnBheWxvYWQucmVzcG9uc2UuRGF0YVJlc3BvbnNlO1xuaW1wb3J0IGNuLmVkdS5zZHUuamF2YS5zZXJ2ZXIucmVwb3NpdG9yeXMuKjtcbmltcG9ydCBjbi5lZHUuc2R1LmphdmEuc2VydmVyLnV0aWwuQ29tRGF0YVV0aWw7XG5pbXBvcnQgY24uZWR1LnNkdS5qYXZhLnNlcnZlci51dGlsLkNvbW1vbk1ldGhvZDtcbmltcG9ydCBjbi5lZHUuc2R1LmphdmEuc2VydmVyLnV0aWwuRGF0ZVRpbWVUb29sO1xuaW1wb3J0IG9yZy5hcGFjaGUucG9pLnhzc2YudXNlcm1vZGVsLio7XG5pbXBvcnQgb3JnLnNsZjRqLkxvZ2dlcjtcbmltcG9ydCBvcmcuc2xmNGouTG9nZ2VyRmFjdG9yeTtcbmltcG9ydCBvcmcuc3ByaW5nZnJhbWV3b3JrLmRhdGEuZG9tYWluLlBhZ2U7XG5pbXBvcnQgb3JnLnNwcmluZ2ZyYW1ld29yay5kYXRhLmRvbWFpbi5QYWdlUmVxdWVzdDtcbmltcG9ydCBvcmcuc3ByaW5nZnJhbWV3b3JrLmRhdGEuZG9tYWluLlBhZ2VhYmxlO1xuaW1wb3J0IG9yZy5zcHJpbmdmcmFtZXdvcmsuaHR0cC5SZXNwb25zZUVudGl0eTtcbmltcG9ydCBvcmcuc3ByaW5nZnJhbWV3b3JrLnNlY3VyaXR5LmNyeXB0by5wYXNzd29yZC5QYXNzd29yZEVuY29kZXI7XG5pbXBvcnQgb3JnLnNwcmluZ2ZyYW1ld29yay5zdGVyZW90eXBlLlNlcnZpY2U7XG5pbXBvcnQgb3JnLnNwcmluZ2ZyYW1ld29yay53ZWIuc2VydmxldC5tdmMubWV0aG9kLmFubm90YXRpb24uU3RyZWFtaW5nUmVzcG9uc2VCb2R5O1xuXG5pbXBvcnQgamF2YS51dGlsLio7XG5cbkBTZXJ2aWNlXG5wdWJsaWMgY2xhc3MgVGVhY2hlclNlcnZpY2VzIHtcbiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBMb2dnZXIgbG9nID0gTG9nZ2VyRmFjdG9yeS5nZXRMb2dnZXIoVGVhY2hlclNlcnZpY2VzLmNsYXNzKTtcbiAgICBwcml2YXRlIGZpbmFsIFBlcnNvblJlcG9zaXRvcnkgcGVyc29uUmVwb3NpdG9yeTsgIC8v5Lq65ZGY5pWw5o2u5pON5L2c6Ieq5Yqo5rOo5YWlXG4gICAgcHJpdmF0ZSBmaW5hbCBUZWFjaGVyUmVwb3NpdG9yeSB0ZWFjaGVyUmVwb3NpdG9yeTsgIC8v5pWZ5biI5pWw5o2u5pON5L2c6Ieq5Yqo5rOo5YWlXG4gICAgcHJpdmF0ZSBmaW5hbCBVc2VyUmVwb3NpdG9yeSB1c2VyUmVwb3NpdG9yeTsgIC8v5pWw5o2u5pON5L2c6Ieq5Yqo5rOo5YWlXG4gICAgcHJpdmF0ZSBmaW5hbCBVc2VyVHlwZVJlcG9zaXRvcnkgdXNlclR5cGVSZXBvc2l0b3J5OyAvL+eUqOaIt+exu+Wei+aVsOaNruaTjeS9nOiHquWKqOazqOWFpVxuICAgIHByaXZhdGUgZmluYWwgUGFzc3dvcmRFbmNvZGVyIGVuY29kZXI7ICAvL+WvhueggeacjeWKoeiHquWKqOazqOWFpVxuICAgIC8v5raI6LS55pWw5o2u5pON5L2c6Ieq5Yqo5rOo5YWlXG4gICAgcHJpdmF0ZSBmaW5hbCBGYW1pbHlNZW1iZXJSZXBvc2l0b3J5IGZhbWlseU1lbWJlclJlcG9zaXRvcnk7XG4gICAgcHJpdmF0ZSBmaW5hbCBTeXN0ZW1TZXJ2aWNlIHN5c3RlbVNlcnZpY2U7XG5cbiAgICBwdWJsaWMgVGVhY2hlclNlcnZpY2VzKFBlcnNvblJlcG9zaXRvcnkgcGVyc29uUmVwb3NpdG9yeSwgVGVhY2hlclJlcG9zaXRvcnkgdGVhY2hlclJlcG9zaXRvcnksIFVzZXJSZXBvc2l0b3J5IHVzZXJSZXBvc2l0b3J5LCBVc2VyVHlwZVJlcG9zaXRvcnkgdXNlclR5cGVSZXBvc2l0b3J5LCBQYXNzd29yZEVuY29kZXIgZW5jb2RlciwgRmVlUmVwb3NpdG9yeSBmZWVSZXBvc2l0b3J5LCBGYW1pbHlNZW1iZXJSZXBvc2l0b3J5IGZhbWlseU1lbWJlclJlcG9zaXRvcnksIFN5c3RlbVNlcnZpY2Ugc3lzdGVtU2VydmljZSkge1xuICAgICAgICB0aGlzLnBlcnNvblJlcG9zaXRvcnkgPSBwZXJzb25SZXBvc2l0b3J5O1xuICAgICAgICB0aGlzLnRlYWNoZXJSZXBvc2l0b3J5ID0gdGVhY2hlclJlcG9zaXRvcnk7XG4gICAgICAgIHRoaXMudXNlclJlcG9zaXRvcnkgPSB1c2VyUmVwb3NpdG9yeTtcbiAgICAgICAgdGhpcy51c2VyVHlwZVJlcG9zaXRvcnkgPSB1c2VyVHlwZVJlcG9zaXRvcnk7XG4gICAgICAgIHRoaXMuZW5jb2RlciA9IGVuY29kZXI7XG4gICAgICAgIHRoaXMuZmFtaWx5TWVtYmVyUmVwb3NpdG9yeSA9IGZhbWlseU1lbWJlclJlcG9zaXRvcnk7XG4gICAgICAgIHRoaXMuc3lzdGVtU2VydmljZSA9IHN5c3RlbVNlcnZpY2U7XG4gICAgfVxuXG4gICAgcHVibGljIE1hcDxTdHJpbmcsIE9iamVjdD4gZ2V0TWFwRnJvbVRlYWNoZXIoVGVhY2hlciBzKSB7XG4gICAgICAgIE1hcDxTdHJpbmcsIE9iamVjdD4gbSA9IG5ldyBIYXNoTWFwPD4oKTtcbiAgICAgICAgUGVyc29uIHA7XG4gICAgICAgIGlmIChzID09IG51bGwpXG4gICAgICAgICAgICByZXR1cm4gbTtcbiAgICAgICAgbS5wdXQoXCJ0aXRsZVwiLCBzLmdldFRpdGxlKCkpO1xuICAgICAgICBtLnB1dChcImRlZ3JlZVwiLCBzLmdldERlZ3JlZSgpKTtcbiAgICAgICAgbS5wdXQoXCJjbGFzc05hbWVcIiwgcy5nZXRDbGFzc05hbWUoKSk7XG4gICAgICAgIHAgPSBzLmdldFBlcnNvbigpO1xuICAgICAgICBpZiAocCA9PSBudWxsKVxuICAgICAgICAgICAgcmV0dXJuIG07XG4gICAgICAgIG0ucHV0KFwicGVyc29uSWRcIiwgcy5nZXRQZXJzb25JZCgpKTtcbiAgICAgICAgbS5wdXQoXCJudW1cIiwgcC5nZXROdW0oKSk7XG4gICAgICAgIG0ucHV0KFwibmFtZVwiLCBwLmdldE5hbWUoKSk7XG4gICAgICAgIG0ucHV0KFwiZGVwdFwiLCBwLmdldERlcHQoKSk7XG4gICAgICAgIG0ucHV0KFwiY2FyZFwiLCBwLmdldENhcmQoKSk7XG4gICAgICAgIFN0cmluZyBnZW5kZXIgPSBwLmdldEdlbmRlcigpO1xuICAgICAgICBtLnB1dChcImdlbmRlclwiLCBnZW5kZXIpO1xuICAgICAgICBtLnB1dChcImdlbmRlck5hbWVcIiwgQ29tRGF0YVV0aWwuZ2V0SW5zdGFuY2UoKS5nZXREaWN0aW9uYXJ5TGFiZWxCeVZhbHVlKFwiWEJNXCIsIGdlbmRlcikpOyAvL+aAp+WIq+exu+Wei+eahOWAvOi9rOaNouaIkOaVsOaNruexu+Wei+WQjVxuICAgICAgICBtLnB1dChcImJpcnRoZGF5XCIsIHAuZ2V0QmlydGhkYXkoKSk7ICAvL+aXtumXtOagvOW8j+i9rOaNouWtl+espuS4slxuICAgICAgICBtLnB1dChcImVtYWlsXCIsIHAuZ2V0RW1haWwoKSk7XG4gICAgICAgIG0ucHV0KFwicGhvbmVcIiwgcC5nZXRQaG9uZSgpKTtcbiAgICAgICAgbS5wdXQoXCJhZGRyZXNzXCIsIHAuZ2V0QWRkcmVzcygpKTtcbiAgICAgICAgbS5wdXQoXCJpbnRyb2R1Y2VcIiwgcC5nZXRJbnRyb2R1Y2UoKSk7XG4gICAgICAgIHJldHVybiBtO1xuICAgIH1cblxuICAgIHB1YmxpYyBMaXN0PE1hcDxTdHJpbmcsIE9iamVjdD4+IGdldFRlYWNoZXJNYXBMaXN0KFN0cmluZyBudW1OYW1lKSB7XG4gICAgICAgIExpc3Q8TWFwPFN0cmluZywgT2JqZWN0Pj4gZGF0YUxpc3QgPSBuZXcgQXJyYXlMaXN0PD4oKTtcbiAgICAgICAgTGlzdDxUZWFjaGVyPiBzTGlzdCA9IHRlYWNoZXJSZXBvc2l0b3J5LmZpbmRUZWFjaGVyTGlzdEJ5TnVtTmFtZShudW1OYW1lKTsgIC8v5pWw5o2u5bqT5p+l6K+i5pON5L2cXG4gICAgICAgIGlmIChzTGlzdCA9PSBudWxsIHx8IHNMaXN0LmlzRW1wdHkoKSlcbiAgICAgICAgICAgIHJldHVybiBkYXRhTGlzdDtcbiAgICAgICAgZm9yIChUZWFjaGVyIHRlYWNoZXIgOiBzTGlzdCkge1xuICAgICAgICAgICAgZGF0YUxpc3QuYWRkKGdldE1hcEZyb21UZWFjaGVyKHRlYWNoZXIpKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZGF0YUxpc3Q7XG4gICAgfVxuXG4gICAgcHVibGljIERhdGFSZXNwb25zZSBnZXRUZWFjaGVyTGlzdChEYXRhUmVxdWVzdCBkYXRhUmVxdWVzdCkge1xuICAgICAgICBTdHJpbmcgbnVtTmFtZSA9IGRhdGFSZXF1ZXN0LmdldFN0cmluZyhcIm51bU5hbWVcIik7XG4gICAgICAgIExpc3Q8TWFwPFN0cmluZywgT2JqZWN0Pj4gZGF0YUxpc3QgPSBnZXRUZWFjaGVyTWFwTGlzdChudW1OYW1lKTtcbiAgICAgICAgcmV0dXJuIENvbW1vbk1ldGhvZC5nZXRSZXR1cm5EYXRhKGRhdGFMaXN0KTsgIC8v5oyJ54Wn5rWL6K+V5qGG5p626KeE6IyD5Lya6YCBTWFw55qEbGlzdFxuICAgIH1cblxuICAgIHB1YmxpYyBEYXRhUmVzcG9uc2UgdGVhY2hlckRlbGV0ZShEYXRhUmVxdWVzdCBkYXRhUmVxdWVzdCkge1xuICAgICAgICBJbnRlZ2VyIHBlcnNvbklkID0gZGF0YVJlcXVlc3QuZ2V0SW50ZWdlcihcInBlcnNvbklkXCIpOyAgLy/ojrflj5Z0ZWFjaGVyX2lk5YC8XG4gICAgICAgIFRlYWNoZXIgcyA9IG51bGw7XG4gICAgICAgIE9wdGlvbmFsPFRlYWNoZXI+IG9wO1xuICAgICAgICBpZiAocGVyc29uSWQgIT0gbnVsbCAmJiBwZXJzb25JZCA+IDApIHtcbiAgICAgICAgICAgIG9wID0gdGVhY2hlclJlcG9zaXRvcnkuZmluZEJ5SWQocGVyc29uSWQpOyAgIC8v5p+l6K+i6I635b6X5a6e5L2T5a+56LGhXG4gICAgICAgICAgICBpZiAob3AuaXNQcmVzZW50KCkpIHtcbiAgICAgICAgICAgICAgICBzID0gb3AuZ2V0KCk7XG4gICAgICAgICAgICAgICAgT3B0aW9uYWw8VXNlcj4gdU9wID0gdXNlclJlcG9zaXRvcnkuZmluZEJ5SWQocGVyc29uSWQpOyAvL+afpeivouWvueW6lOivpeaVmeW4iOeahOi0puaIt1xuICAgICAgICAgICAgICAgIC8v5Yig6Zmk5a+55bqU6K+l5pWZ5biI55qE6LSm5oi3XG4gICAgICAgICAgICAgICAgdU9wLmlmUHJlc2VudCh1c2VyUmVwb3NpdG9yeTo6ZGVsZXRlKTtcbiAgICAgICAgICAgICAgICBQZXJzb24gcCA9IHMuZ2V0UGVyc29uKCk7XG4gICAgICAgICAgICAgICAgdGVhY2hlclJlcG9zaXRvcnkuZGVsZXRlKHMpOyAgICAvL+mmluWFiOaVsOaNruW6k+awuOS5heWIoOmZpOaVmeW4iOS/oeaBr1xuICAgICAgICAgICAgICAgIHBlcnNvblJlcG9zaXRvcnkuZGVsZXRlKHApO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBDb21tb25NZXRob2QuZ2V0UmV0dXJuTWVzc2FnZU9LKCk7ICAvL+mAmuefpeWJjeerr+aTjeS9nOato+W4uFxuICAgIH1cblxuICAgIHB1YmxpYyBEYXRhUmVzcG9uc2UgZ2V0VGVhY2hlckluZm8oRGF0YVJlcXVlc3QgZGF0YVJlcXVlc3QpIHtcbiAgICAgICAgSW50ZWdlciBwZXJzb25JZCA9IGRhdGFSZXF1ZXN0LmdldEludGVnZXIoXCJwZXJzb25JZFwiKTtcbiAgICAgICAgVGVhY2hlciBzID0gbnVsbDtcbiAgICAgICAgT3B0aW9uYWw8VGVhY2hlcj4gb3A7XG4gICAgICAgIGlmIChwZXJzb25JZCAhPSBudWxsKSB7XG4gICAgICAgICAgICBvcCA9IHRlYWNoZXJSZXBvc2l0b3J5LmZpbmRCeUlkKHBlcnNvbklkKTsgLy/moLnmja7lrabnlJ/kuLvplK7ku47mlbDmja7lupPmn6Xor6LlrabnlJ/nmoTkv6Hmga9cbiAgICAgICAgICAgIGlmIChvcC5pc1ByZXNlbnQoKSkge1xuICAgICAgICAgICAgICAgIHMgPSBvcC5nZXQoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gQ29tbW9uTWV0aG9kLmdldFJldHVybkRhdGEoZ2V0TWFwRnJvbVRlYWNoZXIocykpOyAvL+i/memHjOWbnuS8oOWMheWQq+WtpueUn+S/oeaBr+eahE1hcOWvueixoVxuICAgIH1cblxuICAgIHB1YmxpYyBEYXRhUmVzcG9uc2UgdGVhY2hlckVkaXRTYXZlKERhdGFSZXF1ZXN0IGRhdGFSZXF1ZXN0KSB7XG4gICAgICAgIEludGVnZXIgcGVyc29uSWQgPSBkYXRhUmVxdWVzdC5nZXRJbnRlZ2VyKFwicGVyc29uSWRcIik7XG4gICAgICAgIE1hcDxTdHJpbmcsIE9iamVjdD4gZm9ybSA9IGRhdGFSZXF1ZXN0LmdldE1hcChcImZvcm1cIik7IC8v5Y+C5pWw6I635Y+WTWFw5a+56LGhXG4gICAgICAgIFN0cmluZyBudW0gPSBDb21tb25NZXRob2QuZ2V0U3RyaW5nKGZvcm0sIFwibnVtXCIpOyAgLy9NYXAg6I635Y+W5bGe5oCn55qE5YC8XG4gICAgICAgIFRlYWNoZXIgcyA9IG51bGw7XG4gICAgICAgIFBlcnNvbiBwO1xuICAgICAgICBVc2VyIHU7XG4gICAgICAgIE9wdGlvbmFsPFRlYWNoZXI+IG9wO1xuICAgICAgICBib29sZWFuIGlzTmV3ID0gZmFsc2U7XG4gICAgICAgIGlmIChwZXJzb25JZCAhPSBudWxsKSB7XG4gICAgICAgICAgICBvcCA9IHRlYWNoZXJSZXBvc2l0b3J5LmZpbmRCeUlkKHBlcnNvbklkKTsgIC8v5p+l6K+i5a+55bqU5pWw5o2u5bqT5Lit5Li76ZSu5Li6aWTnmoTlgLznmoTlrp7kvZPlr7nosaFcbiAgICAgICAgICAgIGlmIChvcC5pc1ByZXNlbnQoKSkge1xuICAgICAgICAgICAgICAgIHMgPSBvcC5nZXQoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBPcHRpb25hbDxQZXJzb24+IG5PcCA9IHBlcnNvblJlcG9zaXRvcnkuZmluZEJ5TnVtKG51bSk7IC8v5p+l6K+i5piv5ZCm5a2Y5ZyobnVt55qE5Lq65ZGYXG4gICAgICAgIGlmIChuT3AuaXNQcmVzZW50KCkpIHtcbiAgICAgICAgICAgIGlmIChzID09IG51bGwgfHwgIXMuZ2V0UGVyc29uKCkuZ2V0TnVtKCkuZXF1YWxzKG51bSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gQ29tbW9uTWV0aG9kLmdldFJldHVybk1lc3NhZ2VFcnJvcihcIuaWsOW3peWPt+W3sue7j+WtmOWcqO+8jOS4jeiDvea3u+WKoOaIluS/ruaUue+8gVwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAocyA9PSBudWxsKSB7XG4gICAgICAgICAgICBwID0gbmV3IFBlcnNvbigpO1xuICAgICAgICAgICAgcC5zZXROdW0obnVtKTtcbiAgICAgICAgICAgIHAuc2V0VHlwZShcIjJcIik7ICAvLyAy6KGo56S65pWZ5biI57G75Z6LXG4gICAgICAgICAgICBwZXJzb25SZXBvc2l0b3J5LnNhdmVBbmRGbHVzaChwKTsgIC8v5o+S5YWl5paw55qEUGVyc29u6K6w5b2VXG4gICAgICAgICAgICBwZXJzb25JZCA9IHAuZ2V0UGVyc29uSWQoKTtcbiAgICAgICAgICAgIFN0cmluZyBwYXNzd29yZCA9IGVuY29kZXIuZW5jb2RlKFwiMTIzNDU2XCIpO1xuICAgICAgICAgICAgdSA9IG5ldyBVc2VyKCk7XG4gICAgICAgICAgICB1LnNldFBlcnNvbklkKHBlcnNvbklkKTtcbiAgICAgICAgICAgIHUuc2V0VXNlck5hbWUobnVtKTtcbiAgICAgICAgICAgIHUuc2V0UGFzc3dvcmQocGFzc3dvcmQpO1xuICAgICAgICAgICAgdS5zZXRVc2VyVHlwZSh1c2VyVHlwZVJlcG9zaXRvcnkuZmluZEJ5TmFtZShFVXNlclR5cGUuUk9MRV9URUFDSEVSKSk7ICAvLyDorr7nva7kuLrmlZnluIjop5LoibJcbiAgICAgICAgICAgIHUuc2V0Q3JlYXRlVGltZShEYXRlVGltZVRvb2wucGFyc2VEYXRlVGltZShuZXcgRGF0ZSgpKSk7XG4gICAgICAgICAgICB1LnNldENyZWF0b3JJZChDb21tb25NZXRob2QuZ2V0UGVyc29uSWQoKSk7XG4gICAgICAgICAgICB1c2VyUmVwb3NpdG9yeS5zYXZlQW5kRmx1c2godSk7IC8v5o+S5YWl5paw55qEVXNlcuiusOW9lVxuICAgICAgICAgICAgcyA9IG5ldyBUZWFjaGVyKCk7ICAgLy8g5Yib5bu65a6e5L2T5a+56LGhXG4gICAgICAgICAgICBzLnNldFBlcnNvbklkKHBlcnNvbklkKTtcbiAgICAgICAgICAgIHRlYWNoZXJSZXBvc2l0b3J5LnNhdmVBbmRGbHVzaChzKTsgIC8v5o+S5YWl5paw55qEVGVhY2hlcuiusOW9lVxuICAgICAgICAgICAgaXNOZXcgPSB0cnVlO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcCA9IHMuZ2V0UGVyc29uKCk7XG4gICAgICAgIH1cbiAgICAgICAgcGVyc29uSWQgPSBwLmdldFBlcnNvbklkKCk7XG4gICAgICAgIGlmICghbnVtLmVxdWFscyhwLmdldE51bSgpKSkgeyAgIC8v5aaC5p6c5Lq65ZGY57yW5Y+35Y+Y5YyW77yM5L+u5pS55Lq65ZGY57yW5Y+35ZKM55m75b2V6LSm5Y+3XG4gICAgICAgICAgICBPcHRpb25hbDxVc2VyPiB1T3AgPSB1c2VyUmVwb3NpdG9yeS5maW5kQnlQZXJzb25QZXJzb25JZChwZXJzb25JZCk7XG4gICAgICAgICAgICBpZiAodU9wLmlzUHJlc2VudCgpKSB7XG4gICAgICAgICAgICAgICAgdSA9IHVPcC5nZXQoKTtcbiAgICAgICAgICAgICAgICB1LnNldFVzZXJOYW1lKG51bSk7XG4gICAgICAgICAgICAgICAgdXNlclJlcG9zaXRvcnkuc2F2ZUFuZEZsdXNoKHUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcC5zZXROdW0obnVtKTsgIC8v6K6+572u5bGe5oCnXG4gICAgICAgIH1cbiAgICAgICAgcC5zZXROYW1lKENvbW1vbk1ldGhvZC5nZXRTdHJpbmcoZm9ybSwgXCJuYW1lXCIpKTtcbiAgICAgICAgcC5zZXREZXB0KENvbW1vbk1ldGhvZC5nZXRTdHJpbmcoZm9ybSwgXCJkZXB0XCIpKTtcbiAgICAgICAgcC5zZXRDYXJkKENvbW1vbk1ldGhvZC5nZXRTdHJpbmcoZm9ybSwgXCJjYXJkXCIpKTtcbiAgICAgICAgcC5zZXRHZW5kZXIoQ29tbW9uTWV0aG9kLmdldFN0cmluZyhmb3JtLCBcImdlbmRlclwiKSk7XG4gICAgICAgIHAuc2V0QmlydGhkYXkoQ29tbW9uTWV0aG9kLmdldFN0cmluZyhmb3JtLCBcImJpcnRoZGF5XCIpKTtcbiAgICAgICAgcC5zZXRFbWFpbChDb21tb25NZXRob2QuZ2V0U3RyaW5nKGZvcm0sIFwiZW1haWxcIikpO1xuICAgICAgICBwLnNldFBob25lKENvbW1vbk1ldGhvZC5nZXRTdHJpbmcoZm9ybSwgXCJwaG9uZVwiKSk7XG4gICAgICAgIHAuc2V0QWRkcmVzcyhDb21tb25NZXRob2QuZ2V0U3RyaW5nKGZvcm0sIFwiYWRkcmVzc1wiKSk7XG4gICAgICAgIHBlcnNvblJlcG9zaXRvcnkuc2F2ZShwKTsgIC8vIOS/ruaUueS/neWtmOS6uuWRmOS/oeaBr1xuICAgICAgICBzLnNldENsYXNzTmFtZShDb21tb25NZXRob2QuZ2V0U3RyaW5nKGZvcm0sIFwiY2xhc3NOYW1lXCIpKTtcbiAgICAgICAgdGVhY2hlclJlcG9zaXRvcnkuc2F2ZShzKTsgIC8v5L+u5pS55L+d5a2Y5a2m55Sf5L+h5oGvXG4gICAgICAgIHN5c3RlbVNlcnZpY2UubW9kaWZ5TG9nKHMsIGlzTmV3KTtcbiAgICAgICAgcmV0dXJuIENvbW1vbk1ldGhvZC5nZXRSZXR1cm5EYXRhKHMuZ2V0UGVyc29uSWQoKSk7ICAvLyDlsIZwZXJzb25JZOi/lOWbnuWJjeerr1xuICAgIH1cblxuICAgIHB1YmxpYyBSZXNwb25zZUVudGl0eTxTdHJlYW1pbmdSZXNwb25zZUJvZHk+IGdldFRlYWNoZXJMaXN0RXhjbChEYXRhUmVxdWVzdCBkYXRhUmVxdWVzdCkge1xuICAgICAgICBTdHJpbmcgbnVtTmFtZSA9IGRhdGFSZXF1ZXN0LmdldFN0cmluZyhcIm51bU5hbWVcIik7XG4gICAgICAgIExpc3Q8TWFwPFN0cmluZywgT2JqZWN0Pj4gbGlzdCA9IGdldFRlYWNoZXJNYXBMaXN0KG51bU5hbWUpO1xuXG4gICAgICAgIC8vIOiwg+aVtOWIl+WuvemFjee9rlxuICAgICAgICBJbnRlZ2VyW10gd2lkdGhzID0gezgsIDE1LCAxMCwgMjAsIDE1LCAxMCwgOCwgMjUsIDE1LCAzMH07XG4gICAgICAgIFN0cmluZ1tdIHRpdGxlcyA9IHtcIuW6j+WPt1wiLCBcIuW3peWPt1wiLCBcIuWnk+WQjVwiLCBcIuWtpumZolwiLCBcIuiBjOensFwiLCBcIuWtpuS9jVwiLCBcIuaAp+WIq1wiLCBcIumCrueusVwiLCBcIueUteivnVwiLCBcIuWcsOWdgFwifTtcbiAgICAgICAgU3RyaW5nIG91dFB1dFNoZWV0TmFtZSA9IFwidGVhY2hlci54bHN4XCI7XG5cbiAgICAgICAgWFNTRldvcmtib29rIHdiID0gbmV3IFhTU0ZXb3JrYm9vaygpO1xuICAgICAgICBYU1NGU2hlZXQgc2hlZXQgPSB3Yi5jcmVhdGVTaGVldChvdXRQdXRTaGVldE5hbWUpO1xuXG4gICAgICAgIC8vIOiuvue9ruWIl+WuvVxuICAgICAgICBmb3IgKGludCBqID0gMDsgaiA8IHdpZHRocy5sZW5ndGg7IGorKykge1xuICAgICAgICAgICAgc2hlZXQuc2V0Q29sdW1uV2lkdGgoaiwgd2lkdGhzW2pdICogMjU2KTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIOWIm+W7uuagh+mimOihjOagt+W8j1xuICAgICAgICBYU1NGQ2VsbFN0eWxlIHN0eWxlID0gQ29tbW9uTWV0aG9kLmNyZWF0ZUNlbGxTdHlsZSh3YiwgMTEpO1xuICAgICAgICBYU1NGUm93IHJvdyA9IHNoZWV0LmNyZWF0ZVJvdygwKTtcbiAgICAgICAgWFNTRkNlbGxbXSBjZWxsID0gbmV3IFhTU0ZDZWxsW3dpZHRocy5sZW5ndGhdO1xuXG4gICAgICAgIC8vIOWhq+WFheagh+mimOihjFxuICAgICAgICBmb3IgKGludCBqID0gMDsgaiA8IHdpZHRocy5sZW5ndGg7IGorKykge1xuICAgICAgICAgICAgY2VsbFtqXSA9IHJvdy5jcmVhdGVDZWxsKGopO1xuICAgICAgICAgICAgY2VsbFtqXS5zZXRDZWxsU3R5bGUoc3R5bGUpO1xuICAgICAgICAgICAgY2VsbFtqXS5zZXRDZWxsVmFsdWUodGl0bGVzW2pdKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIOWhq+WFheaVsOaNruihjFxuICAgICAgICBpZiAobGlzdCAhPSBudWxsICYmICFsaXN0LmlzRW1wdHkoKSkge1xuICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBsaXN0LnNpemUoKTsgaSsrKSB7XG4gICAgICAgICAgICAgICAgcm93ID0gc2hlZXQuY3JlYXRlUm93KGkgKyAxKTtcbiAgICAgICAgICAgICAgICBNYXA8U3RyaW5nLCBPYmplY3Q+IG0gPSBsaXN0LmdldChpKTtcblxuICAgICAgICAgICAgICAgIC8vIOWIm+W7uuWNleWFg+agvOW5tuiuvue9ruagt+W8j1xuICAgICAgICAgICAgICAgIGZvciAoaW50IGogPSAwOyBqIDwgd2lkdGhzLmxlbmd0aDsgaisrKSB7XG4gICAgICAgICAgICAgICAgICAgIGNlbGxbal0gPSByb3cuY3JlYXRlQ2VsbChqKTtcbiAgICAgICAgICAgICAgICAgICAgY2VsbFtqXS5zZXRDZWxsU3R5bGUoc3R5bGUpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIC8vIOWhq+WFheWFt+S9k+aVsOaNrlxuICAgICAgICAgICAgICAgIGNlbGxbMF0uc2V0Q2VsbFZhbHVlKChpICsgMSkgKyBcIlwiKTsgLy8g5bqP5Y+3XG4gICAgICAgICAgICAgICAgY2VsbFsxXS5zZXRDZWxsVmFsdWUoQ29tbW9uTWV0aG9kLmdldFN0cmluZyhtLCBcIm51bVwiKSk7IC8vIOW3peWPt1xuICAgICAgICAgICAgICAgIGNlbGxbMl0uc2V0Q2VsbFZhbHVlKENvbW1vbk1ldGhvZC5nZXRTdHJpbmcobSwgXCJuYW1lXCIpKTsgLy8g5aeT5ZCNXG4gICAgICAgICAgICAgICAgY2VsbFszXS5zZXRDZWxsVmFsdWUoQ29tbW9uTWV0aG9kLmdldFN0cmluZyhtLCBcImRlcHRcIikpOyAvLyDlrabpmaJcbiAgICAgICAgICAgICAgICBjZWxsWzRdLnNldENlbGxWYWx1ZShDb21tb25NZXRob2QuZ2V0U3RyaW5nKG0sIFwidGl0bGVcIikpOyAvLyDogYznp7BcbiAgICAgICAgICAgICAgICBjZWxsWzVdLnNldENlbGxWYWx1ZShDb21tb25NZXRob2QuZ2V0U3RyaW5nKG0sIFwiZGVncmVlXCIpKTsgLy8g5a2m5L2NXG4gICAgICAgICAgICAgICAgY2VsbFs2XS5zZXRDZWxsVmFsdWUoQ29tbW9uTWV0aG9kLmdldFN0cmluZyhtLCBcImdlbmRlck5hbWVcIikpOyAvLyDmgKfliKtcbiAgICAgICAgICAgICAgICBjZWxsWzddLnNldENlbGxWYWx1ZShDb21tb25NZXRob2QuZ2V0U3RyaW5nKG0sIFwiZW1haWxcIikpOyAvLyDpgq7nrrFcbiAgICAgICAgICAgICAgICBjZWxsWzhdLnNldENlbGxWYWx1ZShDb21tb25NZXRob2QuZ2V0U3RyaW5nKG0sIFwicGhvbmVcIikpOyAvLyDnlLXor51cbiAgICAgICAgICAgICAgICBjZWxsWzldLnNldENlbGxWYWx1ZShDb21tb25NZXRob2QuZ2V0U3RyaW5nKG0sIFwiYWRkcmVzc1wiKSk7IC8vIOWcsOWdgFxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIFN0cmVhbWluZ1Jlc3BvbnNlQm9keSBzdHJlYW0gPSB3Yjo6d3JpdGU7XG4gICAgICAgICAgICByZXR1cm4gUmVzcG9uc2VFbnRpdHkub2soKVxuICAgICAgICAgICAgICAgICAgICAuY29udGVudFR5cGUoQ29tbW9uTWV0aG9kLmV4ZWxUeXBlKVxuICAgICAgICAgICAgICAgICAgICAuYm9keShzdHJlYW0pO1xuICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkge1xuICAgICAgICAgICAgcmV0dXJuIFJlc3BvbnNlRW50aXR5LmludGVybmFsU2VydmVyRXJyb3IoKS5idWlsZCgpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHVibGljIERhdGFSZXNwb25zZSBnZXRUZWFjaGVyUGFnZURhdGEoRGF0YVJlcXVlc3QgZGF0YVJlcXVlc3QpIHtcbiAgICAgICAgU3RyaW5nIG51bU5hbWUgPSBkYXRhUmVxdWVzdC5nZXRTdHJpbmcoXCJudW1OYW1lXCIpO1xuICAgICAgICBJbnRlZ2VyIGNQYWdlID0gZGF0YVJlcXVlc3QuZ2V0Q3VycmVudFBhZ2UoKTtcbiAgICAgICAgaW50IGRhdGFUb3RhbCA9IDA7XG4gICAgICAgIGludCBzaXplID0gNDA7XG4gICAgICAgIExpc3Q8TWFwPFN0cmluZywgT2JqZWN0Pj4gZGF0YUxpc3QgPSBuZXcgQXJyYXlMaXN0PD4oKTtcbiAgICAgICAgUGFnZTxUZWFjaGVyPiBwYWdlID0gbnVsbDtcbiAgICAgICAgUGFnZWFibGUgcGFnZWFibGUgPSBQYWdlUmVxdWVzdC5vZihjUGFnZSwgc2l6ZSk7XG4gICAgICAgIHBhZ2UgPSB0ZWFjaGVyUmVwb3NpdG9yeS5maW5kVGVhY2hlckxpc3RCeU51bU5hbWUobnVtTmFtZSwgcGFnZWFibGUpO1xuICAgICAgICBNYXA8U3RyaW5nLCBPYmplY3Q+IG07XG4gICAgICAgIGlmIChwYWdlICE9IG51bGwpIHtcbiAgICAgICAgICAgIGRhdGFUb3RhbCA9IChpbnQpIHBhZ2UuZ2V0VG90YWxFbGVtZW50cygpO1xuICAgICAgICAgICAgTGlzdDxUZWFjaGVyPiBsaXN0ID0gcGFnZS5nZXRDb250ZW50KCk7XG4gICAgICAgICAgICBpZiAoIWxpc3QuaXNFbXB0eSgpKSB7XG4gICAgICAgICAgICAgICAgZm9yIChUZWFjaGVyIHRlYWNoZXIgOiBsaXN0KSB7XG4gICAgICAgICAgICAgICAgICAgIG0gPSBnZXRNYXBGcm9tVGVhY2hlcih0ZWFjaGVyKTtcbiAgICAgICAgICAgICAgICAgICAgZGF0YUxpc3QuYWRkKG0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBNYXA8U3RyaW5nLCBPYmplY3Q+IGRhdGEgPSBuZXcgSGFzaE1hcDw+KCk7XG4gICAgICAgIGRhdGEucHV0KFwiZGF0YVRvdGFsXCIsIGRhdGFUb3RhbCk7XG4gICAgICAgIGRhdGEucHV0KFwicGFnZVNpemVcIiwgc2l6ZSk7XG4gICAgICAgIGRhdGEucHV0KFwiZGF0YUxpc3RcIiwgZGF0YUxpc3QpO1xuICAgICAgICByZXR1cm4gQ29tbW9uTWV0aG9kLmdldFJldHVybkRhdGEoZGF0YSk7XG4gICAgfVxufVxuXG4uLi5cblBhdGg6IHNyYy9tYWluL2phdmEvY24vZWR1L3NkdS9qYXZhL3NlcnZlci9zZXJ2aWNlcy9UZWFjaGVyU2VydmljZXMuamF2YVxucGFja2FnZSBjbi5lZHUuc2R1LmphdmEuc2VydmVyLnNlcnZpY2VzO1xuXG5pbXBvcnQgY24uZWR1LnNkdS5qYXZhLnNlcnZlci5tb2RlbHMuKjtcbmltcG9ydCBjbi5lZHUuc2R1LmphdmEuc2VydmVyLm1vZGVscy5UZWFjaGVyO1xuaW1wb3J0IGNuLmVkdS5zZHUuamF2YS5zZXJ2ZXIucGF5bG9hZC5yZXF1ZXN0LkRhdGFSZXF1ZXN0O1xuaW1wb3J0IGNuLmVkdS5zZHUuamF2YS5zZXJ2ZXIucGF5bG9hZC5yZXNwb25zZS5EYXRhUmVzcG9uc2U7XG5pbXBvcnQgY24uZWR1LnNkdS5qYXZhLnNlcnZlci5yZXBvc2l0b3J5cy4qO1xuaW1wb3J0IGNuLmVkdS5zZHUuamF2YS5zZXJ2ZXIudXRpbC5Db21EYXRhVXRpbDtcbmltcG9ydCBjbi5lZHUuc2R1LmphdmEuc2VydmVyLnV0aWwuQ29tbW9uTWV0aG9kO1xuaW1wb3J0IGNuLmVkdS5zZHUuamF2YS5zZXJ2ZXIudXRpbC5EYXRlVGltZVRvb2w7XG5pbXBvcnQgb3JnLmFwYWNoZS5wb2kuc3MudXNlcm1vZGVsLkNlbGw7XG5pbXBvcnQgb3JnLmFwYWNoZS5wb2kuc3MudXNlcm1vZGVsLlJvdztcbmltcG9ydCBvcmcuYXBhY2hlLnBvaS54c3NmLnVzZXJtb2RlbC4qO1xuaW1wb3J0IG9yZy5zbGY0ai5Mb2dnZXI7XG5pbXBvcnQgb3JnLnNsZjRqLkxvZ2dlckZhY3Rvcnk7XG5pbXBvcnQgb3JnLnNwcmluZ2ZyYW1ld29yay5kYXRhLmRvbWFpbi5QYWdlO1xuaW1wb3J0IG9yZy5zcHJpbmdmcmFtZXdvcmsuZGF0YS5kb21haW4uUGFnZVJlcXVlc3Q7XG5pbXBvcnQgb3JnLnNwcmluZ2ZyYW1ld29yay5kYXRhLmRvbWFpbi5QYWdlYWJsZTtcbi4uLlxuXG5AU2VydmljZVxucHVibGljIGNsYXNzIFRlYWNoZXJTZXJ2aWNlIHtcbiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBMb2dnZXIgbG9nID0gTG9nZ2VyRmFjdG9yeS5nZXRMb2dnZXIoY24uZWR1LnNkdS5qYXZhLnNlcnZlci5zZXJ2aWNlcy5UZWFjaGVyU2VydmljZS5jbGFzcyk7XG4gICAgcHJpdmF0ZSBmaW5hbCBQZXJzb25SZXBvc2l0b3J5IHBlcnNvblJlcG9zaXRvcnk7ICAvL+S6uuWRmOaVsOaNruaTjeS9nOiHquWKqOazqOWFpVxuICAgIHByaXZhdGUgZmluYWwgVGVhY2hlclJlcG9zaXRvcnkgdGVhY2hlclJlcG9zaXRvcnk7ICAvL+aVmeW4iOaVsOaNruaTjeS9nOiHquWKqOazqOWFpVxuICAgIHByaXZhdGUgZmluYWwgVXNlclJlcG9zaXRvcnkgdXNlclJlcG9zaXRvcnk7ICAvL+aVsOaNruaTjeS9nOiHquWKqOazqOWFpVxuICAgIHByaXZhdGUgZmluYWwgVXNlclR5cGVSZXBvc2l0b3J5IHVzZXJUeXBlUmVwb3NpdG9yeTsgLy/nlKjmiLfnsbvlnovmlbDmja7mk43kvZzoh6rliqjms6jlhaVcbiAgICBwcml2YXRlIGZpbmFsIFBhc3N3b3JkRW5jb2RlciBlbmNvZGVyOyAgLy/lr4bnoIHmnI3liqHoh6rliqjms6jlhaVcbiAgICBwcml2YXRlIGZpbmFsIEZlZVJlcG9zaXRvcnkgZmVlUmVwb3NpdG9yeTsgIC8v5raI6LS55pWw5o2u5pON5L2c6Ieq5Yqo5rOo5YWlXG4gICAgcHJpdmF0ZSBmaW5hbCBGYW1pbHlNZW1iZXJSZXBvc2l0b3J5IGZhbWlseU1lbWJlclJlcG9zaXRvcnk7XG4gICAgcHJpdmF0ZSBmaW5hbCBTeXN0ZW1TZXJ2aWNlIHN5c3RlbVNlcnZpY2U7XG4uLi5cbiAgICBwdWJsaWMgTWFwPFN0cmluZyxPYmplY3Q+IGdldE1hcEZyb21UZWFjaGVyKFRlYWNoZXIgcykge1xuICAgICAgICBNYXA8U3RyaW5nLE9iamVjdD4gbSA9IG5ldyBIYXNoTWFwPD4oKTtcbiAgICAgICAgUGVyc29uIHA7XG4gICAgICAgIGlmKHMgPT0gbnVsbClcbiAgICAgICAgICAgIHJldHVybiBtO1xuICAgICAgICBtLnB1dChcInRpdGxlXCIscy5nZXRUaXRsZSgpKTtcbiAgICAgICAgbS5wdXQoXCJkZWdyZWVcIixzLmdldERlZ3JlZSgpKTtcbiAgICAgICAgbS5wdXQoXCJjbGFzc05hbWVcIixzLmdldENsYXNzTmFtZSgpKTtcbiAgICAgICAgcCA9IHMuZ2V0UGVyc29uKCk7XG4gICAgICAgIGlmKHAgPT0gbnVsbClcbiAgICAgICAgICAgIHJldHVybiBtO1xuICAgICAgICBtLnB1dChcInBlcnNvbklkXCIsIHMuZ2V0UGVyc29uSWQoKSk7XG4gICAgICAgIG0ucHV0KFwibnVtXCIscC5nZXROdW0oKSk7XG4gICAgICAgIG0ucHV0KFwibmFtZVwiLHAuZ2V0TmFtZSgpKTtcbiAgICAgICAgbS5wdXQoXCJkZXB0XCIscC5nZXREZXB0KCkpO1xuICAgICAgICBtLnB1dChcImNhcmRcIixwLmdldENhcmQoKSk7XG4gICAgICAgIFN0cmluZyBnZW5kZXIgPSBwLmdldEdlbmRlcigpO1xuICAgICAgICBtLnB1dChcImdlbmRlclwiLGdlbmRlcik7XG4gICAgICAgIG0ucHV0KFwiZ2VuZGVyTmFtZVwiLCBDb21EYXRhVXRpbC5nZXRJbnN0YW5jZSgpLmdldERpY3Rpb25hcnlMYWJlbEJ5VmFsdWUoXCJYQk1cIiwgZ2VuZGVyKSk7IC8v5oCn5Yir57G75Z6L55qE5YC86L2s5o2i5oiQ5pWw5o2u57G75Z6L5ZCNXG4gICAgICAgIG0ucHV0KFwiYmlydGhkYXlcIiwgcC5nZXRCaXJ0aGRheSgpKTsgIC8v5pe26Ze05qC85byP6L2s5o2i5a2X56ym5LiyXG4gICAgICAgIG0ucHV0KFwiZW1haWxcIixwLmdldEVtYWlsKCkpO1xuICAgICAgICBtLnB1dChcInBob25lXCIscC5nZXRQaG9uZSgpKTtcbiAgICAgICAgbS5wdXQoXCJhZGRyZXNzXCIscC5nZXRBZGRyZXNzKCkpO1xuICAgICAgICBtLnB1dChcImludHJvZHVjZVwiLHAuZ2V0SW50cm9kdWNlKCkpO1xuICAgICAgICByZXR1cm4gbTtcbiAgICB9XG4gICAgcHVibGljIExpc3Q8TWFwPFN0cmluZyxPYmplY3Q+PiBnZXRUZWFjaGVyTWFwTGlzdChTdHJpbmcgbnVtTmFtZSkge1xuICAgICAgICBMaXN0PE1hcDxTdHJpbmcsT2JqZWN0Pj4gZGF0YUxpc3QgPSBuZXcgQXJyYXlMaXN0PD4oKTtcbiAgICAgICAgTGlzdDxUZWFjaGVyPiBzTGlzdCA9IHRlYWNoZXJSZXBvc2l0b3J5LmZpbmRUZWFjaGVyTGlzdEJ5TnVtTmFtZShudW1OYW1lKTsgIC8v5pWw5o2u5bqT5p+l6K+i5pON5L2cXG4gICAgICAgIGlmIChzTGlzdCA9PSBudWxsIHx8IHNMaXN0LmlzRW1wdHkoKSlcbiAgICAgICAgICAgIHJldHVybiBkYXRhTGlzdDtcbiAgICAgICAgZm9yIChUZWFjaGVyIHRlYWNoZXIgOiBzTGlzdCkge1xuICAgICAgICAgICAgZGF0YUxpc3QuYWRkKGdldE1hcEZyb21UZWFjaGVyKHRlYWNoZXIpKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZGF0YUxpc3Q7XG4gICAgfVxuICAgIHB1YmxpYyBEYXRhUmVzcG9uc2UgZ2V0VGVhY2hlckxpc3QoRGF0YVJlcXVlc3QgZGF0YVJlcXVlc3QpIHtcbiAgICAgICAgU3RyaW5nIG51bU5hbWUgPSBkYXRhUmVxdWVzdC5nZXRTdHJpbmcoXCJudW1OYW1lXCIpO1xuICAgICAgICBMaXN0PE1hcDxTdHJpbmcsT2JqZWN0Pj4gZGF0YUxpc3QgPSAgZ2V0VGVhY2hlckxpc3QobnVtTmFtZSk7XG4gICAgICAgIHJldHVybiBDb21tb25NZXRob2QuZ2V0UmV0dXJuRGF0YShkYXRhTGlzdCk7ICAvL+aMieeFp+a1i+ivleahhuaetuinhOiMg+S8mumAgU1hcOeahGxpc3RcbiAgICB9XG4gICAgcHVibGljIERhdGFSZXNwb25zZSB0ZWFjaGVyRGVsZXRlKERhdGFSZXF1ZXN0IGRhdGFSZXF1ZXN0KSB7XG4gICAgICAgIEludGVnZXIgcGVyc29uSWQgPSBkYXRhUmVxdWVzdC5nZXRJbnRlZ2VyKFwicGVyc29uSWRcIik7ICAvL+iOt+WPlnRlYWNoZXJfaWTlgLxcbiAgICAgICAgVGVhY2hlciBzID0gbnVsbDtcbiAgICAgICAgT3B0aW9uYWw8VGVhY2hlcj4gb3A7XG4gICAgICAgIGlmIChwZXJzb25JZCAhPSBudWxsICYmIHBlcnNvbklkID4gMCkge1xuICAgICAgICAgICAgb3AgPSB0ZWFjaGVyUmVwb3NpdG9yeS5maW5kQnlJZChwZXJzb25JZCk7ICAgLy/mn6Xor6Lojrflvpflrp7kvZPlr7nosaFcbiAgICAgICAgICAgIGlmKG9wLmlzUHJlc2VudCgpKSB7XG4gICAgICAgICAgICAgICAgcyA9IG9wLmdldCgpO1xuICAgICAgICAgICAgICAgIE9wdGlvbmFsPFVzZXI+IHVPcCA9IHVzZXJSZXBvc2l0b3J5LmZpbmRCeUlkKHBlcnNvbklkKTsgLy/mn6Xor6Llr7nlupTor6XmlZnluIjnmoTotKbmiLdcbiAgICAgICAgICAgICAgICAvL+WIoOmZpOWvueW6lOivpeaVmeW4iOeahOi0puaIt1xuICAgICAgICAgICAgICAgIHVPcC5pZlByZXNlbnQodXNlclJlcG9zaXRvcnk6OmRlbGV0ZSk7XG4gICAgICAgICAgICAgICAgUGVyc29uIHAgPSBzLmdldFBlcnNvbigpO1xuICAgICAgICAgICAgICAgIHRlYWNoZXJSZXBvc2l0b3J5LmRlbGV0ZShzKTsgICAgLy/pppblhYjmlbDmja7lupPmsLjkuYXliKDpmaTmlZnluIjkv6Hmga9cbiAgICAgICAgICAgICAgICBwZXJzb25SZXBvc2l0b3J5LmRlbGV0ZShwKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gQ29tbW9uTWV0aG9kLmdldFJldHVybk1lc3NhZ2VPSygpOyAgLy/pgJrnn6XliY3nq6/mk43kvZzmraPluLhcbiAgICB9XG4gICAgcHVibGljIERhdGFSZXNwb25zZSBnZXRUZWFjaGVySW5mbyhEYXRhUmVxdWVzdCBkYXRhUmVxdWVzdCkge1xuICAgICAgICBJbnRlZ2VyIHBlcnNvbklkID0gZGF0YVJlcXVlc3QuZ2V0SW50ZWdlcihcInBlcnNvbklkXCIpO1xuICAgICAgICBUZWFjaGVyIHMgPSBudWxsO1xuICAgICAgICBPcHRpb25hbDxUZWFjaGVyPiBvcDtcbiAgICAgICAgaWYgKHBlcnNvbklkICE9IG51bGwpIHtcbiAgICAgICAgICAgIG9wID0gdGVhY2hlclJlcG9zaXRvcnkuZmluZEJ5SWQocGVyc29uSWQpOyAvL+agueaNruWtpueUn+S4u+mUruS7juaVsOaNruW6k+afpeivouWtpueUn+eahOS/oeaBr1xuICAgICAgICAgICAgaWYgKG9wLmlzUHJlc2VudCgpKSB7XG4gICAgICAgICAgICAgICAgcyA9IG9wLmdldCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBDb21tb25NZXRob2QuZ2V0UmV0dXJuRGF0YShnZXRNYXBGcm9tVGVhY2hlcihzKSk7IC8v6L+Z6YeM5Zue5Lyg5YyF5ZCr5a2m55Sf5L+h5oGv55qETWFw5a+56LGhXG4gICAgfVxuXG4gICAgcHVibGljIERhdGFSZXNwb25zZSB0ZWFjaGVyRWRpdFNhdmUoRGF0YVJlcXVlc3QgZGF0YVJlcXVlc3QpIHtcbiAgICAgICAgSW50ZWdlciBwZXJzb25JZCA9IGRhdGFSZXF1ZXN0LmdldEludGVnZXIoXCJwZXJzb25JZFwiKTtcbiAgICAgICAgTWFwPFN0cmluZyxPYmplY3Q+IGZvcm0gPSBkYXRhUmVxdWVzdC5nZXRNYXAoXCJmb3JtXCIpOyAvL+WPguaVsOiOt+WPlk1hcOWvueixoVxuICAgICAgICBTdHJpbmcgbnVtID0gQ29tbW9uTWV0aG9kLmdldFN0cmluZyhmb3JtLCBcIm51bVwiKTsgIC8vTWFwIOiOt+WPluWxnuaAp+eahOWAvFxuICAgICAgICBUZWFjaGVyIHMgPSBudWxsO1xuICAgICAgICBQZXJzb24gcDtcbiAgICAgICAgVXNlciB1O1xuICAgICAgICBPcHRpb25hbDxUZWFjaGVyPiBvcDtcbiAgICAgICAgYm9vbGVhbiBpc05ldyA9IGZhbHNlO1xuICAgICAgICBpZiAocGVyc29uSWQgIT0gbnVsbCkge1xuICAgICAgICAgICAgb3AgPSB0ZWFjaGVyUmVwb3NpdG9yeS5maW5kQnlJZChwZXJzb25JZCk7ICAvL+afpeivouWvueW6lOaVsOaNruW6k+S4reS4u+mUruS4umlk55qE5YC855qE5a6e5L2T5a+56LGhXG4gICAgICAgICAgICBpZiAob3AuaXNQcmVzZW50KCkpIHtcbiAgICAgICAgICAgICAgICBzID0gb3AuZ2V0KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgT3B0aW9uYWw8UGVyc29uPiBuT3AgPSBwZXJzb25SZXBvc2l0b3J5LmZpbmRCeU51bShudW0pOyAvL+afpeivouaYr+WQpuWtmOWcqG51beeahOS6uuWRmFxuICAgICAgICBpZiAobk9wLmlzUHJlc2VudCgpKSB7XG4gICAgICAgICAgICBpZiAocyA9PSBudWxsIHx8ICFzLmdldFBlcnNvbigpLmdldE51bSgpLmVxdWFscyhudW0pKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIENvbW1vbk1ldGhvZC5nZXRSZXR1cm5NZXNzYWdlRXJyb3IoXCLmlrDlrablj7flt7Lnu4/lrZjlnKjvvIzkuI3og73mt7vliqDmiJbkv67mlLnvvIFcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbi4uLlxuICAgIHB1YmxpYyBSZXNwb25zZUVudGl0eTxTdHJlYW1pbmdSZXNwb25zZUJvZHk+IGdldFRlYWNoZXJMaXN0RXhjbChEYXRhUmVxdWVzdCBkYXRhUmVxdWVzdCkge1xuICAgICAgICBTdHJpbmcgbnVtTmFtZSA9IGRhdGFSZXF1ZXN0LmdldFN0cmluZyhcIm51bU5hbWVcIik7XG4gICAgICAgIExpc3Q8TWFwPFN0cmluZyxPYmplY3Q+PiBsaXN0ID0gZ2V0VGVhY2hlck1hcExpc3QobnVtTmFtZSk7IC8vIOWBh+iuvuW3suaUueS4uuiOt+WPluaVmeW4iOaVsOaNrueahOaWueazlVxuXG4gICAgICAgIC8vIOiwg+aVtOWIl+WuvemFjee9ru+8iOagueaNruaVmeW4iOS/oeaBr+eJueeCueiwg+aVtO+8iVxuICAgICAgICBJbnRlZ2VyW10gd2lkdGhzID0gezgsIDE1LCAxMCwgMjAsIDE1LCAxMCwgOCwgMjUsIDE1LCAzMH07XG4gICAgICAgIFN0cmluZ1tdIHRpdGxlcyA9IHtcIuW6j+WPt1wiLCBcIuW3peWPt1wiLCBcIuWnk+WQjVwiLCBcIuWtpumZolwiLCBcIuiBjOensFwiLCBcIuWtpuS9jVwiLCBcIuaAp+WIq1wiLCBcIumCrueusVwiLCBcIueUteivnVwiLCBcIuWcsOWdgFwifTtcbiAgICAgICAgU3RyaW5nIG91dFB1dFNoZWV0TmFtZSA9IFwidGVhY2hlci54bHN4XCI7XG5cbiAgICAgICAgWFNTRldvcmtib29rIHdiID0gbmV3IFhTU0ZXb3JrYm9vaygpO1xuICAgICAgICBYU1NGU2hlZXQgc2hlZXQgPSB3Yi5jcmVhdGVTaGVldChvdXRQdXRTaGVldE5hbWUpO1xuXG4gICAgICAgIC8vIOiuvue9ruWIl+WuvVxuICAgICAgICBmb3IoaW50IGogPSAwOyBqIDwgd2lkdGhzLmxlbmd0aDsgaisrKSB7XG4gICAgICAgICAgICBzaGVldC5zZXRDb2x1bW5XaWR0aChqLCB3aWR0aHNbal0gKiAyNTYpO1xuICAgICAgICB9XG4uLi5cbiAgICBwdWJsaWMgRGF0YVJlc3BvbnNlIGdldFRlYWNoZXJQYWdlRGF0YShEYXRhUmVxdWVzdCBkYXRhUmVxdWVzdCkge1xuICAgICAgICBTdHJpbmcgbnVtTmFtZSA9IGRhdGFSZXF1ZXN0LmdldFN0cmluZyhcIm51bU5hbWVcIik7XG4gICAgICAgIEludGVnZXIgY1BhZ2UgPSBkYXRhUmVxdWVzdC5nZXRDdXJyZW50UGFnZSgpO1xuICAgICAgICBpbnQgZGF0YVRvdGFsID0gMDtcbiAgICAgICAgaW50IHNpemUgPSA0MDtcbiAgICAgICAgTGlzdDxNYXA8U3RyaW5nLE9iamVjdD4+IGRhdGFMaXN0ID0gbmV3IEFycmF5TGlzdDw+KCk7XG4gICAgICAgIFBhZ2U8VGVhY2hlcj4gcGFnZSA9IG51bGw7XG4gICAgICAgIFBhZ2VhYmxlIHBhZ2VhYmxlID0gUGFnZVJlcXVlc3Qub2YoY1BhZ2UsIHNpemUpO1xuICAgICAgICBwYWdlID0gdGVhY2hlclJlcG9zaXRvcnkuZmluZFRlYWNoZXJMaXN0QnlOdW1OYW1lKG51bU5hbWUsIHBhZ2VhYmxlKTtcbiAgICAgICAgTWFwPFN0cmluZyxPYmplY3Q+IG07XG4gICAgICAgIGlmIChwYWdlICE9IG51bGwpIHtcbiAgICAgICAgICAgIGRhdGFUb3RhbCA9IChpbnQpIHBhZ2UuZ2V0VG90YWxFbGVtZW50cygpO1xuICAgICAgICAgICAgTGlzdDxUZWFjaGVyPiBsaXN0ID0gcGFnZS5nZXRDb250ZW50KCk7XG4gICAgICAgICAgICBpZiAoIWxpc3QuaXNFbXB0eSgpKSB7XG4gICAgICAgICAgICAgICAgZm9yIChUZWFjaGVyIHRlYWNoZXIgOiBsaXN0KSB7XG4gICAgICAgICAgICAgICAgICAgIG0gPSBnZXRNYXBGcm9tVGVhY2hlcih0ZWFjaGVyKTtcbiAgICAgICAgICAgICAgICAgICAgZGF0YUxpc3QuYWRkKG0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuLi4uXG4gICAgcHVibGljIERhdGFSZXNwb25zZSBnZXRGYW1pbHlNZW1iZXJMaXN0KERhdGFSZXF1ZXN0IGRhdGFSZXF1ZXN0KSB7XG4gICAgICAgIEludGVnZXIgcGVyc29uSWQgPSBkYXRhUmVxdWVzdC5nZXRJbnRlZ2VyKFwicGVyc29uSWRcIik7XG4gICAgICAgIExpc3Q8RmFtaWx5TWVtYmVyPiBmTGlzdCA9IGZhbWlseU1lbWJlclJlcG9zaXRvcnkuZmluZEJ5VGVhY2hlclBlcnNvbklkKHBlcnNvbklkKTtcbiAgICAgICAgTGlzdDxNYXA8U3RyaW5nLE9iamVjdD4+IGRhdGFMaXN0ID0gbmV3IEFycmF5TGlzdDw+KCk7XG4gICAgICAgIE1hcDxTdHJpbmcsT2JqZWN0PiBtO1xuICAgICAgICBpZiAoZkxpc3QgIT0gbnVsbCkge1xuICAgICAgICAgICAgZm9yIChGYW1pbHlNZW1iZXIgZiA6IGZMaXN0KSB7XG4gICAgICAgICAgICAgICAgbSA9IG5ldyBIYXNoTWFwPD4oKTtcbiAgICAgICAgICAgICAgICBtLnB1dChcIm1lbWJlcklkXCIsIGYuZ2V0TWVtYmVySWQoKSk7XG4gICAgICAgICAgICAgICAgbS5wdXQoXCJwZXJzb25JZFwiLCBmLmdldFRlYWNoZXIoKS5nZXRQZXJzb25JZCgpKTtcbiAgICAgICAgICAgICAgICBtLnB1dChcInJlbGF0aW9uXCIsIGYuZ2V0UmVsYXRpb24oKSk7XG4gICAgICAgICAgICAgICAgbS5wdXQoXCJuYW1lXCIsIGYuZ2V0TmFtZSgpKTtcbiAgICAgICAgICAgICAgICBtLnB1dChcImdlbmRlclwiLCBmLmdldEdlbmRlcigpKTtcbiAgICAgICAgICAgICAgICBtLnB1dChcImFnZVwiLCBmLmdldEFnZSgpK1wiXCIpO1xuICAgICAgICAgICAgICAgIG0ucHV0KFwidW5pdFwiLCBmLmdldFVuaXQoKSk7XG4gICAgICAgICAgICAgICAgZGF0YUxpc3QuYWRkKG0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBDb21tb25NZXRob2QuZ2V0UmV0dXJuRGF0YShkYXRhTGlzdCk7XG4gICAgfVxuLi4uXG4iLCJpc0Vycm9yIjpmYWxzZSwicmVxdWVzdElkIjoiIn19LCIwNjQ3NTJmYi0yYjg4LTRlMWEtOTgzMS00ZWY4OGFiYWYwYjc7dG9vbHVfdnJ0eF8wMUg1c2JVRUc2Q3VIV1F5OWRGUkZQWVYiOnsicmVxdWVzdElkIjoiMDY0NzUyZmItMmI4OC00ZTFhLTk4MzEtNGVmODhhYmFmMGI3IiwidG9vbFVzZUlkIjoidG9vbHVfdnJ0eF8wMUg1c2JVRUc2Q3VIV1F5OWRGUkZQWVYiLCJwaGFzZSI6NSwicmVzdWx0Ijp7InRleHQiOiJUaGUgZm9sbG93aW5nIGNvZGUgc2VjdGlvbnMgd2VyZSByZXRyaWV2ZWQ6XG5QYXRoOiBzcmMvbWFpbi9qYXZhL2NuL2VkdS9zZHUvamF2YS9zZXJ2ZXIvc2VydmljZXMvVGVhY2hlclNlcnZpY2VzLmphdmFcbi4uLlxuXG5AU2VydmljZVxucHVibGljIGNsYXNzIFRlYWNoZXJTZXJ2aWNlIHtcbiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBMb2dnZXIgbG9nID0gTG9nZ2VyRmFjdG9yeS5nZXRMb2dnZXIoY24uZWR1LnNkdS5qYXZhLnNlcnZlci5zZXJ2aWNlcy5UZWFjaGVyU2VydmljZS5jbGFzcyk7XG4gICAgcHJpdmF0ZSBmaW5hbCBQZXJzb25SZXBvc2l0b3J5IHBlcnNvblJlcG9zaXRvcnk7ICAvL+S6uuWRmOaVsOaNruaTjeS9nOiHquWKqOazqOWFpVxuICAgIHByaXZhdGUgZmluYWwgVGVhY2hlclJlcG9zaXRvcnkgdGVhY2hlclJlcG9zaXRvcnk7ICAvL+aVmeW4iOaVsOaNruaTjeS9nOiHquWKqOazqOWFpVxuICAgIHByaXZhdGUgZmluYWwgVXNlclJlcG9zaXRvcnkgdXNlclJlcG9zaXRvcnk7ICAvL+aVsOaNruaTjeS9nOiHquWKqOazqOWFpVxuICAgIHByaXZhdGUgZmluYWwgVXNlclR5cGVSZXBvc2l0b3J5IHVzZXJUeXBlUmVwb3NpdG9yeTsgLy/nlKjmiLfnsbvlnovmlbDmja7mk43kvZzoh6rliqjms6jlhaVcbiAgICBwcml2YXRlIGZpbmFsIFBhc3N3b3JkRW5jb2RlciBlbmNvZGVyOyAgLy/lr4bnoIHmnI3liqHoh6rliqjms6jlhaVcbiAgICBwcml2YXRlIGZpbmFsIEZlZVJlcG9zaXRvcnkgZmVlUmVwb3NpdG9yeTsgIC8v5raI6LS55pWw5o2u5pON5L2c6Ieq5Yqo5rOo5YWlXG4gICAgcHJpdmF0ZSBmaW5hbCBGYW1pbHlNZW1iZXJSZXBvc2l0b3J5IGZhbWlseU1lbWJlclJlcG9zaXRvcnk7XG4gICAgcHJpdmF0ZSBmaW5hbCBTeXN0ZW1TZXJ2aWNlIHN5c3RlbVNlcnZpY2U7XG4uLi5cbiAgICBwdWJsaWMgTWFwPFN0cmluZyxPYmplY3Q+IGdldE1hcEZyb21UZWFjaGVyKFRlYWNoZXIgcykge1xuICAgICAgICBNYXA8U3RyaW5nLE9iamVjdD4gbSA9IG5ldyBIYXNoTWFwPD4oKTtcbiAgICAgICAgUGVyc29uIHA7XG4gICAgICAgIGlmKHMgPT0gbnVsbClcbiAgICAgICAgICAgIHJldHVybiBtO1xuICAgICAgICBtLnB1dChcInRpdGxlXCIscy5nZXRUaXRsZSgpKTtcbiAgICAgICAgbS5wdXQoXCJkZWdyZWVcIixzLmdldERlZ3JlZSgpKTtcbiAgICAgICAgbS5wdXQoXCJjbGFzc05hbWVcIixzLmdldENsYXNzTmFtZSgpKTtcbiAgICAgICAgcCA9IHMuZ2V0UGVyc29uKCk7XG4gICAgICAgIGlmKHAgPT0gbnVsbClcbiAgICAgICAgICAgIHJldHVybiBtO1xuICAgICAgICBtLnB1dChcInBlcnNvbklkXCIsIHMuZ2V0UGVyc29uSWQoKSk7XG4gICAgICAgIG0ucHV0KFwibnVtXCIscC5nZXROdW0oKSk7XG4gICAgICAgIG0ucHV0KFwibmFtZVwiLHAuZ2V0TmFtZSgpKTtcbiAgICAgICAgbS5wdXQoXCJkZXB0XCIscC5nZXREZXB0KCkpO1xuICAgICAgICBtLnB1dChcImNhcmRcIixwLmdldENhcmQoKSk7XG4gICAgICAgIFN0cmluZyBnZW5kZXIgPSBwLmdldEdlbmRlcigpO1xuICAgICAgICBtLnB1dChcImdlbmRlclwiLGdlbmRlcik7XG4gICAgICAgIG0ucHV0KFwiZ2VuZGVyTmFtZVwiLCBDb21EYXRhVXRpbC5nZXRJbnN0YW5jZSgpLmdldERpY3Rpb25hcnlMYWJlbEJ5VmFsdWUoXCJYQk1cIiwgZ2VuZGVyKSk7IC8v5oCn5Yir57G75Z6L55qE5YC86L2s5o2i5oiQ5pWw5o2u57G75Z6L5ZCNXG4gICAgICAgIG0ucHV0KFwiYmlydGhkYXlcIiwgcC5nZXRCaXJ0aGRheSgpKTsgIC8v5pe26Ze05qC85byP6L2s5o2i5a2X56ym5LiyXG4gICAgICAgIG0ucHV0KFwiZW1haWxcIixwLmdldEVtYWlsKCkpO1xuICAgICAgICBtLnB1dChcInBob25lXCIscC5nZXRQaG9uZSgpKTtcbiAgICAgICAgbS5wdXQoXCJhZGRyZXNzXCIscC5nZXRBZGRyZXNzKCkpO1xuICAgICAgICBtLnB1dChcImludHJvZHVjZVwiLHAuZ2V0SW50cm9kdWNlKCkpO1xuICAgICAgICByZXR1cm4gbTtcbiAgICB9XG4gICAgcHVibGljIExpc3Q8TWFwPFN0cmluZyxPYmplY3Q+PiBnZXRUZWFjaGVyTWFwTGlzdChTdHJpbmcgbnVtTmFtZSkge1xuICAgICAgICBMaXN0PE1hcDxTdHJpbmcsT2JqZWN0Pj4gZGF0YUxpc3QgPSBuZXcgQXJyYXlMaXN0PD4oKTtcbiAgICAgICAgTGlzdDxUZWFjaGVyPiBzTGlzdCA9IHRlYWNoZXJSZXBvc2l0b3J5LmZpbmRUZWFjaGVyTGlzdEJ5TnVtTmFtZShudW1OYW1lKTsgIC8v5pWw5o2u5bqT5p+l6K+i5pON5L2cXG4gICAgICAgIGlmIChzTGlzdCA9PSBudWxsIHx8IHNMaXN0LmlzRW1wdHkoKSlcbiAgICAgICAgICAgIHJldHVybiBkYXRhTGlzdDtcbiAgICAgICAgZm9yIChUZWFjaGVyIHRlYWNoZXIgOiBzTGlzdCkge1xuICAgICAgICAgICAgZGF0YUxpc3QuYWRkKGdldE1hcEZyb21UZWFjaGVyKHRlYWNoZXIpKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZGF0YUxpc3Q7XG4gICAgfVxuICAgIHB1YmxpYyBEYXRhUmVzcG9uc2UgZ2V0VGVhY2hlckxpc3QoRGF0YVJlcXVlc3QgZGF0YVJlcXVlc3QpIHtcbiAgICAgICAgU3RyaW5nIG51bU5hbWUgPSBkYXRhUmVxdWVzdC5nZXRTdHJpbmcoXCJudW1OYW1lXCIpO1xuICAgICAgICBMaXN0PE1hcDxTdHJpbmcsT2JqZWN0Pj4gZGF0YUxpc3QgPSAgZ2V0VGVhY2hlckxpc3QobnVtTmFtZSk7XG4gICAgICAgIHJldHVybiBDb21tb25NZXRob2QuZ2V0UmV0dXJuRGF0YShkYXRhTGlzdCk7ICAvL+aMieeFp+a1i+ivleahhuaetuinhOiMg+S8mumAgU1hcOeahGxpc3RcbiAgICB9XG4gICAgcHVibGljIERhdGFSZXNwb25zZSB0ZWFjaGVyRGVsZXRlKERhdGFSZXF1ZXN0IGRhdGFSZXF1ZXN0KSB7XG4gICAgICAgIEludGVnZXIgcGVyc29uSWQgPSBkYXRhUmVxdWVzdC5nZXRJbnRlZ2VyKFwicGVyc29uSWRcIik7ICAvL+iOt+WPlnRlYWNoZXJfaWTlgLxcbiAgICAgICAgVGVhY2hlciBzID0gbnVsbDtcbiAgICAgICAgT3B0aW9uYWw8VGVhY2hlcj4gb3A7XG4gICAgICAgIGlmIChwZXJzb25JZCAhPSBudWxsICYmIHBlcnNvbklkID4gMCkge1xuICAgICAgICAgICAgb3AgPSB0ZWFjaGVyUmVwb3NpdG9yeS5maW5kQnlJZChwZXJzb25JZCk7ICAgLy/mn6Xor6Lojrflvpflrp7kvZPlr7nosaFcbiAgICAgICAgICAgIGlmKG9wLmlzUHJlc2VudCgpKSB7XG4gICAgICAgICAgICAgICAgcyA9IG9wLmdldCgpO1xuICAgICAgICAgICAgICAgIE9wdGlvbmFsPFVzZXI+IHVPcCA9IHVzZXJSZXBvc2l0b3J5LmZpbmRCeUlkKHBlcnNvbklkKTsgLy/mn6Xor6Llr7nlupTor6XmlZnluIjnmoTotKbmiLdcbiAgICAgICAgICAgICAgICAvL+WIoOmZpOWvueW6lOivpeaVmeW4iOeahOi0puaIt1xuICAgICAgICAgICAgICAgIHVPcC5pZlByZXNlbnQodXNlclJlcG9zaXRvcnk6OmRlbGV0ZSk7XG4gICAgICAgICAgICAgICAgUGVyc29uIHAgPSBzLmdldFBlcnNvbigpO1xuICAgICAgICAgICAgICAgIHRlYWNoZXJSZXBvc2l0b3J5LmRlbGV0ZShzKTsgICAgLy/pppblhYjmlbDmja7lupPmsLjkuYXliKDpmaTmlZnluIjkv6Hmga9cbiAgICAgICAgICAgICAgICBwZXJzb25SZXBvc2l0b3J5LmRlbGV0ZShwKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gQ29tbW9uTWV0aG9kLmdldFJldHVybk1lc3NhZ2VPSygpOyAgLy/pgJrnn6XliY3nq6/mk43kvZzmraPluLhcbiAgICB9XG4gICAgcHVibGljIERhdGFSZXNwb25zZSBnZXRUZWFjaGVySW5mbyhEYXRhUmVxdWVzdCBkYXRhUmVxdWVzdCkge1xuICAgICAgICBJbnRlZ2VyIHBlcnNvbklkID0gZGF0YVJlcXVlc3QuZ2V0SW50ZWdlcihcInBlcnNvbklkXCIpO1xuICAgICAgICBUZWFjaGVyIHMgPSBudWxsO1xuICAgICAgICBPcHRpb25hbDxUZWFjaGVyPiBvcDtcbiAgICAgICAgaWYgKHBlcnNvbklkICE9IG51bGwpIHtcbiAgICAgICAgICAgIG9wID0gdGVhY2hlclJlcG9zaXRvcnkuZmluZEJ5SWQocGVyc29uSWQpOyAvL+agueaNruWtpueUn+S4u+mUruS7juaVsOaNruW6k+afpeivouWtpueUn+eahOS/oeaBr1xuICAgICAgICAgICAgaWYgKG9wLmlzUHJlc2VudCgpKSB7XG4gICAgICAgICAgICAgICAgcyA9IG9wLmdldCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBDb21tb25NZXRob2QuZ2V0UmV0dXJuRGF0YShnZXRNYXBGcm9tVGVhY2hlcihzKSk7IC8v6L+Z6YeM5Zue5Lyg5YyF5ZCr5a2m55Sf5L+h5oGv55qETWFw5a+56LGhXG4gICAgfVxuXG4gICAgcHVibGljIERhdGFSZXNwb25zZSB0ZWFjaGVyRWRpdFNhdmUoRGF0YVJlcXVlc3QgZGF0YVJlcXVlc3QpIHtcbiAgICAgICAgSW50ZWdlciBwZXJzb25JZCA9IGRhdGFSZXF1ZXN0LmdldEludGVnZXIoXCJwZXJzb25JZFwiKTtcbiAgICAgICAgTWFwPFN0cmluZyxPYmplY3Q+IGZvcm0gPSBkYXRhUmVxdWVzdC5nZXRNYXAoXCJmb3JtXCIpOyAvL+WPguaVsOiOt+WPlk1hcOWvueixoVxuICAgICAgICBTdHJpbmcgbnVtID0gQ29tbW9uTWV0aG9kLmdldFN0cmluZyhmb3JtLCBcIm51bVwiKTsgIC8vTWFwIOiOt+WPluWxnuaAp+eahOWAvFxuICAgICAgICBUZWFjaGVyIHMgPSBudWxsO1xuICAgICAgICBQZXJzb24gcDtcbiAgICAgICAgVXNlciB1O1xuICAgICAgICBPcHRpb25hbDxUZWFjaGVyPiBvcDtcbiAgICAgICAgYm9vbGVhbiBpc05ldyA9IGZhbHNlO1xuICAgICAgICBpZiAocGVyc29uSWQgIT0gbnVsbCkge1xuICAgICAgICAgICAgb3AgPSB0ZWFjaGVyUmVwb3NpdG9yeS5maW5kQnlJZChwZXJzb25JZCk7ICAvL+afpeivouWvueW6lOaVsOaNruW6k+S4reS4u+mUruS4umlk55qE5YC855qE5a6e5L2T5a+56LGhXG4gICAgICAgICAgICBpZiAob3AuaXNQcmVzZW50KCkpIHtcbiAgICAgICAgICAgICAgICBzID0gb3AuZ2V0KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgT3B0aW9uYWw8UGVyc29uPiBuT3AgPSBwZXJzb25SZXBvc2l0b3J5LmZpbmRCeU51bShudW0pOyAvL+afpeivouaYr+WQpuWtmOWcqG51beeahOS6uuWRmFxuICAgICAgICBpZiAobk9wLmlzUHJlc2VudCgpKSB7XG4gICAgICAgICAgICBpZiAocyA9PSBudWxsIHx8ICFzLmdldFBlcnNvbigpLmdldE51bSgpLmVxdWFscyhudW0pKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIENvbW1vbk1ldGhvZC5nZXRSZXR1cm5NZXNzYWdlRXJyb3IoXCLmlrDlrablj7flt7Lnu4/lrZjlnKjvvIzkuI3og73mt7vliqDmiJbkv67mlLnvvIFcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHMgPT0gbnVsbCkge1xuICAgICAgICAgICAgcCA9IG5ldyBQZXJzb24oKTtcbiAgICAgICAgICAgIHAuc2V0TnVtKG51bSk7XG4gICAgICAgICAgICBwLnNldFR5cGUoXCIxXCIpO1xuICAgICAgICAgICAgcGVyc29uUmVwb3NpdG9yeS5zYXZlQW5kRmx1c2gocCk7ICAvL+aPkuWFpeaWsOeahFBlcnNvbuiusOW9lVxuICAgICAgICAgICAgcGVyc29uSWQgPSBwLmdldFBlcnNvbklkKCk7XG4gICAgICAgICAgICBTdHJpbmcgcGFzc3dvcmQgPSBlbmNvZGVyLmVuY29kZShcIjEyMzQ1NlwiKTtcbiAgICAgICAgICAgIHUgPSBuZXcgVXNlcigpO1xuICAgICAgICAgICAgdS5zZXRQZXJzb25JZChwZXJzb25JZCk7XG4gICAgICAgICAgICB1LnNldFVzZXJOYW1lKG51bSk7XG4gICAgICAgICAgICB1LnNldFBhc3N3b3JkKHBhc3N3b3JkKTtcbiAgICAgICAgICAgIHUuc2V0VXNlclR5cGUodXNlclR5cGVSZXBvc2l0b3J5LmZpbmRCeU5hbWUoRVVzZXJUeXBlLlJPTEVfU1RVREVOVCkpO1xuICAgICAgICAgICAgdS5zZXRDcmVhdGVUaW1lKERhdGVUaW1lVG9vbC5wYXJzZURhdGVUaW1lKG5ldyBEYXRlKCkpKTtcbiAgICAgICAgICAgIHUuc2V0Q3JlYXRvcklkKENvbW1vbk1ldGhvZC5nZXRQZXJzb25JZCgpKTtcbiAgICAgICAgICAgIHVzZXJSZXBvc2l0b3J5LnNhdmVBbmRGbHVzaCh1KTsgLy/mj5LlhaXmlrDnmoRVc2Vy6K6w5b2VXG4gICAgICAgICAgICBzID0gbmV3IFRlYWNoZXIoKTsgICAvLyDliJvlu7rlrp7kvZPlr7nosaFcbiAgICAgICAgICAgIHMuc2V0UGVyc29uSWQocGVyc29uSWQpO1xuICAgICAgICAgICAgdGVhY2hlclJlcG9zaXRvcnkuc2F2ZUFuZEZsdXNoKHMpOyAgLy/mj5LlhaXmlrDnmoRTdHVkZW506K6w5b2VXG4gICAgICAgICAgICBpc05ldyA9IHRydWU7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBwID0gcy5nZXRQZXJzb24oKTtcbiAgICAgICAgfVxuICAgICAgICBwZXJzb25JZCA9IHAuZ2V0UGVyc29uSWQoKTtcbiAgICAgICAgaWYgKCFudW0uZXF1YWxzKHAuZ2V0TnVtKCkpKSB7ICAgLy/lpoLmnpzkurrlkZjnvJblj7flj5jljJbvvIzkv67mlLnkurrlkZjnvJblj7flkoznmbvlvZXotKblj7dcbiAgICAgICAgICAgIE9wdGlvbmFsPFVzZXI+IHVPcCA9IHVzZXJSZXBvc2l0b3J5LmZpbmRCeVBlcnNvblBlcnNvbklkKHBlcnNvbklkKTtcbiAgICAgICAgICAgIGlmICh1T3AuaXNQcmVzZW50KCkpIHtcbiAgICAgICAgICAgICAgICB1ID0gdU9wLmdldCgpO1xuICAgICAgICAgICAgICAgIHUuc2V0VXNlck5hbWUobnVtKTtcbiAgICAgICAgICAgICAgICB1c2VyUmVwb3NpdG9yeS5zYXZlQW5kRmx1c2godSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBwLnNldE51bShudW0pOyAgLy/orr7nva7lsZ7mgKdcbiAgICAgICAgfVxuICAgICAgICBwLnNldE5hbWUoQ29tbW9uTWV0aG9kLmdldFN0cmluZyhmb3JtLCBcIm5hbWVcIikpO1xuICAgICAgICBwLnNldERlcHQoQ29tbW9uTWV0aG9kLmdldFN0cmluZyhmb3JtLCBcImRlcHRcIikpO1xuICAgICAgICBwLnNldENhcmQoQ29tbW9uTWV0aG9kLmdldFN0cmluZyhmb3JtLCBcImNhcmRcIikpO1xuICAgICAgICBwLnNldEdlbmRlcihDb21tb25NZXRob2QuZ2V0U3RyaW5nKGZvcm0sIFwiZ2VuZGVyXCIpKTtcbiAgICAgICAgcC5zZXRCaXJ0aGRheShDb21tb25NZXRob2QuZ2V0U3RyaW5nKGZvcm0sIFwiYmlydGhkYXlcIikpO1xuICAgICAgICBwLnNldEVtYWlsKENvbW1vbk1ldGhvZC5nZXRTdHJpbmcoZm9ybSwgXCJlbWFpbFwiKSk7XG4gICAgICAgIHAuc2V0UGhvbmUoQ29tbW9uTWV0aG9kLmdldFN0cmluZyhmb3JtLCBcInBob25lXCIpKTtcbiAgICAgICAgcC5zZXRBZGRyZXNzKENvbW1vbk1ldGhvZC5nZXRTdHJpbmcoZm9ybSwgXCJhZGRyZXNzXCIpKTtcbiAgICAgICAgcGVyc29uUmVwb3NpdG9yeS5zYXZlKHApOyAgLy8g5L+u5pS55L+d5a2Y5Lq65ZGY5L+h5oGvXG4gICAgICAgIHMuc2V0Q2xhc3NOYW1lKENvbW1vbk1ldGhvZC5nZXRTdHJpbmcoZm9ybSwgXCJjbGFzc05hbWVcIikpO1xuICAgICAgICB0ZWFjaGVyUmVwb3NpdG9yeS5zYXZlKHMpOyAgLy/kv67mlLnkv53lrZjlrabnlJ/kv6Hmga9cbiAgICAgICAgc3lzdGVtU2VydmljZS5tb2RpZnlMb2cocyxpc05ldyk7XG4gICAgICAgIHJldHVybiBDb21tb25NZXRob2QuZ2V0UmV0dXJuRGF0YShzLmdldFBlcnNvbklkKCkpOyAgLy8g5bCGcGVyc29uSWTov5Tlm57liY3nq69cbiAgICB9XG4uLi5cblxuICAgICAgICAgICAgICAgIC8vIOWhq+WFheWFt+S9k+aVsOaNru+8iOWtl+auteWQjemcgOimgeagueaNruWunumZheaVmeW4iOaVsOaNrue7k+aehOiwg+aVtO+8iVxuICAgICAgICAgICAgICAgIGNlbGxbMF0uc2V0Q2VsbFZhbHVlKChpICsgMSkgKyBcIlwiKTsgLy8g5bqP5Y+3XG4gICAgICAgICAgICAgICAgY2VsbFsxXS5zZXRDZWxsVmFsdWUoQ29tbW9uTWV0aG9kLmdldFN0cmluZyhtLCBcInRlYWNoZXJOdW1cIikpOyAvLyDlt6Xlj7dcbiAgICAgICAgICAgICAgICBjZWxsWzJdLnNldENlbGxWYWx1ZShDb21tb25NZXRob2QuZ2V0U3RyaW5nKG0sIFwibmFtZVwiKSk7IC8vIOWnk+WQjVxuICAgICAgICAgICAgICAgIGNlbGxbM10uc2V0Q2VsbFZhbHVlKENvbW1vbk1ldGhvZC5nZXRTdHJpbmcobSwgXCJkZXBhcnRcIikpOyAvLyDlrabpmaJcbiAgICAgICAgICAgICAgICBjZWxsWzRdLnNldENlbGxWYWx1ZShDb21tb25NZXRob2QuZ2V0U3RyaW5nKG0sIFwidGl0bGVcIikpOyAvLyDogYznp7BcbiAgICAgICAgICAgICAgICBjZWxsWzVdLnNldENlbGxWYWx1ZShDb21tb25NZXRob2QuZ2V0U3RyaW5nKG0sIFwiZGVncmVlXCIpKTsgLy8g5a2m5L2NXG4gICAgICAgICAgICAgICAgY2VsbFs2XS5zZXRDZWxsVmFsdWUoQ29tbW9uTWV0aG9kLmdldFN0cmluZyhtLCBcImdlbmRlclwiKSk7IC8vIOaAp+WIq1xuICAgICAgICAgICAgICAgIGNlbGxbN10uc2V0Q2VsbFZhbHVlKENvbW1vbk1ldGhvZC5nZXRTdHJpbmcobSwgXCJlbWFpbFwiKSk7IC8vIOmCrueusVxuICAgICAgICAgICAgICAgIGNlbGxbOF0uc2V0Q2VsbFZhbHVlKENvbW1vbk1ldGhvZC5nZXRTdHJpbmcobSwgXCJwaG9uZVwiKSk7IC8vIOeUteivnVxuICAgICAgICAgICAgICAgIGNlbGxbOV0uc2V0Q2VsbFZhbHVlKENvbW1vbk1ldGhvZC5nZXRTdHJpbmcobSwgXCJhZGRyZXNzXCIpKTsgLy8g5Zyw5Z2AXG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbi4uLlxuICAgIHB1YmxpYyBEYXRhUmVzcG9uc2UgZ2V0VGVhY2hlclBhZ2VEYXRhKERhdGFSZXF1ZXN0IGRhdGFSZXF1ZXN0KSB7XG4gICAgICAgIFN0cmluZyBudW1OYW1lID0gZGF0YVJlcXVlc3QuZ2V0U3RyaW5nKFwibnVtTmFtZVwiKTtcbiAgICAgICAgSW50ZWdlciBjUGFnZSA9IGRhdGFSZXF1ZXN0LmdldEN1cnJlbnRQYWdlKCk7XG4gICAgICAgIGludCBkYXRhVG90YWwgPSAwO1xuICAgICAgICBpbnQgc2l6ZSA9IDQwO1xuICAgICAgICBMaXN0PE1hcDxTdHJpbmcsT2JqZWN0Pj4gZGF0YUxpc3QgPSBuZXcgQXJyYXlMaXN0PD4oKTtcbiAgICAgICAgUGFnZTxUZWFjaGVyPiBwYWdlID0gbnVsbDtcbiAgICAgICAgUGFnZWFibGUgcGFnZWFibGUgPSBQYWdlUmVxdWVzdC5vZihjUGFnZSwgc2l6ZSk7XG4gICAgICAgIHBhZ2UgPSB0ZWFjaGVyUmVwb3NpdG9yeS5maW5kVGVhY2hlckxpc3RCeU51bU5hbWUobnVtTmFtZSwgcGFnZWFibGUpO1xuICAgICAgICBNYXA8U3RyaW5nLE9iamVjdD4gbTtcbiAgICAgICAgaWYgKHBhZ2UgIT0gbnVsbCkge1xuICAgICAgICAgICAgZGF0YVRvdGFsID0gKGludCkgcGFnZS5nZXRUb3RhbEVsZW1lbnRzKCk7XG4gICAgICAgICAgICBMaXN0PFRlYWNoZXI+IGxpc3QgPSBwYWdlLmdldENvbnRlbnQoKTtcbiAgICAgICAgICAgIGlmICghbGlzdC5pc0VtcHR5KCkpIHtcbiAgICAgICAgICAgICAgICBmb3IgKFRlYWNoZXIgdGVhY2hlciA6IGxpc3QpIHtcbiAgICAgICAgICAgICAgICAgICAgbSA9IGdldE1hcEZyb21UZWFjaGVyKHRlYWNoZXIpO1xuICAgICAgICAgICAgICAgICAgICBkYXRhTGlzdC5hZGQobSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4uLi5cbiAgICBwdWJsaWMgRGF0YVJlc3BvbnNlIGdldEZhbWlseU1lbWJlckxpc3QoRGF0YVJlcXVlc3QgZGF0YVJlcXVlc3QpIHtcbiAgICAgICAgSW50ZWdlciBwZXJzb25JZCA9IGRhdGFSZXF1ZXN0LmdldEludGVnZXIoXCJwZXJzb25JZFwiKTtcbiAgICAgICAgTGlzdDxGYW1pbHlNZW1iZXI+IGZMaXN0ID0gZmFtaWx5TWVtYmVyUmVwb3NpdG9yeS5maW5kQnlUZWFjaGVyUGVyc29uSWQocGVyc29uSWQpO1xuICAgICAgICBMaXN0PE1hcDxTdHJpbmcsT2JqZWN0Pj4gZGF0YUxpc3QgPSBuZXcgQXJyYXlMaXN0PD4oKTtcbiAgICAgICAgTWFwPFN0cmluZyxPYmplY3Q+IG07XG4gICAgICAgIGlmIChmTGlzdCAhPSBudWxsKSB7XG4gICAgICAgICAgICBmb3IgKEZhbWlseU1lbWJlciBmIDogZkxpc3QpIHtcbiAgICAgICAgICAgICAgICBtID0gbmV3IEhhc2hNYXA8PigpO1xuICAgICAgICAgICAgICAgIG0ucHV0KFwibWVtYmVySWRcIiwgZi5nZXRNZW1iZXJJZCgpKTtcbiAgICAgICAgICAgICAgICBtLnB1dChcInBlcnNvbklkXCIsIGYuZ2V0VGVhY2hlcigpLmdldFBlcnNvbklkKCkpO1xuICAgICAgICAgICAgICAgIG0ucHV0KFwicmVsYXRpb25cIiwgZi5nZXRSZWxhdGlvbigpKTtcbiAgICAgICAgICAgICAgICBtLnB1dChcIm5hbWVcIiwgZi5nZXROYW1lKCkpO1xuICAgICAgICAgICAgICAgIG0ucHV0KFwiZ2VuZGVyXCIsIGYuZ2V0R2VuZGVyKCkpO1xuICAgICAgICAgICAgICAgIG0ucHV0KFwiYWdlXCIsIGYuZ2V0QWdlKCkrXCJcIik7XG4gICAgICAgICAgICAgICAgbS5wdXQoXCJ1bml0XCIsIGYuZ2V0VW5pdCgpKTtcbiAgICAgICAgICAgICAgICBkYXRhTGlzdC5hZGQobSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIENvbW1vbk1ldGhvZC5nZXRSZXR1cm5EYXRhKGRhdGFMaXN0KTtcbiAgICB9XG4gICAgcHVibGljIERhdGFSZXNwb25zZSBmYW1pbHlNZW1iZXJTYXZlKERhdGFSZXF1ZXN0IGRhdGFSZXF1ZXN0KSB7XG4gICAgICAgIE1hcDxTdHJpbmcsT2JqZWN0PiBmb3JtID0gZGF0YVJlcXVlc3QuZ2V0TWFwKFwiZm9ybVwiKTtcbiAgICAgICAgSW50ZWdlciBwZXJzb25JZCA9IENvbW1vbk1ldGhvZC5nZXRJbnRlZ2VyKGZvcm0sXCJwZXJzb25JZFwiKTtcbiAgICAgICAgSW50ZWdlciBtZW1iZXJJZCA9IENvbW1vbk1ldGhvZC5nZXRJbnRlZ2VyKGZvcm0sXCJtZW1iZXJJZFwiKTtcbiAgICAgICAgT3B0aW9uYWw8RmFtaWx5TWVtYmVyPiBvcDtcbiAgICAgICAgRmFtaWx5TWVtYmVyIGYgPSBudWxsO1xuICAgICAgICBpZihtZW1iZXJJZCAhPSBudWxsKSB7XG4gICAgICAgICAgICBvcCA9IGZhbWlseU1lbWJlclJlcG9zaXRvcnkuZmluZEJ5SWQobWVtYmVySWQpO1xuICAgICAgICAgICAgaWYob3AuaXNQcmVzZW50KCkpIHtcbiAgICAgICAgICAgICAgICBmID0gb3AuZ2V0KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYoZj09IG51bGwpIHtcbiAgICAgICAgICAgIGYgPSBuZXcgRmFtaWx5TWVtYmVyKCk7XG4gICAgICAgICAgICBhc3NlcnQgcGVyc29uSWQgIT0gbnVsbDtcbiAgICAgICAgICAgIGYuc2V0U3R1ZGVudCh0ZWFjaGVyUmVwb3NpdG9yeS5maW5kQnlJZChwZXJzb25JZCkuZ2V0KCkpO1xuICAgICAgICB9XG4gICAgICAgIGYuc2V0UmVsYXRpb24oQ29tbW9uTWV0aG9kLmdldFN0cmluZyhmb3JtLFwicmVsYXRpb25cIikpO1xuICAgICAgICBmLnNldE5hbWUoQ29tbW9uTWV0aG9kLmdldFN0cmluZyhmb3JtLFwibmFtZVwiKSk7XG4gICAgICAgIGYuc2V0R2VuZGVyKENvbW1vbk1ldGhvZC5nZXRTdHJpbmcoZm9ybSxcImdlbmRlclwiKSk7XG4gICAgICAgIGYuc2V0QWdlKENvbW1vbk1ldGhvZC5nZXRJbnRlZ2VyKGZvcm0sXCJhZ2VcIikpO1xuICAgICAgICBmLnNldFVuaXQoQ29tbW9uTWV0aG9kLmdldFN0cmluZyhmb3JtLFwidW5pdFwiKSk7XG4gICAgICAgIGZhbWlseU1lbWJlclJlcG9zaXRvcnkuc2F2ZShmKTtcbiAgICAgICAgcmV0dXJuIENvbW1vbk1ldGhvZC5nZXRSZXR1cm5NZXNzYWdlT0soKTtcbiAgICB9XG59XG5cbi4uLlxuUGF0aDogc3JjL21haW4vamF2YS9jbi9lZHUvc2R1L2phdmEvc2VydmVyL3NlcnZpY2VzL1N0dWRlbnRTZXJ2aWNlLmphdmFcbi4uLlxuXG4gICAgcHVibGljIERhdGFSZXNwb25zZSBmYW1pbHlNZW1iZXJTYXZlKERhdGFSZXF1ZXN0IGRhdGFSZXF1ZXN0KSB7XG4gICAgICAgIE1hcDxTdHJpbmcsT2JqZWN0PiBmb3JtID0gZGF0YVJlcXVlc3QuZ2V0TWFwKFwiZm9ybVwiKTtcbiAgICAgICAgSW50ZWdlciBwZXJzb25JZCA9IENvbW1vbk1ldGhvZC5nZXRJbnRlZ2VyKGZvcm0sXCJwZXJzb25JZFwiKTtcbiAgICAgICAgSW50ZWdlciBtZW1iZXJJZCA9IENvbW1vbk1ldGhvZC5nZXRJbnRlZ2VyKGZvcm0sXCJtZW1iZXJJZFwiKTtcbiAgICAgICAgT3B0aW9uYWw8RmFtaWx5TWVtYmVyPiBvcDtcbiAgICAgICAgRmFtaWx5TWVtYmVyIGYgPSBudWxsO1xuICAgICAgICBpZihtZW1iZXJJZCAhPSBudWxsKSB7XG4gICAgICAgICAgICBvcCA9IGZhbWlseU1lbWJlclJlcG9zaXRvcnkuZmluZEJ5SWQobWVtYmVySWQpO1xuICAgICAgICAgICAgaWYob3AuaXNQcmVzZW50KCkpIHtcbiAgICAgICAgICAgICAgICBmID0gb3AuZ2V0KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYoZj09IG51bGwpIHtcbiAgICAgICAgICAgIGYgPSBuZXcgRmFtaWx5TWVtYmVyKCk7XG4gICAgICAgICAgICBhc3NlcnQgcGVyc29uSWQgIT0gbnVsbDtcbiAgICAgICAgICAgIGYuc2V0U3R1ZGVudChzdHVkZW50UmVwb3NpdG9yeS5maW5kQnlJZChwZXJzb25JZCkuZ2V0KCkpO1xuICAgICAgICB9XG4gICAgICAgIGYuc2V0UmVsYXRpb24oQ29tbW9uTWV0aG9kLmdldFN0cmluZyhmb3JtLFwicmVsYXRpb25cIikpO1xuICAgICAgICBmLnNldE5hbWUoQ29tbW9uTWV0aG9kLmdldFN0cmluZyhmb3JtLFwibmFtZVwiKSk7XG4gICAgICAgIGYuc2V0R2VuZGVyKENvbW1vbk1ldGhvZC5nZXRTdHJpbmcoZm9ybSxcImdlbmRlclwiKSk7XG4gICAgICAgIGYuc2V0QWdlKENvbW1vbk1ldGhvZC5nZXRJbnRlZ2VyKGZvcm0sXCJhZ2VcIikpO1xuICAgICAgICBmLnNldFVuaXQoQ29tbW9uTWV0aG9kLmdldFN0cmluZyhmb3JtLFwidW5pdFwiKSk7XG4gICAgICAgIGZhbWlseU1lbWJlclJlcG9zaXRvcnkuc2F2ZShmKTtcbiAgICAgICAgcmV0dXJuIENvbW1vbk1ldGhvZC5nZXRSZXR1cm5NZXNzYWdlT0soKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgRGF0YVJlc3BvbnNlIGZhbWlseU1lbWJlckRlbGV0ZShEYXRhUmVxdWVzdCBkYXRhUmVxdWVzdCkge1xuICAgICAgICBJbnRlZ2VyIG1lbWJlcklkID0gZGF0YVJlcXVlc3QuZ2V0SW50ZWdlcihcIm1lbWJlcklkXCIpO1xuICAgICAgICBPcHRpb25hbDxGYW1pbHlNZW1iZXI+IG9wO1xuICAgICAgICBvcCA9IGZhbWlseU1lbWJlclJlcG9zaXRvcnkuZmluZEJ5SWQobWVtYmVySWQpO1xuICAgICAgICBvcC5pZlByZXNlbnQoZmFtaWx5TWVtYmVyUmVwb3NpdG9yeTo6ZGVsZXRlKTtcbiAgICAgICAgcmV0dXJuIENvbW1vbk1ldGhvZC5nZXRSZXR1cm5NZXNzYWdlT0soKTtcbiAgICB9XG4uLi5cblBhdGg6IGphdmEtc2VydmVyL3NyYy9tYWluL2phdmEvY24vZWR1L3NkdS9qYXZhL3NlcnZlci9zZXJ2aWNlcy9UZWFjaGVyU2VydmljZXMuamF2YVxuLi4uXG5pbXBvcnQgb3JnLnNwcmluZ2ZyYW1ld29yay5zdGVyZW90eXBlLlNlcnZpY2U7XG5pbXBvcnQgb3JnLnNwcmluZ2ZyYW1ld29yay53ZWIuc2VydmxldC5tdmMubWV0aG9kLmFubm90YXRpb24uU3RyZWFtaW5nUmVzcG9uc2VCb2R5O1xuXG5pbXBvcnQgamF2YS51dGlsLio7XG5cbkBTZXJ2aWNlXG5wdWJsaWMgY2xhc3MgVGVhY2hlclNlcnZpY2VzIHtcbiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBMb2dnZXIgbG9nID0gTG9nZ2VyRmFjdG9yeS5nZXRMb2dnZXIoVGVhY2hlclNlcnZpY2VzLmNsYXNzKTtcbiAgICBwcml2YXRlIGZpbmFsIFBlcnNvblJlcG9zaXRvcnkgcGVyc29uUmVwb3NpdG9yeTsgIC8v5Lq65ZGY5pWw5o2u5pON5L2c6Ieq5Yqo5rOo5YWlXG4gICAgcHJpdmF0ZSBmaW5hbCBUZWFjaGVyUmVwb3NpdG9yeSB0ZWFjaGVyUmVwb3NpdG9yeTsgIC8v5pWZ5biI5pWw5o2u5pON5L2c6Ieq5Yqo5rOo5YWlXG4gICAgcHJpdmF0ZSBmaW5hbCBVc2VyUmVwb3NpdG9yeSB1c2VyUmVwb3NpdG9yeTsgIC8v5pWw5o2u5pON5L2c6Ieq5Yqo5rOo5YWlXG4gICAgcHJpdmF0ZSBmaW5hbCBVc2VyVHlwZVJlcG9zaXRvcnkgdXNlclR5cGVSZXBvc2l0b3J5OyAvL+eUqOaIt+exu+Wei+aVsOaNruaTjeS9nOiHquWKqOazqOWFpVxuICAgIHByaXZhdGUgZmluYWwgUGFzc3dvcmRFbmNvZGVyIGVuY29kZXI7ICAvL+WvhueggeacjeWKoeiHquWKqOazqOWFpVxuICAgIC8v5raI6LS55pWw5o2u5pON5L2c6Ieq5Yqo5rOo5YWlXG4gICAgcHJpdmF0ZSBmaW5hbCBGYW1pbHlNZW1iZXJSZXBvc2l0b3J5IGZhbWlseU1lbWJlclJlcG9zaXRvcnk7XG4gICAgcHJpdmF0ZSBmaW5hbCBTeXN0ZW1TZXJ2aWNlIHN5c3RlbVNlcnZpY2U7XG5cbiAgICBwdWJsaWMgVGVhY2hlclNlcnZpY2VzKFBlcnNvblJlcG9zaXRvcnkgcGVyc29uUmVwb3NpdG9yeSwgVGVhY2hlclJlcG9zaXRvcnkgdGVhY2hlclJlcG9zaXRvcnksIFVzZXJSZXBvc2l0b3J5IHVzZXJSZXBvc2l0b3J5LCBVc2VyVHlwZVJlcG9zaXRvcnkgdXNlclR5cGVSZXBvc2l0b3J5LCBQYXNzd29yZEVuY29kZXIgZW5jb2RlciwgRmVlUmVwb3NpdG9yeSBmZWVSZXBvc2l0b3J5LCBGYW1pbHlNZW1iZXJSZXBvc2l0b3J5IGZhbWlseU1lbWJlclJlcG9zaXRvcnksIFN5c3RlbVNlcnZpY2Ugc3lzdGVtU2VydmljZSkge1xuICAgICAgICB0aGlzLnBlcnNvblJlcG9zaXRvcnkgPSBwZXJzb25SZXBvc2l0b3J5O1xuICAgICAgICB0aGlzLnRlYWNoZXJSZXBvc2l0b3J5ID0gdGVhY2hlclJlcG9zaXRvcnk7XG4gICAgICAgIHRoaXMudXNlclJlcG9zaXRvcnkgPSB1c2VyUmVwb3NpdG9yeTtcbiAgICAgICAgdGhpcy51c2VyVHlwZVJlcG9zaXRvcnkgPSB1c2VyVHlwZVJlcG9zaXRvcnk7XG4gICAgICAgIHRoaXMuZW5jb2RlciA9IGVuY29kZXI7XG4gICAgICAgIHRoaXMuZmFtaWx5TWVtYmVyUmVwb3NpdG9yeSA9IGZhbWlseU1lbWJlclJlcG9zaXRvcnk7XG4gICAgICAgIHRoaXMuc3lzdGVtU2VydmljZSA9IHN5c3RlbVNlcnZpY2U7XG4gICAgfVxuXG4gICAgcHVibGljIE1hcDxTdHJpbmcsIE9iamVjdD4gZ2V0TWFwRnJvbVRlYWNoZXIoVGVhY2hlciBzKSB7XG4gICAgICAgIE1hcDxTdHJpbmcsIE9iamVjdD4gbSA9IG5ldyBIYXNoTWFwPD4oKTtcbiAgICAgICAgUGVyc29uIHA7XG4gICAgICAgIGlmIChzID09IG51bGwpXG4gICAgICAgICAgICByZXR1cm4gbTtcbiAgICAgICAgbS5wdXQoXCJ0aXRsZVwiLCBzLmdldFRpdGxlKCkpO1xuICAgICAgICBtLnB1dChcImRlZ3JlZVwiLCBzLmdldERlZ3JlZSgpKTtcbiAgICAgICAgbS5wdXQoXCJjbGFzc05hbWVcIiwgcy5nZXRDbGFzc05hbWUoKSk7XG4gICAgICAgIHAgPSBzLmdldFBlcnNvbigpO1xuICAgICAgICBpZiAocCA9PSBudWxsKVxuICAgICAgICAgICAgcmV0dXJuIG07XG4gICAgICAgIG0ucHV0KFwicGVyc29uSWRcIiwgcy5nZXRQZXJzb25JZCgpKTtcbiAgICAgICAgbS5wdXQoXCJudW1cIiwgcC5nZXROdW0oKSk7XG4gICAgICAgIG0ucHV0KFwibmFtZVwiLCBwLmdldE5hbWUoKSk7XG4gICAgICAgIG0ucHV0KFwiZGVwdFwiLCBwLmdldERlcHQoKSk7XG4gICAgICAgIG0ucHV0KFwiY2FyZFwiLCBwLmdldENhcmQoKSk7XG4gICAgICAgIFN0cmluZyBnZW5kZXIgPSBwLmdldEdlbmRlcigpO1xuICAgICAgICBtLnB1dChcImdlbmRlclwiLCBnZW5kZXIpO1xuICAgICAgICBtLnB1dChcImdlbmRlck5hbWVcIiwgQ29tRGF0YVV0aWwuZ2V0SW5zdGFuY2UoKS5nZXREaWN0aW9uYXJ5TGFiZWxCeVZhbHVlKFwiWEJNXCIsIGdlbmRlcikpOyAvL+aAp+WIq+exu+Wei+eahOWAvOi9rOaNouaIkOaVsOaNruexu+Wei+WQjVxuICAgICAgICBtLnB1dChcImJpcnRoZGF5XCIsIHAuZ2V0QmlydGhkYXkoKSk7ICAvL+aXtumXtOagvOW8j+i9rOaNouWtl+espuS4slxuICAgICAgICBtLnB1dChcImVtYWlsXCIsIHAuZ2V0RW1haWwoKSk7XG4gICAgICAgIG0ucHV0KFwicGhvbmVcIiwgcC5nZXRQaG9uZSgpKTtcbiAgICAgICAgbS5wdXQoXCJhZGRyZXNzXCIsIHAuZ2V0QWRkcmVzcygpKTtcbiAgICAgICAgbS5wdXQoXCJpbnRyb2R1Y2VcIiwgcC5nZXRJbnRyb2R1Y2UoKSk7XG4gICAgICAgIHJldHVybiBtO1xuICAgIH1cblxuICAgIHB1YmxpYyBMaXN0PE1hcDxTdHJpbmcsIE9iamVjdD4+IGdldFRlYWNoZXJNYXBMaXN0KFN0cmluZyBudW1OYW1lKSB7XG4gICAgICAgIExpc3Q8TWFwPFN0cmluZywgT2JqZWN0Pj4gZGF0YUxpc3QgPSBuZXcgQXJyYXlMaXN0PD4oKTtcbiAgICAgICAgTGlzdDxUZWFjaGVyPiBzTGlzdCA9IHRlYWNoZXJSZXBvc2l0b3J5LmZpbmRUZWFjaGVyTGlzdEJ5TnVtTmFtZShudW1OYW1lKTsgIC8v5pWw5o2u5bqT5p+l6K+i5pON5L2cXG4gICAgICAgIGlmIChzTGlzdCA9PSBudWxsIHx8IHNMaXN0LmlzRW1wdHkoKSlcbiAgICAgICAgICAgIHJldHVybiBkYXRhTGlzdDtcbiAgICAgICAgZm9yIChUZWFjaGVyIHRlYWNoZXIgOiBzTGlzdCkge1xuICAgICAgICAgICAgZGF0YUxpc3QuYWRkKGdldE1hcEZyb21UZWFjaGVyKHRlYWNoZXIpKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZGF0YUxpc3Q7XG4gICAgfVxuXG4gICAgcHVibGljIERhdGFSZXNwb25zZSBnZXRUZWFjaGVyTGlzdChEYXRhUmVxdWVzdCBkYXRhUmVxdWVzdCkge1xuICAgICAgICBTdHJpbmcgbnVtTmFtZSA9IGRhdGFSZXF1ZXN0LmdldFN0cmluZyhcIm51bU5hbWVcIik7XG4gICAgICAgIExpc3Q8TWFwPFN0cmluZywgT2JqZWN0Pj4gZGF0YUxpc3QgPSBnZXRUZWFjaGVyTWFwTGlzdChudW1OYW1lKTtcbiAgICAgICAgcmV0dXJuIENvbW1vbk1ldGhvZC5nZXRSZXR1cm5EYXRhKGRhdGFMaXN0KTsgIC8v5oyJ54Wn5rWL6K+V5qGG5p626KeE6IyD5Lya6YCBTWFw55qEbGlzdFxuICAgIH1cblxuICAgIHB1YmxpYyBEYXRhUmVzcG9uc2UgdGVhY2hlckRlbGV0ZShEYXRhUmVxdWVzdCBkYXRhUmVxdWVzdCkge1xuICAgICAgICBJbnRlZ2VyIHBlcnNvbklkID0gZGF0YVJlcXVlc3QuZ2V0SW50ZWdlcihcInBlcnNvbklkXCIpOyAgLy/ojrflj5Z0ZWFjaGVyX2lk5YC8XG4gICAgICAgIFRlYWNoZXIgcyA9IG51bGw7XG4gICAgICAgIE9wdGlvbmFsPFRlYWNoZXI+IG9wO1xuICAgICAgICBpZiAocGVyc29uSWQgIT0gbnVsbCAmJiBwZXJzb25JZCA+IDApIHtcbiAgICAgICAgICAgIG9wID0gdGVhY2hlclJlcG9zaXRvcnkuZmluZEJ5SWQocGVyc29uSWQpOyAgIC8v5p+l6K+i6I635b6X5a6e5L2T5a+56LGhXG4gICAgICAgICAgICBpZiAob3AuaXNQcmVzZW50KCkpIHtcbiAgICAgICAgICAgICAgICBzID0gb3AuZ2V0KCk7XG4gICAgICAgICAgICAgICAgT3B0aW9uYWw8VXNlcj4gdU9wID0gdXNlclJlcG9zaXRvcnkuZmluZEJ5SWQocGVyc29uSWQpOyAvL+afpeivouWvueW6lOivpeaVmeW4iOeahOi0puaIt1xuICAgICAgICAgICAgICAgIC8v5Yig6Zmk5a+55bqU6K+l5pWZ5biI55qE6LSm5oi3XG4gICAgICAgICAgICAgICAgdU9wLmlmUHJlc2VudCh1c2VyUmVwb3NpdG9yeTo6ZGVsZXRlKTtcbiAgICAgICAgICAgICAgICBQZXJzb24gcCA9IHMuZ2V0UGVyc29uKCk7XG4gICAgICAgICAgICAgICAgdGVhY2hlclJlcG9zaXRvcnkuZGVsZXRlKHMpOyAgICAvL+mmluWFiOaVsOaNruW6k+awuOS5heWIoOmZpOaVmeW4iOS/oeaBr1xuICAgICAgICAgICAgICAgIHBlcnNvblJlcG9zaXRvcnkuZGVsZXRlKHApO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBDb21tb25NZXRob2QuZ2V0UmV0dXJuTWVzc2FnZU9LKCk7ICAvL+mAmuefpeWJjeerr+aTjeS9nOato+W4uFxuICAgIH1cblxuICAgIHB1YmxpYyBEYXRhUmVzcG9uc2UgZ2V0VGVhY2hlckluZm8oRGF0YVJlcXVlc3QgZGF0YVJlcXVlc3QpIHtcbiAgICAgICAgSW50ZWdlciBwZXJzb25JZCA9IGRhdGFSZXF1ZXN0LmdldEludGVnZXIoXCJwZXJzb25JZFwiKTtcbiAgICAgICAgVGVhY2hlciBzID0gbnVsbDtcbiAgICAgICAgT3B0aW9uYWw8VGVhY2hlcj4gb3A7XG4gICAgICAgIGlmIChwZXJzb25JZCAhPSBudWxsKSB7XG4gICAgICAgICAgICBvcCA9IHRlYWNoZXJSZXBvc2l0b3J5LmZpbmRCeUlkKHBlcnNvbklkKTsgLy/moLnmja7lrabnlJ/kuLvplK7ku47mlbDmja7lupPmn6Xor6LlrabnlJ/nmoTkv6Hmga9cbiAgICAgICAgICAgIGlmIChvcC5pc1ByZXNlbnQoKSkge1xuICAgICAgICAgICAgICAgIHMgPSBvcC5nZXQoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gQ29tbW9uTWV0aG9kLmdldFJldHVybkRhdGEoZ2V0TWFwRnJvbVRlYWNoZXIocykpOyAvL+i/memHjOWbnuS8oOWMheWQq+WtpueUn+S/oeaBr+eahE1hcOWvueixoVxuICAgIH1cblxuICAgIHB1YmxpYyBEYXRhUmVzcG9uc2UgdGVhY2hlckVkaXRTYXZlKERhdGFSZXF1ZXN0IGRhdGFSZXF1ZXN0KSB7XG4gICAgICAgIEludGVnZXIgcGVyc29uSWQgPSBkYXRhUmVxdWVzdC5nZXRJbnRlZ2VyKFwicGVyc29uSWRcIik7XG4gICAgICAgIE1hcDxTdHJpbmcsIE9iamVjdD4gZm9ybSA9IGRhdGFSZXF1ZXN0LmdldE1hcChcImZvcm1cIik7IC8v5Y+C5pWw6I635Y+WTWFw5a+56LGhXG4gICAgICAgIFN0cmluZyBudW0gPSBDb21tb25NZXRob2QuZ2V0U3RyaW5nKGZvcm0sIFwibnVtXCIpOyAgLy9NYXAg6I635Y+W5bGe5oCn55qE5YC8XG4gICAgICAgIFRlYWNoZXIgcyA9IG51bGw7XG4gICAgICAgIFBlcnNvbiBwO1xuICAgICAgICBVc2VyIHU7XG4gICAgICAgIE9wdGlvbmFsPFRlYWNoZXI+IG9wO1xuICAgICAgICBib29sZWFuIGlzTmV3ID0gZmFsc2U7XG4gICAgICAgIGlmIChwZXJzb25JZCAhPSBudWxsKSB7XG4gICAgICAgICAgICBvcCA9IHRlYWNoZXJSZXBvc2l0b3J5LmZpbmRCeUlkKHBlcnNvbklkKTsgIC8v5p+l6K+i5a+55bqU5pWw5o2u5bqT5Lit5Li76ZSu5Li6aWTnmoTlgLznmoTlrp7kvZPlr7nosaFcbiAgICAgICAgICAgIGlmIChvcC5pc1ByZXNlbnQoKSkge1xuICAgICAgICAgICAgICAgIHMgPSBvcC5nZXQoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBPcHRpb25hbDxQZXJzb24+IG5PcCA9IHBlcnNvblJlcG9zaXRvcnkuZmluZEJ5TnVtKG51bSk7IC8v5p+l6K+i5piv5ZCm5a2Y5ZyobnVt55qE5Lq65ZGYXG4gICAgICAgIGlmIChuT3AuaXNQcmVzZW50KCkpIHtcbiAgICAgICAgICAgIGlmIChzID09IG51bGwgfHwgIXMuZ2V0UGVyc29uKCkuZ2V0TnVtKCkuZXF1YWxzKG51bSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gQ29tbW9uTWV0aG9kLmdldFJldHVybk1lc3NhZ2VFcnJvcihcIuaWsOW3peWPt+W3sue7j+WtmOWcqO+8jOS4jeiDvea3u+WKoOaIluS/ruaUue+8gVwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAocyA9PSBudWxsKSB7XG4gICAgICAgICAgICBwID0gbmV3IFBlcnNvbigpO1xuICAgICAgICAgICAgcC5zZXROdW0obnVtKTtcbiAgICAgICAgICAgIHAuc2V0VHlwZShcIjJcIik7ICAvLyAy6KGo56S65pWZ5biI57G75Z6LXG4gICAgICAgICAgICBwZXJzb25SZXBvc2l0b3J5LnNhdmVBbmRGbHVzaChwKTsgIC8v5o+S5YWl5paw55qEUGVyc29u6K6w5b2VXG4gICAgICAgICAgICBwZXJzb25JZCA9IHAuZ2V0UGVyc29uSWQoKTtcbiAgICAgICAgICAgIFN0cmluZyBwYXNzd29yZCA9IGVuY29kZXIuZW5jb2RlKFwiMTIzNDU2XCIpO1xuICAgICAgICAgICAgdSA9IG5ldyBVc2VyKCk7XG4gICAgICAgICAgICB1LnNldFBlcnNvbklkKHBlcnNvbklkKTtcbiAgICAgICAgICAgIHUuc2V0VXNlck5hbWUobnVtKTtcbiAgICAgICAgICAgIHUuc2V0UGFzc3dvcmQocGFzc3dvcmQpO1xuICAgICAgICAgICAgdS5zZXRVc2VyVHlwZSh1c2VyVHlwZVJlcG9zaXRvcnkuZmluZEJ5TmFtZShFVXNlclR5cGUuUk9MRV9URUFDSEVSKSk7ICAvLyDorr7nva7kuLrmlZnluIjop5LoibJcbiAgICAgICAgICAgIHUuc2V0Q3JlYXRlVGltZShEYXRlVGltZVRvb2wucGFyc2VEYXRlVGltZShuZXcgRGF0ZSgpKSk7XG4gICAgICAgICAgICB1LnNldENyZWF0b3JJZChDb21tb25NZXRob2QuZ2V0UGVyc29uSWQoKSk7XG4gICAgICAgICAgICB1c2VyUmVwb3NpdG9yeS5zYXZlQW5kRmx1c2godSk7IC8v5o+S5YWl5paw55qEVXNlcuiusOW9lVxuICAgICAgICAgICAgcyA9IG5ldyBUZWFjaGVyKCk7ICAgLy8g5Yib5bu65a6e5L2T5a+56LGhXG4gICAgICAgICAgICBzLnNldFBlcnNvbklkKHBlcnNvbklkKTtcbiAgICAgICAgICAgIHRlYWNoZXJSZXBvc2l0b3J5LnNhdmVBbmRGbHVzaChzKTsgIC8v5o+S5YWl5paw55qEVGVhY2hlcuiusOW9lVxuICAgICAgICAgICAgaXNOZXcgPSB0cnVlO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcCA9IHMuZ2V0UGVyc29uKCk7XG4gICAgICAgIH1cbiAgICAgICAgcGVyc29uSWQgPSBwLmdldFBlcnNvbklkKCk7XG4gICAgICAgIGlmICghbnVtLmVxdWFscyhwLmdldE51bSgpKSkgeyAgIC8v5aaC5p6c5Lq65ZGY57yW5Y+35Y+Y5YyW77yM5L+u5pS55Lq65ZGY57yW5Y+35ZKM55m75b2V6LSm5Y+3XG4gICAgICAgICAgICBPcHRpb25hbDxVc2VyPiB1T3AgPSB1c2VyUmVwb3NpdG9yeS5maW5kQnlQZXJzb25QZXJzb25JZChwZXJzb25JZCk7XG4gICAgICAgICAgICBpZiAodU9wLmlzUHJlc2VudCgpKSB7XG4gICAgICAgICAgICAgICAgdSA9IHVPcC5nZXQoKTtcbiAgICAgICAgICAgICAgICB1LnNldFVzZXJOYW1lKG51bSk7XG4gICAgICAgICAgICAgICAgdXNlclJlcG9zaXRvcnkuc2F2ZUFuZEZsdXNoKHUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcC5zZXROdW0obnVtKTsgIC8v6K6+572u5bGe5oCnXG4gICAgICAgIH1cbiAgICAgICAgcC5zZXROYW1lKENvbW1vbk1ldGhvZC5nZXRTdHJpbmcoZm9ybSwgXCJuYW1lXCIpKTtcbiAgICAgICAgcC5zZXREZXB0KENvbW1vbk1ldGhvZC5nZXRTdHJpbmcoZm9ybSwgXCJkZXB0XCIpKTtcbiAgICAgICAgcC5zZXRDYXJkKENvbW1vbk1ldGhvZC5nZXRTdHJpbmcoZm9ybSwgXCJjYXJkXCIpKTtcbiAgICAgICAgcC5zZXRHZW5kZXIoQ29tbW9uTWV0aG9kLmdldFN0cmluZyhmb3JtLCBcImdlbmRlclwiKSk7XG4gICAgICAgIHAuc2V0QmlydGhkYXkoQ29tbW9uTWV0aG9kLmdldFN0cmluZyhmb3JtLCBcImJpcnRoZGF5XCIpKTtcbiAgICAgICAgcC5zZXRFbWFpbChDb21tb25NZXRob2QuZ2V0U3RyaW5nKGZvcm0sIFwiZW1haWxcIikpO1xuICAgICAgICBwLnNldFBob25lKENvbW1vbk1ldGhvZC5nZXRTdHJpbmcoZm9ybSwgXCJwaG9uZVwiKSk7XG4gICAgICAgIHAuc2V0QWRkcmVzcyhDb21tb25NZXRob2QuZ2V0U3RyaW5nKGZvcm0sIFwiYWRkcmVzc1wiKSk7XG4gICAgICAgIHBlcnNvblJlcG9zaXRvcnkuc2F2ZShwKTsgIC8vIOS/ruaUueS/neWtmOS6uuWRmOS/oeaBr1xuICAgICAgICBzLnNldENsYXNzTmFtZShDb21tb25NZXRob2QuZ2V0U3RyaW5nKGZvcm0sIFwiY2xhc3NOYW1lXCIpKTtcbiAgICAgICAgdGVhY2hlclJlcG9zaXRvcnkuc2F2ZShzKTsgIC8v5L+u5pS55L+d5a2Y5a2m55Sf5L+h5oGvXG4gICAgICAgIHN5c3RlbVNlcnZpY2UubW9kaWZ5TG9nKHMsIGlzTmV3KTtcbiAgICAgICAgcmV0dXJuIENvbW1vbk1ldGhvZC5nZXRSZXR1cm5EYXRhKHMuZ2V0UGVyc29uSWQoKSk7ICAvLyDlsIZwZXJzb25JZOi/lOWbnuWJjeerr1xuICAgIH1cbi4uLlxuXG4gICAgICAgICAgICAgICAgLy8g5aGr5YWF5YW35L2T5pWw5o2uXG4gICAgICAgICAgICAgICAgY2VsbFswXS5zZXRDZWxsVmFsdWUoKGkgKyAxKSArIFwiXCIpOyAvLyDluo/lj7dcbiAgICAgICAgICAgICAgICBjZWxsWzFdLnNldENlbGxWYWx1ZShDb21tb25NZXRob2QuZ2V0U3RyaW5nKG0sIFwibnVtXCIpKTsgLy8g5bel5Y+3XG4gICAgICAgICAgICAgICAgY2VsbFsyXS5zZXRDZWxsVmFsdWUoQ29tbW9uTWV0aG9kLmdldFN0cmluZyhtLCBcIm5hbWVcIikpOyAvLyDlp5PlkI1cbiAgICAgICAgICAgICAgICBjZWxsWzNdLnNldENlbGxWYWx1ZShDb21tb25NZXRob2QuZ2V0U3RyaW5nKG0sIFwiZGVwdFwiKSk7IC8vIOWtpumZolxuICAgICAgICAgICAgICAgIGNlbGxbNF0uc2V0Q2VsbFZhbHVlKENvbW1vbk1ldGhvZC5nZXRTdHJpbmcobSwgXCJ0aXRsZVwiKSk7IC8vIOiBjOensFxuICAgICAgICAgICAgICAgIGNlbGxbNV0uc2V0Q2VsbFZhbHVlKENvbW1vbk1ldGhvZC5nZXRTdHJpbmcobSwgXCJkZWdyZWVcIikpOyAvLyDlrabkvY1cbiAgICAgICAgICAgICAgICBjZWxsWzZdLnNldENlbGxWYWx1ZShDb21tb25NZXRob2QuZ2V0U3RyaW5nKG0sIFwiZ2VuZGVyTmFtZVwiKSk7IC8vIOaAp+WIq1xuICAgICAgICAgICAgICAgIGNlbGxbN10uc2V0Q2VsbFZhbHVlKENvbW1vbk1ldGhvZC5nZXRTdHJpbmcobSwgXCJlbWFpbFwiKSk7IC8vIOmCrueusVxuICAgICAgICAgICAgICAgIGNlbGxbOF0uc2V0Q2VsbFZhbHVlKENvbW1vbk1ldGhvZC5nZXRTdHJpbmcobSwgXCJwaG9uZVwiKSk7IC8vIOeUteivnVxuICAgICAgICAgICAgICAgIGNlbGxbOV0uc2V0Q2VsbFZhbHVlKENvbS4uLiIsImlzRXJyb3IiOmZhbHNlLCJyZXF1ZXN0SWQiOiIifX0sIjM2NDE0YzhlLTdjYzMtNDUzOS1hZWI0LWEwYTFlMmZhMTY1OTt0b29sdV92cnR4XzAxUUZOSExLellRWGVicWFEd25mMW5pVCI6eyJyZXF1ZXN0SWQiOiIzNjQxNGM4ZS03Y2MzLTQ1MzktYWViNC1hMGExZTJmYTE2NTkiLCJ0b29sVXNlSWQiOiJ0b29sdV92cnR4XzAxUUZOSExLellRWGVicWFEd25mMW5pVCIsInBoYXNlIjo1LCJyZXN1bHQiOnsidGV4dCI6IkZpbGUgc2F2ZWQgc3VjY2Vzc2Z1bGx5LiIsImlzRXJyb3IiOmZhbHNlLCJyZXF1ZXN0SWQiOiIifX19LCJkcmFmdEV4Y2hhbmdlIjp7InJlcXVlc3RfbWVzc2FnZSI6IiIsInJpY2hfdGV4dF9qc29uX3JlcHIiOnsidHlwZSI6ImRvYyIsImNvbnRlbnQiOlt7InR5cGUiOiJwYXJhZ3JhcGgifV19LCJtZW50aW9uZWRfaXRlbXMiOltdLCJzdGF0dXMiOiJkcmFmdCJ9LCJyZXF1ZXN0SWRzIjpbXSwiaXNQaW5uZWQiOmZhbHNlLCJpc1NoYXJlYWJsZSI6dHJ1ZSwiZXh0cmFEYXRhIjp7ImlzQWdlbnRDb252ZXJzYXRpb24iOnRydWUsImhhc0FnZW50T25ib2FyZGVkIjp0cnVlLCJoYXNEaXJ0eUVkaXRzIjpmYWxzZX0sInBlcnNvbmFUeXBlIjowfX0sImFnZW50RXhlY3V0aW9uTW9kZSI6Im1hbnVhbCIsImlzQWdlbnRFZGl0c0NvbGxhcHNlZCI6dHJ1ZSwiaXNDb250ZXh0UGFuZU9wZW4iOmZhbHNlLCJpc0FjdGlvbnNQYW5lT3BlbiI6ZmFsc2UsInNvcnRDb252ZXJzYXRpb25zQnkiOiJsYXN0TWVzc2FnZVRpbWVzdGFtcCJ9" />
      </map>
    </option>
  </component>
</project>